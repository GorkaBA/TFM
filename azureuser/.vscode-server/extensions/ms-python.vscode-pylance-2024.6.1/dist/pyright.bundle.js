"use strict";exports.id=80,exports.ids=[80],exports.modules={6468:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.analyzeProgram=t.nullCallback=void 0;const i=n(64704),o=s(n(83181)),l=n(6216);t.nullCallback=()=>{},t.analyzeProgram=function(e,n,a,r,s,p){let c=!1;r=null!=r?r:t.nullCallback;try{(0,i.throwIfCancellationRequested)(p);const t=new l.Duration;c=e.analyze(n,p);const s=e.getFilesToAnalyzeCount(),o=void 0!==n,d=e.getDiagnostics(a,o),u=d.length,m=t.getDurationInSeconds();(u>0||!c)&&r({diagnostics:d,filesInProgram:e.getFileCount(),requiringAnalysisCount:s,checkingOnlyOpenFiles:e.isCheckingOnlyOpenFiles(),fatalErrorOccurred:!1,configParseErrorOccurred:!1,elapsedTime:m})}catch(e){if(i.OperationCanceledException.is(e))return!1;const t=o.getErrorString(e);s.error("Error performing analysis: "+t),r({diagnostics:[],filesInProgram:0,requiringAnalysisCount:{files:0,cells:0},checkingOnlyOpenFiles:!0,fatalErrorOccurred:!0,configParseErrorOccurred:!1,elapsedTime:0,error:o.getSerializableError(e)})}return c}},35964:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAnnotationEvaluationPostponed=void 0;const a=n(61328);t.isAnnotationEvaluationPostponed=function(e){return!!e.isStubFile||(!!e.futureImports.has("annotations")||!!e.executionEnvironment.pythonVersion.isGreaterOrEqualTo(a.pythonVersion3_14))}},9316:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCodeUnreachable=t.setDunderAllInfo=t.getDunderAllInfo=t.setCodeFlowComplexity=t.getCodeFlowComplexity=t.setCodeFlowExpressions=t.getCodeFlowExpressions=t.setFileInfo=t.getFileInfo=t.setAfterFlowNode=t.getAfterFlowNode=t.setFlowNode=t.getFlowNode=t.setDeclaration=t.getDeclaration=t.setScope=t.getScope=t.setImportInfo=t.getImportInfo=t.cleanNodeAnalysisInfo=void 0;const a=n(31508);function r(e){return e.flowNode}t.cleanNodeAnalysisInfo=function(e){const t=e;delete t.scope,delete t.declaration,delete t.flowNode,delete t.afterFlowNode,delete t.fileInfo,delete t.codeFlowExpressions,delete t.codeFlowComplexity,delete t.dunderAllInfo,delete t.typeParameterSymbol},t.getImportInfo=function(e){return e.importInfo},t.setImportInfo=function(e,t){e.importInfo=t},t.getScope=function(e){return e.scope},t.setScope=function(e,t){e.scope=t},t.getDeclaration=function(e){return e.declaration},t.setDeclaration=function(e,t){e.declaration=t},t.getFlowNode=r,t.setFlowNode=function(e,t){e.flowNode=t},t.getAfterFlowNode=function(e){return e.afterFlowNode},t.setAfterFlowNode=function(e,t){e.afterFlowNode=t},t.getFileInfo=function(e){for(;36!==e.nodeType;)e=e.parent;return e.fileInfo},t.setFileInfo=function(e,t){e.fileInfo=t},t.getCodeFlowExpressions=function(e){return e.codeFlowExpressions},t.setCodeFlowExpressions=function(e,t){e.codeFlowExpressions=t},t.getCodeFlowComplexity=function(e){var t;return null!==(t=e.codeFlowComplexity)&&void 0!==t?t:0},t.setCodeFlowComplexity=function(e,t){e.codeFlowComplexity=t},t.getDunderAllInfo=function(e){return e.dunderAllInfo},t.setDunderAllInfo=function(e,t){e.dunderAllInfo=t},t.isCodeUnreachable=function(e){let t=e;for(;t;){const e=r(t);if(e)return!!(e.flags&a.FlowFlags.Unreachable);t=t.parent}return!1}},95156:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundAnalysisProgram=t.InvalidatedReason=void 0,n(58484);const a=n(6468),r=n(4732);var s;!function(e){e[e.Reanalyzed=0]="Reanalyzed",e[e.SourceWatcherChanged=1]="SourceWatcherChanged",e[e.LibraryWatcherChanged=2]="LibraryWatcherChanged",e[e.LibraryWatcherContentOnlyChanged=3]="LibraryWatcherContentOnlyChanged"}(s||(t.InvalidatedReason=s={}));t.BackgroundAnalysisProgram=class{constructor(e,t,n,a,s,i,o){this.serviceId=e,this._serviceProvider=t,this._configOptions=n,this._importResolver=a,this._backgroundAnalysis=s,this._maxAnalysisTime=i,this._disableChecker=o,this._disposed=!1,this._program=new r.Program(this.importResolver,this.configOptions,this._serviceProvider,void 0,this._disableChecker,e)}get configOptions(){return this._configOptions}get importResolver(){return this._importResolver}get program(){return this._program}get host(){return this._importResolver.host}get backgroundAnalysis(){return this._backgroundAnalysis}hasSourceFile(e){return!!this._program.getSourceFile(e)}setConfigOptions(e){var t;this._configOptions=e,null===(t=this._backgroundAnalysis)||void 0===t||t.setConfigOptions(e),this._program.setConfigOptions(e)}setImportResolver(e){var t;this._importResolver=e,null===(t=this._backgroundAnalysis)||void 0===t||t.setImportResolver(e),this._program.setImportResolver(e),this.configOptions.getExecutionEnvironments().forEach((e=>this._ensurePartialStubPackages(e)))}setTrackedFiles(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.setTrackedFiles(e);const n=this._program.setTrackedFiles(e);this._reportDiagnosticsForRemovedFiles(n)}setAllowedThirdPartyImports(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.setAllowedThirdPartyImports(e),this._program.setAllowedThirdPartyImports(e)}setFileOpened(e,t,n,a){var r;null===(r=this._backgroundAnalysis)||void 0===r||r.setFileOpened(e,t,n,a),this._program.setFileOpened(e,t,n,a)}getChainedUri(e){return this._program.getChainedUri(e)}updateChainedUri(e,t){var n;null===(n=this._backgroundAnalysis)||void 0===n||n.updateChainedUri(e,t),this._program.updateChainedUri(e,t)}updateOpenFileContents(e,t,n,a){var r;null===(r=this._backgroundAnalysis)||void 0===r||r.setFileOpened(e,t,n,a),this._program.setFileOpened(e,t,n,a),this.markFilesDirty([e],!0)}setFileClosed(e,t){var n;null===(n=this._backgroundAnalysis)||void 0===n||n.setFileClosed(e,t);const a=this._program.setFileClosed(e,t);this._reportDiagnosticsForRemovedFiles(a)}addInterimFile(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.addInterimFile(e),this._program.addInterimFile(e)}markAllFilesDirty(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.markAllFilesDirty(e),this._program.markAllFilesDirty(e)}markFilesDirty(e,t){var n;null===(n=this._backgroundAnalysis)||void 0===n||n.markFilesDirty(e,t),this._program.markFilesDirty(e,t)}setCompletionCallback(e){var t;this._onAnalysisCompletion=e,null===(t=this._backgroundAnalysis)||void 0===t||t.setCompletionCallback(e)}startAnalysis(e){return this._backgroundAnalysis?(this._backgroundAnalysis.startAnalysis(this,e),!1):(0,a.analyzeProgram)(this._program,this._maxAnalysisTime,this._configOptions,this._onAnalysisCompletion,this._serviceProvider.console(),e)}async analyzeFile(e,t){return this._backgroundAnalysis?this._backgroundAnalysis.analyzeFile(e,t):this._program.analyzeFile(e,t)}libraryUpdated(){return!1}async getDiagnosticsForRange(e,t,n){return this._backgroundAnalysis?this._backgroundAnalysis.getDiagnosticsForRange(e,t,n):this._program.getDiagnosticsForRange(e,t)}async writeTypeStub(e,t,n,r){return this._backgroundAnalysis?this._backgroundAnalysis.writeTypeStub(e,t,n,r):((0,a.analyzeProgram)(this._program,void 0,this._configOptions,this._onAnalysisCompletion,this._serviceProvider.console(),r),this._program.writeTypeStub(e,t,n,r))}invalidateAndForceReanalysis(e){var t;null===(t=this._backgroundAnalysis)||void 0===t||t.invalidateAndForceReanalysis(e),this._importResolver.invalidateCache(),this._program.markAllFilesDirty(!0)}restart(){var e;null===(e=this._backgroundAnalysis)||void 0===e||e.restart()}dispose(){var e;this._disposed||(this._disposed=!0,this._program.dispose(),null===(e=this._backgroundAnalysis)||void 0===e||e.shutdown())}enterEditMode(){this._preEditAnalysis=this._backgroundAnalysis,this._backgroundAnalysis=void 0,this._program.enterEditMode()}exitEditMode(){return this._backgroundAnalysis=this._preEditAnalysis,this._preEditAnalysis=void 0,this._program.exitEditMode()}_ensurePartialStubPackages(e){var t,n;return null===(t=this._backgroundAnalysis)||void 0===t||t.ensurePartialStubPackages(null===(n=e.root)||void 0===n?void 0:n.toString()),this._importResolver.ensurePartialStubPackages(e)}_reportDiagnosticsForRemovedFiles(e){0!==e.length&&!this._backgroundAnalysis&&this._onAnalysisCompletion&&this._onAnalysisCompletion({diagnostics:e,filesInProgram:this._program.getFileCount(),requiringAnalysisCount:this._program.getFilesToAnalyzeCount(),checkingOnlyOpenFiles:this._program.isCheckingOnlyOpenFiles(),fatalErrorOccurred:!1,configParseErrorOccurred:!1,elapsedTime:0})}}},4868:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.DummyScopeGenerator=t.ReturnFinder=t.YieldFinder=t.Binder=void 0;const i=n(28040),o=n(83181),l=n(97652),p=n(11699),c=n(96193),d=n(55164),u=n(55084),m=n(95960),y=s(n(9316)),g=n(31508),h=n(65392),f=n(99216),T=s(n(28340)),v=n(78232),b=n(32700),_=s(n(21084)),C=n(52328),I=n(80944);class k extends v.ParseTreeWalker{constructor(e,t=!1){super(),this._moduleSymbolOnly=t,this._deferredBindingTasks=[],this._currentExceptTargets=[],this._finallyTargets=[],this._typingImportAliases=[],this._sysImportAliases=[],this._dataclassesImportAliases=[],this._typingSymbolAliases=new Map,this._dataclassesSymbolAliases=new Map,this._dunderAllStringNodes=[],this._usesUnsupportedDunderAllForm=!1,this._isInExceptSuite=!1,this._isInAnnotatedAnnotation=!1,this._potentialHiddenSymbols=new Map,this._potentialPrivateSymbols=new Map,this._codeFlowComplexity=0,this._fileInfo=e}bindModule(e){var t;const n=void 0===this._fileInfo.builtinsScope;this._createNewScope(n?5:4,this._fileInfo.builtinsScope,void 0,(()=>{y.setScope(e,this._currentScope),y.setFlowNode(e,this._currentFlowNode),this._addImplicitSymbolToCurrentScope("__name__",e,"str"),this._addImplicitSymbolToCurrentScope("__loader__",e,"Any"),this._addImplicitSymbolToCurrentScope("__package__",e,"str | None"),this._addImplicitSymbolToCurrentScope("__spec__",e,"Any"),this._addImplicitSymbolToCurrentScope("__path__",e,"Iterable[str]"),this._addImplicitSymbolToCurrentScope("__file__",e,"str"),this._addImplicitSymbolToCurrentScope("__cached__",e,"str"),this._addImplicitSymbolToCurrentScope("__dict__",e,"Dict[str, Any]"),this._addImplicitSymbolToCurrentScope("__annotations__",e,"Dict[str, Any]"),this._addImplicitSymbolToCurrentScope("__builtins__",e,"Any");const t=T.getDocString(e.statements);this._addImplicitSymbolToCurrentScope("__doc__",e,!this._fileInfo.isStubFile&&t?"str":"str | None"),this._currentFlowNode=this._createStartFlowNode(),this._walkStatementsAndReportUnreachable(e.statements),y.setAfterFlowNode(e,this._currentFlowNode),y.setCodeFlowExpressions(e,this._currentScopeCodeFlowExpressions),y.setCodeFlowComplexity(e,this._codeFlowComplexity)})),this._bindDeferred(),this._potentialHiddenSymbols.forEach(((e,t)=>{var n;(null===(n=this._dunderAllNames)||void 0===n?void 0:n.some((e=>e===t)))||(this._fileInfo.isStubFile?e.setIsExternallyHidden():e.setPrivatePyTypedImport())})),this._potentialPrivateSymbols.forEach(((e,t)=>{var n;(null===(n=this._dunderAllNames)||void 0===n?void 0:n.some((e=>e===t)))||e.setIsPrivateMember()})),this._dunderAllNames?y.setDunderAllInfo(e,{names:this._dunderAllNames,stringNodes:this._dunderAllStringNodes,usesUnsupportedDunderAllForm:this._usesUnsupportedDunderAllForm}):y.setDunderAllInfo(e,void 0);const a=y.getScope(e);if(a&&this._dunderAllNames)for(const e of this._dunderAllNames)null===(t=a.symbolTable.get(e))||void 0===t||t.setIsInDunderAll()}visitModule(e){return(0,o.fail)("We should never get here"),!1}visitSuite(e){return this._walkStatementsAndReportUnreachable(e.statements),!1}visitModuleName(e){const t=y.getImportInfo(e);if((0,o.assert)(void 0!==t),t.isNativeLib)return!0;if(!t.isImportFound)return this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingImports,l.DiagnosticRule.reportMissingImports,m.LocMessage.importResolveFailure().format({importName:t.importName,venv:this._fileInfo.executionEnvironment.name}),e),!0;if(!t.isStubFile&&1===t.importType&&!t.pyTypedInfo){const n=this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportMissingTypeStubs,l.DiagnosticRule.reportMissingTypeStubs,m.LocMessage.stubFileMissing().format({importName:t.importName}),e);if(n){const e={action:"pyright.createtypestub",moduleName:t.importName};n.addAction(e)}}return!0}visitClass(e){this.walkMultiple(e.decorators);const t={type:6,node:e,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},n=this._bindNameToScope(this._currentScope,e.name);let a;return n&&n.addDeclaration(t),y.setDeclaration(e,t),e.typeParameters&&(this.walk(e.typeParameters),a=y.getScope(e.typeParameters)),this.walkMultiple(e.arguments),this._createNewScope(3,null!=a?a:this._getNonClassParentScope(),void 0,(()=>{y.setScope(e,this._currentScope),this._addImplicitSymbolToCurrentScope("__doc__",e,"str | None"),this._addImplicitSymbolToCurrentScope("__module__",e,"str"),this._addImplicitSymbolToCurrentScope("__qualname__",e,"str"),this._dunderSlotsEntries=void 0,this._moduleSymbolOnly||this.walk(e.suite),this._dunderSlotsEntries&&this._addSlotsToCurrentScope(this._dunderSlotsEntries),this._dunderSlotsEntries=void 0})),this._createAssignmentTargetFlowNodes(e.name,!1,!1),!1}visitFunction(e){this._createVariableAnnotationFlowNode(),y.setFlowNode(e,this._currentFlowNode);const t=this._bindNameToScope(this._currentScope,e.name),n=T.getEnclosingClass(e,!0),a={type:5,node:e,isMethod:!!n,isGenerator:!1,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};let r;return t&&t.addDeclaration(a),y.setDeclaration(e,a),e.parameters.forEach((e=>{e.defaultValue&&this.walk(e.defaultValue)})),e.typeParameters&&(this.walk(e.typeParameters),r=y.getScope(e.typeParameters)),this.walkMultiple(e.decorators),e.parameters.forEach((e=>{e.typeAnnotation&&this.walk(e.typeAnnotation),e.typeAnnotationComment&&this.walk(e.typeAnnotationComment)})),e.returnTypeAnnotation&&this.walk(e.returnTypeAnnotation),e.functionAnnotationComment&&this.walk(e.functionAnnotationComment),this._createNewScope(2,null!=r?r:this._getNonClassParentScope(),void 0,(()=>{y.setScope(e,this._currentScope);T.getEnclosingClass(e)&&this._addImplicitSymbolToCurrentScope("__class__",e,"class"),this._deferBinding((()=>{this._currentFlowNode=this._createStartFlowNode(),this._codeFlowComplexity=0,e.parameters.forEach((t=>{var n,a;if(t.name){const r=this._bindNameToScope(this._currentScope,t.name);let s=T.getDocString(null!==(a=null===(n=null==e?void 0:e.suite)||void 0===n?void 0:n.statements)&&void 0!==a?a:[]);if(void 0!==s&&(s=(0,f.extractParameterDocumentation)(s,t.name.value)),r){const e={type:2,node:t,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(t,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:s};r.addDeclaration(e),y.setDeclaration(t.name,e)}this._createFlowAssignment(t.name)}})),this._targetFunctionDeclaration=a,this._currentReturnTarget=this._createBranchLabel(),this.walk(e.suite),this._targetFunctionDeclaration=void 0,y.setAfterFlowNode(e.suite,this._currentFlowNode),this._addAntecedent(this._currentReturnTarget,this._currentFlowNode);const t=this._finishFlowLabel(this._currentReturnTarget);y.setAfterFlowNode(e,t),y.setCodeFlowExpressions(e,this._currentScopeCodeFlowExpressions),y.setCodeFlowComplexity(e,this._codeFlowComplexity)}))})),this._createAssignmentTargetFlowNodes(e.name,!1,!1),!1}visitLambda(e){return this._createVariableAnnotationFlowNode(),y.setFlowNode(e,this._currentFlowNode),e.parameters.forEach((e=>{e.defaultValue&&this.walk(e.defaultValue)})),this._createNewScope(2,this._getNonClassParentScope(),void 0,(()=>{y.setScope(e,this._currentScope),this._deferBinding((()=>{this._currentFlowNode=this._createStartFlowNode(),e.parameters.forEach((e=>{if(e.name){const t=this._bindNameToScope(this._currentScope,e.name);if(t){const n={type:2,node:e,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};t.addDeclaration(n),y.setDeclaration(e.name,n)}this._createFlowAssignment(e.name),this.walk(e.name),y.setFlowNode(e,this._currentFlowNode)}})),this.walk(e.expression),y.setCodeFlowExpressions(e,this._currentScopeCodeFlowExpressions)}))})),!1}visitCall(e){var t,n;if(this._disableTrueFalseTargets((()=>{this.walk(e.leftExpression);T.getArgumentsByRuntimeOrder(e).forEach((e=>{this._currentFlowNode&&y.setFlowNode(e,this._currentFlowNode),this.walk(e)}))})),T.isNodeContainedWithinNodeType(e,13)||this._isInAnnotatedAnnotation||this._createCallFlowNode(e),4===this._currentScope.type&&35===e.leftExpression.nodeType&&38===e.leftExpression.leftExpression.nodeType&&"__all__"===e.leftExpression.leftExpression.value){let a=!0;if("extend"===e.leftExpression.memberName.value&&1===e.arguments.length){const t=e.arguments[0].valueExpression;if(31===t.nodeType)t.entries.forEach((e=>{var t,n;48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType&&(null===(t=this._dunderAllNames)||void 0===t||t.push(e.strings[0].value),null===(n=this._dunderAllStringNodes)||void 0===n||n.push(e.strings[0]),a=!1)}));else if(35===t.nodeType&&38===t.leftExpression.nodeType&&"__all__"===t.memberName.value){const e=this._getDunderAllNamesFromImport(t.leftExpression.value);e&&e.length>0&&(e.forEach((e=>{var t;null===(t=this._dunderAllNames)||void 0===t||t.push(e)})),a=!1)}}else if("remove"===e.leftExpression.memberName.value&&1===e.arguments.length){const t=e.arguments[0].valueExpression;48===t.nodeType&&1===t.strings.length&&49===t.strings[0].nodeType&&this._dunderAllNames&&(this._dunderAllNames=this._dunderAllNames.filter((e=>e!==t.strings[0].value)),this._dunderAllStringNodes=this._dunderAllStringNodes.filter((e=>e.value!==t.strings[0].value)),a=!1)}else if("append"===e.leftExpression.memberName.value&&1===e.arguments.length){const r=e.arguments[0].valueExpression;48===r.nodeType&&1===r.strings.length&&49===r.strings[0].nodeType&&(null===(t=this._dunderAllNames)||void 0===t||t.push(r.strings[0].value),null===(n=this._dunderAllStringNodes)||void 0===n||n.push(r.strings[0]),a=!1)}a&&(this._usesUnsupportedDunderAllForm=!0,this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,l.DiagnosticRule.reportUnsupportedDunderAll,m.LocMessage.unsupportedDunderAllOperation(),e))}return!1}visitTypeParameterList(e){const t=new b.Scope(0,this._getNonClassParentScope(),this._currentScope);e.parameters.forEach((e=>{e.boundExpression&&this.walk(e.boundExpression)}));const n=new Set;return e.parameters.forEach((a=>{const r=a.name,s=t.addSymbol(r.value,0),i={type:3,node:a,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};s.addDeclaration(i),y.setDeclaration(r,i),n.has(r.value)?this._addSyntaxError(m.LocMessage.typeParameterExistingTypeParameter().format({name:r.value}),r):n.add(r.value)})),e.parameters.forEach((e=>{e.defaultExpression&&this.walk(e.defaultExpression)})),y.setScope(e,t),!1}visitTypeAlias(e){let t;this._bindNameToScope(this._currentScope,e.name),this.walk(e.name),e.typeParameters&&(this.walk(e.typeParameters),t=y.getScope(e.typeParameters));const n={type:4,node:e,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e.expression)},a=this._bindNameToScope(this._currentScope,e.name);a&&a.addDeclaration(n),y.setDeclaration(e,n),this._createAssignmentTargetFlowNodes(e.name,!0,!1);const r=this._currentScope;return this._currentScope=null!=t?t:this._currentScope,this.walk(e.expression),this._currentScope=r,!1}visitAssignment(e){if(this._handleTypingStubAssignmentOrAnnotation(e))return!1;if(this._bindPossibleTupleNamedTarget(e.leftExpression),e.typeAnnotationComment&&(this.walk(e.typeAnnotationComment),this._addTypeDeclarationForVariable(e.leftExpression,e.typeAnnotationComment)),e.chainedTypeAnnotationComment&&this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidTypeForm,l.DiagnosticRule.reportInvalidTypeForm,m.LocMessage.annotationNotSupported(),e.chainedTypeAnnotationComment),24===e.leftExpression.nodeType){const t=e.leftExpression;if(1===t.items.length&&!t.trailingComma&&48===t.items[0].valueExpression.nodeType&&(0,g.isCodeFlowSupportedForReference)(t.baseExpression)){const e=(0,g.createKeyForReference)(t.baseExpression);this._currentScopeCodeFlowExpressions.add(e)}}this.walk(e.rightExpression);let t=!0;if((T.getEnclosingFunction(e)||9===e.rightExpression.nodeType&&this._fileInfo.isTypingStubFile||T.isWithinLoop(e))&&(t=!1),this._addInferredTypeAssignmentForVariable(e.leftExpression,e.rightExpression,t),this._createAssignmentTargetFlowNodes(e.leftExpression,!0,!1),4===this._currentScope.type&&(38===e.leftExpression.nodeType&&"__all__"===e.leftExpression.value||54===e.leftExpression.nodeType&&38===e.leftExpression.valueExpression.nodeType&&"__all__"===e.leftExpression.valueExpression.value)){const t=e.rightExpression;this._dunderAllNames=[];let n=!1;31===t.nodeType?t.entries.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?(this._dunderAllNames.push(e.strings[0].value),this._dunderAllStringNodes.push(e.strings[0])):n=!0})):52===t.nodeType?t.expressions.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?(this._dunderAllNames.push(e.strings[0].value),this._dunderAllStringNodes.push(e.strings[0])):n=!0})):n=!0,n&&(this._usesUnsupportedDunderAllForm=!0,this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,l.DiagnosticRule.reportUnsupportedDunderAll,m.LocMessage.unsupportedDunderAllOperation(),e))}if(3===this._currentScope.type&&(38===e.leftExpression.nodeType&&"__slots__"===e.leftExpression.value||54===e.leftExpression.nodeType&&38===e.leftExpression.valueExpression.nodeType&&"__slots__"===e.leftExpression.valueExpression.value)){const t=e.rightExpression;this._dunderSlotsEntries=[];let n=!0;48===t.nodeType?this._dunderSlotsEntries.push(t):31===t.nodeType?t.entries.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?this._dunderSlotsEntries.push(e):n=!1})):52===t.nodeType?t.expressions.forEach((e=>{48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType?this._dunderSlotsEntries.push(e):n=!1})):n=!1,n||(this._dunderSlotsEntries=void 0)}return!1}visitAssignmentExpression(e){this._disableTrueFalseTargets((()=>{this.walk(e.rightExpression)}));const t=T.getEvaluationNodeForAssignmentExpression(e);if(t){const n=y.getScope(t);let a=this._currentScope;for(;a&&a!==n;){if(a.lookUpSymbol(e.name.value)){this._addSyntaxError(m.LocMessage.assignmentExprComprehension().format({name:e.name.value}),e.name);break}a=a.parent}this._bindNameToScope(n,e.name),this._addInferredTypeAssignmentForVariable(e.name,e.rightExpression),this._createAssignmentTargetFlowNodes(e.name,!0,!1)}else this._addSyntaxError(m.LocMessage.assignmentExprContext(),e),this.walk(e.name);return!1}visitAugmentedAssignment(e){if(this.walk(e.leftExpression),this.walk(e.rightExpression),this._bindPossibleTupleNamedTarget(e.destExpression),this._createAssignmentTargetFlowNodes(e.destExpression,!1,!1),1===e.operator&&4===this._currentScope.type&&38===e.leftExpression.nodeType&&"__all__"===e.leftExpression.value){const t=e.rightExpression;let n=!0;if(31===t.nodeType)t.entries.forEach((e=>{var t;48===e.nodeType&&1===e.strings.length&&49===e.strings[0].nodeType&&(null===(t=this._dunderAllNames)||void 0===t||t.push(e.strings[0].value),this._dunderAllStringNodes.push(e.strings[0]))})),n=!1;else if(35===t.nodeType&&38===t.leftExpression.nodeType&&"__all__"===t.memberName.value){const e=this._getDunderAllNamesFromImport(t.leftExpression.value);e&&(e.forEach((e=>{var t;null===(t=this._dunderAllNames)||void 0===t||t.push(e)})),n=!1)}n&&(this._usesUnsupportedDunderAllForm=!0,this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll,l.DiagnosticRule.reportUnsupportedDunderAll,m.LocMessage.unsupportedDunderAllOperation(),e))}return!1}visitDel(e){return e.expressions.forEach((e=>{this._bindPossibleTupleNamedTarget(e),this.walk(e),this._createAssignmentTargetFlowNodes(e,!1,!0)})),!1}visitTypeAnnotation(e){var t;if(this._handleTypingStubAssignmentOrAnnotation(e))return!1;const n=3===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&void 0!==T.getEnclosingClass(e,!0);n||this.walk(e.typeAnnotation),this._createVariableAnnotationFlowNode(),this._bindPossibleTupleNamedTarget(e.valueExpression),this._addTypeDeclarationForVariable(e.valueExpression,e.typeAnnotation),n&&this.walk(e.typeAnnotation);const a=[];return this._isNarrowingExpression(e.valueExpression,a)&&a.forEach((e=>{const t=(0,g.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(t)})),this.walk(e.valueExpression),!1}visitFor(e){this._bindPossibleTupleNamedTarget(e.targetExpression),this._addInferredTypeAssignmentForVariable(e.targetExpression,e),this.walk(e.iterableExpression);const t=this._createLoopLabel(),n=this._createBranchLabel(),a=this._createBranchLabel();this._addAntecedent(t,this._currentFlowNode),this._currentFlowNode=t,this._addAntecedent(n,this._currentFlowNode);const r=this._trackCodeFlowExpressions((()=>{this._createAssignmentTargetFlowNodes(e.targetExpression,!0,!1)}));if(this._bindLoopStatement(t,a,(()=>{this.walk(e.forSuite),this._addAntecedent(t,this._currentFlowNode),r.forEach((e=>{var t;null===(t=this._currentScopeCodeFlowExpressions)||void 0===t||t.add(e)}))})),this._currentFlowNode=this._finishFlowLabel(n),e.elseSuite&&this.walk(e.elseSuite),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),e.asyncToken&&!this._fileInfo.ipythonMode){const t=T.getEnclosingFunction(e);t&&t.isAsync||this._addSyntaxError(m.LocMessage.asyncNotInAsyncFunction(),e.asyncToken)}return!1}visitContinue(e){return this._currentContinueTarget&&this._addAntecedent(this._currentContinueTarget,this._currentFlowNode),this._currentFlowNode=k._unreachableFlowNode,!1}visitBreak(e){return this._currentBreakTarget&&this._addAntecedent(this._currentBreakTarget,this._currentFlowNode),this._currentFlowNode=k._unreachableFlowNode,!1}visitReturn(e){return this._targetFunctionDeclaration&&(this._targetFunctionDeclaration.returnStatements||(this._targetFunctionDeclaration.returnStatements=[]),this._targetFunctionDeclaration.returnStatements.push(e)),e.returnExpression&&this.walk(e.returnExpression),y.setFlowNode(e,this._currentFlowNode),this._currentReturnTarget&&this._addAntecedent(this._currentReturnTarget,this._currentFlowNode),this._finallyTargets.forEach((e=>{this._addAntecedent(e,this._currentFlowNode)})),this._currentFlowNode=k._unreachableFlowNode,!1}visitYield(e){return this._isInListComprehension(e,!0)&&this._addSyntaxError(m.LocMessage.yieldWithinListCompr(),e),this._bindYield(e),!1}visitYieldFrom(e){return this._isInListComprehension(e,!0)&&this._addSyntaxError(m.LocMessage.yieldWithinListCompr(),e),this._bindYield(e),!1}visitMemberAccess(e){return this.walk(e.leftExpression),y.setFlowNode(e,this._currentFlowNode),!1}visitName(e){return y.setFlowNode(e,this._currentFlowNode),!1}visitIndex(e){y.setFlowNode(e,this._currentFlowNode),this.walk(e.baseExpression);const t=this._isInAnnotatedAnnotation;return this._isTypingAnnotation(e.baseExpression,"Annotated")&&(this._isInAnnotatedAnnotation=!0),e.items.forEach((e=>{this.walk(e)})),this._isInAnnotatedAnnotation=t,!1}visitIf(e){const t=this._currentFlowNode,n=this._createBranchLabel(),a=this._createBranchLabel(),r=this._createBranchLabel(t);return r.affectedExpressions=this._trackCodeFlowExpressions((()=>{const t=_.evaluateStaticBoolLikeExpression(e.testExpression,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants,this._typingImportAliases,this._sysImportAliases);this._bindConditional(e.testExpression,n,a),this._currentFlowNode=!1===t?k._unreachableFlowNode:this._finishFlowLabel(n),this.walk(e.ifSuite),this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=!0===t?k._unreachableFlowNode:this._finishFlowLabel(a),e.elseSuite?this.walk(e.elseSuite):this._bindNeverCondition(e.testExpression,r,!1),this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(r)})),!1}visitWhile(e){const t=this._createBranchLabel(),n=this._createBranchLabel(),a=this._createBranchLabel(),r=_.evaluateStaticBoolLikeExpression(e.testExpression,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants,this._typingImportAliases,this._sysImportAliases),s=this._createLoopLabel();return this._addAntecedent(s,this._currentFlowNode),this._currentFlowNode=s,this._bindConditional(e.testExpression,t,n),this._currentFlowNode=!1===r?k._unreachableFlowNode:this._finishFlowLabel(t),this._bindLoopStatement(s,a,(()=>{this.walk(e.whileSuite)})),this._addAntecedent(s,this._currentFlowNode),this._currentFlowNode=!0===r?k._unreachableFlowNode:this._finishFlowLabel(n),e.elseSuite&&this.walk(e.elseSuite),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),!1}visitAssert(e){const t=this._createBranchLabel(),n=this._createBranchLabel();return this._bindConditional(e.testExpression,t,n),e.exceptionExpression&&(this._currentFlowNode=this._finishFlowLabel(n),this.walk(e.exceptionExpression)),this._currentFlowNode=this._finishFlowLabel(t),!1}visitExcept(e){if(e.typeExpression&&this.walk(e.typeExpression),e.name){this.walk(e.name);const t=this._bindNameToScope(this._currentScope,e.name);if(this._createAssignmentTargetFlowNodes(e.name,!0,!1),t){const n={type:1,node:e.name,isConstant:(0,I.isConstantName)(e.name.value),inferredTypeSource:e,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e.name,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,isExplicitBinding:void 0!==this._currentScope.getBindingType(e.name.value)};t.addDeclaration(n)}}const t=this._isInExceptSuite;return this._isInExceptSuite=!0,this.walk(e.exceptSuite),this._isInExceptSuite=t,e.name&&this._createFlowAssignment(e.name,!0),!1}visitRaise(e){return this._currentFlowNode&&this._addExceptTargets(this._currentFlowNode),this._targetFunctionDeclaration&&(this._targetFunctionDeclaration.raiseStatements||(this._targetFunctionDeclaration.raiseStatements=[]),this._targetFunctionDeclaration.raiseStatements.push(e)),e.typeExpression&&this.walk(e.typeExpression),e.valueExpression&&this.walk(e.valueExpression),e.tracebackExpression&&this.walk(e.tracebackExpression),this._finallyTargets.forEach((e=>{this._addAntecedent(e,this._currentFlowNode)})),this._currentFlowNode=k._unreachableFlowNode,!1}visitTry(e){const t=this._currentFlowNode,n=e.exceptClauses.map((()=>this._createBranchLabel())),a=this._createBranchLabel(t);let r=!1;const s=this._createBranchLabel(t),i={flags:g.FlowFlags.PreFinallyGate,id:this._getUniqueFlowNodeId(),antecedent:s};if(a.affectedExpressions=this._trackCodeFlowExpressions((()=>{e.finallySuite&&this._addAntecedent(a,i);e.exceptClauses.some((e=>!e.typeExpression))||n.push(s),n.forEach((e=>{this._addAntecedent(e,this._currentFlowNode)})),e.finallySuite&&this._finallyTargets.push(s),this._useExceptTargets(n,(()=>{this.walk(e.trySuite)})),e.elseSuite&&this.walk(e.elseSuite),this._addAntecedent(a,this._currentFlowNode),this._isCodeUnreachable()||(r=!0),e.exceptClauses.forEach(((e,t)=>{this._currentFlowNode=this._finishFlowLabel(n[t]),this.walk(e),this._addAntecedent(a,this._currentFlowNode),this._isCodeUnreachable()||(r=!0)})),e.finallySuite&&this._finallyTargets.pop(),this._currentFlowNode=this._finishFlowLabel(a)})),e.finallySuite){this.walk(e.finallySuite);const t={flags:g.FlowFlags.PostFinally,id:this._getUniqueFlowNodeId(),finallyNode:e.finallySuite,antecedent:this._currentFlowNode,preFinallyGate:i};this._currentFlowNode=r?t:k._unreachableFlowNode}return!1}visitAwait(e){var t;const n=T.getEnclosingFunction(e);if(void 0===n||!n.isAsync){if(this._fileInfo.ipythonMode&&void 0===n)return!0;32!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&this._addSyntaxError(m.LocMessage.awaitNotInAsync(),e)}return!0}visitGlobal(e){const t=this._currentScope.getGlobalScope().scope;return e.nameList.forEach((e=>{const n=e.value;0===this._currentScope.getBindingType(n)&&this._addSyntaxError(m.LocMessage.nonLocalRedefinition().format({name:n}),e);const a=this._currentScope.lookUpSymbolRecursive(n);a&&a.scope===this._currentScope&&this._addSyntaxError(m.LocMessage.globalReassignment().format({name:n}),e),this._bindNameToScope(t,e),this._currentScope!==t&&this._currentScope.setBindingType(n,1)})),!0}visitNonlocal(e){const t=this._currentScope.getGlobalScope().scope;return this._currentScope===t?this._addSyntaxError(m.LocMessage.nonLocalInModule(),e):e.nameList.forEach((e=>{const n=e.value;1===this._currentScope.getBindingType(n)&&this._addSyntaxError(m.LocMessage.globalRedefinition().format({name:n}),e);const a=this._currentScope.lookUpSymbolRecursive(n);a&&a.scope===this._currentScope?this._addSyntaxError(m.LocMessage.nonLocalReassignment().format({name:n}),e):a&&a.scope!==t||this._addSyntaxError(m.LocMessage.nonLocalNoBinding().format({name:n}),e),a&&this._currentScope.setBindingType(n,0)})),!0}visitImportAs(e){var t,n,a,r,s,i;if(e.module.nameParts.length>0){const l=e.module.nameParts[0].value;let p,c;e.alias?(p=e.alias.value,c=e.alias):(p=l,c=e.module.nameParts[0]);const d=this._bindNameToScope(this._currentScope,c);!d||4!==this._currentScope.type&&5!==this._currentScope.type||e.alias&&1===e.module.nameParts.length&&e.module.nameParts[0].value===e.alias.value||(this._fileInfo.isStubFile||this._fileInfo.isInPyTypedPackage)&&this._potentialHiddenSymbols.set(p,d);const u=y.getImportInfo(e.module);(0,o.assert)(void 0!==u),d&&this._createAliasDeclarationForMultipartImportName(e,e.alias,u,d),this._createFlowAssignment(e.alias?e.alias:e.module.nameParts[0]),1===e.module.nameParts.length&&("typing"===l||"typing_extensions"===l?this._typingImportAliases.push(null!==(n=null===(t=e.alias)||void 0===t?void 0:t.value)&&void 0!==n?n:l):"sys"===l?this._sysImportAliases.push(null!==(r=null===(a=e.alias)||void 0===a?void 0:a.value)&&void 0!==r?r:l):"dataclasses"===l&&this._dataclassesImportAliases.push(null!==(i=null===(s=e.alias)||void 0===s?void 0:s.value)&&void 0!==i?i:l))}return!0}visitImportFrom(e){var t;const n=["Final","ClassVar","Annotated"],a=["InitVar"],r=y.getImportInfo(e.module);y.setFlowNode(e,this._currentFlowNode);let s=u.Uri.empty();r&&r.isImportFound&&!r.isNativeLib&&(s=r.resolvedUris[r.resolvedUris.length-1]);const i=(0,p.stripFileExtension)(this._fileInfo.fileUri.fileName),o="__init__"===i&&1===e.module.leadingDots&&1===e.module.nameParts.length;let l=!1,h=!1;if(1===e.module.nameParts.length){const t=e.module.nameParts[0].value;"typing"!==t&&"typing_extensions"!==t||(l=!0),"dataclasses"===t&&(h=!0)}if(e.isWildcardImport){if((T.getEnclosingClass(e)||T.getEnclosingFunction(e))&&this._addSyntaxError(m.LocMessage.wildcardInFunction(),e),r){const i=[];null===(t=this._currentScopeCodeFlowExpressions)||void 0===t||t.add(g.wildcardImportReferenceKey);const p=this._fileInfo.importLookup(s);if(p){const t=this._getWildcardImportNames(p);if(o){t.some((t=>t===e.module.nameParts[0].value))||this._addImplicitFromImport(e,r)}t.forEach((t=>{const n=this._bindNameValueToScope(this._currentScope,t);if(n){if(p.symbolTable.get(t)){const a={type:8,node:e,uri:s,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!1,symbolName:t,moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};n.addDeclaration(a),i.push(t)}else if(r&&r.filteredImplicitImports){const a=r.filteredImplicitImports.get(t);if(a){const r={type:8,node:e,uri:a.uri,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!1,moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},o={type:8,node:e,uri:s,loadSymbolsFromPath:!0,usesLocalName:!1,symbolName:t,submoduleFallback:r,range:(0,d.getEmptyRange)(),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite};n.addDeclaration(o),i.push(t)}}}}))}this._createFlowWildcardImport(e,i),l&&n.forEach((e=>{this._typingSymbolAliases.set(e,e)})),h&&a.forEach((e=>{this._dataclassesSymbolAliases.set(e,e)}))}}else o&&this._addImplicitFromImport(e,r),e.imports.forEach((t=>{const o=t.name.value,p=t.alias||t.name;y.setFlowNode(t,this._currentFlowNode);const u=this._bindNameToScope(this._currentScope,p);if(u){let m,y;e.module.nameParts.length>0&&(4!==this._currentScope.type&&5!==this._currentScope.type||t.alias&&t.alias.value===t.name.value||(this._fileInfo.isStubFile||this._fileInfo.isInPyTypedPackage)&&this._potentialHiddenSymbols.set(p.value,u)),r&&r.filteredImplicitImports&&(m=r.filteredImplicitImports.get(o));let g=!0;m&&(y={type:8,node:t,uri:m.uri,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!1,moduleName:this._formatModuleName(e.module),isInExceptSuite:this._isInExceptSuite},"__init__"===i&&(1===e.module.leadingDots&&0===e.module.nameParts.length||s.equals(this._fileInfo.fileUri))&&(g=!1));const f={type:8,node:t,uri:s,loadSymbolsFromPath:g,usesLocalName:!!t.alias,symbolName:o,submoduleFallback:y,range:(0,c.convertTextRangeToRange)(p,this._fileInfo.lines),moduleName:this._formatModuleName(e.module),isInExceptSuite:this._isInExceptSuite,isNativeLib:null==r?void 0:r.isNativeLib};u.addDeclaration(f),this._createFlowAssignment(t.alias||t.name),l&&n.some((e=>e===t.name.value))&&this._typingSymbolAliases.set(p.value,t.name.value),h&&a.some((e=>e===t.name.value))&&this._dataclassesSymbolAliases.set(p.value,t.name.value)}}));return!0}visitWith(e){e.withItems.forEach((e=>{this.walk(e.expression),e.target&&(this._bindPossibleTupleNamedTarget(e.target),this._addInferredTypeAssignmentForVariable(e.target,e),this._createAssignmentTargetFlowNodes(e.target,!0,!1))}));const t=this._createContextManagerLabel(e.withItems.map((e=>e.expression)),!!e.isAsync,!1);this._addAntecedent(t,this._currentFlowNode);const n=this._createContextManagerLabel(e.withItems.map((e=>e.expression)),!!e.isAsync,!0);this._currentExceptTargets.forEach((e=>{this._addAntecedent(e,n)}));const a=this._currentFlowNode,r=this._createBranchLabel(a);return this._addAntecedent(r,t),r.affectedExpressions=this._trackCodeFlowExpressions((()=>{if(this._useExceptTargets([t,n],(()=>{this.walk(e.suite)})),this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=r,this._isCodeUnreachable()||this._addExceptTargets(this._currentFlowNode),e.asyncToken&&!this._fileInfo.ipythonMode){const t=T.getEnclosingFunction(e);t&&t.isAsync||this._addSyntaxError(m.LocMessage.asyncNotInAsyncFunction(),e.asyncToken)}})),!1}visitTernary(e){const t=this._currentFlowNode,n=this._createBranchLabel(),a=this._createBranchLabel(),r=this._createBranchLabel(t);return r.affectedExpressions=this._trackCodeFlowExpressions((()=>{this._bindConditional(e.testExpression,n,a),this._currentFlowNode=this._finishFlowLabel(n),this.walk(e.ifExpression),this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),this.walk(e.elseExpression),this._addAntecedent(r,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(r)})),!1}visitUnaryOperation(e){return 38===e.operator&&this._currentFalseTarget&&this._currentTrueTarget?this._bindConditional(e.expression,this._currentFalseTarget,this._currentTrueTarget):this._disableTrueFalseTargets((()=>{this.walk(e.expression)})),!1}visitBinaryOperation(e){if(36===e.operator||37===e.operator){let t,n=this._currentTrueTarget,a=this._currentFalseTarget;n&&a||(t=this._createBranchLabel(),n=a=t);const r=this._createBranchLabel();36===e.operator?this._bindConditional(e.leftExpression,r,a):this._bindConditional(e.leftExpression,n,r),this._currentFlowNode=this._finishFlowLabel(r),this._bindConditional(e.rightExpression,n,a),t&&(this._currentFlowNode=this._finishFlowLabel(t))}else this._disableTrueFalseTargets((()=>{this.walk(e.leftExpression),this.walk(e.rightExpression)}));return!1}visitListComprehension(e){const t=T.getEnclosingFunction(e);return e.forIfNodes.length>0&&33===e.forIfNodes[0].nodeType&&this.walk(e.forIfNodes[0].iterableExpression),this._createNewScope(1,this._getNonClassParentScope(),void 0,(()=>{var n;y.setScope(e,this._currentScope);const a=this._createBranchLabel();for(let a=0;a<e.forIfNodes.length;a++){const r=e.forIfNodes[a],s=new Map;33===r.nodeType&&(this._bindPossibleTupleNamedTarget(r.targetExpression,s),this._addInferredTypeAssignmentForVariable(r.targetExpression,r),r.asyncToken&&!this._fileInfo.ipythonMode&&(t&&t.isAsync||31===(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&this._addSyntaxError(m.LocMessage.asyncNotInAsyncFunction(),r.asyncToken)))}for(let t=0;t<e.forIfNodes.length;t++){const n=e.forIfNodes[t];if(33===n.nodeType)0!==t&&this.walk(n.iterableExpression),this._createAssignmentTargetFlowNodes(n.targetExpression,!0,!1);else{const e=this._createBranchLabel();this._bindConditional(n.testExpression,e,a),this._currentFlowNode=this._finishFlowLabel(e)}}this.walk(e.expression),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a)})),!1}visitMatch(e){this.walk(e.subjectExpression);const t=[],n=this._isNarrowingExpression(e.subjectExpression,t);n&&t.forEach((e=>{const t=(0,g.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(t)}));const a=this._createBranchLabel();let r=!1;return e.cases.forEach((t=>{const n=this._createBranchLabel(),s=this._createBranchLabel(),i=this._createBranchLabel();this._addAntecedent(s,this._currentFlowNode),t.isIrrefutable?t.guardExpression||(r=!0):this._addAntecedent(n,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(s),this.walk(t.pattern),this._createFlowNarrowForPattern(e.subjectExpression,t),t.guardExpression?this._bindConditional(t.guardExpression,i,n):this._addAntecedent(i,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(i),this.walk(t.suite),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(n)})),n&&this._createFlowNarrowForPattern(e.subjectExpression,e),r||this._createFlowExhaustedMatch(e),this._addAntecedent(a,this._currentFlowNode),this._currentFlowNode=this._finishFlowLabel(a),!1}visitPatternAs(e){const t=this._createBranchLabel();if(e.orPatterns.forEach((e=>{this.walk(e),this._addAntecedent(t,this._currentFlowNode)})),this._currentFlowNode=this._finishFlowLabel(t),e.target){this.walk(e.target);const t=this._bindNameToScope(this._currentScope,e.target);if(this._createAssignmentTargetFlowNodes(e.target,!1,!1),t){const n={type:1,node:e.target,isConstant:(0,I.isConstantName)(e.target.value),inferredTypeSource:e,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e.target,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,isExplicitBinding:void 0!==this._currentScope.getBindingType(e.target.value)};t.addDeclaration(n)}}return!1}visitPatternCapture(e){return e.isWildcard||this._addPatternCaptureTarget(e.target),!0}visitPatternMappingExpandEntry(e){return"_"!==e.target.value&&this._addPatternCaptureTarget(e.target),!0}_formatModuleName(e){return".".repeat(e.leadingDots)+e.nameParts.map((e=>e.value)).join(".")}_getNonClassParentScope(){let e=this._currentScope;for(;3===e.type;)e=e.parent;return e}_addSlotsToCurrentScope(e){(0,o.assert)(3===this._currentScope.type);let t=!1;for(const n of e){const e=n.strings[0].value;if("__dict__"===e){t=!0;continue}let a=this._currentScope.lookUpSymbol(e);if(!a){a=this._currentScope.addSymbol(e,5);const t="none"!==this._fileInfo.diagnosticRuleSet.reportPrivateUsage;(0,I.isPrivateOrProtectedName)(e)&&t&&a.setIsPrivateMember()}const r={type:1,node:n,isConstant:(0,I.isConstantName)(e),isDefinedBySlots:!0,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(n,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,isExplicitBinding:void 0!==this._currentScope.getBindingType(e)};a.addDeclaration(r)}t||this._currentScope.setSlotsNames(e.map((e=>e.strings[0].value)))}_isInListComprehension(e,t=!1){let n,a,r=e;for(;r;){if(32===r.nodeType){if(t&&r.forIfNodes.length>0){const e=r.forIfNodes[0];if(n===e&&33===e.nodeType&&a===e.iterableExpression)return!1}return!0}a=n,n=r,r=r.parent}return!1}_addPatternCaptureTarget(e){const t=this._bindNameToScope(this._currentScope,e);if(this._createAssignmentTargetFlowNodes(e,!1,!1),t){const n={type:1,node:e,isConstant:(0,I.isConstantName)(e.value),inferredTypeSource:e.parent,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,isExplicitBinding:void 0!==this._currentScope.getBindingType(e.value)};t.addDeclaration(n)}}_useExceptTargets(e,t){const n=this._currentExceptTargets;this._currentExceptTargets=e,t(),this._currentExceptTargets=n}_getDunderAllNamesFromImport(e){var t,n;const a=this._currentScope.lookUpSymbol(e);if(!a)return;const r=a.getDeclarations().find((e=>8===e.type)),s=(null==r?void 0:r.uri)&&!r.uri.isEmpty()&&r.loadSymbolsFromPath?r.uri:(null===(t=null==r?void 0:r.submoduleFallback)||void 0===t?void 0:t.uri)&&!r.submoduleFallback.uri.isEmpty()&&r.submoduleFallback.loadSymbolsFromPath?r.submoduleFallback.uri:void 0;if(!s)return;let i=this._fileInfo.importLookup(s);return(null==i?void 0:i.dunderAllNames)?i.dunderAllNames:(null===(n=null==r?void 0:r.submoduleFallback)||void 0===n?void 0:n.uri)&&!r.submoduleFallback.uri.isEmpty()?(i=this._fileInfo.importLookup(r.submoduleFallback.uri),null==i?void 0:i.dunderAllNames):void 0}_addImplicitFromImport(e,t){const n=e.module.nameParts[0].value,a=this._bindNameValueToScope(this._currentScope,n);a&&this._createAliasDeclarationForMultipartImportName(e,void 0,t,a),this._createFlowAssignment(e.module.nameParts[0])}_createAliasDeclarationForMultipartImportName(e,t,n,a){var r;const s=e.module.nameParts[0].value;y.setFlowNode(e,this._currentFlowNode);const i=a.getDeclarations().find((e=>8===e.type&&e.firstNamePart===s));let o,l;l=n&&n.isImportFound&&!n.isNativeLib&&n.resolvedUris.length>0?n.resolvedUris[n.resolvedUris.length-1]:h.UnresolvedModuleMarker;const p=n&&n.isImportFound&&!n.isNativeLib&&n.resolvedUris.length>0;o=i||(p?{type:8,node:e,uri:l,loadSymbolsFromPath:!1,range:(0,d.getEmptyRange)(),usesLocalName:!!t,moduleName:t?this._formatModuleName(e.module):".".repeat(e.module.leadingDots)+s,firstNamePart:s,isInExceptSuite:this._isInExceptSuite}:{type:8,node:e,uri:l,loadSymbolsFromPath:!0,range:(0,d.getEmptyRange)(),usesLocalName:!!t,moduleName:null!==(r=null==n?void 0:n.importName)&&void 0!==r?r:"",firstNamePart:t?this._formatModuleName(e.module):".".repeat(e.module.leadingDots)+s,isUnresolved:!0,isInExceptSuite:this._isInExceptSuite});const c=y.getImportInfo(e.module.nameParts[0]);if(c&&c.resolvedUris.length&&(o.uri=c.resolvedUris[0],o.loadSymbolsFromPath=!0,this._addImplicitImportsToLoaderActions(c,o)),t||1===e.module.nameParts.length)o.uri=l,o.loadSymbolsFromPath=!0,o.isUnresolved=!1,n&&this._addImplicitImportsToLoaderActions(n,o);else{let t=o;for(let a=1;a<e.module.nameParts.length;a++){const r=e.module.nameParts[a].value;let s=t.implicitImports?t.implicitImports.get(r):void 0;if(!s){s={uri:n&&a<n.resolvedUris.length?n.resolvedUris[a]:h.UnresolvedModuleMarker,loadSymbolsFromPath:!1,implicitImports:new Map,isUnresolved:!p},t.implicitImports||(t.implicitImports=new Map),t.implicitImports.set(r,s)}if(a===e.module.nameParts.length-1)n&&a<n.resolvedUris.length&&(s.uri=n.resolvedUris[a],s.loadSymbolsFromPath=!0,this._addImplicitImportsToLoaderActions(n,s));else{const t=y.getImportInfo(e.module.nameParts[a]);t&&t.resolvedUris.length&&(s.uri=t.resolvedUris[a],s.loadSymbolsFromPath=!0,this._addImplicitImportsToLoaderActions(t,s))}t=s}}i||a.addDeclaration(o)}_getWildcardImportNames(e){const t=[];if(e.dunderAllNames){if(!e.usesUnsupportedDunderAllForm)return e.dunderAllNames;(0,i.appendArray)(t,e.dunderAllNames)}return e.symbolTable.forEach(((e,n)=>{e.isExternallyHidden()||n.startsWith("_")||t.push(n)})),t}_walkStatementsAndReportUnreachable(e){let t=!1;for(const n of e)if(y.setFlowNode(n,this._currentFlowNode),t||(t=this._isCodeUnreachable()),t){if(this._targetFunctionDeclaration&&!this._targetFunctionDeclaration.isGenerator){(new w).checkContainsYield(n)&&(this._targetFunctionDeclaration.isGenerator=!0)}if(!this._moduleSymbolOnly){new A(this._currentScope).walk(n)}}else this.walk(n);return!1}_createStartFlowNode(){return{flags:g.FlowFlags.Start,id:this._getUniqueFlowNodeId()}}_createBranchLabel(e){return{flags:g.FlowFlags.BranchLabel,id:this._getUniqueFlowNodeId(),antecedents:[],preBranchAntecedent:e,affectedExpressions:void 0}}_createFlowNarrowForPattern(e,t){const n={flags:g.FlowFlags.NarrowForPattern,id:this._getUniqueFlowNodeId(),subjectExpression:e,statement:t,antecedent:this._currentFlowNode};this._currentFlowNode=n}_createContextManagerLabel(e,t,n){return{flags:g.FlowFlags.PostContextManager|g.FlowFlags.BranchLabel,id:this._getUniqueFlowNodeId(),antecedents:[],expressions:e,affectedExpressions:void 0,isAsync:t,blockIfSwallowsExceptions:n}}_createLoopLabel(){return{flags:g.FlowFlags.LoopLabel,id:this._getUniqueFlowNodeId(),antecedents:[],affectedExpressions:void 0}}_finishFlowLabel(e){return 0===e.antecedents.length?k._unreachableFlowNode:1===e.antecedents.length&&e.flags===g.FlowFlags.BranchLabel?e.antecedents[0]:(this._codeFlowComplexity+=e.antecedents.length-1,e)}_bindNeverCondition(e,t,n){const a=[];if(55===e.nodeType&&38===e.operator)this._bindNeverCondition(e.expression,t,!n);else if(7!==e.nodeType||36!==e.operator&&37!==e.operator){if(this._isNarrowingExpression(e,a,!0)){a.filter((e=>38===e.nodeType)).length>0&&(this._currentFlowNode=this._createFlowConditional(n?g.FlowFlags.TrueNeverCondition:g.FlowFlags.FalseNeverCondition,this._currentFlowNode,e))}this._addAntecedent(t,this._currentFlowNode)}else{let a=36===e.operator;if(n&&(a=!a),a){const a=this._currentFlowNode;this._bindNeverCondition(e.leftExpression,t,n),this._currentFlowNode=a,this._bindNeverCondition(e.rightExpression,t,n)}else{const a=this._currentFlowNode,r=this._createBranchLabel();if(this._bindNeverCondition(e.leftExpression,r,n),a!==this._currentFlowNode){this._currentFlowNode=this._finishFlowLabel(r);const s=this._currentFlowNode;this._bindNeverCondition(e.rightExpression,t,n),s===this._currentFlowNode&&(this._currentFlowNode=a)}}}}_bindConditional(e,t,n){this._setTrueFalseTargets(t,n,(()=>{this.walk(e)})),this._isLogicalExpression(e)||(this._addAntecedent(t,this._createFlowConditional(g.FlowFlags.TrueCondition,this._currentFlowNode,e)),this._addAntecedent(n,this._createFlowConditional(g.FlowFlags.FalseCondition,this._currentFlowNode,e)))}_disableTrueFalseTargets(e){this._setTrueFalseTargets(void 0,void 0,e)}_setTrueFalseTargets(e,t,n){const a=this._currentTrueTarget,r=this._currentFalseTarget;this._currentTrueTarget=e,this._currentFalseTarget=t,n(),this._currentTrueTarget=a,this._currentFalseTarget=r}_createFlowConditional(e,t,n){if(t.flags&g.FlowFlags.Unreachable)return t;const a=_.evaluateStaticBoolLikeExpression(n,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants,this._typingImportAliases,this._sysImportAliases);if(!0===a&&e&g.FlowFlags.FalseCondition||!1===a&&e&g.FlowFlags.TrueCondition)return k._unreachableFlowNode;const r=[];if(!this._isNarrowingExpression(n,r,0!=(e&(g.FlowFlags.TrueNeverCondition|g.FlowFlags.FalseNeverCondition))))return t;r.forEach((e=>{const t=(0,g.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(t)}));const s=r.filter((e=>38===e.nodeType)),i={flags:e,id:this._getUniqueFlowNodeId(),reference:s.length>0?s[0]:void 0,expression:n,antecedent:t};return this._addExceptTargets(i),i}_isLogicalExpression(e){switch(e.nodeType){case 55:return 38===e.operator;case 7:return 36===e.operator||37===e.operator}return!1}_isNarrowingExpression(e,t,n=!1,a=!1){switch(e.nodeType){case 38:case 35:case 24:if(n){if(38!==e.nodeType)return!1;if(!a)return!1}return!!(0,g.isCodeFlowSupportedForReference)(e)&&(t.push(e),n||(35===e.nodeType&&(0,g.isCodeFlowSupportedForReference)(e.leftExpression)&&t.push(e.leftExpression),24!==e.nodeType||1!==e.items.length||e.trailingComma||0!==e.items[0].argumentCategory||(0,g.isCodeFlowSupportedForReference)(e.baseExpression)&&t.push(e.baseExpression)),!0);case 4:return t.push(e.name),this._isNarrowingExpression(e.rightExpression,t,n,!0),!0;case 7:{const a=39===e.operator||40===e.operator,r=12===e.operator||28===e.operator;if(a||r){if(11===e.rightExpression.nodeType&&26===e.rightExpression.constType)return this._isNarrowingExpression(e.leftExpression,t,n,!0);if(a&&9===e.leftExpression.nodeType&&38===e.leftExpression.leftExpression.nodeType&&"type"===e.leftExpression.leftExpression.value&&1===e.leftExpression.arguments.length&&0===e.leftExpression.arguments[0].argumentCategory)return this._isNarrowingExpression(e.leftExpression.arguments[0].valueExpression,t,n,!0);return this._isNarrowingExpression(e.leftExpression,t,n,!0)}if(40===e.rightExpression.nodeType&&e.rightExpression.isInteger&&(20===e.operator||21===e.operator||15===e.operator||16===e.operator)){return this._isNarrowingExpression(e.leftExpression,t,n,!0)}if((41===e.operator||42===e.operator)&&48===e.leftExpression.nodeType&&this._isNarrowingExpression(e.rightExpression,t,n,!0))return!0;if(41===e.operator||42===e.operator){const a=this._isNarrowingExpression(e.leftExpression,t,n,!0),r=this._isNarrowingExpression(e.rightExpression,t,n,!0);return a||r}return!1}case 55:return 38===e.operator&&this._isNarrowingExpression(e.expression,t,n,!1);case 5:return this._isNarrowingExpression(e.rightExpression,t,n,!0);case 9:if(38===e.leftExpression.nodeType&&("isinstance"===e.leftExpression.value||"issubclass"===e.leftExpression.value)&&2===e.arguments.length)return this._isNarrowingExpression(e.arguments[0].valueExpression,t,n,!0);if(38===e.leftExpression.nodeType&&"callable"===e.leftExpression.value&&1===e.arguments.length)return this._isNarrowingExpression(e.arguments[0].valueExpression,t,n,!0);if(e.arguments.length>=1)return!n&&this._isNarrowingExpression(e.arguments[0].valueExpression,t,n,!0)}return!1}_createAssignmentTargetFlowNodes(e,t,n){switch(e.nodeType){case 38:case 35:case 24:this._createFlowAssignment(e,n),t&&this.walk(e);break;case 52:e.expressions.forEach((e=>{this._createAssignmentTargetFlowNodes(e,t,n)}));break;case 54:this._createAssignmentTargetFlowNodes(e.valueExpression,!1,n),t&&this.walk(e);break;case 56:this._createAssignmentTargetFlowNodes(e.expression,!1,n),t&&this.walk(e);break;case 31:e.entries.forEach((e=>{this._createAssignmentTargetFlowNodes(e,t,n)}));break;default:t&&this.walk(e)}}_createCallFlowNode(e){if(!this._isCodeUnreachable()){this._addExceptTargets(this._currentFlowNode);const t={flags:g.FlowFlags.Call,id:this._getUniqueFlowNodeId(),node:e,antecedent:this._currentFlowNode};this._currentFlowNode=t}}_createVariableAnnotationFlowNode(){if(!this._isCodeUnreachable()){const e={flags:g.FlowFlags.VariableAnnotation,id:this._getUniqueFlowNodeId(),antecedent:this._currentFlowNode};this._currentFlowNode=e}}_createFlowAssignment(e,t=!1){let n=C.indeterminateSymbolId;if(38===e.nodeType){const t=this._currentScope.lookUpSymbolRecursive(e.value);(0,o.assert)(void 0!==t),n=t.symbol.id}const a=this._currentFlowNode;if(!this._isCodeUnreachable()&&(0,g.isCodeFlowSupportedForReference)(e)){const a={flags:g.FlowFlags.Assignment,id:this._getUniqueFlowNodeId(),node:e,antecedent:this._currentFlowNode,targetSymbolId:n},r=(0,g.createKeyForReference)(e);this._currentScopeCodeFlowExpressions.add(r),t&&(a.flags|=g.FlowFlags.Unbind),35===e.nodeType&&this._addExceptTargets(a),this._currentFlowNode=a}t&&void 0!==y.getFlowNode(e)||y.setFlowNode(e,t?a:this._currentFlowNode)}_createFlowWildcardImport(e,t){if(!this._isCodeUnreachable()){const n={flags:g.FlowFlags.WildcardImport,id:this._getUniqueFlowNodeId(),node:e,names:t,antecedent:this._currentFlowNode};this._addExceptTargets(n),this._currentFlowNode=n}y.setFlowNode(e,this._currentFlowNode)}_createFlowExhaustedMatch(e){if(!this._isCodeUnreachable()){const t={flags:g.FlowFlags.ExhaustedMatch,id:this._getUniqueFlowNodeId(),node:e,antecedent:this._currentFlowNode,subjectExpression:e.subjectExpression};this._currentFlowNode=t}y.setAfterFlowNode(e,this._currentFlowNode)}_isCodeUnreachable(){return!!(this._currentFlowNode.flags&g.FlowFlags.Unreachable)}_addExceptTargets(e){this._currentExceptTargets&&this._currentExceptTargets.forEach((t=>{this._addAntecedent(t,e)}))}_trackCodeFlowExpressions(e){const t=this._currentScopeCodeFlowExpressions;this._currentScopeCodeFlowExpressions=new Set,e();const n=this._currentScopeCodeFlowExpressions;return t&&this._currentScopeCodeFlowExpressions.forEach((e=>{t.add(e)})),this._currentScopeCodeFlowExpressions=t,n}_bindLoopStatement(e,t,n){const a=this._currentContinueTarget,r=this._currentBreakTarget;this._currentContinueTarget=e,this._currentBreakTarget=t,e.affectedExpressions=this._trackCodeFlowExpressions(n),this._currentContinueTarget=a,this._currentBreakTarget=r}_addAntecedent(e,t){this._currentFlowNode.flags&g.FlowFlags.Unreachable||e.antecedents.some((e=>e.id===t.id))||e.antecedents.push(t)}_bindNameToScope(e,t,n){return this._bindNameValueToScope(e,t.value,n)}_bindNameValueToScope(e,t,n){const a=this._currentScope.getBindingType(t);if(void 0===a){let a=e.lookUpSymbol(t);return a||(a=e.addSymbol(t,5),4!==this._currentScope.type&&5!==this._currentScope.type||(0,I.isPrivateOrProtectedName)(t)&&((0,I.isPrivateName)(t)?a.setIsExternallyHidden():this._fileInfo.isStubFile||this._fileInfo.isInPyTypedPackage?5===this._currentScope.type?a.setIsExternallyHidden():this._potentialPrivateSymbols.set(t,a):a.setIsPrivateMember()),n&&n.set(t,a)),a}{const e=(0===a?this._currentScope.parent:this._currentScope.getGlobalScope().scope).lookUpSymbolRecursive(t);if(e)return e.symbol}}_bindPossibleTupleNamedTarget(e,t){switch(e.nodeType){case 38:this._bindNameToScope(this._currentScope,e,t);break;case 52:e.expressions.forEach((e=>{this._bindPossibleTupleNamedTarget(e,t)}));break;case 31:e.entries.forEach((e=>{this._bindPossibleTupleNamedTarget(e,t)}));break;case 54:this._bindPossibleTupleNamedTarget(e.valueExpression,t);break;case 56:this._bindPossibleTupleNamedTarget(e.expression,t)}}_addImplicitSymbolToCurrentScope(e,t,n){const a=this._addSymbolToCurrentScope(e,!1);a&&(a.addDeclaration({type:0,node:t,intrinsicType:n,uri:this._fileInfo.fileUri,range:(0,d.getEmptyRange)(),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite}),a.setIsIgnoredForProtocolMatch())}_addSymbolToCurrentScope(e,t){let n=this._currentScope.lookUpSymbol(e);if(!n){let a=0;t&&(a|=1),3===this._currentScope.type&&(a|=4),this._fileInfo.isStubFile&&(0,I.isPrivateOrProtectedName)(e)&&(a|=2),n=this._currentScope.addSymbol(e,a)}return n}_createNewScope(e,t,n,a){const r=this._currentScope,s=new b.Scope(e,t,n);this._currentScope=s;const i=5===e||4===e||2===e,o=this._currentScopeCodeFlowExpressions;return i&&(this._currentScopeCodeFlowExpressions=new Set),a(),this._currentScopeCodeFlowExpressions=o,this._currentScope=r,s}_addInferredTypeAssignmentForVariable(e,t,n=!1){switch(e.nodeType){case 38:{const a=e,r=this._currentScope.lookUpSymbolRecursive(a.value);if(r&&r.symbol){const s={type:1,node:e,isConstant:(0,I.isConstantName)(e.value),inferredTypeSource:t,isInferenceAllowedInPyTyped:this._isInferenceAllowedInPyTyped(a.value),typeAliasName:n?e:void 0,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(a,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e),isExplicitBinding:void 0!==this._currentScope.getBindingType(a.value)};r.symbol.addDeclaration(s)}break}case 35:{const n=this._getMemberAccessInfo(e);if(n){const a=e.memberName;let r=n.classScope.lookUpSymbol(a.value);if(!r){r=n.classScope.addSymbol(a.value,1);const e="none"!==this._fileInfo.diagnosticRuleSet.reportPrivateUsage;(0,I.isPrivateOrProtectedName)(a.value)&&e&&r.setIsPrivateMember()}n.isInstanceMember?r.isClassMember()&&r.getDeclarations().some((e=>5===e.type&&e.isMethod))||r.setIsInstanceMember():r.setIsClassMember();const s={type:1,node:e.memberName,isConstant:(0,I.isConstantName)(a.value),inferredTypeSource:t,isDefinedByMemberAccess:!0,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(e.memberName,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e)};r.addDeclaration(s)}break}case 52:e.expressions.forEach((e=>{this._addInferredTypeAssignmentForVariable(e,t)}));break;case 54:this._addInferredTypeAssignmentForVariable(e.valueExpression,t);break;case 56:this._addInferredTypeAssignmentForVariable(e.expression,t);break;case 31:e.entries.forEach((e=>{this._addInferredTypeAssignmentForVariable(e,t)}))}}_isInferenceAllowedInPyTyped(e){return["__match_args__","__slots__","__all__"].some((t=>t===e))}_addTypeDeclarationForVariable(e,t){var n,a,r;let s=!1;switch(e.nodeType){case 38:{const i=e,o=this._currentScope.lookUpSymbolRecursive(i.value);if(o&&o.symbol){const s=this._isAnnotationFinal(t);let l=t;s.isFinal&&(s.finalTypeNode||(l=void 0));const p=this._isAnnotationClassVar(t);p.isClassVar&&(p.classVarTypeNode||(l=void 0));let d=!1;if(s.isFinal){const t=T.getEnclosingClassOrFunction(e);t&&10===t.nodeType&&(3!==(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&3!==(null===(r=null===(a=e.parent)||void 0===a?void 0:a.parent)||void 0===r?void 0:r.nodeType)||(d=!0))}const u={type:1,node:e,isConstant:(0,I.isConstantName)(i.value),isFinal:s.isFinal,typeAliasName:e,uri:this._fileInfo.fileUri,typeAnnotationNode:l,range:(0,c.convertTextRangeToRange)(i,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e),isExplicitBinding:void 0!==this._currentScope.getBindingType(i.value)};if(o.symbol.addDeclaration(u),d&&o.symbol.setIsFinalVarInClassBody(),p.isClassVar?o.symbol.setIsClassVar():d||o.symbol.setIsInstanceMember(),24===t.nodeType)if(this._isDataclassesAnnotation(t.baseExpression,"InitVar"))o.symbol.setIsInitVar();else if(this._isTypingAnnotation(t.baseExpression,"Annotated")&&t.items.length>0){const e=t.items[0].valueExpression;24===e.nodeType&&this._isDataclassesAnnotation(e.baseExpression,"InitVar")&&o.symbol.setIsInitVar()}}s=!0;break}case 35:{const n=this._getMemberAccessInfo(e);if(n){const a=e.memberName;let r=n.classScope.lookUpSymbol(a.value);if(!r){r=n.classScope.addSymbol(a.value,1);const e="none"!==this._fileInfo.diagnosticRuleSet.reportPrivateUsage;(0,I.isPrivateOrProtectedName)(a.value)&&e&&r.setIsPrivateMember()}n.isInstanceMember?r.setIsInstanceMember():r.setIsClassMember();const i=this._isAnnotationFinal(t),o={type:1,node:e.memberName,isConstant:(0,I.isConstantName)(a.value),isDefinedByMemberAccess:!0,isFinal:i.isFinal,uri:this._fileInfo.fileUri,typeAnnotationNode:i.isFinal&&!i.finalTypeNode?void 0:t,range:(0,c.convertTextRangeToRange)(e.memberName,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite,docString:this._getVariableDocString(e)};r.addDeclaration(o),s=!0}break}}s||this._addDiagnostic(this._fileInfo.diagnosticRuleSet.reportInvalidTypeForm,l.DiagnosticRule.reportInvalidTypeForm,m.LocMessage.annotationNotSupported(),t)}_isTypingAnnotation(e,t){return this._isKnownAnnotation(e,t,this._typingImportAliases,this._typingSymbolAliases)}_isDataclassesAnnotation(e,t){return this._isKnownAnnotation(e,t,this._dataclassesImportAliases,this._dataclassesSymbolAliases)}_isKnownAnnotation(e,t,n,a){let r=e;if(48===r.nodeType&&r.typeAnnotation&&(r=r.typeAnnotation),38===r.nodeType){if(a.get(r.value)===t)return!0}else if(35===r.nodeType&&38===r.leftExpression.nodeType&&r.memberName.value===t){const e=r.leftExpression.value;return n.some((t=>t===e))}return!1}_getVariableDocString(e){const t=T.getVariableDocStringNode(e);if(!t)return;const n=t.strings;return 1===n.length?n[0].value:n.map((e=>e.value)).join("")}_isAnnotationFinal(e){let t,n=!1;if(e){const a=this._isAnnotationClassVar(e);if((null==a?void 0:a.classVarTypeNode)&&(e=a.classVarTypeNode),this._isTypingAnnotation(e,"Final"))n=!0;else if(24===e.nodeType&&1===e.items.length){!this._isAnnotationFinal(e.baseExpression).isFinal||0!==e.items[0].argumentCategory||e.items[0].name||e.trailingComma||(n=!0,t=e.items[0].valueExpression)}}return{isFinal:n,finalTypeNode:t}}_isAnnotationClassVar(e){let t,n=!1;for(;e;){if(48===e.nodeType&&e.typeAnnotation&&(e=e.typeAnnotation),!(24===e.nodeType&&e.items.length>0&&this._isTypingAnnotation(e.baseExpression,"Annotated"))){if(this._isTypingAnnotation(e,"ClassVar")){n=!0;break}if(24===e.nodeType&&1===e.items.length){!this._isAnnotationClassVar(e.baseExpression).isClassVar||0!==e.items[0].argumentCategory||e.items[0].name||e.trailingComma||(n=!0,t=e.items[0].valueExpression);break}break}e=e.items[0].valueExpression}return{isClassVar:n,classVarTypeNode:t}}_getMemberAccessInfo(e){if(38!==e.leftExpression.nodeType)return;const t=e.leftExpression.value,n=T.getEnclosingFunction(e);if(!n)return;const a=T.getEnclosingClass(n,!0);if(!a)return;let r=!1;if(n.parameters.length<1||!n.parameters[0].name)return;const s=a.name.value,i=n.parameters[0].name.value;if(t===s)r=!1;else{if(t!==i)return;if("__new__"===n.name.value)r=!1;else{r=!0;for(const e of n.decorators)if(38===e.expression.nodeType){const t=e.expression.value;if("staticmethod"===t)return;if("classmethod"===t){r=!1;break}}}}const l=y.getScope(a);return(0,o.assert)(void 0!==l),{classNode:a,methodNode:n,classScope:l,isInstanceMember:r}}_addImplicitImportsToLoaderActions(e,t){e.filteredImplicitImports.forEach((e=>{const n=t.implicitImports?t.implicitImports.get(e.name):void 0;n?(n.uri=e.uri,n.loadSymbolsFromPath=!0):(t.implicitImports||(t.implicitImports=new Map),t.implicitImports.set(e.name,{uri:e.uri,loadSymbolsFromPath:!0,implicitImports:new Map}))}))}_handleTypingStubAssignmentOrAnnotation(e){if(!this._fileInfo.isTypingStubFile)return!1;let t;if(54===e.nodeType)t=e;else{if(54!==e.leftExpression.nodeType)return!1;t=e.leftExpression}if(38!==t.valueExpression.nodeType)return!1;const n=t.valueExpression,a=new Set(["Tuple","Generic","Protocol","Callable","Type","ClassVar","Final","Literal","TypedDict","Union","Optional","Annotated","TypeAlias","Concatenate","TypeGuard","Unpack","Self","NoReturn","Never","LiteralString","OrderedDict","TypeIs"]),r=n.value;if(!a.has(r))return!1;const s={type:7,node:t,uri:this._fileInfo.fileUri,range:(0,c.convertTextRangeToRange)(t,this._fileInfo.lines),moduleName:this._fileInfo.moduleName,isInExceptSuite:this._isInExceptSuite},i=this._bindNameToScope(this._currentScope,t.valueExpression);return i&&i.addDeclaration(s),y.setDeclaration(e,s),!0}_deferBinding(e){this._moduleSymbolOnly||this._deferredBindingTasks.push({scope:this._currentScope,codeFlowExpressions:this._currentScopeCodeFlowExpressions,callback:e})}_bindDeferred(){for(;this._deferredBindingTasks.length>0;){const e=this._deferredBindingTasks.shift();this._currentScope=e.scope,this._currentScopeCodeFlowExpressions=e.codeFlowExpressions,e.callback()}}_bindYield(e){const t=T.getEnclosingFunction(e);t?t.isAsync&&61===e.nodeType&&this._addSyntaxError(m.LocMessage.yieldFromOutsideAsync(),e):T.getEnclosingLambda(e)||this._addSyntaxError(m.LocMessage.yieldOutsideFunction(),e),this._targetFunctionDeclaration&&(this._targetFunctionDeclaration.yieldStatements||(this._targetFunctionDeclaration.yieldStatements=[]),this._targetFunctionDeclaration.yieldStatements.push(e),this._targetFunctionDeclaration.isGenerator=!0),e.expression&&this.walk(e.expression),y.setFlowNode(e,this._currentFlowNode)}_getUniqueFlowNodeId(){return this._codeFlowComplexity+=.05,(0,g.getUniqueFlowNodeId)()}_addDiagnostic(e,t,n,a){let r;switch(e){case"error":case"warning":case"information":r=this._fileInfo.diagnosticSink.addDiagnosticWithTextRange(e,n,a);break;case"none":break;default:return(0,o.assertNever)(e,`${e} is not expected`)}return r&&r.setRule(t),r}_addSyntaxError(e,t){return this._fileInfo.diagnosticSink.addDiagnosticWithTextRange("error",e,t)}}t.Binder=k,k._unreachableFlowNode={flags:g.FlowFlags.Unreachable,id:(0,g.getUniqueFlowNodeId)()};class w extends v.ParseTreeWalker{constructor(){super(...arguments),this._containsYield=!1}checkContainsYield(e){return this.walk(e),this._containsYield}visitYield(e){return this._containsYield=!0,!1}visitYieldFrom(e){return this._containsYield=!0,!1}}t.YieldFinder=w;class S extends v.ParseTreeWalker{constructor(){super(...arguments),this._containsReturn=!1}checkContainsReturn(e){return this.walk(e),this._containsReturn}visitReturn(e){return this._containsReturn=!0,!1}}t.ReturnFinder=S;class A extends v.ParseTreeWalker{constructor(e){super(),this._currentScope=e}visitClass(e){const t=this._createNewScope(3,(()=>{this.walk(e.suite)}));return y.getScope(e)||y.setScope(e,t),!1}visitFunction(e){const t=this._createNewScope(2,(()=>{this.walk(e.suite)}));return y.getScope(e)||y.setScope(e,t),!1}_createNewScope(e,t){const n=this._currentScope,a=new b.Scope(e,this._currentScope);return this._currentScope=a,t(),this._currentScope=n,a}}t.DummyScopeGenerator=A},80232:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CacheManager=void 0;const a=n(83181),r=n(47604);class s{constructor(e=0){this._maxWorkers=e,this._pausedCount=0,this._cacheOwners=[],this._sharedUsagePosition=0,this._lastHeapStats=Date.now()}registerCacheOwner(e){this._cacheOwners.push(e)}addWorker(e,t){const n=this._getSharedUsageBuffer();n&&(t.postMessage({requestType:"cacheUsageBuffer",sharedUsageBuffer:n,data:e.toString()}),t.on("exit",(()=>{new Float64Array(n)[e]=0})))}handleCachedUsageBufferMessage(e){if("cacheUsageBuffer"===e.requestType){const t=parseInt(e.data||"0"),n=e.sharedUsageBuffer;n&&t&&(this._sharedUsageBuffer=n,this._sharedUsagePosition=t)}}unregisterCacheOwner(e){const t=this._cacheOwners.findIndex((t=>t===e));t<0?(0,a.fail)("Specified cache provider not found"):this._cacheOwners.splice(t,1)}pauseTracking(){const e=this;return e._pausedCount++,{dispose(){e._pausedCount--}}}getCacheUsage(){if(this._pausedCount>0)return-1;let e=0;return this._cacheOwners.forEach((t=>{e+=t.getCacheUsage()})),e}emptyCache(e){if(e){const t=(0,r.getHeapStatistics)();e.info(`Emptying type cache to avoid heap overflow. Used ${this._convertToMB(t.used_heap_size)} out of ${this._convertToMB(t.heap_size_limit)}.`)}this._cacheOwners.forEach((e=>{e.emptyCache()}))}getUsedHeapRatio(e){const t=(0,r.getHeapStatistics)();let n=this._getTotalHeapUsage(t);return e&&Date.now()-this._lastHeapStats>1e3&&(this._lastHeapStats=Date.now(),e.info(`Heap stats: total_heap_size=${this._convertToMB(t.total_heap_size)}, used_heap_size=${this._convertToMB(t.used_heap_size)}, cross_worker_used_heap_size=${this._convertToMB(n)}, total_physical_size=${this._convertToMB(t.total_physical_size)}, total_available_size=${this._convertToMB(t.total_available_size)}, heap_size_limit=${this._convertToMB(t.heap_size_limit)}`)),n+=.05*n,n/t.heap_size_limit}_convertToMB(e){return`${Math.round(e/1048576)}MB`}_getSharedUsageBuffer(){try{return!this._sharedUsageBuffer&&this._maxWorkers>0&&(this._sharedUsageBuffer=new SharedArrayBuffer(8*(this._maxWorkers+1))),this._sharedUsageBuffer}catch{return}}_getTotalHeapUsage(e){const t=this._getSharedUsageBuffer();if(t){const n=new Float64Array(t);return n[this._sharedUsagePosition]=e.used_heap_size,n.reduce(((e,t)=>e+t),0)}return e.used_heap_size}}t.CacheManager=s,function(e){e.is=function(e){return void 0!==e.registerCacheOwner&&void 0!==e.unregisterCacheOwner&&void 0!==e.pauseTracking&&void 0!==e.getCacheUsage&&void 0!==e.emptyCache&&void 0!==e.getUsedHeapRatio}}(s||(t.CacheManager=s={}))},2816:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Checker=void 0;const i=n(65872),o=n(28040),l=n(83181),p=n(72484),c=n(97652),d=n(61328),u=n(55164),m=n(55084),y=n(46772),g=n(95960),h=n(79428),f=n(70736),T=s(n(9316)),v=n(90272),b=n(65392),_=n(61340),C=n(27884),I=n(62744),k=n(29332),w=n(21440),S=n(92488),A=s(n(28340)),x=n(78232),P=n(3573),N=n(85636),D=n(69160),F=n(41500),E=n(76392),M=n(21084),O=s(n(80944)),z=n(8e4),V=n(508),U=n(46048),R=n(808),L=n(97632),j=n(45468),B=n(8312);class q extends x.ParseTreeWalker{constructor(e,t,n,a,r){super(),this._importResolver=e,this._evaluator=t,this._sourceMapper=a,this._dependentFiles=r,this._isUnboundCheckSuppressed=!1,this._scopedNodes=[],this._typeParameterLists=[],this._moduleNode=n.parseTree,this._fileInfo=T.getFileInfo(this._moduleNode)}check(){this._scopedNodes.push(this._moduleNode),this._conditionallyReportShadowedModule();const e=T.getCodeFlowComplexity(this._moduleNode);e>V.maxCodeComplexity&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.codeTooComplexToAnalyze(),{start:0,length:0}),this._walkStatementsAndReportUnreachable(this._moduleNode.statements);const t=T.getDunderAllInfo(this._moduleNode);t&&(this._evaluator.markNamesAccessed(this._moduleNode,t.names),this._reportUnusedDunderAllSymbols(t.stringNodes)),this._validateSymbolTables(),this._reportDuplicateImports()}walk(e){T.isCodeUnreachable(e)?this._evaluator.suppressDiagnostics(e,(()=>{super.walk(e)})):super.walk(e)}visitSuite(e){return this._walkStatementsAndReportUnreachable(e.statements),!1}visitStatementList(e){return e.statements.forEach((e=>{(0,h.isExpressionNode)(e)&&(this._evaluator.getType(e),this._reportUnusedExpression(e))})),!0}visitClass(e){const t=this._evaluator.getTypeOfClass(e);return e.typeParameters&&this.walk(e.typeParameters),this.walk(e.suite),this.walkMultiple(e.decorators),this.walkMultiple(e.arguments),t&&(B.ClassType.isProtocolClass(t.classType)&&(e.arguments.forEach((e=>{if(!e.name){const n=this._evaluator.getType(e.valueExpression);n&&(0,B.isInstantiableClass)(n)&&!B.ClassType.isBuiltIn(n,"Protocol")&&!B.ClassType.isBuiltIn(n,"Generic")&&(B.ClassType.isProtocolClass(n)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.protocolBaseClass().format({classType:t.classType.details.name,baseType:n.details.name}),e.valueExpression))}})),this._validateProtocolTypeParamVariance(e,t.classType)),this._fileInfo.isStubFile||this._validateSlotsClassVarConflict(t.classType),this._validateBaseClassOverrides(t.classType),this._validateTypedDictOverrides(t.classType),this._validateOverloadDecoratorConsistency(t.classType),this._validateMultipleInheritanceBaseClasses(t.classType,e.name),this._validateMultipleInheritanceCompatibility(t.classType,e.name),this._validateConstructorConsistency(t.classType,e.name),this._validateFinalMemberOverrides(t.classType),this._validateInstanceVariableInitialization(e,t.classType),this._validateFinalClassNotAbstract(t.classType,e),this._validateDataClassPostInit(t.classType,e),this._validateEnumMembers(t.classType,e),B.ClassType.isTypedDictClass(t.classType)&&this._validateTypedDictClassSuite(e.suite),B.ClassType.isEnumClass(t.classType)&&this._validateEnumClassOverride(e,t.classType),this._evaluator.validateInitSubclassArgs(e,t.classType)),this._scopedNodes.push(e),!1}visitFunction(e){var t,n;e.typeParameters&&this.walk(e.typeParameters),this._fileInfo.diagnosticRuleSet.analyzeUnannotatedFunctions||this._fileInfo.isStubFile||A.isUnannotatedFunction(e)&&this._evaluator.addInformation(g.LocMessage.unannotatedFunctionSkipped().format({name:e.name.value}),e.name);const a=this._evaluator.getTypeOfFunction(e),r=A.getEnclosingClass(e,!0);if(a){let s=!1;const i=new Set,o=(0,S.getParameterListDetails)(a.functionType);if(e.parameters.forEach(((e,t)=>{if(e.name)if(0===e.category&&t>=o.positionOnlyParamCount&&i.add(e.name.value),1===e.category){const t=e.typeAnnotation||e.typeAnnotationComment;if(t&&35===t.nodeType&&"args"===t.memberName.value){const e=this._evaluator.getType(t.leftExpression);e&&(0,B.isTypeVar)(e)&&e.details.isParamSpec&&(s=!0)}}else 2===e.category&&(s=!1);if(e.name&&0===e.category&&s&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.namedParamAfterParamSpecArgs().format({name:e.name.value}),e.name),e.name&&"_"!==e.name.value){const t=a.functionType.details.parameters.find((t=>{var n;return t.name===(null===(n=e.name)||void 0===n?void 0:n.value)}));if(t){const n=t.type;if("none"!==this._fileInfo.diagnosticRuleSet.reportUnknownParameterType)if((0,B.isUnknown)(n)||(0,B.isTypeVar)(n)&&n.details.isSynthesized&&!n.details.isSynthesizedSelf)this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownParameterType,g.LocMessage.paramTypeUnknown().format({paramName:e.name.value}),e.name);else if((0,R.isPartlyUnknown)(n)){const t=new p.DiagnosticAddendum;t.addMessage(g.LocAddendum.paramType().format({paramType:this._evaluator.printType(n,{expandTypeAlias:!0})})),this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownParameterType,g.LocMessage.paramTypePartiallyUnknown().format({paramName:e.name.value})+t.getString(),e.name)}let a=!1;(t.typeAnnotation||(0,B.isTypeVar)(n)&&n.details.isSynthesizedSelf)&&(a=!0),a||"none"===this._fileInfo.diagnosticRuleSet.reportMissingParameterType||this._evaluator.addDiagnostic(c.DiagnosticRule.reportMissingParameterType,g.LocMessage.paramAnnotationMissing().format({name:e.name.value}),e.name)}}})),o.hasUnpackedTypedDict){const n=a.functionType.details.parameters.length-1,r=B.FunctionType.getEffectiveParameterType(a.functionType,n);if((0,B.isClass)(r)&&r.details.typedDictEntries){const a=new Set;r.details.typedDictEntries.knownItems.forEach(((e,t)=>{i.has(t)&&a.add(t)})),a.size>0&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.overlappingKeywordArgs().format({names:[...a.values()].join(", ")}),null!==(t=e.parameters[n].typeAnnotation)&&void 0!==t?t:e.parameters[n])}}const l=a.functionType.details.parameters.filter((e=>!!(e.typeAnnotation&&(0,B.isTypeVar)(e.type)&&(0,B.isParamSpec)(e.type)&&0!==e.category&&e.name&&e.type.paramSpecAccess)));if(1===l.length&&l[0].typeAnnotation&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.paramSpecArgsKwargsUsage(),l[0].typeAnnotation),this._fileInfo.isStubFile){e.returnTypeAnnotation||(null===(n=e.functionAnnotationComment)||void 0===n?void 0:n.returnTypeAnnotation)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownParameterType,g.LocMessage.returnTypeUnknown(),e.name)}r&&this._validateMethod(e,a.functionType,r)}e.parameters.forEach(((e,t)=>{if(e.defaultValue&&this.walk(e.defaultValue),e.typeAnnotation&&this.walk(e.typeAnnotation),e.typeAnnotationComment&&this.walk(e.typeAnnotationComment),a){const n=e.typeAnnotation||e.typeAnnotationComment;if(n&&t<a.functionType.details.parameters.length){const e=a.functionType.details.parameters[t].type,s=["__init__","__new__"];r&&(0,B.isTypeVar)(e)&&3===e.details.declaredVariance&&!e.details.isSynthesized&&!s.some((e=>e===a.functionType.details.name))&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.paramTypeCovariant(),n)}}})),e.returnTypeAnnotation&&this.walk(e.returnTypeAnnotation),e.functionAnnotationComment&&(this.walk(e.functionAnnotationComment),"none"!==this._fileInfo.diagnosticRuleSet.reportTypeCommentUsage&&this._fileInfo.executionEnvironment.pythonVersion.isGreaterOrEqualTo(d.pythonVersion3_5)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportTypeCommentUsage,g.LocMessage.typeCommentDeprecated(),e.functionAnnotationComment)),this.walkMultiple(e.decorators),e.parameters.forEach((e=>{e.name&&this.walk(e.name)}));const s=T.getCodeFlowComplexity(e),i=s>V.maxCodeComplexity;if(i?this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.codeTooComplexToAnalyze(),e.name):this.walk(e.suite),a&&(i||this._validateFunctionReturn(e,a.functionType),this._validateDunderSignatures(e,a.functionType,void 0!==r),this._validateTypeGuardFunction(e,a.functionType,void 0!==r),this._validateFunctionTypeVarUsage(e,a),this._validateGeneratorReturnType(e,a.functionType),this._reportDeprecatedClassProperty(e,a),!r&&B.FunctionType.isFinal(a.functionType)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalNonMethod().format({name:e.name.value}),e.name)),this._fileInfo.isStubFile&&"__getattr__"===e.name.value){const t=(0,D.getScopeForNode)(e);4===(null==t?void 0:t.type)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompleteStub,g.LocMessage.stubUsesGetAttr(),e.name)}if(this._scopedNodes.push(e),a&&(0,B.isOverloadedFunction)(a.decoratedType)){if(B.OverloadedFunctionType.getImplementation(a.decoratedType)!==a.functionType){const t=B.OverloadedFunctionType.getOverloads(a.decoratedType);if(t.length>1){const n=100;t.length<n&&this._validateOverloadConsistency(e,t[t.length-1],t.slice(0,t.length-1))}}this._validateOverloadAttributeConsistency(e,a.decoratedType)}return!1}visitLambda(e){this._evaluator.getType(e),this.walkMultiple([...e.parameters,e.expression]),e.parameters.forEach((e=>{if(e.name){const t=this._evaluator.getType(e.name);t&&((0,B.isUnknown)(t)?this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownLambdaType,g.LocMessage.paramTypeUnknown().format({paramName:e.name.value}),e.name):(0,R.isPartlyUnknown)(t)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownLambdaType,g.LocMessage.paramTypePartiallyUnknown().format({paramName:e.name.value}),e.name))}}));const t=this._evaluator.getType(e.expression);return t&&((0,B.isUnknown)(t)?this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownLambdaType,g.LocMessage.lambdaReturnTypeUnknown(),e.expression):(0,R.isPartlyUnknown)(t)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownLambdaType,g.LocMessage.lambdaReturnTypePartiallyUnknown().format({returnType:this._evaluator.printType(t,{expandTypeAlias:!0})}),e.expression)),this._scopedNodes.push(e),!1}visitCall(e){var t;if(this._validateIsInstanceCall(e),this._validateIllegalDefaultParamInitializer(e),this._validateStandardCollectionInstantiation(e),("none"!==this._fileInfo.diagnosticRuleSet.reportUnusedCallResult||"none"!==this._fileInfo.diagnosticRuleSet.reportUnusedCoroutine)&&47===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)){const t=38===e.leftExpression.nodeType&&"reveal_type"===e.leftExpression.value,n=this._evaluator.getType(e);!t&&n&&this._isTypeValidForUnusedValueTest(n)&&(this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnusedCallResult,g.LocMessage.unusedCallResult().format({type:this._evaluator.printType(n)}),e),(0,B.isClassInstance)(n)&&B.ClassType.isBuiltIn(n,"Coroutine")&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnusedCoroutine,g.LocMessage.unusedCoroutine(),e))}return!0}visitAwait(e){var t;if("none"!==this._fileInfo.diagnosticRuleSet.reportUnusedCallResult&&47===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&9===e.expression.nodeType){const t=this._evaluator.getType(e);t&&this._isTypeValidForUnusedValueTest(t)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnusedCallResult,g.LocMessage.unusedCallResult().format({type:this._evaluator.printType(t)}),e)}return!0}visitFor(e){return this._evaluator.evaluateTypesForStatement(e),e.typeComment&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportInvalidTypeForm,c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.annotationNotSupported(),e.typeComment),!0}visitList(e){return this._validateIllegalDefaultParamInitializer(e),!0}visitSet(e){return this._validateIllegalDefaultParamInitializer(e),!0}visitDictionary(e){return this._validateIllegalDefaultParamInitializer(e),!0}visitListComprehension(e){return this._scopedNodes.push(e),!0}visitListComprehensionIf(e){return this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitIf(e){return this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitWhile(e){return this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitWith(e){return e.withItems.forEach((e=>{this._evaluator.evaluateTypesForStatement(e)})),e.typeComment&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportInvalidTypeForm,c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.annotationNotSupported(),e.typeComment),!0}visitReturn(e){var t,n,a,r,s;let i,o;const l=A.getEnclosingFunction(e),d=l?this._evaluator.getFunctionDeclaredReturnType(l):void 0;if(i=e.returnExpression?null!==(t=this._evaluator.getTypeResult(e.returnExpression))&&void 0!==t?t:{type:B.UnknownType.create()}:{type:this._evaluator.getNoneType()},o=i.type,o.specialForm&&(o=o.specialForm),(null==l?void 0:l.isAsync)&&e.returnExpression){const t=T.getDeclaration(l);5===(null==t?void 0:t.type)&&t.isGenerator&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.returnInAsyncGenerator(),e.returnExpression)}if(this._evaluator.isNodeReachable(e,void 0)&&l){if(d)if((0,B.isNever)(d))this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.noReturnContainsReturn(),e);else{let t=new p.DiagnosticAddendum,r=!1;if(this._evaluator.assignType(d,o,t,new L.TypeVarContext,void 0,128))r=!0;else{const n=(0,R.getTypeVarArgumentsRecursive)(d);if(n&&n.some((e=>e.details.constraints.length>0))){const a=new L.TypeVarContext;for(const t of n)if(t.details.constraints.length>0){const n=this._evaluator.narrowConstrainedTypeVar(e,t);n&&(a.setTypeVarType(t,n),a.addSolveForScope((0,R.getTypeVarScopeId)(t)))}if(!a.isEmpty()){const e=(0,R.applySolvedTypeVars)(d,a);this._evaluator.assignType(e,o,t,void 0,void 0,128)&&(r=!0)}}}r||(i.expectedTypeDiagAddendum&&(t=i.expectedTypeDiagAddendum),this._evaluator.addDiagnostic(c.DiagnosticRule.reportReturnType,g.LocMessage.returnTypeMismatch().format({exprType:this._evaluator.printType(o),returnType:this._evaluator.printType(d)})+t.getString(),null!==(n=e.returnExpression)&&void 0!==n?n:e,null===(a=i.expectedTypeDiagAddendum)||void 0===a?void 0:a.getEffectiveTextRange()))}(0,B.isUnknown)(o)?this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownVariableType,g.LocMessage.returnTypeUnknown(),null!==(r=e.returnExpression)&&void 0!==r?r:e):(0,R.isPartlyUnknown)(o)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownVariableType,g.LocMessage.returnTypePartiallyUnknown().format({returnType:this._evaluator.printType(o,{expandTypeAlias:!0})}),null!==(s=e.returnExpression)&&void 0!==s?s:e)}return!0}visitYield(e){var t;const n=e.expression?this._evaluator.getTypeResult(e.expression):{type:this._evaluator.getNoneType()};return this._validateYieldType(e,null!==(t=null==n?void 0:n.type)&&void 0!==t?t:B.UnknownType.create(),null==n?void 0:n.expectedTypeDiagAddendum),!0}visitYieldFrom(e){var t,n,a,r;const s=this._evaluator.getType(e.expression)||B.UnknownType.create();let i,o;if((0,B.isClassInstance)(s)&&B.ClassType.isBuiltIn(s,"Coroutine"))i=B.UnknownType.create();else{i=null!==(n=null===(t=this._evaluator.getTypeOfIterable({type:s},!1,e))||void 0===t?void 0:t.type)&&void 0!==n?n:B.UnknownType.create();const l=(0,R.getGeneratorTypeArgs)(i);l?(i=l.length>=1?l[0]:B.UnknownType.create(),o=l.length>=2?l[1]:void 0):i=null!==(r=null===(a=this._evaluator.getTypeOfIterator({type:s},!1,e))||void 0===a?void 0:a.type)&&void 0!==r?r:B.UnknownType.create()}return this._validateYieldType(e,i,void 0,o),!0}visitRaise(e){if(this._evaluator.verifyRaiseExceptionType(e),e.valueExpression){const t=this._evaluator.getBuiltInType(e,"BaseException"),n=this._evaluator.getType(e.valueExpression);if(n&&t&&(0,B.isInstantiableClass)(t)){const a=new p.DiagnosticAddendum;(0,R.doForEachSubtype)(n,(e=>{e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(0,B.isAnyOrUnknown)(e)||(0,R.isNoneInstance)(e)||(0,B.isClass)(e)&&(0,R.derivesFromClassRecursive)(e,t,!1)||a.addMessage(g.LocMessage.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)}))})),a.isEmpty()||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.expectedExceptionObj()+a.getString(),e.valueExpression)}}return!0}visitExcept(e){if(e.typeExpression){this._evaluator.evaluateTypesForStatement(e);const t=this._evaluator.getType(e.typeExpression);t&&this._validateExceptionType(t,e.typeExpression)}return!0}visitAssert(e){e.exceptionExpression&&this._evaluator.getType(e.exceptionExpression),this._validateConditionalIsBool(e.testExpression);const t=this._evaluator.getType(e.testExpression);return t&&(0,B.isClassInstance)(t)&&(0,R.isTupleClass)(t)&&t.tupleTypeArguments&&t.tupleTypeArguments.length>0&&((0,R.isUnboundedTupleClass)(t)||this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportAssertAlwaysTrue,c.DiagnosticRule.reportAssertAlwaysTrue,g.LocMessage.assertAlwaysTrue(),e.testExpression)),!0}visitAssignment(e){if(this._evaluator.evaluateTypesForStatement(e),e.typeAnnotationComment&&(this._evaluator.getType(e.typeAnnotationComment),"none"!==this._fileInfo.diagnosticRuleSet.reportTypeCommentUsage&&this._fileInfo.executionEnvironment.pythonVersion.isGreaterOrEqualTo(d.pythonVersion3_6)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportTypeCommentUsage,g.LocMessage.typeCommentDeprecated(),e.typeAnnotationComment)),54===e.leftExpression.nodeType){const t=this._evaluator.getTypeOfAnnotation(e.leftExpression.typeAnnotation);if((0,B.isClassInstance)(t)&&B.ClassType.isBuiltIn(t,"TypeAlias")){const t=(0,D.getScopeForNode)(e);t&&3!==t.type&&4!==t.type&&5!==t.type&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasNotInModuleOrClass(),e.leftExpression.typeAnnotation)}}return!0}visitAssignmentExpression(e){return this._evaluator.getType(e),!0}visitAugmentedAssignment(e){return this._evaluator.evaluateTypesForStatement(e),!0}visitIndex(e){this._evaluator.getType(e);const t=this._evaluator.getType(e.baseExpression);return t&&(0,R.doForEachSubtype)(t,(n=>{const a=(0,R.getSpecializedTupleType)(n);if(!(0,B.isClassInstance)(n)||!(null==a?void 0:a.tupleTypeArguments)||(0,R.isUnboundedTupleClass)(a))return;const r=a.tupleTypeArguments.length;if(1!==e.items.length||e.trailingComma||0!==e.items[0].argumentCategory||e.items[0].name)return;const s=this._evaluator.getType(e.items[0].valueExpression);s&&(0,B.isClassInstance)(s)&&B.ClassType.isBuiltIn(s,"int")&&(0,R.isLiteralType)(s)&&"number"==typeof s.literalValue&&((s.literalValue<0||s.literalValue<r)&&(s.literalValue>=0||s.literalValue+r>=0)||this._evaluator.isTypeSubsumedByOtherType(a,t,!1)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.tupleIndexOutOfRange().format({index:s.literalValue,type:this._evaluator.printType(n)}),e))})),!0}visitBinaryOperation(e){return 36!==e.operator&&37!==e.operator||(this._validateConditionalIsBool(e.leftExpression),this._validateConditionalIsBool(e.rightExpression)),12===e.operator||28===e.operator?A.isWithinAssertExpression(e)||this._validateComparisonTypes(e):39===e.operator||40===e.operator?A.isWithinAssertExpression(e)||this._validateComparisonTypesForIsOperator(e):41!==e.operator&&42!==e.operator||A.isWithinAssertExpression(e)||this._validateContainmentTypes(e),this._evaluator.getType(e),!0}visitSlice(e){return this._evaluator.getType(e),!0}visitUnpack(e){return this._evaluator.getType(e),!0}visitTuple(e){return this._evaluator.getType(e),!0}visitUnaryOperation(e){return 38===e.operator&&this._validateConditionalIsBool(e.expression),this._evaluator.getType(e),!0}visitTernary(e){return this._evaluator.getType(e),this._validateConditionalIsBool(e.testExpression),this._reportUnnecessaryConditionExpression(e.testExpression),!0}visitStringList(e){const t=[];if(this._fileInfo.executionEnvironment.pythonVersion.isLessThan(d.pythonVersion3_12)){let n=e;for(;n;)27===n.nodeType&&t.push(n),n=n.parent}for(const n of e.strings){if((49===n.nodeType?[n.token]:n.middleTokens).forEach((e=>{const n=(0,f.getUnescapedString)(e);let a=e.start;if(5===e.type&&(a+=e.prefixLength+e.quoteMarkLength),n.unescapeErrors.forEach((e=>{0===e.errorType&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportInvalidStringEscapeSequence,c.DiagnosticRule.reportInvalidStringEscapeSequence,g.LocMessage.stringUnsupportedEscape(),{start:a+e.offset,length:e.length})})),t.length>0){e.escapedValue.indexOf("\\")>=0&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.formatStringEscape(),{start:a,length:1})}})),t.length>0){const e=7;t.some((t=>(t.token.flags&e)==(n.token.flags&e)))&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.formatStringNestedQuote(),n)}}return e.typeAnnotation&&this._evaluator.getType(e),e.strings.length>1&&!e.isParenthesized&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportImplicitStringConcatenation,c.DiagnosticRule.reportImplicitStringConcatenation,g.LocMessage.implicitStringConcat(),e),!0}visitFormatString(e){return e.fieldExpressions.forEach((e=>{this._evaluator.getType(e)})),e.formatExpressions.forEach((e=>{this._evaluator.getType(e)})),!0}visitGlobal(e){return this._suppressUnboundCheck((()=>{e.nameList.forEach((e=>{this._evaluator.getType(e),this.walk(e)}))})),!1}visitNonlocal(e){return this._suppressUnboundCheck((()=>{e.nameList.forEach((e=>{this._evaluator.getType(e),this.walk(e)}))})),!1}visitName(e){this._conditionallyReportPrivateUsage(e),this._isUnboundCheckSuppressed||this._reportUnboundName(e);const t=this._evaluator.getType(e);return this._reportDeprecatedUseForType(e,t),!0}visitDel(e){return e.expressions.forEach((e=>{this._evaluator.verifyDeleteExpression(e),this.walk(e)})),!1}visitMemberAccess(e){var t;const n=this._evaluator.getTypeResult(e),a=null!==(t=null==n?void 0:n.type)&&void 0!==t?t:B.UnknownType.create(),r=this._evaluator.getType(e.leftExpression);return this._reportDeprecatedUseForType(e.memberName,a,r&&(0,B.isModule)(r)&&"typing"===r.moduleName),(null==n?void 0:n.memberAccessDeprecationInfo)&&this._reportDeprecatedUseForMemberAccess(e.memberName,n.memberAccessDeprecationInfo),this._conditionallyReportPrivateUsage(e.memberName),this.walk(e.leftExpression),!1}visitImportAs(e){return this._conditionallyReportShadowedImport(e),this._evaluator.evaluateTypesForStatement(e),!0}visitImportFrom(e){if(0===e.module.leadingDots&&1===e.module.nameParts.length&&"__future__"===e.module.nameParts[0].value&&(A.isValidLocationForFutureImport(e)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.futureImportLocationNotAllowed(),e)),this._conditionallyReportShadowedImport(e),e.isWildcardImport){this._evaluator.evaluateTypesForStatement(e);const t=T.getImportInfo(e.module);t&&t.isImportFound&&2!==t.importType&&!this._fileInfo.isStubFile&&this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportWildcardImportFromLibrary,c.DiagnosticRule.reportWildcardImportFromLibrary,g.LocMessage.wildcardLibraryImport(),e.wildcardToken||e)}else e.imports.forEach((e=>{this._evaluator.evaluateTypesForStatement(e)}));return!0}visitImportFromAs(e){var t,n;if(this._fileInfo.isStubFile)return!1;const a=this._evaluator.getDeclarationsForNameNode(e.name);if(!a)return!1;for(const t of a){if(!(0,b.isAliasDeclaration)(t)||!t.submoduleFallback||t.node!==e)continue;const n=this._evaluator.resolveAliasDeclaration(t,!0),a=null==n?void 0:n.uri;if(!a||!(0,E.isStubFile)(a))continue;const r=this._getImportResult(e,a);if(r){this._addMissingModuleSourceDiagnosticIfNeeded(r,e.name);break}}let r=!1;22===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&0===e.parent.module.leadingDots&&1===e.parent.module.nameParts.length&&"typing"===e.parent.module.nameParts[0].value&&(r=!0);const s=this._evaluator.getType(null!==(n=e.alias)&&void 0!==n?n:e.name);return this._reportDeprecatedUseForType(e.name,s,r),!1}visitModuleName(e){if(this._fileInfo.isStubFile)return!1;const t=T.getImportInfo(e);return(0,l.assert)(void 0!==t),this._addMissingModuleSourceDiagnosticIfNeeded(t,e),!1}visitTypeParameterList(e){return this._typeParameterLists.push(e),!0}visitTypeParameter(e){var t,n,a,r;let s=null===(n=null===(t=e.parent)||void 0===t?void 0:t.parent)||void 0===n?void 0:n.parent,i=!1;for(;s;){const t=A.getTypeVarScopeNode(s);if(!t)break;if(10===t.nodeType){const n=null===(a=this._evaluator.getTypeOfClass(t))||void 0===a?void 0:a.classType;if(null==n?void 0:n.details.typeParameters.some((t=>t.details.name===e.name.value))){i=!0;break}}else if(28===t.nodeType){const n=null===(r=this._evaluator.getTypeOfFunction(t))||void 0===r?void 0:r.functionType;if(null==n?void 0:n.details.typeParameters.some((t=>t.details.name===e.name.value))){i=!0;break}}s=t.parent}return i&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarUsedByOuterScope().format({name:e.name.value}),e.name),!1}visitTypeAlias(e){const t=(0,D.getScopeForNode)(e);return t&&3!==t.type&&4!==t.type&&5!==t.type&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasStatementBadScope(),e.name),!0}visitTypeAnnotation(e){return this._evaluator.getType(e.typeAnnotation),!0}visitMatch(e){return this._evaluator.getType(e.subjectExpression),this._validateExhaustiveMatch(e),!0}visitCase(e){return e.guardExpression&&this._validateConditionalIsBool(e.guardExpression),this._evaluator.evaluateTypesForStatement(e.pattern),!0}visitPatternClass(e){return(0,P.validateClassPattern)(this._evaluator,e),!0}visitTry(e){return this._reportUnusedExceptStatements(e),!0}visitError(e){return e.child&&this._evaluator.getType(e.child),!1}_getImportResult(e,t){const n=this._importResolver.getConfigOptions().findExecEnvironment(t),a=0===e.parent.module.leadingDots?this._importResolver.getModuleNameForImport(t,n).moduleName:(0,w.getRelativeModuleName)(this._importResolver.fileSystem,this._fileInfo.fileUri,t,this._importResolver.getConfigOptions());if(a)return this._importResolver.resolveImport(this._fileInfo.fileUri,n,(0,k.createImportedModuleDescriptor)(a))}_addMissingModuleSourceDiagnosticIfNeeded(e,t){!e.isNativeLib&&e.isStubFile&&0!==e.importType&&e.nonStubImportResult&&!e.nonStubImportResult.isImportFound&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportMissingModuleSource,g.LocMessage.importSourceResolveFailure().format({importName:e.importName,venv:this._fileInfo.executionEnvironment.name}),t)}_validateConditionalIsBool(e){const t=this._evaluator.getType(e);if(!t)return;let n=!0;const a=new p.DiagnosticAddendum;this._evaluator.mapSubtypesExpandTypeVars(t,void 0,(t=>{if((0,B.isAnyOrUnknown)(t))return;if((0,B.isClassInstance)(t)&&B.ClassType.isBuiltIn(t,"bool"))return;const r=this._evaluator.getTypeOfMagicMethodCall(t,"__bool__",[],e,void 0);r&&!(0,B.isAnyOrUnknown)(r)&&((0,B.isClassInstance)(r)&&B.ClassType.isBuiltIn(r,"bool")||(n=!1,a.addMessage(g.LocAddendum.conditionalRequiresBool().format({operandType:this._evaluator.printType(t),boolReturnType:this._evaluator.printType(r)}))))})),n||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.conditionalOperandInvalid().format({type:this._evaluator.printType(t)})+a.getString(),e)}_reportUnnecessaryConditionExpression(e){if(7===e.nodeType)return void(36!==e.operator&&37!==e.operator||(this._reportUnnecessaryConditionExpression(e.leftExpression),this._reportUnnecessaryConditionExpression(e.rightExpression)));if(55===e.nodeType)return void(38===e.operator&&this._reportUnnecessaryConditionExpression(e.expression));const t=this._evaluator.getTypeOfExpression(e);let n=!0,a=!0;(0,R.doForEachSubtype)(t.type,(e=>{e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(0,B.isFunction)(e)||(0,B.isOverloadedFunction)(e)||(n=!1),(0,B.isClassInstance)(e)&&B.ClassType.isBuiltIn(e,"Coroutine")||(a=!1)})),n&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryComparison,g.LocMessage.functionInConditionalExpression(),e),a&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryComparison,g.LocMessage.coroutineInConditionalExpression(),e)}_reportUnusedExpression(e){var t,n;if("none"===this._fileInfo.diagnosticRuleSet.reportUnusedExpression)return;let a=!1;[55,7,40,11,38,52].some((t=>t===e.nodeType))?a=!0:31!==e.nodeType&&45!==e.nodeType&&15!==e.nodeType||e.entries.some((e=>32===e.nodeType))||(a=!0),a&&this._fileInfo.ipythonMode===F.IPythonMode.CellDocs&&47===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.statements[e.parent.statements.length-1]===e&&36===(null===(n=e.parent.parent)||void 0===n?void 0:n.nodeType)&&e.parent.parent.statements[e.parent.parent.statements.length-1]===e.parent&&(a=!1),a&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnusedExpression,g.LocMessage.unusedExpression(),e)}_validateExhaustiveMatch(e){if("none"===this._fileInfo.diagnosticRuleSet.reportMatchNotExhaustive)return;const t=this._evaluator.evaluateTypeForSubnode(e,(()=>{this._evaluator.evaluateTypesForMatchStatement(e)}));if(t&&!(0,B.isNever)(t.type)){const n=new p.DiagnosticAddendum;n.addMessage(g.LocAddendum.matchIsNotExhaustiveType().format({type:this._evaluator.printType(t.type)})),n.addMessage(g.LocAddendum.matchIsNotExhaustiveHint()),this._evaluator.addDiagnostic(c.DiagnosticRule.reportMatchNotExhaustive,g.LocMessage.matchIsNotExhaustive()+n.getString(),e.subjectExpression)}}_suppressUnboundCheck(e){const t=this._isUnboundCheckSuppressed;this._isUnboundCheckSuppressed=!0;try{e()}finally{this._isUnboundCheckSuppressed=t}}_validateIllegalDefaultParamInitializer(e){"none"!==this._fileInfo.diagnosticRuleSet.reportCallInDefaultInitializer&&A.isWithinDefaultParamInitializer(e)&&!this._fileInfo.isStubFile&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportCallInDefaultInitializer,g.LocMessage.defaultValueContainsCall(),e)}_validateStandardCollectionInstantiation(e){const t=this._evaluator.getType(e.leftExpression);if(t&&(0,B.isInstantiableClass)(t)&&B.ClassType.isBuiltIn(t)&&!t.includeSubclasses&&t.aliasName){["List","Set","Dict","Tuple"].some((e=>e===t.aliasName))&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.collectionAliasInstantiation().format({type:t.aliasName,alias:t.details.name}),e.leftExpression)}}_validateContainmentTypes(e){const t=this._evaluator.getType(e.leftExpression),n=this._evaluator.getType(e.rightExpression);if(!t||!n)return;if((0,B.isNever)(t)||(0,B.isNever)(n))return;const a=(0,U.getElementTypeForContainerNarrowing)(n);if(!a)return;const r=(0,U.narrowTypeForContainerElementType)(this._evaluator,t,this._evaluator.makeTopLevelTypeVarsConcrete(a));if((0,B.isNever)(r)){const n=()=>41===e.operator?g.LocMessage.containmentAlwaysFalse():g.LocMessage.containmentAlwaysTrue();this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryContains,n().format({leftType:this._evaluator.printType(t,{expandTypeAlias:!0}),rightType:this._evaluator.printType(a,{expandTypeAlias:!0})}),e)}}_validateComparisonTypesForIsOperator(e){const t=this._evaluator.getType(e.rightExpression);if(!t||!(0,R.isNoneInstance)(t))return;const n=this._evaluator.getType(e.leftExpression);if(!n)return;let a=!1;(0,R.doForEachSubtype)(n,(e=>{e=this._evaluator.makeTopLevelTypeVarsConcrete(e),this._evaluator.assignType(e,this._evaluator.getNoneType())&&(a=!0)}));a||this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryComparison,(39===e.operator?g.LocMessage.comparisonAlwaysFalse():g.LocMessage.comparisonAlwaysTrue()).format({leftType:this._evaluator.printType(n,{expandTypeAlias:!0}),rightType:this._evaluator.printType(t)}),e)}_validateComparisonTypes(e){let t=e.rightExpression;7===t.nodeType&&!t.parenthesized&&A.operatorSupportsChaining(t.operator)&&(t=t.leftExpression);const n=this._evaluator.getType(e.leftExpression),a=this._evaluator.getType(t);if(!n||!a)return;if((0,B.isNever)(n)||(0,B.isNever)(a))return;const r=()=>12===e.operator?g.LocMessage.comparisonAlwaysFalse():g.LocMessage.comparisonAlwaysTrue();if((0,R.isLiteralTypeOrUnion)(a)&&(0,R.isLiteralTypeOrUnion)(n)){if(void 0===(0,M.evaluateStaticBoolExpression)(e,this._fileInfo.executionEnvironment,this._fileInfo.definedConstants)){let t=!1;(0,R.doForEachSubtype)(n,(e=>{this._evaluator.assignType(a,e)&&(t=!0)})),t||this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryComparison,r().format({leftType:this._evaluator.printType(n,{expandTypeAlias:!0}),rightType:this._evaluator.printType(a,{expandTypeAlias:!0})}),e)}}else{let t=!1;if((0,R.doForEachSubtype)(n,(e=>{t||(e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(0,R.doForEachSubtype)(a,(n=>{t||(n=this._evaluator.makeTopLevelTypeVarsConcrete(n),this._isTypeComparable(e,n)&&(t=!0))})))})),!t){const t=this._evaluator.printType(n,{expandTypeAlias:!0}),s=this._evaluator.printType(a,{expandTypeAlias:!0});this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryComparison,r().format({leftType:t,rightType:s}),e)}}}_isTypeComparable(e,t){if((0,B.isAnyOrUnknown)(e)||(0,B.isAnyOrUnknown)(t))return!0;if((0,B.isNever)(e)||(0,B.isNever)(t))return!1;if((0,B.isModule)(e)||(0,B.isModule)(t))return(0,B.isTypeSame)(e,t);if((0,R.isNoneInstance)(e)||(0,R.isNoneInstance)(t))return(0,B.isTypeSame)(e,t);if(((0,B.isFunction)(e)||(0,B.isOverloadedFunction)(e))!==((0,B.isFunction)(t)||(0,B.isOverloadedFunction)(t)))return!1;if((0,B.isInstantiableClass)(e)||(0,B.isClassInstance)(e)&&B.ClassType.isBuiltIn(e,"type")){if((0,B.isInstantiableClass)(t)||(0,B.isClassInstance)(t)&&B.ClassType.isBuiltIn(t,"type")){const n=B.ClassType.cloneForSpecialization(e,void 0,!1),a=B.ClassType.cloneForSpecialization(t,void 0,!1);if(this._evaluator.assignType(n,a)||this._evaluator.assignType(a,n))return!0}const n=e.details.effectiveMetaclass;return!!(n&&(0,B.isClass)(n)&&(0,R.lookUpClassMember)(n,"__eq__",4))}if((0,B.isClassInstance)(e)){if((0,B.isClassInstance)(t)){const n=B.ClassType.cloneForSpecialization(e,void 0,!1),a=B.ClassType.cloneForSpecialization(t,void 0,!1);if(this._evaluator.assignType(n,a)||this._evaluator.assignType(a,n))return!0;if(B.ClassType.isBuiltIn(e)&&B.ClassType.isBuiltIn(t))return!1}const n=(0,R.lookUpClassMember)(B.ClassType.cloneAsInstantiable(e),"__eq__",4);return!!n&&(!B.ClassType.isDataClass(e)||!n.symbol.getSynthesizedType())}return!0}_validateGeneratorReturnType(e,t){var n;if(!B.FunctionType.isGenerator(t))return;const a=t.details.declaredReturnType;if(!a)return;if((0,B.isNever)(a))return;const r=t.details.declaration;if(!r||!r.yieldStatements||0===r.yieldStatements.length)return;let s;if(s=!e.isAsync&&(0,B.isClassInstance)(a)&&B.ClassType.isBuiltIn(a,"AwaitableGenerator")?this._evaluator.getTypingType(e,"AwaitableGenerator"):this._evaluator.getTypingType(e,e.isAsync?"AsyncGenerator":"Generator"),!s||!(0,B.isInstantiableClass)(s))return;const i=B.ClassType.cloneAsInstance(B.ClassType.cloneForSpecialization(s,[B.AnyType.create(),B.AnyType.create(),B.AnyType.create()],!0)),o=new p.DiagnosticAddendum;if(!this._evaluator.assignType(a,i,o)){const t=e.isAsync?g.LocMessage.generatorAsyncReturnType():g.LocMessage.generatorSyncReturnType();this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidTypeForm,t.format({yieldType:this._evaluator.printType(B.AnyType.create())})+o.getString(),null!==(n=e.returnTypeAnnotation)&&void 0!==n?n:e.name)}}_isTypeValidForUnusedValueTest(e){return!(0,R.isNoneInstance)(e)&&!(0,B.isNever)(e)&&!(0,B.isAnyOrUnknown)(e)}_validateFunctionTypeVarUsage(e,t){if("none"===this._fileInfo.diagnosticRuleSet.reportInvalidTypeVarUse)return;const n=t.functionType,a=new Map,r=new Map;let s,i,o=!0;if(B.FunctionType.isInstanceMethod(n)&&"__init__"===e.name.value){const t=A.getEnclosingClassOrFunction(e);if(t&&10===t.nodeType){const e=this._evaluator.getTypeOfClass(t);e&&(0,B.isClass)(e.classType)&&(i=e.classType)}}const l=new A.NameNodeWalker(((t,n,l)=>{var p,c,d,u,m,y;const g=this._evaluator.getType(t);if(g&&(0,B.isTypeVar)(g)&&!g.details.isSynthesizedSelf){if(g.scopeId===A.getScopeIdForNode(e)){let e=g.details.constraints.length>0||g.details.isDefaultExplicit||o&&void 0!==n||(0,B.isParamSpec)(g);if(!e&&l&&void 0!==n){const t=this._evaluator.getType(l);(null==t?void 0:t.typeAliasInfo)&&t.typeAliasInfo.typeParameters&&n<t.typeAliasInfo.typeParameters.length&&(e=!0)}const r=a.get(g.details.name),i=18===(null===(p=null==s?void 0:s.defaultValue)||void 0===p?void 0:p.nodeType);r?(r.nodes.push(t),void 0!==s?(r.paramTypeUsageCount+=1,i&&(r.paramTypeWithEllipsisUsageCount+=1,r.paramWithEllipsis||(r.paramWithEllipsis=null===(d=null==s?void 0:s.name)||void 0===d?void 0:d.value))):r.returnTypeUsageCount+=1):a.set(g.details.name,{nodes:[t],typeVar:g,paramTypeUsageCount:void 0!==s?1:0,paramTypeWithEllipsisUsageCount:i?1:0,returnTypeUsageCount:void 0===s?1:0,paramWithEllipsis:i?null===(c=null==s?void 0:s.name)||void 0===c?void 0:c.value:void 0,isExempt:e})}if(i&&g.scopeId===i.details.typeVarScopeId){const e=r.get(g.details.name),n=18===(null===(u=null==s?void 0:s.defaultValue)||void 0===u?void 0:u.nodeType),a=!!g.details.isDefaultExplicit;e?(e.nodes.push(t),void 0!==s&&(e.paramTypeUsageCount+=1,n&&(e.paramTypeWithEllipsisUsageCount+=1,e.paramWithEllipsis||(e.paramWithEllipsis=null===(y=null==s?void 0:s.name)||void 0===y?void 0:y.value)))):r.set(g.details.name,{typeVar:g,nodes:[t],paramTypeUsageCount:void 0!==s?1:0,paramTypeWithEllipsisUsageCount:n?1:0,returnTypeUsageCount:0,paramWithEllipsis:n?null===(m=null==s?void 0:s.name)||void 0===m?void 0:m.value:void 0,isExempt:a})}}}));e.parameters.forEach((e=>{const t=e.typeAnnotation||e.typeAnnotationComment;t&&(s=e,l.walk(t))})),s=void 0,e.returnTypeAnnotation&&(o=!1,l.walk(e.returnTypeAnnotation)),e.functionAnnotationComment&&(e.functionAnnotationComment.paramTypeAnnotations.forEach((e=>{l.walk(e)})),e.functionAnnotationComment.returnTypeAnnotation&&(o=!1,l.walk(e.functionAnnotationComment.returnTypeAnnotation))),a.forEach((e=>{var a;if(1===e.nodes.length&&!e.isExempt){let t;t=e.typeVar.details.isVariadic?'"tuple[object, ...]"':e.typeVar.details.boundType?`"${this._evaluator.printType((0,R.convertToInstance)(e.typeVar.details.boundType))}"`:'"object"';const n=new p.DiagnosticAddendum;n.addMessage(g.LocAddendum.typeVarUnnecessarySuggestion().format({type:t})),this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidTypeVarUse,g.LocMessage.typeVarUsedOnlyOnce().format({name:e.nodes[0].value})+n.getString(),e.nodes[0])}let r=e.returnTypeUsageCount>0;if(1===e.returnTypeUsageCount&&n.details.declaredReturnType){const t=n.details.declaredReturnType;(0,B.isUnion)(t)&&t.subtypes.some((t=>(0,B.isTypeVar)(t)&&t.details.name===e.nodes[0].value))&&(r=!1)}const s=(0,B.isOverloadedFunction)(t.decoratedType)&&!B.FunctionType.isOverloaded(t.functionType);if(r&&e.paramTypeWithEllipsisUsageCount>0&&e.paramTypeUsageCount===e.paramTypeWithEllipsisUsageCount&&!s){const t=new p.DiagnosticAddendum;t.addMessage(g.LocAddendum.typeVarUnsolvableRemedy()),this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidTypeVarUse,g.LocMessage.typeVarPossiblyUnsolvable().format({name:e.nodes[0].value,param:null!==(a=e.paramWithEllipsis)&&void 0!==a?a:""})+t.getString(),e.nodes[0])}})),r.forEach((e=>{var t;if(e.paramTypeWithEllipsisUsageCount>0&&e.paramTypeUsageCount===e.paramTypeWithEllipsisUsageCount&&!e.isExempt){const n=new p.DiagnosticAddendum;n.addMessage(g.LocAddendum.typeVarUnsolvableRemedy()),this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidTypeVarUse,g.LocMessage.typeVarPossiblyUnsolvable().format({name:e.nodes[0].value,param:null!==(t=e.paramWithEllipsis)&&void 0!==t?t:""})+n.getString(),e.nodes[0])}}))}_validateOverloadAttributeConsistency(e,t){var n,a,r,s,i,o;let l=0,p=0;t.overloads.forEach((e=>{B.FunctionType.isStaticMethod(e)&&l++,B.FunctionType.isClassMethod(e)&&p++})),l>0&&l<t.overloads.length&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentOverload,g.LocMessage.overloadStaticMethodInconsistent().format({name:e.name.value}),null!==(r=null===(a=null===(n=t.overloads[0])||void 0===n?void 0:n.details.declaration)||void 0===a?void 0:a.node.name)&&void 0!==r?r:e.name),p>0&&p<t.overloads.length&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentOverload,g.LocMessage.overloadClassMethodInconsistent().format({name:e.name.value}),null!==(o=null===(i=null===(s=t.overloads[0])||void 0===s?void 0:s.details.declaration)||void 0===i?void 0:i.node.name)&&void 0!==o?o:e.name)}_validateOverloadConsistency(e,t,n){for(let a=0;a<n.length;a++){const r=n[a];if(this._isOverlappingOverload(t,r,!1)){this._evaluator.addDiagnostic(c.DiagnosticRule.reportOverlappingOverload,g.LocMessage.overlappingOverload().format({name:e.name.value,obscured:n.length+1,obscuredBy:a+1}),e.name);break}}for(let a=0;a<n.length;a++){const r=n[a];if(this._isOverlappingOverload(r,t,!0)){const s=B.FunctionType.getSpecializedReturnType(r),i=B.FunctionType.getSpecializedReturnType(t);if(s&&i&&!this._evaluator.assignType(i,s,void 0,new L.TypeVarContext,void 0,1032)){const t=this._findNodeForOverload(e,r);this._evaluator.addDiagnostic(c.DiagnosticRule.reportOverlappingOverload,g.LocMessage.overloadReturnTypeMismatch().format({name:e.name.value,newIndex:n.length+1,prevIndex:a+1}),(t||e).name);break}}}}_findNodeForOverload(e,t){const n=this._evaluator.getDeclarationsForNameNode(e.name);if(n)for(const e of n)if(5===e.type){const n=this._evaluator.getTypeOfFunction(e.node);if((null==n?void 0:n.functionType)===t)return e.node}}_isOverlappingOverload(e,t,n){if(B.FunctionType.isInstanceMethod(e)&&"__get__"===e.details.name)return!1;let a=80;return n&&(a|=32),this._evaluator.assignType(e,t,void 0,new L.TypeVarContext((0,R.getTypeVarScopeId)(e)),void 0,a)}_isLegalOverloadImplementation(e,t,n){var a;const r=new L.TypeVarContext((0,R.getTypeVarScopeId)(t)),s=new L.TypeVarContext((0,R.getTypeVarScopeId)(e));let i=this._evaluator.assignType(e,t,n,s,r,578);const o=null!==(a=e.details.declaredReturnType)&&void 0!==a?a:this._evaluator.getFunctionInferredReturnType(e),l=(0,R.applySolvedTypeVars)(t.details.declaredReturnType||this._evaluator.getFunctionInferredReturnType(t),r),c=new p.DiagnosticAddendum;return(0,B.isNever)(o)||this._evaluator.assignType(l,o,c.createAddendum(),r,s,8)||(c.addMessage(g.LocAddendum.functionReturnTypeMismatch().format({sourceType:this._evaluator.printType(o),destType:this._evaluator.printType(l)})),null==n||n.addAddendum(c),i=!1),i}_walkStatementsAndReportUnreachable(e){let t,n=!1;for(const a of e){if(!n&&!this._evaluator.isNodeReachable(a,t)){const t=a.start,r=e[e.length-1],s=u.TextRange.getEnd(r);this._evaluator.addUnreachableCode(a,{start:t,length:s-t}),n=!0}!n&&this._fileInfo.isStubFile&&this._validateStubStatement(a),this.walk(a),t=a}}_validateStubStatement(e){switch(e.nodeType){case 19:case 28:case 10:case 0:break;case 57:case 26:case 53:case 58:this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidStubStatement,g.LocMessage.invalidStubStatement(),e);break;case 47:for(const t of e.statements){let e=!0;switch(t.nodeType){case 2:case 4:case 6:case 7:case 11:case 14:case 15:case 24:case 26:case 27:case 29:case 30:case 31:case 35:case 38:case 39:case 40:case 43:case 44:case 45:case 46:case 51:case 52:case 53:case 55:case 56:case 57:case 58:case 59:case 60:case 61:e=!1;break;case 5:e=1===t.operator&&38===t.leftExpression.nodeType&&"__all__"===t.leftExpression.value;break;case 9:e=35===t.leftExpression.nodeType&&38===t.leftExpression.leftExpression.nodeType&&"__all__"===t.leftExpression.leftExpression.value}e||this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidStubStatement,g.LocMessage.invalidStubStatement(),t)}}}_validateExceptionTypeRecursive(e,t,n,a){(0,R.doForEachSubtype)(e,(e=>{var r;if(!(0,B.isAnyOrUnknown)(e)&&(0,B.isClass)(e)){if(B.TypeBase.isInstantiable(e))return r=e,void(n&&(0,B.isInstantiableClass)(n)&&!(0,R.derivesFromClassRecursive)(r,n,!1)&&t.addMessage(g.LocMessage.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)})));if(a&&e.tupleTypeArguments)return void e.tupleTypeArguments.forEach((e=>{this._validateExceptionTypeRecursive(e.type,t,n,!1)}));t.addMessage(g.LocMessage.exceptionTypeIncorrect().format({type:this._evaluator.printType(e)}))}}))}_validateExceptionType(e,t){const n=this._evaluator.getBuiltInType(t,"BaseException"),a=new p.DiagnosticAddendum;this._validateExceptionTypeRecursive(e,a,n,!0),a.isEmpty()||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.exceptionTypeNotClass().format({type:this._evaluator.printType(e)}),t)}_reportUnusedDunderAllSymbols(e){if("none"===this._fileInfo.diagnosticRuleSet.reportUnsupportedDunderAll)return;const t=T.getScope(this._moduleNode);t&&e.forEach((e=>{t.symbolTable.has(e.value)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnsupportedDunderAll,g.LocMessage.dunderAllSymbolNotPresent().format({name:e.value}),e)}))}_validateSymbolTables(){var e;const t=null===(e=this._dependentFiles)||void 0===e?void 0:e.map((e=>T.getFileInfo(e.parseTree)));for(const e of this._scopedNodes){const n=T.getScope(e);n&&n.symbolTable.forEach(((e,a)=>{this._conditionallyReportUnusedSymbol(a,e,n.type,t),this._reportIncompatibleDeclarations(a,e),this._reportMultipleFinalDeclarations(a,e,n.type),this._reportMultipleTypeAliasDeclarations(a,e),this._reportInvalidOverload(a,e)}))}const n=this._fileInfo.accessedSymbolSet;for(const e of this._typeParameterLists){const t=T.getScope(e);for(const a of e.parameters){const e=null==t?void 0:t.symbolTable.get(a.name.value);if(!e)return;if(!n.has(e.id)){e.getDeclarations().forEach((e=>{this._conditionallyReportUnusedDeclaration(e,!1)}))}}}}_reportInvalidOverload(e,t){const n=t.getTypedDeclarations();if(n.length>=1){const a=n[0];if(5===a.type){const n=this._evaluator.getEffectiveTypeOfSymbol(t),r=(0,B.isOverloadedFunction)(n)?B.OverloadedFunctionType.getOverloads(n):(0,B.isFunction)(n)&&B.FunctionType.isOverloaded(n)?[n]:[];if(1===r.length&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentOverload,g.LocMessage.singleOverload().format({name:e}),a.node.name),!this._fileInfo.isStubFile&&r.length>0){let t,r=!1;if((0,B.isOverloadedFunction)(n)){t=B.OverloadedFunctionType.getImplementation(n);const e=B.OverloadedFunctionType.getOverloads(n);e.length>0&&""===e[0].details.name&&(r=!0)}else(0,B.isFunction)(n)&&!B.FunctionType.isOverloaded(n)&&(t=n);if(t)(0,B.isOverloadedFunction)(n)&&B.OverloadedFunctionType.getOverloads(n).forEach(((n,r)=>{var s,i,o,l;const d=new p.DiagnosticAddendum;if(!this._isLegalOverloadImplementation(n,t,d)&&t.details.declaration){const p=this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentOverload,g.LocMessage.overloadImplementationMismatch().format({name:e,index:r+1})+d.getString(),t.details.declaration.node.name);p&&n.details.declaration&&p.addRelatedInfo(g.LocAddendum.overloadSignature(),null!==(i=null===(s=n.details.declaration)||void 0===s?void 0:s.uri)&&void 0!==i?i:a.uri,null!==(l=null===(o=n.details.declaration)||void 0===o?void 0:o.range)&&void 0!==l?l:a.range)}}));else{const e=A.getEnclosingClassOrFunction(a.node);if(e&&10===e.nodeType){const t=this._evaluator.getTypeOfClass(e);t&&(B.ClassType.isProtocolClass(t.classType)||B.ClassType.supportsAbstractMethods(t.classType)&&(0,B.isOverloadedFunction)(n)&&B.OverloadedFunctionType.getOverloads(n).every((e=>B.FunctionType.isAbstractMethod(e))))&&(r=!0)}r||this._evaluator.addDiagnostic(c.DiagnosticRule.reportNoOverloadImplementation,g.LocMessage.overloadWithoutImplementation().format({name:a.node.name.value}),a.node.name)}}}}}_reportMultipleFinalDeclarations(e,t,n){if(!this._evaluator.isFinalVariable(t))return;const a=t.getDeclarations();let r=!1,s=!1;if(a.forEach((t=>{var a;this._evaluator.isFinalVariableDeclaration(t)&&(r&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalRedeclaration().format({name:e}),t.node),r=!0);let i=!1;if(1===t.type){if(t.inferredTypeSource){if(s){let e=!1;if(3===n){const n=A.getEnclosingClassOrFunction(t.node);28===(null==n?void 0:n.nodeType)&&(e=!0)}e||(i=!0)}s=!0}}else i=!0;i&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalReassigned().format({name:e}),null!==(a=(0,_.getNameNodeForDeclaration)(t))&&void 0!==a?a:t.node)})),!s&&!this._fileInfo.isStubFile){const n=a.find((e=>1===e.type&&e.isFinal));if(n){let a=!1,r=!1;if(t.isClassMember()&&!t.isClassVar()){const e=A.getEnclosingClass(n.node,!0);if(e){const t=this._evaluator.getTypeOfClass(e);t&&(0,B.isClass)(t.decoratedType)&&(B.ClassType.isDataClass(t.decoratedType)&&(a=!0),B.ClassType.isProtocolClass(t.decoratedType)&&(r=!0))}}a||r||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalUnassigned().format({name:e}),n.node)}}}_reportMultipleTypeAliasDeclarations(e,t){const n=t.getDeclarations(),a=n.find((e=>this._evaluator.isExplicitTypeAliasDeclaration(e)));a&&n.length>1&&n.forEach((t=>{t!==a&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportRedeclaration,g.LocMessage.typeAliasRedeclared().format({name:e}),t.node)}))}_reportIncompatibleDeclarations(e,t){var n,a,r,s;const i=(0,z.getLastTypedDeclarationForSymbol)(t);if(!i)return;if("_"===e)return;let o,l=t.getDeclarations().filter((e=>e!==i));if(5===i.type){const e=this._evaluator.getTypeOfFunction(i.node);l=l.filter((t=>{if(5!==t.type)return!0;const n=this._evaluator.getTypeOfFunction(t.node);if(!n)return!0;const a=e?this._evaluator.makeTopLevelTypeVarsConcrete(e.decoratedType):void 0;return a&&(0,B.isClassInstance)(a)&&B.ClassType.isPropertyClass(a)&&(0,B.isClassInstance)(n.decoratedType)&&B.ClassType.isPropertyClass(n.decoratedType)?n.decoratedType.details.typeSourceId!==a.details.typeSourceId:!B.FunctionType.isOverloaded(n.functionType)}))}if(0===l.length)return;o=5===i.type?i.isMethod?g.LocAddendum.seeMethodDeclaration():g.LocAddendum.seeFunctionDeclaration():6===i.type?g.LocAddendum.seeClassDeclaration():2===i.type?g.LocAddendum.seeParameterDeclaration():1===i.type?g.LocAddendum.seeVariableDeclaration():4===i.type?g.LocAddendum.seeTypeAliasDeclaration():g.LocAddendum.seeDeclaration();const p=e=>{if(e){let t;5===i.type||6===i.type?t=i.node.name:1===i.type?38===i.node.nodeType&&(t=i.node):2!==i.type&&3!==i.type||i.node.name&&(t=i.node.name),t&&e.addRelatedInfo(o,i.uri,i.range)}};for(const t of l)if(6===t.type){let n=!1;if(3===i.type&&(n=!0),!n){p(this._evaluator.addDiagnostic(c.DiagnosticRule.reportRedeclaration,g.LocMessage.obscuredClassDeclaration().format({name:e}),t.node.name))}}else if(5===t.type){const r=null===(n=this._evaluator.getTypeForDeclaration(i))||void 0===n?void 0:n.type;let s=!1;r&&(0,B.isFunction)(r)&&this._evaluator.getFunctionInferredReturnType(r);const o=null===(a=this._evaluator.getTypeForDeclaration(t))||void 0===a?void 0:a.type,l=A.getEnclosingSuite(i.node)===A.getEnclosingSuite(t.node);if(o&&(0,B.isFunction)(o)&&this._evaluator.getFunctionInferredReturnType(o),!l&&r&&o&&(0,B.isTypeSame)(r,o)&&(s=!0),3===i.type&&(s=!0),!s){p(this._evaluator.addDiagnostic(c.DiagnosticRule.reportRedeclaration,t.isMethod?g.LocMessage.obscuredMethodDeclaration().format({name:e}):g.LocMessage.obscuredFunctionDeclaration().format({name:e}),t.node.name))}}else if(2===t.type){if(t.node.name){let n=!1;if(3===i.type&&(n=!0),!n){const n=g.LocMessage.obscuredParameterDeclaration();p(this._evaluator.addDiagnostic(c.DiagnosticRule.reportRedeclaration,n.format({name:e}),t.node.name))}}}else if(1===t.type){const n=null===(r=this._evaluator.getTypeForDeclaration(i))||void 0===r?void 0:r.type;if(t.typeAnnotationNode&&38===t.node.nodeType){let a=!1;const r=null===(s=this._evaluator.getTypeForDeclaration(t))||void 0===s?void 0:s.type;if(n&&r&&(0,B.isTypeSame)(n,r)&&(a=!0),3===i.type&&(a=!0),!a){p(this._evaluator.addDiagnostic(c.DiagnosticRule.reportRedeclaration,g.LocMessage.obscuredVariableDeclaration().format({name:e}),t.node))}}}else if(4===t.type){p(this._evaluator.addDiagnostic(c.DiagnosticRule.reportRedeclaration,g.LocMessage.obscuredTypeAliasDeclaration().format({name:e}),t.node.name))}}_conditionallyReportUnusedSymbol(e,t,n,a){const r=this._fileInfo.accessedSymbolSet;if(t.isIgnoredForProtocolMatch()||r.has(t.id))return;if(a&&a.some((e=>e.accessedSymbolSet.has(t.id))))return;if("_"===e)return;if(O.isDunderName(e))return;t.getDeclarations().forEach((t=>{this._conditionallyReportUnusedDeclaration(t,this._isSymbolPrivate(e,n))}))}_conditionallyReportUnusedDeclaration(e,t){var n;let a,r,s,i;switch(e.type){case 8:if(a=this._fileInfo.diagnosticRuleSet.reportUnusedImport,i=c.DiagnosticRule.reportUnusedImport,21===e.node.nodeType)if(e.node.alias)e.node.alias.value!==e.moduleName&&(r=e.node.alias);else{const t=e.node.module.nameParts;if(t.length>0){const e=t.map((e=>e.value)).join(".");let n={start:t[0].start,length:t[0].length};return n=u.TextRange.extend(n,t[t.length-1]),this._fileInfo.diagnosticSink.addUnusedCodeWithTextRange(g.LocMessage.unaccessedSymbol().format({name:e}),n,{action:"pyright.unusedImport"}),void this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportUnusedImport,c.DiagnosticRule.reportUnusedImport,g.LocMessage.unaccessedImport().format({name:e}),n)}}else if(23===e.node.nodeType){const t=e.node.parent,a=(null===(n=e.node.alias)||void 0===n?void 0:n.value)===e.node.name.value,s=1===t.module.nameParts.length&&"__future__"===t.module.nameParts[0].value;a||s||(r=e.node.alias||e.node.name)}r&&(s=g.LocMessage.unaccessedImport().format({name:r.value}));break;case 4:case 1:case 2:if(!t)return;if(this._fileInfo.isStubFile)return;a=this._fileInfo.diagnosticRuleSet.reportUnusedVariable,38===e.node.nodeType?(r=e.node,r.value.startsWith("_")&&(a="none")):41===e.node.nodeType&&(r=e.node.name,a="none"),r&&(i=c.DiagnosticRule.reportUnusedVariable,s=g.LocMessage.unaccessedVariable().format({name:r.value}));break;case 6:if(!t)return;if(this._fileInfo.isStubFile)return;a=this._fileInfo.diagnosticRuleSet.reportUnusedClass,r=e.node.name,i=c.DiagnosticRule.reportUnusedClass,s=g.LocMessage.unaccessedClass().format({name:r.value});break;case 5:if(!t)return;if(this._fileInfo.isStubFile)return;a=this._fileInfo.diagnosticRuleSet.reportUnusedFunction,r=e.node.name,i=c.DiagnosticRule.reportUnusedFunction,s=g.LocMessage.unaccessedFunction().format({name:r.value});break;case 3:a="none",r=e.node.name;break;case 0:case 7:return;default:(0,l.assertNever)(e)}const o=i===c.DiagnosticRule.reportUnusedImport?{action:"pyright.unusedImport"}:void 0;r&&(this._fileInfo.diagnosticSink.addUnusedCodeWithTextRange(g.LocMessage.unaccessedSymbol().format({name:r.value}),r,o),void 0!==i&&s&&"none"!==a&&this._evaluator.addDiagnostic(i,s,r))}_validateIsInstanceCall(e){if(38!==e.leftExpression.nodeType||"isinstance"!==e.leftExpression.value&&"issubclass"!==e.leftExpression.value||2!==e.arguments.length)return;const t="isinstance"===e.leftExpression.value;let n=this._evaluator.getType(e.arguments[0].valueExpression);if(!n)return;n=(0,R.mapSubtypes)(n,(e=>(0,R.transformPossibleRecursiveTypeAlias)(e))),n=this._evaluator.expandPromotionTypes(e,n);const a=this._evaluator.getType(e.arguments[1].valueExpression);if(!a)return;let r=!0;const s=new p.DiagnosticAddendum;if((0,R.doForEachSubtype)(a,(e=>{(0,B.isClassInstance)(e)&&B.ClassType.isTupleClass(e)&&e.tupleTypeArguments?e.tupleTypeArguments.some((e=>!this._isTypeSupportedTypeForIsInstance(e.type,t,s)))&&(r=!1):this._isTypeSupportedTypeForIsInstance(e,t,s)||(r=!1)})),r||this._evaluator.addDiagnostic(c.DiagnosticRule.reportArgumentType,t?g.LocMessage.isInstanceInvalidType().format({type:this._evaluator.printType(a)})+s.getString():g.LocMessage.isSubclassInvalidType().format({type:this._evaluator.printType(a)})+s.getString(),e.arguments[1]),!t){const t=new p.DiagnosticAddendum;(0,R.doForEachSubtype)(a,(e=>{(0,B.isClassInstance)(e)&&B.ClassType.isTupleClass(e)&&e.tupleTypeArguments?e.tupleTypeArguments.forEach((e=>{this._validateNotDataProtocol(e.type,t)})):this._validateNotDataProtocol(e,t)})),t.isEmpty()||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.dataProtocolInSubclassCheck(),e.arguments[1])}let i=e;for(;i;){if(2===i.nodeType)return;i=i.parent}const o=["FunctionType","LambdaType","BuiltinFunctionType","BuiltinMethodType","type","Type"],l=[];let d=!1;if((0,R.doForEachSubtype)(a,(a=>{(0,B.isClass)(a)?B.TypeBase.isInstantiable(a)?(void 0===a.literalValue&&(l.push(a),B.ClassType.isBuiltIn(a)&&o.some((e=>e===a.details.name))&&(r=!1),a.includeSubclasses&&(d=!0)),n&&this._validateUnsafeProtocolOverlap(e.arguments[0].valueExpression,(0,R.convertToInstance)(a),t?n:(0,R.convertToInstance)(n))):((0,R.isTupleClass)(a)?a.tupleTypeArguments&&a.tupleTypeArguments.forEach((a=>{(0,B.isInstantiableClass)(a.type)?(l.push(a.type),a.type.includeSubclasses&&(d=!0),n&&this._validateUnsafeProtocolOverlap(e.arguments[0].valueExpression,(0,R.convertToInstance)(a.type),t?n:(0,R.convertToInstance)(n))):r=!1})):a.includeSubclasses&&(d=!0),B.ClassType.isBuiltIn(a)&&o.some((e=>e===a.details.name))&&(r=!1)):r=!1})),!r)return;if((0,R.derivesFromAnyOrUnknown)(n))return;const u=e=>(0,B.combineTypes)(e),m=e=>{const n=[];for(const a of l){const r=(0,U.isIsinstanceFilterSuperclass)(this._evaluator,e,e,a,a,t),s=(0,U.isIsinstanceFilterSubclass)(this._evaluator,e,a,t);r&&s&&!B.ClassType.isSameGenericClass(e,a)?n.push(B.UnknownType.create()):r?n.push(e):s&&n.push(a)}return t?n.map((e=>(0,B.isInstantiableClass)(e)?B.ClassType.cloneAsInstance(e):e)):n};let y;if(t&&(0,B.isClassInstance)(n)){y=u(m(B.ClassType.cloneAsInstantiable(n)))}else if(!t&&(0,B.isInstantiableClass)(n)){y=u(m(n))}else{if(!(0,B.isUnion)(n))return;{let e=[],a=!1;if((0,R.doForEachSubtype)(n,(n=>{(0,B.isAnyOrUnknown)(n)&&(a=!0),t&&(0,B.isClassInstance)(n)?e=e.concat(m(B.ClassType.cloneAsInstantiable(n))):!t&&(0,B.isInstantiableClass)(n)&&(e=e.concat(m(n)))})),y=u(e),a)return}}const h=()=>{const e=l.map((e=>B.ClassType.cloneAsInstance(e)));return(0,B.combineTypes)(e)};!d&&(0,B.isTypeSame)(y,n,{ignorePseudoGeneric:!0})&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnnecessaryIsInstance,t?g.LocMessage.unnecessaryIsInstanceAlways().format({testType:this._evaluator.printType(n),classType:this._evaluator.printType(h())}):g.LocMessage.unnecessaryIsSubclassAlways().format({testType:this._evaluator.printType(n),classType:this._evaluator.printType(h())}),e)}_validateUnsafeProtocolOverlap(e,t,n){if(B.ClassType.isProtocolClass(t)){let a=!1;const r=new p.DiagnosticAddendum;(0,R.doForEachSubtype)(n,(e=>{(0,B.isClassInstance)(e)&&(0,N.isProtocolUnsafeOverlap)(this._evaluator,t,e)&&(a=!0,r.addMessage(g.LocAddendum.protocolUnsafeOverlap().format({name:e.details.name})))})),a&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.protocolUnsafeOverlap().format({name:t.details.name})+r.getString(),e)}}_isTypeSupportedTypeForIsInstance(e,t,n){let a=!0;return(0,R.doForEachSubtype)(e,(e=>{if(e=this._evaluator.makeTopLevelTypeVarsConcrete(e),(e=(0,R.transformPossibleRecursiveTypeAlias)(e)).specialForm&&B.ClassType.isBuiltIn(e.specialForm,"TypeAliasType"))return n.addMessage(g.LocAddendum.typeAliasInstanceCheck()),void(a=!1);switch(e.category){case 2:case 1:case 0:break;case 6:B.ClassType.isBuiltIn(e,"TypedDict")?(n.addMessage(g.LocAddendum.typedDictNotAllowed()),a=!1):B.ClassType.isBuiltIn(e,"NamedTuple")?(n.addMessage(g.LocAddendum.namedTupleNotAllowed()),a=!1):(0,R.isNoneInstance)(e)?(n.addMessage(g.LocAddendum.noneNotAllowed()),a=!1):B.ClassType.isTypedDictClass(e)?(n.addMessage(g.LocAddendum.typedDictClassNotAllowed()),a=!1):e.isTypeArgumentExplicit&&!e.includeSubclasses?(n.addMessage(g.LocAddendum.genericClassNotAllowed()),a=!1):!B.ClassType.isProtocolClass(e)||B.ClassType.isRuntimeCheckable(e)||e.includeSubclasses?B.ClassType.isNewTypeClass(e)?(n.addMessage(g.LocAddendum.newTypeClassNotAllowed()),a=!1):e.specialForm&&(0,B.isInstantiableClass)(e.specialForm)&&B.ClassType.isBuiltIn(e.specialForm,"Annotated")&&(n.addMessage(g.LocAddendum.annotatedNotAllowed()),a=!1):(n.addMessage(g.LocAddendum.protocolRequiresRuntimeCheckable()),a=!1);break;case 4:B.TypeBase.isInstantiable(e)&&!e.isCallableWithTypeArgs||(n.addMessage(g.LocAddendum.genericClassNotAllowed()),a=!1);break;case 9:n.addMessage(g.LocAddendum.typeVarNotAllowed()),a=!1}})),a}_validateNotDataProtocol(e,t){(0,B.isInstantiableClass)(e)&&B.ClassType.isProtocolClass(e)&&!(0,N.isMethodOnlyProtocol)(e)&&t.addMessage(g.LocAddendum.dataProtocolUnsupported().format({name:e.details.name}))}_isSymbolPrivate(e,t){if(2===t||1===t)return!0;if(O.isPrivateName(e))return!0;if(O.isProtectedName(e)){return!(3===t)}return!1}_reportDeprecatedClassProperty(e,t){(0,B.isClassInstance)(t.decoratedType)&&B.ClassType.isClassProperty(t.decoratedType)&&this._reportDeprecatedDiagnostic(e.name,g.LocMessage.classPropertyDeprecated())}_reportDeprecatedUseForMemberAccess(e,t){let n;"property"===t.accessType?n="get"===t.accessMethod?g.LocMessage.deprecatedPropertyGetter().format({name:e.value}):"set"===t.accessMethod?g.LocMessage.deprecatedPropertySetter().format({name:e.value}):g.LocMessage.deprecatedPropertyDeleter().format({name:e.value}):"descriptor"===t.accessType&&(n="get"===t.accessMethod?g.LocMessage.deprecatedDescriptorGetter().format({name:e.value}):"set"===t.accessMethod?g.LocMessage.deprecatedDescriptorSetter().format({name:e.value}):g.LocMessage.deprecatedDescriptorDeleter().format({name:e.value})),n&&this._reportDeprecatedDiagnostic(e,n,t.deprecationMessage)}_reportDeprecatedUseForType(e,t,n=!1){var a,r;if(!t)return;let s,i;function o(e){if(e.details.declaration&&28===e.details.declaration.node.nodeType){const t=A.getEnclosingClass(e.details.declaration.node,!0);if(t)return g.LocMessage.deprecatedMethod().format({name:e.details.name||"<anonymous>",className:t.name.value})}return g.LocMessage.deprecatedFunction().format({name:e.details.name})}function l(t,n){let a;const r=A.getCallForName(e);if(r)a=t.getTypeResult(r);else{const n=A.getDecoratorForName(e);n&&(a=t.getTypeResultForDecorator(n))}a&&a.overloadsUsedForCall&&a.overloadsUsedForCall.length>0&&a.overloadsUsedForCall.forEach((t=>{void 0!==t.details.deprecatedMessage&&(e.value===t.details.name?(i=t.details.deprecatedMessage,s=o(t)):(0,B.isInstantiableClass)(n)&&"__init__"===t.details.name?(i=t.details.deprecatedMessage,s=g.LocMessage.deprecatedConstructor().format({name:n.details.name})):(0,B.isClassInstance)(n)&&"__call__"===t.details.name&&(i=t.details.deprecatedMessage,s=g.LocMessage.deprecatedFunction().format({name:e.value})))}))}if((0,R.doForEachSubtype)(t,(t=>{if((0,B.isClass)(t))return t.includeSubclasses||void 0===t.details.deprecatedMessage||e.value!==t.details.name?void l(this._evaluator,t):(i=t.details.deprecatedMessage,void(s=g.LocMessage.deprecatedClass().format({name:t.details.name})));if((0,B.isFunction)(t))void 0!==t.details.deprecatedMessage&&(t.details.name&&"__call__"!==t.details.name&&e.value!==t.details.name||(i=t.details.deprecatedMessage,s=o(t)));else if((0,B.isOverloadedFunction)(t)){l(this._evaluator,t);const n=B.OverloadedFunctionType.getImplementation(t);void 0!==(null==n?void 0:n.details.deprecatedMessage)&&(n.details.name&&e.value!==n.details.name||(i=n.details.deprecatedMessage,s=o(n)))}})),s&&this._reportDeprecatedDiagnostic(e,s,i),this._fileInfo.diagnosticRuleSet.deprecateTypingAliases){const s=null!==(a=C.deprecatedAliases.get(e.value))&&void 0!==a?a:C.deprecatedSpecialForms.get(e.value);s&&((0,B.isInstantiableClass)(t)&&t.details.fullName===s.fullName||(null===(r=t.typeAliasInfo)||void 0===r?void 0:r.fullName)===s.fullName)&&this._fileInfo.executionEnvironment.pythonVersion.isGreaterOrEqualTo(s.version)&&(s.typingImportOnly&&!n||("none"===this._fileInfo.diagnosticRuleSet.reportDeprecated?this._evaluator.addDeprecated(g.LocMessage.deprecatedType().format({version:s.version.toString(),replacement:s.replacementText}),e):this._evaluator.addDiagnostic(c.DiagnosticRule.reportDeprecated,g.LocMessage.deprecatedType().format({version:s.version.toString(),replacement:s.replacementText}),e)))}}_reportDeprecatedDiagnostic(e,t,n){const a=new p.DiagnosticAddendum;n&&a.addMessage(n),"none"===this._fileInfo.diagnosticRuleSet.reportDeprecated?this._evaluator.addDeprecated(t+a.getString(),e):this._evaluator.addDiagnostic(c.DiagnosticRule.reportDeprecated,t+a.getString(),e)}_reportUnboundName(e){if("none"!==this._fileInfo.diagnosticRuleSet.reportUnboundVariable&&!T.isCodeUnreachable(e)){const t=this._evaluator.getType(e);t&&((0,B.isUnbound)(t)?this._evaluator.isNodeReachable(e)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnboundVariable,g.LocMessage.symbolIsUnbound().format({name:e.value}),e):(0,B.isPossiblyUnbound)(t)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportPossiblyUnboundVariable,g.LocMessage.symbolIsPossiblyUnbound().format({name:e.value}),e))}}_conditionallyReportShadowedModule(){if("none"===this._fileInfo.diagnosticRuleSet.reportShadowedImports)return;const e=this._fileInfo.moduleName,t={nameParts:e.split("."),leadingDots:0,importedSymbols:new Set};if(this._importResolver.getTypeshedStdLibPath(this._fileInfo.executionEnvironment)&&this._importResolver.isStdlibModule(t,this._fileInfo.executionEnvironment)&&this._sourceMapper.isUserCode(this._fileInfo.fileUri)){const t=this._evaluator.addDiagnosticForTextRange(this._fileInfo,this._fileInfo.diagnosticRuleSet.reportShadowedImports,c.DiagnosticRule.reportShadowedImports,g.LocMessage.stdlibModuleOverridden().format({name:e,path:this._fileInfo.fileUri.toUserVisibleString()}),this._moduleNode);if(t){const e={action:"renameShadowedFile",oldUri:this._fileInfo.fileUri,newUri:this._sourceMapper.getNextFileName(this._fileInfo.fileUri)};t.addAction(e)}}}_conditionallyReportShadowedImport(e){var t,n;if("none"===this._fileInfo.diagnosticRuleSet.reportShadowedImports)return;const a=23===e.nodeType?22===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)?null===(n=e.parent)||void 0===n?void 0:n.module:void 0:e.module;if(null==a?void 0:a.leadingDots)return;const r=21===e.nodeType?e.module.nameParts:23===e.nodeType?[e.name]:e.module.nameParts,s=r.map((e=>e.value)),o={nameParts:s,leadingDots:0,importedSymbols:new Set},l=this._importResolver.getTypeshedStdLibPath(this._fileInfo.executionEnvironment);if(l&&this._importResolver.isStdlibModule(o,this._fileInfo.executionEnvironment)){const t=y.DefinitionProvider.getDefinitionsForNode(this._sourceMapper,this._evaluator,r[r.length-1],r[r.length-1].start,i.CancellationToken.None);(t?t.map((e=>e.uri)):[]).forEach((t=>{if(!t.startsWith(l)&&!(0,E.isStubFile)(t)&&this._sourceMapper.isUserCode(t)){const n=this._evaluator.addDiagnostic(c.DiagnosticRule.reportShadowedImports,g.LocMessage.stdlibModuleOverridden().format({name:s.join("."),path:t.toUserVisibleString()}),e);if(n){const e={action:"renameShadowedFile",oldUri:t,newUri:this._sourceMapper.getNextFileName(t)};n.addAction(e)}}}))}}_conditionallyReportPrivateUsage(e){var t,n;if("none"===this._fileInfo.diagnosticRuleSet.reportPrivateUsage)return;if(this._fileInfo.isStubFile)return;if(1===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.name===e)return;const a=e.value,r=O.isPrivateName(a),s=O.isProtectedName(a);if(!r&&!s)return;const i=null===(n=this._evaluator.getDeclarationsForNameNode(e))||void 0===n?void 0:n.filter((e=>1!==e.type||!e.isExplicitBinding));let o,l=i&&i.length>0?i[i.length-1]:void 0;if(!l||l.node===e)return;if(8===l.type){if(l.usesLocalName)return;const e=this._evaluator.resolveAliasDeclarationWithInfo(l,!0);if(!e)return;if(l=e.declaration,!e.isPrivate)return}if(!l||l.node===e)return;l.node&&(o=A.getEnclosingClass(l.node)),l.node&&l.node.parent&&l.node.parent===o&&(o=A.getEnclosingClass(o));let p=!1;if(o&&s){const t=this._evaluator.getTypeOfClass(o);if(t&&(0,B.isInstantiableClass)(t.decoratedType)){if(B.ClassType.isDefinedInStub(t.decoratedType))return;p=!0;const n=A.getEnclosingClass(e);if(n){const e=this._evaluator.getTypeOfClass(n);if(e&&(0,B.isInstantiableClass)(e.decoratedType)&&(0,R.derivesFromClassRecursive)(e.decoratedType,t.decoratedType,!0))return}}}o&&!A.isNodeContainedWithin(e,o)&&(p?this._evaluator.addDiagnostic(c.DiagnosticRule.reportPrivateUsage,g.LocMessage.protectedUsedOutsideOfClass().format({name:a}),e):this._evaluator.addDiagnostic(c.DiagnosticRule.reportPrivateUsage,g.LocMessage.privateUsedOutsideOfClass().format({name:a}),e))}_validateEnumClassOverride(e,t){t.details.baseClasses.forEach(((t,n)=>{(0,B.isClass)(t)&&(0,I.isEnumClassWithMembers)(this._evaluator,t)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.enumClassOverride().format({name:t.details.name}),e.arguments[n])}))}_validateTypedDictClassSuite(e){const t=e=>{this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typedDictBadVar(),e)};e.statements.forEach((e=>{if(!T.isCodeUnreachable(e))if(47===e.nodeType)for(const n of e.statements)54!==n.nodeType&&18!==n.nodeType&&48!==n.nodeType&&42!==n.nodeType&&t(n);else t(e)}))}_validateTypeGuardFunction(e,t,n){var a;const r=t.details.declaredReturnType;if(!r)return;if(!(0,B.isClassInstance)(r)||!r.typeArguments||r.typeArguments.length<1)return;const s=B.ClassType.isBuiltIn(r,"TypeGuard"),i=B.ClassType.isBuiltIn(r,"TypeIs");if(!s&&!i)return;let o=t.details.parameters.length;if(n&&(B.FunctionType.isInstanceMethod(t)||B.FunctionType.isConstructorMethod(t)||B.FunctionType.isClassMethod(t))&&o--,o<1&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeGuardParamCount(),e.name),i){const s=r.typeArguments[0],i=n&&!B.FunctionType.isStaticMethod(t)?1:0;if(i>=t.details.parameters.length)return;const o=B.FunctionType.getEffectiveParameterType(t,i);if(!this._evaluator.assignType(o,s)){const t=e.returnTypeAnnotation||(null===(a=e.functionAnnotationComment)||void 0===a?void 0:a.returnTypeAnnotation);t&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeIsReturnType().format({type:this._evaluator.printType(o),returnType:this._evaluator.printType(s)}),t)}}}_validateDunderSignatures(e,t,n){var a;const r=t.details.name;if(n&&"__init__"===r){const n=e.returnTypeAnnotation||(null===(a=e.functionAnnotationComment)||void 0===a?void 0:a.returnTypeAnnotation),r=t.details.declaredReturnType;if(n&&r)(0,R.isNoneInstance)(r)||(0,B.isNever)(r)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.initMustReturnNone(),n);else{const n=this._evaluator.getFunctionInferredReturnType(t);(0,B.isNever)(n)||(0,R.isNoneInstance)(n)||(0,B.isAnyOrUnknown)(n)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.initMustReturnNone(),e.name)}}}_validateFunctionReturn(e,t){var n;if(this._fileInfo.isStubFile)return;const a=e.returnTypeAnnotation||(null===(n=e.functionAnnotationComment)||void 0===n?void 0:n.returnTypeAnnotation);if(a){const n=!this._evaluator.isAfterNodeReachable(e),r=this._evaluator.isAfterNodeReachable(e.suite);let s=t.details.declaredReturnType;if(s&&(this._reportUnknownReturnResult(e,s),this._validateReturnTypeIsNotContravariant(s,a)),B.FunctionType.isGenerator(t)&&(s=(0,R.getDeclaredGeneratorReturnType)(t)),s&&!n&&r)if((0,B.isNever)(s))A.isSuiteEmpty(e.suite)||B.FunctionType.isOverloaded(t)||B.FunctionType.isAsync(t)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportReturnType,g.LocMessage.noReturnReturnsNone(),a);else if(!B.FunctionType.isAbstractMethod(t)){const n=new p.DiagnosticAddendum;this._evaluator.assignType(s,this._evaluator.getNoneType(),n)||A.isSuiteEmpty(e.suite)||B.FunctionType.isOverloaded(t)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportReturnType,g.LocMessage.returnMissing().format({returnType:this._evaluator.printType(s)})+n.getString(),a)}}else{const n=this._evaluator.getFunctionInferredReturnType(t);this._reportUnknownReturnResult(e,n),this._validateReturnTypeIsNotContravariant(n,e.name)}}_validateReturnTypeIsNotContravariant(e,t){let n=!1;(0,R.doForEachSubtype)(e,(e=>{(0,B.isTypeVar)(e)&&4===e.details.declaredVariance&&0===e.scopeType&&(n=!0)})),n&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.returnTypeContravariant(),t)}_reportUnknownReturnResult(e,t){(0,B.isUnknown)(t)?this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownParameterType,g.LocMessage.returnTypeUnknown(),e.name):(0,R.isPartlyUnknown)(t)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnknownParameterType,g.LocMessage.returnTypePartiallyUnknown().format({returnType:this._evaluator.printType(t,{expandTypeAlias:!0})}),e.name)}_validateFinalMemberOverrides(e){B.ClassType.getSymbolTable(e).forEach(((t,n)=>{const a=(0,R.lookUpClassMember)(e,n,1);if(a&&(0,B.isInstantiableClass)(a.classType)&&!O.isPrivateName(n))if(this._evaluator.isFinalVariable(a.symbol)){const e=t.getDeclarations()[0];this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalRedeclarationBySubclass().format({name:n,className:a.classType.details.name}),e.node)}else if(B.ClassType.isReadOnlyInstanceVariables(a.classType)&&!O.isDunderName(n)){const e=t.getDeclarations()[0];1===e.type&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.namedTupleEntryRedeclared().format({name:n,className:a.classType.details.name}),e.node)}}))}_validateEnumMembers(e,t){if(!B.ClassType.isEnumClass(e)||B.ClassType.isBuiltIn(e))return;const n=(0,I.getEnumDeclaredValueType)(this._evaluator,e,!0);let a=(0,v.getBoundNewMethod)(this._evaluator,t.name,e,void 0,4);(null==a?void 0:a.classType)&&(0,B.isClass)(a.classType)&&B.ClassType.isBuiltIn(a.classType)&&(a=void 0);let r=(0,v.getBoundInitMethod)(this._evaluator,t.name,B.ClassType.cloneAsInstance(e),void 0,4);(null==r?void 0:r.classType)&&(0,B.isClass)(r.classType)&&B.ClassType.isBuiltIn(r.classType)&&(r=void 0),B.ClassType.getSymbolTable(e).forEach(((t,s)=>{var i;if(t.getTypedDeclarations().length>0)return;const o=(0,I.transformTypeForEnumMember)(this._evaluator,e,s);if(!(o&&(0,B.isClassInstance)(o)&&B.ClassType.isSameGenericClass(o,e)&&o.literalValue instanceof B.EnumLiteral))return;const l=t.getDeclarations();if(l.length>=2&&1===l[0].type)return void this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.duplicateEnumMember().format({name:s}),l[1].node);if(1!==l[0].type)return;const d=l[0].node,u=o.literalValue.itemType,m=A.getParentNodeOfType(d,3),y=null!==(i=null==m?void 0:m.rightExpression)&&void 0!==i?i:d;if(a||r){if(!(0,B.isAnyOrUnknown)(u)){const e=[{argumentCategory:(0,B.isClassInstance)(u)&&(0,R.isTupleClass)(u)?1:0,typeResult:{type:u}}];a&&this._evaluator.validateCallArguments(y,e,a,void 0,void 0,void 0,void 0),r&&this._evaluator.validateCallArguments(y,e,r,void 0,void 0,void 0,void 0)}}else if(n){const t=new p.DiagnosticAddendum;(0,B.isClassInstance)(u)&&B.ClassType.isSameGenericClass(u,e)||this._evaluator.assignType(n,u,t)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportAssignmentType,g.LocMessage.typeAssignmentMismatch().format(this._evaluator.printSrcDestTypes(u,n))+t.getString(),y)}}))}_validateDataClassPostInit(e,t){if(!B.ClassType.isDataClass(e))return;const n=(0,R.lookUpClassMember)(e,"__post_init__",66);if(!n)return;if(B.ClassType.derivesFromAnyOrUnknown(e))return;const a=new Map;B.ClassType.getReverseMro(e).forEach((e=>{(0,B.isClass)(e)&&B.ClassType.isDataClass(e)&&B.ClassType.getSymbolTable(e).forEach(((e,t)=>{e.isInitVar()&&a.set(t,e)}))}));const r=this._evaluator.getTypeOfMember(n);if(!(0,B.isFunction)(r)||!B.FunctionType.isInstanceMethod(r)||!r.details.declaration)return;const s=(0,S.getParameterListDetails)(r);if(void 0!==s.argsIndex||void 0!==s.kwargsIndex||void 0!==s.firstKeywordOnlyIndex)return;const i=s.params.filter((e=>!e.param.hasDefault)),o=a.size+1;(o<i.length||o>s.params.length)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.dataClassPostInitParamCount().format({expected:a.size}),r.details.declaration.node.name);let l=1;a.forEach(((e,t)=>{var n;if(l>=s.params.length)return;const a=s.params[l].param;if(a.hasDeclaredType&&a.typeAnnotation){const i=null===(n=this._evaluator.getDeclaredTypeOfSymbol(e))||void 0===n?void 0:n.type,o=B.FunctionType.getEffectiveParameterType(r,s.params[l].index),d=new p.DiagnosticAddendum;if(i&&!this._evaluator.assignType(o,i,d)){const n=this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.dataClassPostInitType().format({fieldName:t})+d.getString(),a.typeAnnotation);if(n){const t=e.getTypedDeclarations();t.length>0&&n.addRelatedInfo(g.LocAddendum.dataClassFieldLocation(),t[0].uri,t[0].range)}}}l++}))}_validateFinalClassNotAbstract(e,t){if(!B.ClassType.isFinal(e))return;if(!B.ClassType.supportsAbstractMethods(e))return;const n=this._evaluator.getAbstractSymbols(e);if(0===n.length)return;const a=new p.DiagnosticAddendum;n.forEach(((e,t)=>{if(2===t)a.addMessage(g.LocAddendum.memberIsAbstractMore().format({count:n.length-2}));else if(t<2&&(0,B.isInstantiableClass)(e.classType)){const t=e.classType.details.name;a.addMessage(g.LocAddendum.memberIsAbstract().format({type:t,name:e.symbolName}))}})),this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalClassIsAbstract().format({type:e.details.name})+a.getString(),t.name)}_validateInstanceVariableInitialization(e,t){if(this._fileInfo.isStubFile)return;if("none"===this._fileInfo.diagnosticRuleSet.reportUninitializedInstanceVariable)return;if(B.ClassType.isProtocolClass(t)||B.ClassType.supportsAbstractMethods(t)&&!B.ClassType.isFinal(t))return;const n=new Map;B.ClassType.isFinal(t)&&(0,R.getProtocolSymbolsRecursive)(t,n,2048),B.ClassType.getSymbolTable(t).forEach(((e,a)=>{if(n.delete(a),!e.isInstanceMember())return;const r=e.getDeclarations();if(r.find((e=>{var n,a,r;const s=A.getEnclosingClassOrFunction(e.node);if(!s)return!0;if(10===s.nodeType){if(3===(null===(n=e.node.parent)||void 0===n?void 0:n.nodeType))return!0;if(54===(null===(a=e.node.parent)||void 0===a?void 0:a.nodeType)&&3===(null===(r=e.node.parent.parent)||void 0===r?void 0:r.nodeType))return!0;if(B.ClassType.isDataClass(t))return!0;if(B.ClassType.isTypedDictClass(t))return!0}return"__init__"===s.name.value})))return;(0,R.lookUpClassMember)(t,a,1)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportUninitializedInstanceVariable,g.LocMessage.uninitializedInstanceVariable().format({name:a}),r[0].node)}));const a=new p.DiagnosticAddendum;n.forEach(((e,t)=>{const n=e.symbol.getDeclarations();0!==n.length&&(0,B.isClass)(e.classType)&&1===n[0].type&&(n.some((e=>1===e.type&&!!e.inferredTypeSource))||a.addMessage(g.LocAddendum.uninitializedAbstractVariable().format({name:t,classType:e.classType.details.name})))})),a.isEmpty()||this._evaluator.addDiagnostic(c.DiagnosticRule.reportUninitializedInstanceVariable,g.LocMessage.uninitializedAbstractVariables().format({classType:t.details.name})+a.getString(),e.name)}_validateProtocolTypeParamVariance(e,t){if(0===t.details.typeParameters.length)return;const n=this._evaluator.getBuiltInType(e,"object");if(!(0,B.isInstantiableClass)(n))return;const a=B.ClassType.cloneAsInstance(n),r=B.ClassType.createInstantiable("__varianceDummy","","",m.Uri.empty(),0,0,void 0,void 0);t.details.typeParameters.forEach(((n,s)=>{if(n.details.isVariadic||n.details.isParamSpec)return;if(0===n.details.declaredVariance)return;const i=t.details.typeParameters.map(((e,t)=>e.details.isVariadic?e:t===s?a:r)),o=t.details.typeParameters.map(((e,t)=>t===s||e.details.isVariadic?e:r)),l=B.ClassType.cloneForSpecialization(t,i,!0),p=B.ClassType.cloneForSpecialization(t,o,!0);let d;if(this._evaluator.assignClassToSelf(l,p,3))d=3;else{d=this._evaluator.assignClassToSelf(p,l,4)?4:2}if(d!==t.details.typeParameters[s].details.declaredVariance){let a;a=3===d?g.LocMessage.protocolVarianceCovariant().format({variable:n.details.name,class:t.details.name}):4===d?g.LocMessage.protocolVarianceContravariant().format({variable:n.details.name,class:t.details.name}):g.LocMessage.protocolVarianceInvariant().format({variable:n.details.name,class:t.details.name}),this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidTypeVarUse,a,e.name)}}))}_validateSlotsClassVarConflict(e){e.details.localSlotsNames&&(B.ClassType.isDataClass(e)||B.ClassType.getSymbolTable(e).forEach(((e,t)=>{const n=e.getDeclarations();n.some((e=>1===e.type&&e.isDefinedBySlots))&&n.forEach((e=>{1!==e.type||e.isDefinedBySlots||e.isDefinedByMemberAccess||38===e.node.nodeType&&A.isWriteAccess(e.node)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.slotsClassVarConflict().format({name:t}),e.node)}))})))}_validateConstructorConsistency(e,t){if((0,v.getBoundCallMethod)(this._evaluator,t,e))return;const n=(0,v.getBoundNewMethod)(this._evaluator,t,e);if(!n||n.typeErrors||!n.classType||!(0,B.isClass)(n.classType))return;const a=(0,v.getBoundInitMethod)(this._evaluator,t,B.ClassType.cloneAsInstance(e));if(!a||a.typeErrors||!a.classType||!(0,B.isClass)(a.classType))return;if(!B.ClassType.isSameGenericClass(a.classType,e)&&!B.ClassType.isSameGenericClass(n.classType,e))return;let r=n.type;if(!(0,B.isFunction)(r)&&!(0,B.isOverloadedFunction)(r))return;if((0,B.isOverloadedFunction)(r)&&(r=B.OverloadedFunctionType.getImplementation(r),!r))return;let s=a.type;if(((0,B.isFunction)(s)||(0,B.isOverloadedFunction)(s))&&(!(0,B.isOverloadedFunction)(s)||(s=B.OverloadedFunctionType.getImplementation(s),s))&&!(B.FunctionType.hasDefaultParameters(s)||B.FunctionType.hasDefaultParameters(r)||(s=B.FunctionType.cloneWithNewFlags(s,98304|s.details.flags),r=B.FunctionType.cloneWithNewFlags(r,98304|s.details.flags),this._evaluator.assignType(r,s,void 0,void 0,void 0,64)&&this._evaluator.assignType(s,r,void 0,void 0,void 0,64)))){const t=B.ClassType.isSameGenericClass(a.classType,e),i=s.details.declaration,o=r.details.declaration;if(i&&o){const e=t?i:o,l=28===e.node.nodeType?e.node.name:e.node,d=new p.DiagnosticAddendum,u=this._evaluator.printType(s),m=this._evaluator.printType(r);d.addMessage(g.LocAddendum.initMethodSignature().format({type:u})),d.addMessage(g.LocAddendum.newMethodSignature().format({type:m}));const y=this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentConstructor,g.LocMessage.constructorParametersMismatch().format({classType:this._evaluator.printType(B.ClassType.cloneAsInstance(t?a.classType:n.classType))})+d.getString(),l);if(y){const e=t?o:i;y.addRelatedInfo((t?g.LocAddendum.newMethodLocation():g.LocAddendum.initMethodLocation()).format({type:this._evaluator.printType(B.ClassType.cloneAsInstance(t?n.classType:a.classType))}),e.uri,e.range)}}}}_validateMultipleInheritanceBaseClasses(e,t){const n=[];for(const t of e.details.baseClasses){if(!(0,B.isClass)(t))return;B.ClassType.isBuiltIn(t,["Generic","Protocol","object"])||n.push(t)}if(n.length<2)return;const a=new p.DiagnosticAddendum;for(const t of n){const n=(0,R.buildTypeVarContextFromSpecializedClass)(t);for(const r of t.details.mro)if((0,B.isClass)(r)&&r.details.typeParameters.length>0){const s=(0,R.applySolvedTypeVars)(r,n),i=e.details.mro.find((e=>(0,B.isClass)(e)&&B.ClassType.isSameGenericClass(e,s)));if(i&&(0,B.isInstantiableClass)(i)){const e=B.ClassType.cloneAsInstance(i),n=B.ClassType.cloneAsInstance(s);if(!this._evaluator.assignType(e,n)){const r=new p.DiagnosticAddendum,s=(0,R.convertToInstance)(t);(0,B.isTypeSame)(s,n)?r.addMessage(g.LocAddendum.baseClassIncompatible().format({baseClass:this._evaluator.printType(s),type:this._evaluator.printType(e)})):r.addMessage(g.LocAddendum.baseClassIncompatibleSubclass().format({baseClass:this._evaluator.printType(s),subclass:this._evaluator.printType(n),type:this._evaluator.printType(e)})),a.addAddendum(r);break}}}}a.isEmpty()||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.baseClassIncompatible().format({type:e.details.name})+a.getString(),t)}_validateMultipleInheritanceCompatibility(e,t){if("none"===this._fileInfo.diagnosticRuleSet.reportIncompatibleMethodOverride&&"none"===this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride)return;const n=[];if(e.details.baseClasses.forEach((e=>{!(0,B.isClass)(e)||B.ClassType.isBuiltIn(e,"Generic")||B.ClassType.isBuiltIn(e,"Protocol")||n.push(e)})),n.length<2)return;const a=n.map((t=>{const n=e.details.mro.find((e=>(0,B.isClass)(e)&&B.ClassType.isSameGenericClass(e,t)));return n&&(0,B.isClass)(n)?(0,R.getClassFieldsRecursive)(n):new Map})),r=(0,R.getClassFieldsRecursive)(e);for(let n=1;n<a.length;n++){const s=a[n];for(const[n,a]of s){if(O.isDunderName(n)||O.isPrivateName(n))continue;const s=a.classType;if(!(0,B.isClass)(s))continue;const i=r.get(n);if(i){const r=i.classType;if(!(0,B.isClass)(r)||B.ClassType.isSameGenericClass(r,s)||B.ClassType.isSameGenericClass(r,e))continue;this._validateMultipleInheritanceOverride(a,i,e,n,t)}}}}_validateMultipleInheritanceOverride(e,t,n,a,r){var s,i,o,l;if(!(0,B.isClass)(e.classType)||!(0,B.isClass)(t.classType))return;if("_"===a)return;let d=this._evaluator.getEffectiveTypeOfSymbol(e.symbol);d=(0,R.partiallySpecializeType)(d,e.classType);const u=t.symbol;let m=this._evaluator.getEffectiveTypeOfSymbol(u);m=(0,R.partiallySpecializeType)(m,t.classType);const y=B.ClassType.getSymbolTable(n).get(a),h=y?this._evaluator.getEffectiveTypeOfSymbol(y):void 0;let f;const T=(0,z.getLastTypedDeclarationForSymbol)(t.symbol),v=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);if((0,B.isFunction)(d)||(0,B.isOverloadedFunction)(d)){const e=new p.DiagnosticAddendum;let t;if((0,B.isFunction)(m))t=m;else if((0,B.isOverloadedFunction)(m)&&(t=B.OverloadedFunctionType.getImplementation(m),!t))return;if(t&&!this._evaluator.validateOverrideMethod(d,t,void 0,e,!0)){const s=t.details.declaration;s&&5===s.type&&(f=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.baseClassMethodTypeIncompatible().format({classType:n.details.name,name:a})+e.getString(),r))}}else if((0,R.isProperty)(d)){if(!(0,R.isProperty)(m)&&!(0,B.isAnyOrUnknown)(m)){u.getDeclarations().length>0&&(f=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.baseClassVariableTypeIncompatible().format({classType:n.details.name,name:a}),r))}}else if("none"!==this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride){const p=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);let u,y,T=1===(null==p?void 0:p.type)&&!p.isFinal;if(B.ClassType.isFrozenDataClass(e.classType)&&e.classType.details.dataClassEntries){e.classType.details.dataClassEntries.find((e=>e.name===a))&&(T=!1)}if(e.classType.details.typedDictEntries&&(u=null!==(i=null!==(s=e.classType.details.typedDictEntries.knownItems.get(a))&&void 0!==s?s:e.classType.details.typedDictEntries.extraItems)&&void 0!==i?i:(0,j.getEffectiveExtraItemsEntryType)(this._evaluator,e.classType),(null==u?void 0:u.isReadOnly)&&(T=!1)),t.classType.details.typedDictEntries&&(y=null!==(l=null!==(o=t.classType.details.typedDictEntries.knownItems.get(a))&&void 0!==o?o:t.classType.details.typedDictEntries.extraItems)&&void 0!==l?l:(0,j.getEffectiveExtraItemsEntryType)(this._evaluator,t.classType)),this._evaluator.assignType(d,null!=h?h:m,void 0,void 0,void 0,T?1:0)){if(u&&y){let e,t=!0;if(u.isReadOnly?e=y.isRequired||!u.isRequired:(t=!y.isReadOnly,e=y.isRequired===u.isRequired),e)t||(f=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.typedDictFieldReadOnlyRedefinition().format({name:a}),r));else{const e=y.isRequired?g.LocMessage.typedDictFieldRequiredRedefinition:g.LocMessage.typedDictFieldNotRequiredRedefinition;f=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,e().format({name:a}),r)}}}else f=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.baseClassVariableTypeIncompatible().format({classType:n.details.name,name:a}),r)}f&&T&&v&&(f.addRelatedInfo(g.LocAddendum.baseClassOverriddenType().format({baseClass:this._evaluator.printType((0,R.convertToInstance)(e.classType)),type:this._evaluator.printType(d)}),v.uri,v.range),f.addRelatedInfo(g.LocAddendum.baseClassOverridesType().format({baseClass:this._evaluator.printType((0,R.convertToInstance)(t.classType)),type:this._evaluator.printType(m)}),T.uri,T.range))}_validateOverloadDecoratorConsistency(e){B.ClassType.getSymbolTable(e).forEach(((e,t)=>{const n=(0,z.getLastTypedDeclarationForSymbol)(e);if(!n||5!==n.type)return;const a=this._evaluator.getEffectiveTypeOfSymbol(e);if(!(0,B.isOverloadedFunction)(a))return;const r=B.OverloadedFunctionType.getOverloads(a),s=B.OverloadedFunctionType.getImplementation(a);s?B.FunctionType.isFinal(s)||r.forEach((e=>{var t,n;B.FunctionType.isFinal(e)&&(null===(t=e.details.declaration)||void 0===t?void 0:t.node)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentOverload,g.LocMessage.overloadFinalInconsistencyImpl().format({name:e.details.name}),null!==(n=(0,_.getNameNodeForDeclaration)(e.details.declaration))&&void 0!==n?n:e.details.declaration.node)})):B.FunctionType.isFinal(r[0])||r.slice(1).forEach(((e,t)=>{var n,a;B.FunctionType.isFinal(e)&&(null===(n=e.details.declaration)||void 0===n?void 0:n.node)&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportInconsistentOverload,g.LocMessage.overloadFinalInconsistencyNoImpl().format({name:e.details.name,index:t+2}),null!==(a=(0,_.getNameNodeForDeclaration)(e.details.declaration))&&void 0!==a?a:e.details.declaration.node)}))}))}_validateTypedDictOverrides(e){if(!B.ClassType.isTypedDictClass(e))return;const t=(0,j.getTypedDictMembersForClass)(this._evaluator,e,!1);for(const n of e.details.baseClasses){const a=new p.DiagnosticAddendum;if(!(0,B.isClass)(n)||!B.ClassType.isTypedDictClass(n)||!B.ClassType.isTypedDictEffectivelyClosed(n))continue;const r=(0,j.getTypedDictMembersForClass)(this._evaluator,n,!1),s=(0,R.buildTypeVarContextFromSpecializedClass)(n),i=r.extraItems?(0,R.applySolvedTypeVars)(r.extraItems.valueType,s):B.UnknownType.create();for(const[e,n]of t.knownItems){r.knownItems.get(e)||(!r.extraItems||(0,B.isNever)(r.extraItems.valueType)?a.addMessage(g.LocAddendum.typedDictClosedExtraNotAllowed().format({name:e})):this._evaluator.assignType(i,n.valueType,void 0,void 0,void 0,r.extraItems.isReadOnly?0:1)?!r.extraItems.isReadOnly&&n.isRequired&&a.addMessage(g.LocAddendum.typedDictClosedFieldNotRequired().format({name:e})):a.addMessage(g.LocAddendum.typedDictClosedExtraTypeMismatch().format({name:e,type:this._evaluator.printType(n.valueType)})))}if(t.extraItems&&r.extraItems&&(this._evaluator.assignType(i,t.extraItems.valueType,void 0,void 0,void 0,r.extraItems.isReadOnly?0:1)||a.addMessage(g.LocAddendum.typedDictClosedExtraTypeMismatch().format({name:"__extra_items__",type:this._evaluator.printType(t.extraItems.valueType)}))),!a.isEmpty()&&e.details.declaration){const t=(0,_.getNameNodeForDeclaration)(e.details.declaration);t&&(r.extraItems?this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.typedDictClosedExtras().format({name:n.details.name,type:this._evaluator.printType(i)})+a.getString(),t):this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.typedDictClosedNoExtras().format({name:n.details.name})+a.getString(),t))}}}_validateBaseClassOverrides(e){B.ClassType.getSymbolTable(e).forEach(((t,n)=>{if(O.isPrivateName(n))return;let a=!0;t.hasTypedDeclarations()||(a=!1);const r=this._evaluator.getEffectiveTypeOfSymbol(t);if((0,B.isAnyOrUnknown)(r))return;let s;for(const i of e.details.baseClasses){if(!(0,B.isClass)(i))continue;const o=e.details.mro.find((e=>(0,B.isClass)(e)&&B.ClassType.isSameGenericClass(e,i)));if(!o)continue;(0,l.assert)((0,B.isClass)(o));const p=(0,R.lookUpClassMember)(o,n,0);p&&(s=null!=s?s:p,this._validateBaseClassOverride(p,t,a?r:B.AnyType.create(),e,n))}s?this._validateOverrideDecoratorPresent(t,r,s):this._validateOverrideDecoratorNotPresent(t,r)}))}_validateOverrideDecoratorPresent(e,t,n){if("none"===this._fileInfo.diagnosticRuleSet.reportImplicitOverride)return;let a;if((0,B.isFunction)(t)?a=t:(0,B.isOverloadedFunction)(t)?a=B.OverloadedFunctionType.getImplementation(t):(0,B.isClassInstance)(t)&&B.ClassType.isPropertyClass(t)&&t.fgetInfo&&(a=t.fgetInfo.methodType),!(null==a?void 0:a.details.declaration)||B.FunctionType.isOverridden(a))return;if(this._isMethodExemptFromLsp(a.details.name))return;if(!e.getDeclarations().some((e=>e===a.details.declaration)))return;if((0,B.isAnyOrUnknown)(n.classType))return;const r=a.details.declaration.node;this._evaluator.addDiagnostic(c.DiagnosticRule.reportImplicitOverride,g.LocMessage.overrideDecoratorMissing().format({name:r.name.value,className:this._evaluator.printType((0,R.convertToInstance)(n.classType))}),r.name)}_isMethodExemptFromLsp(e){return["__init__","__new__","__init_subclass__","__post_init__"].some((t=>t===e))}_validateOverrideDecoratorNotPresent(e,t){let n;if((0,B.isFunction)(t)?n=t:(0,B.isOverloadedFunction)(t)?n=B.OverloadedFunctionType.getImplementation(t):(0,B.isClassInstance)(t)&&B.ClassType.isPropertyClass(t)&&t.fgetInfo&&(n=t.fgetInfo.methodType),!(null==n?void 0:n.details.declaration)||!B.FunctionType.isOverridden(n))return;if(!e.getDeclarations().some((e=>e===n.details.declaration)))return;const a=n.details.declaration.node;this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.overriddenMethodNotFound().format({name:a.name.value}),a.name)}_validateBaseClassOverride(e,t,n,a,r){var s,i,o,l,d,u,m,y,h,f,T,v;if(!(0,B.isInstantiableClass)(e.classType))return;if(e.symbol.isIgnoredForOverrideChecks()||t.isIgnoredForOverrideChecks())return;if(!e.symbol.hasTypedDeclarations())return;if("_"===r)return;const b=e.classType,C=B.ClassType.cloneAsInstance((0,R.selfSpecializeClass)(a)),I=(0,R.partiallySpecializeType)(this._evaluator.getEffectiveTypeOfSymbol(e.symbol),b,C);if(n=(0,R.partiallySpecializeType)(n,a,C),(0,B.isFunction)(I)||(0,B.isOverloadedFunction)(I)){const o=new p.DiagnosticAddendum;let l=!1;if(O.isPrivateName(r)||((0,B.isFunction)(I)&&B.FunctionType.isFinal(I)||(0,B.isOverloadedFunction)(I)&&I.overloads.some((e=>B.FunctionType.isFinal(e))))&&(l=!0),l){const n=(0,z.getLastTypedDeclarationForSymbol)(t);if(n&&5===n.type){const t=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.finalMethodOverride().format({name:r,className:b.details.name}),n.node.name),a=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);t&&a&&t.addRelatedInfo(g.LocAddendum.finalMethod(),a.uri,a.range)}}if((0,B.isFunction)(n)||(0,B.isOverloadedFunction)(n)){const i=!O.isDunderName(r);if(!(this._isMethodExemptFromLsp(r)||O.isPrivateName(r)||B.ClassType.isTypedDictClass(a)||this._evaluator.validateOverrideMethod(I,n,a,o,i))){const a=(0,B.isFunction)(n)&&n.details.declaration?n.details.declaration:(0,z.getLastTypedDeclarationForSymbol)(t);if(a){const t=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.incompatibleMethodOverride().format({name:r,className:b.details.name})+o.getString(),null!==(s=(0,_.getNameNodeForDeclaration)(a))&&void 0!==s?s:a.node),n=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);t&&n&&t.addRelatedInfo(g.LocAddendum.overriddenMethod(),n.uri,n.range)}}}else if(!(0,B.isAnyOrUnknown)(n)&&!B.ClassType.isBuiltIn(b,"_TypedDict")){const a=t.getDeclarations();if(a.length>0){const t=a[a.length-1],s=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.methodOverridden().format({name:r,className:b.details.name,type:this._evaluator.printType(n)}),null!==(i=(0,_.getNameNodeForDeclaration)(t))&&void 0!==i?i:t.node),o=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);s&&o&&s.addRelatedInfo(g.LocAddendum.overriddenMethod(),o.uri,o.range)}}}else if((0,R.isProperty)(I))if((0,R.isProperty)(n)){const e=b,s=[["fget",e=>{var t;return null===(t=e.fgetInfo)||void 0===t?void 0:t.methodType}],["fset",e=>{var t;return null===(t=e.fsetInfo)||void 0===t?void 0:t.methodType}],["fdel",e=>{var t;return null===(t=e.fdelInfo)||void 0===t?void 0:t.methodType}]];s.forEach((s=>{var i;const o=new p.DiagnosticAddendum,[l,d]=s,u=d(I),m=d(n);if(u){const n=(0,R.partiallySpecializeType)(u,e);if((0,B.isFunction)(n))if(m){const t=(0,R.partiallySpecializeType)(m,a);if((0,B.isFunction)(t)&&!this._evaluator.validateOverrideMethod(n,t,a,o.createAddendum())){o.addMessage(g.LocAddendum.propertyMethodIncompatible().format({name:l}));const a=t.details.declaration;if(a&&5===a.type){const t=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.propertyOverridden().format({name:r,className:e.details.name})+o.getString(),a.node.name),s=n.details.declaration;t&&s&&t.addRelatedInfo(g.LocAddendum.overriddenMethod(),s.uri,s.range)}}}else{o.addMessage(g.LocAddendum.propertyMethodMissing().format({name:l}));const a=t.getDeclarations();if(a.length>0){const t=a[a.length-1],s=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.propertyOverridden().format({name:r,className:e.details.name})+o.getString(),null!==(i=(0,_.getNameNodeForDeclaration)(t))&&void 0!==i?i:t.node),l=n.details.declaration;s&&l&&s.addRelatedInfo(g.LocAddendum.overriddenMethod(),l.uri,l.range)}}}}))}else{const e=t.getDeclarations();if(e.length>0&&t.isClassMember()){const t=e[e.length-1];this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleMethodOverride,g.LocMessage.propertyOverridden().format({name:r,className:b.details.name}),null!==(o=(0,_.getNameNodeForDeclaration)(t))&&void 0!==o?o:t.node)}}else if("none"!==this._fileInfo.diagnosticRuleSet.reportIncompatibleVariableOverride){const s=t.getDeclarations();if(s.length>0){const i=s[s.length-1],o=s[0];let C,k,w=1===(null==o?void 0:o.type)&&!o.isFinal;if(B.ClassType.isFrozenDataClass(b)&&b.details.dataClassEntries){b.details.dataClassEntries.find((e=>e.name===r))&&(w=!1)}t.isIgnoredForProtocolMatch()||(b.details.typedDictEntries&&(C=null!==(d=null!==(l=b.details.typedDictEntries.knownItems.get(r))&&void 0!==l?l:b.details.typedDictEntries.extraItems)&&void 0!==d?d:(0,j.getEffectiveExtraItemsEntryType)(this._evaluator,b),(null==C?void 0:C.isReadOnly)&&(w=!1)),a.details.typedDictEntries&&(B.ClassType.isTypedDictMarkedClosed(a)&&"__extra_items__"===r?(k=C,n=I):k=null!==(m=null!==(u=a.details.typedDictEntries.knownItems.get(r))&&void 0!==u?u:a.details.typedDictEntries.extraItems)&&void 0!==m?m:(0,j.getEffectiveExtraItemsEntryType)(this._evaluator,a)));let S=new p.DiagnosticAddendum;if(this._evaluator.assignType(I,n,S,void 0,void 0,w?1:0)){if(C&&k){let e=!0;if(e=C.isReadOnly?k.isRequired||!C.isRequired:k.isRequired===C.isRequired,!e){const e=k.isRequired?g.LocMessage.typedDictFieldRequiredRedefinition:g.LocMessage.typedDictFieldNotRequiredRedefinition;this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,e().format({name:r}),null!==(h=(0,_.getNameNodeForDeclaration)(i))&&void 0!==h?h:i.node)}!C.isReadOnly&&k.isReadOnly&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typedDictFieldReadOnlyRedefinition().format({name:r}),null!==(f=(0,_.getNameNodeForDeclaration)(i))&&void 0!==f?f:i.node)}}else{w&&(S=new p.DiagnosticAddendum,S.addMessage(g.LocAddendum.overrideIsInvariant()),S.createAddendum().addMessage(g.LocAddendum.overrideInvariantMismatch().format({overrideType:this._evaluator.printType(n),baseType:this._evaluator.printType(I)})));const t=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.symbolOverridden().format({name:r,className:b.details.name})+S.getString(),null!==(y=(0,_.getNameNodeForDeclaration)(i))&&void 0!==y?y:i.node),a=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);t&&a&&t.addRelatedInfo(g.LocAddendum.overriddenSymbol(),a.uri,a.range)}const A=this._evaluator.isFinalVariable(e.symbol),x=s.find((e=>this._evaluator.isFinalVariableDeclaration(e)));if(!A&&x){const e=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,g.LocMessage.variableFinalOverride().format({name:r,className:b.details.name}),null!==(T=(0,_.getNameNodeForDeclaration)(i))&&void 0!==T?T:i.node);e&&e.addRelatedInfo(g.LocAddendum.overriddenSymbol(),x.uri,x.range)}const P=e.symbol.isClassVar();let N=t.isClassVar();P&&!N&&(t.hasTypedDeclarations()||(N=!0),t.getTypedDeclarations().every((e=>6===e.type))&&(N=!0));const D=B.ClassType.isTypedDictClass(a)&&!N;if(P!==N&&!D){const n=t.isClassVar()?g.LocMessage.classVarOverridesInstanceVar():g.LocMessage.instanceVarOverridesClassVar(),a=this._evaluator.addDiagnostic(c.DiagnosticRule.reportIncompatibleVariableOverride,n.format({name:r,className:b.details.name}),null!==(v=(0,_.getNameNodeForDeclaration)(i))&&void 0!==v?v:i.node),s=(0,z.getLastTypedDeclarationForSymbol)(e.symbol);a&&s&&a.addRelatedInfo(g.LocAddendum.overriddenSymbol(),s.uri,s.range)}}}}_validateMethod(e,t,n){var a,r;const s=this._evaluator.getTypeOfClass(n),i=null==s?void 0:s.classType;if(e.name&&i){["__init__","__init_subclass__","__enter__","__exit__"].some((t=>t===e.name.value))&&(B.FunctionType.isAbstractMethod(t)||B.FunctionType.isOverloaded(t)||this._fileInfo.isStubFile||this._validateSuperCallForMethod(e,t,i))}if("__new__"===(null===(a=e.name)||void 0===a?void 0:a.value))0!==e.parameters.length&&e.parameters[0].name&&["cls","_cls","__cls","__mcls","mcls","mcs","metacls"].some((t=>e.parameters[0].name.value===t))||this._evaluator.addDiagnostic(c.DiagnosticRule.reportSelfClsParameterName,g.LocMessage.newClsParam(),e.parameters.length>0?e.parameters[0]:e.name),i&&this._validateClsSelfParameterType(t,i,!0);else if("_generate_next_value_"===(null===(r=e.name)||void 0===r?void 0:r.value));else if(B.FunctionType.isStaticMethod(t)){if(e.parameters.length>0&&e.parameters[0].name){const t=e.parameters[0].name.value;"self"!==t&&"cls"!==t||this._evaluator.addDiagnostic(c.DiagnosticRule.reportSelfClsParameterName,g.LocMessage.staticClsSelfParam(),e.parameters[0].name)}}else if(B.FunctionType.isClassMethod(t)){let n="";e.parameters.length>0&&e.parameters[0].name&&(n=e.parameters[0].name.value),"cls"!==n&&(this._fileInfo.isStubFile&&(n.startsWith("_")||"metacls"===n)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportSelfClsParameterName,g.LocMessage.classMethodClsParam(),e.parameters.length>0?e.parameters[0]:e.name)),i&&this._validateClsSelfParameterType(t,i,!0)}else{const a=e.decorators.length>0;if(B.FunctionType.isOverloaded(t)||!a){let t="",a=!0;if(e.parameters.length>0&&(e.parameters[0].name&&(t=e.parameters[0].name.value),0!==e.parameters[0].category&&(a=!1)),a&&"self"!==t){let a=!1;if(["cls","mcls","mcs"].some((e=>e===t))){const e=this._evaluator.getTypeOfClass(n),t=this._evaluator.getBuiltInType(n,"type");t&&(0,B.isInstantiableClass)(t)&&e&&(0,B.isInstantiableClass)(e.classType)&&(0,R.derivesFromClassRecursive)(e.classType,t,!0)&&(a=!0)}const r=O.isPrivateOrProtectedName(t);a||r||this._evaluator.addDiagnostic(c.DiagnosticRule.reportSelfClsParameterName,g.LocMessage.instanceMethodSelfParam(),e.parameters.length>0?e.parameters[0]:e.name)}}i&&this._validateClsSelfParameterType(t,i,!1)}}_validateSuperCallForMethod(e,t,n){if("none"===this._fileInfo.diagnosticRuleSet.reportMissingSuperCall)return;let a=17;B.ClassType.isFinal(n)&&(a|=4);if(!(0,R.lookUpClassMember)(n,t.details.name,a))return;let r=!1;const s=new A.CallNodeWalker((e=>{if(35===e.leftExpression.nodeType&&e.leftExpression.memberName.value===t.details.name){const t=e.leftExpression.leftExpression;if(9===t.nodeType&&38===t.leftExpression.nodeType&&"super"===t.leftExpression.value)r=!0;else{const e=this._evaluator.getType(t);e&&(0,B.isInstantiableClass)(e)&&(r=!0)}}}));s.walk(e.suite),r||this._evaluator.addDiagnostic(c.DiagnosticRule.reportMissingSuperCall,g.LocMessage.missingSuperCall().format({methodName:t.details.name}),e.name)}_validateClsSelfParameterType(e,t,n){if(e.details.parameters.length<1)return;const a=e.details.parameters[0];if(!a.typeAnnotation||!a.name)return;if("__init__"===e.details.name&&e.details.methodClass){(0,R.getTypeVarArgumentsRecursive)(a.type).some((t=>{var n;return t.scopeId===(null===(n=e.details.methodClass)||void 0===n?void 0:n.details.typeVarScopeId)}))&&this._evaluator.addDiagnostic(c.DiagnosticRule.reportInvalidTypeVarUse,g.LocMessage.initMethodSelfParamTypeVar(),a.typeAnnotation)}if(B.ClassType.isProtocolClass(t))return;const r=this._evaluator.makeTopLevelTypeVarsConcrete(a.type),s=n?t:(0,R.convertToInstance)(t);if((0,B.isInstantiableClass)(r)&&B.ClassType.isProtocolClass(r))return;if((0,B.isClassInstance)(r)&&B.ClassType.isProtocolClass(r))return;if(1===a.category&&(0,B.isParamSpec)(a.type)&&"args"===a.type.paramSpecAccess)return;if(B.FunctionType.isOverloaded(e))return;if((0,B.isClassInstance)(r)&&B.ClassType.isBuiltIn(r,"LiteralString")&&B.ClassType.isBuiltIn(t,"str"))return;const i=new L.TypeVarContext((0,R.getTypeVarScopeId)(e));this._evaluator.assignType(r,s,void 0,i)||(0,B.isNever)(r)||this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.clsSelfParamTypeMismatch().format({name:a.name,classType:this._evaluator.printType(s)}),a.typeAnnotation)}_validateYieldType(e,t,n,a){var r,s,i,o;const l=A.getEnclosingFunction(e);if(!l||!l.returnTypeAnnotation)return;const d=this._evaluator.getTypeOfFunction(l);if(!d)return;const u=B.FunctionType.getSpecializedReturnType(d.functionType);if(!u)return;let m;if(m=!l.isAsync&&(0,B.isClassInstance)(u)&&B.ClassType.isBuiltIn(u,"AwaitableGenerator")?this._evaluator.getTypingType(e,"AwaitableGenerator"):this._evaluator.getTypingType(e,l.isAsync?"AsyncGenerator":"Generator"),!m||!(0,B.isInstantiableClass)(m))return;if(!this._evaluator.isNodeReachable(e,void 0))return;if((0,B.isNever)(u))return void this._evaluator.addDiagnostic(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.noReturnContainsYield(),e);const y=[t,null!=a?a:B.UnknownType.create(),B.UnknownType.create()],h=B.ClassType.cloneAsInstance(B.ClassType.cloneForSpecialization(m,y,!0)),f=new p.DiagnosticAddendum;if(!this._evaluator.assignType(u,h,f)){const a=l.isAsync?g.LocMessage.generatorAsyncReturnType():g.LocMessage.generatorSyncReturnType();this._evaluator.addDiagnostic(c.DiagnosticRule.reportReturnType,a.format({yieldType:this._evaluator.printType(t)})+(null!==(r=null==n?void 0:n.getString())&&void 0!==r?r:f.getString()),null!==(s=e.expression)&&void 0!==s?s:e,null!==(o=null!==(i=null==n?void 0:n.getEffectiveTextRange())&&void 0!==i?i:e.expression)&&void 0!==o?o:e)}}_reportUnusedExceptStatements(e){let t=!1;const n=[];e.exceptClauses.forEach((e=>{var a,r;if(t||e.isExceptGroup||!e.typeExpression)return;const s=this._evaluator.getType(e.typeExpression);if(!s||(0,B.isAnyOrUnknown)(s))return void(t=!0);const i=[];if((0,B.isInstantiableClass)(s))s.includeSubclasses&&(t=!0),i.push(s);else if((0,B.isClassInstance)(s)){const n=null!==(r=null===(a=this._evaluator.getTypeOfIterator({type:s},!1,e.typeExpression,!1))||void 0===a?void 0:a.type)&&void 0!==r?r:B.UnknownType.create();(0,R.doForEachSubtype)(n,(e=>{(0,B.isAnyOrUnknown)(e)&&(t=!0),(0,B.isInstantiableClass)(e)&&(e.includeSubclasses&&(t=!0),i.push(e))}))}else t=!0;if(n.length>0&&!t){const t=new p.DiagnosticAddendum;let a=0;i.forEach((e=>{const r=n.find((t=>(0,R.derivesFromClassRecursive)(e,t,!0)));r&&(t.addMessage(g.LocAddendum.unreachableExcept().format({exceptionType:this._evaluator.printType((0,R.convertToInstance)(e)),parentType:this._evaluator.printType((0,R.convertToInstance)(r))})),a++)})),i.length>0&&i.length===a&&(this._evaluator.addDiagnostic(c.DiagnosticRule.reportUnusedExcept,g.LocMessage.unreachableExcept()+t.getString(),e.typeExpression),this._evaluator.addUnreachableCode(e,e.exceptSuite))}(0,o.appendArray)(n,i)}))}_reportDuplicateImports(){const e=(0,w.getTopLevelImports)(this._moduleNode),t=new Map;e.orderedImports.forEach((e=>{if(22===e.node.nodeType){const t=new Map;e.node.imports.forEach((e=>{if(!e.alias){t.get(e.name.value)?this._evaluator.addDiagnostic(c.DiagnosticRule.reportDuplicateImport,g.LocMessage.duplicateImport().format({importName:e.name.value}),e.name):t.set(e.name.value,e)}}))}else if(e.subnode&&!e.subnode.alias){t.get(e.moduleName)?this._evaluator.addDiagnostic(c.DiagnosticRule.reportDuplicateImport,g.LocMessage.duplicateImport().format({importName:e.moduleName}),e.subnode):t.set(e.moduleName,e.subnode)}}))}}t.Checker=q},53748:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularDependency=void 0;t.CircularDependency=class{constructor(){this._paths=[]}appendPath(e){this._paths.push(e)}getPaths(){return this._paths}normalizeOrder(){let e=0;this._paths.forEach(((t,n)=>{t<this._paths[e]&&(e=n)})),0!==e&&(this._paths=this._paths.slice(e).concat(this._paths.slice(0,e)))}isEqual(e){if(e._paths.length!==this._paths.length)return!1;for(let t=0;t<this._paths.length;t++)if(this._paths[t]!==e._paths[t])return!1;return!0}}},94416:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCodeFlowEngine=t.isIncompleteType=void 0;const a=n(83181),r=n(96193),s=n(9316),i=n(31508),o=n(48816),l=n(90272),p=n(28340),c=n(3573),d=n(45468),u=n(46048),m=n(8312),y=n(808);function g(e){return!!e.isIncompleteType}t.isIncompleteType=g;t.getCodeFlowEngine=function(e,t){const n=new Set,h=new Map,f=new Map;let T=1,v=0,b=0;function _(t,r,s=!1){const o=new Set,l=new Set;if(n.has(t.id))return!0;n.add(t.id);try{return function t(n,r,p=0){var c;if(p>64)return!0;p++;let d=n;for(;;){if(o.has(d.id))return!1;if(o.add(d.id),d.flags&i.FlowFlags.Unreachable)return!1;if(d===r)return!0;if(d.flags&(i.FlowFlags.VariableAnnotation|i.FlowFlags.Assignment|i.FlowFlags.TrueCondition|i.FlowFlags.FalseCondition|i.FlowFlags.WildcardImport|i.FlowFlags.NarrowForPattern|i.FlowFlags.ExhaustedMatch))d=d.antecedent;else if(d.flags&(i.FlowFlags.TrueNeverCondition|i.FlowFlags.FalseNeverCondition)){const t=d;if(t.reference){const n=e.lookUpSymbolRecursive(t.reference,t.reference.value,!1);if(n&&n.symbol.hasTypedDeclarations()){let n=!1;const a=(0,u.getTypeNarrowingCallback)(e,t.reference,t.expression,!!(t.flags&(i.FlowFlags.TrueCondition|i.FlowFlags.TrueNeverCondition)));if(a){const r=e.getTypeOfExpression(t.reference),s=a(r.type),i=null!==(c=null==s?void 0:s.type)&&void 0!==c?c:r.type;(0,m.isNever)(i)&&!r.isIncomplete&&(n=!0)}if(n)return!1}}d=t.antecedent}else if(d.flags&i.FlowFlags.Call){const t=d;if(!s&&I(e,t))return!1;d=t.antecedent}else{if(d.flags&(i.FlowFlags.BranchLabel|i.FlowFlags.LoopLabel)){if(d.flags&i.FlowFlags.PostContextManager){const t=d;if(!t.expressions.some((n=>w(e,n,t.isAsync))))return!1}const n=d;for(const e of n.antecedents)if(t(e,r,p))return!0;return!1}if(d.flags&i.FlowFlags.Start)return!r;if(!(d.flags&i.FlowFlags.PreFinallyGate)){if(d.flags&i.FlowFlags.PostFinally){const e=d,n=l.has(e.preFinallyGate.id);try{return l.add(e.preFinallyGate.id),t(e.antecedent,r,p)}finally{n||l.delete(e.preFinallyGate.id)}}return(0,a.fail)("Unexpected flow node flags"),!1}{const e=d;if(l.has(e.id))return!1;d=e.antecedent}}}}(t,r)}finally{n.delete(t.id)}}function C(e,t){let n=!0;return(0,y.doForEachSubtype)(e,(e=>{(0,m.isTypeVar)(e)?(0,m.isTypeSame)(e,t)||(n=!1):e.condition&&e.condition.some((e=>e.typeVar.details.constraints.length>0&&e.typeVar.nameWithScope===t.nameWithScope))||(n=!1)})),n}function I(e,t){const n=t.node;if(h.has(n.id)){const e=h.get(n.id);return e}if(v>m.maxTypeRecursionCount)return!1;if(30===n.leftExpression.nodeType)return!1;h.set(n.id,!1),v++;try{let t=0,a=0;const r=e.getTypeOfExpression(n.leftExpression,2),s=r.type;(0,y.doForEachSubtype)(s,(s=>{var i;if(a++,(0,m.isInstantiableClass)(s)){if((0,l.getBoundCallMethod)(e,n,s))return;const t=(0,l.getBoundNewMethod)(e,n,s);t&&((0,m.isFunction)(t.type)||(0,m.isOverloadedFunction)(t.type))&&(s=t.type)}else if((0,m.isClassInstance)(s)){const t=e.getBoundMagicMethod(s,"__call__");t&&(s=t)}const o=6===(null===(i=n.parent)||void 0===i?void 0:i.nodeType);if((0,m.isFunction)(s))k(s,o)&&t++;else if((0,m.isOverloadedFunction)(s)){let a=0,i=0;if(m.OverloadedFunctionType.getOverloads(s).forEach((e=>{a++,k(e,o)&&i++})),i>0)if(i===a)t++;else{const a=e.validateOverloadedFunctionArguments(n,n.arguments,{type:s,isIncomplete:r.isIncomplete},void 0,!1,void 0,void 0);a.returnType&&(0,m.isNever)(a.returnType)&&t++}}}));const i=a>0&&t===a;return h.set(n.id,i),i}finally{v--}}function k(e,t){const n=e.details.declaredReturnType;return!!n&&(!!((0,m.isClassInstance)(n)&&m.ClassType.isBuiltIn(n,"Coroutine")&&n.typeArguments&&n.typeArguments.length>=3&&(0,m.isNever)(n.typeArguments[2])&&t)||(0,m.isNever)(n))}function w(e,t,n){if(f.has(t.id))return f.get(t.id);if(f.set(t.id,!1),b>m.maxTypeRecursionCount)return!1;b++;let a=!1;try{const r=e.getTypeOfExpression(t).type;if(r&&(0,m.isClassInstance)(r)){const t=n?"__aexit__":"__exit__",s=e.getBoundMagicMethod(r,t);if(s&&(0,m.isFunction)(s)&&s.details.declaredReturnType){let e=s.details.declaredReturnType;n&&(0,m.isClassInstance)(e)&&m.ClassType.isBuiltIn(e,"Coroutine")&&e.typeArguments&&e.typeArguments.length>=3&&(e=e.typeArguments[2]),a=!1,(0,m.isClassInstance)(e)&&m.ClassType.isBuiltIn(e,"bool")&&(void 0!==e.literalValue&&!0!==e.literalValue||(a=!0))}}}finally{b--}return f.set(t.id,a),a}function S(t,n){const r=(0,s.getImportInfo)(t.node.module);(0,a.assert)(void 0!==r&&r.isImportFound),(0,a.assert)(t.node.isWildcardImport);const i=e.lookUpSymbolRecursive(t.node,n,!1);(0,a.assert)(void 0!==i);const o=i.symbol.getDeclarations().find((e=>e.node===t.node));return o&&e.getInferredTypeOfDeclaration(i.symbol,o)||m.UnknownType.create()}function A(e,t,n,a=console){let i="";if(t){const e=(0,s.getFileInfo)(t),n=(0,r.convertOffsetToPosition)(t.start,e.lines);i=`${(0,p.printExpression)(t)}[${n.line+1}:${n.character+1}]`}a.log(`${n}@${e.id}: ${i||"(none)"}`),a.log((0,o.formatControlFlowGraph)(e))}return{createCodeFlowAnalyzer:function(n){const r=new Map;function s(e){if(!e)return!1;for(const[t,n]of r.entries())if(t!==e&&n.pendingNodes.size>0)return!0;return!1}return{getTypeFromCodeFlow:function(n,o,l){var h,f;const v=void 0!==o?(0,i.createKeyForReference)(o):void 0;let b;const C=void 0!==v&&void 0!==(null==l?void 0:l.targetSymbolId)?v+`.${null==l?void 0:l.targetSymbolId.toString()}`:".",k=function(e){let t=r.get(e);return t||(t={cache:new Map,pendingNodes:new Set,closedFinallyGateNodes:new Set},r.set(e,t)),t}(C);function A(e,n,a){if(a){if(n){const t=k.cache.get(e.id);if(t){const e=t;e.isIncompleteType&&e.type&&!(0,m.isTypeSame)(e.type,n)&&T++}}}else T++;const r=a?{isIncompleteType:!0,type:n,incompleteSubtypes:[],generationCount:T}:n;return k.cache.set(e.id,r),t.trackEntry(k.cache,e.id),{type:n,isIncomplete:a,generationCount:T,incompleteSubtypes:a?[]:void 0}}function x(e,t,n,r,s,i){const o=k.cache.get(e.id);void 0!==o&&g(o)||(0,a.fail)(`setIncompleteSubtype can be called only on a valid incomplete cache entry: prev cache entry?: ${!o} index=${t} isPending=${s} evaluationCount=${i}`);const l=o.incompleteSubtypes;if(t<l.length){const e=l[t];e.isIncomplete===r&&(0,m.isTypeSame)(e.type,n)?e.isPending!==s&&(l[t]={type:n,isIncomplete:r,isPending:s,evaluationCount:i}):(l[t]={type:n,isIncomplete:r,isPending:s,evaluationCount:i},T++)}else(0,a.assert)(l.length===t),l.push({type:n,isIncomplete:r,isPending:s,evaluationCount:i}),T++;let p;if(o.incompleteSubtypes.length>0){const e=[];o.incompleteSubtypes.forEach((t=>{t.type&&e.push(t.type)})),p=e.length>0?(0,m.combineTypes)(e):void 0}return o.type=p,o.generationCount=T,P(e)}function P(e){if(!k.cache.has(e.id))return;const t=k.cache.get(e.id);return void 0===t?{type:void 0,isIncomplete:!1}:g(t)?{type:t.type,isIncomplete:!0,incompleteSubtypes:t.incompleteSubtypes,generationCount:t.generationCount}:{type:t,isIncomplete:!1}}function N(t){let n=t.node;const a=t.node.parent;return a&&(28!==a.nodeType&&10!==a.nodeType||(n=a)),e.evaluateTypeForSubnode(n,(()=>{e.evaluateTypesForStatement(t.node)}))}function D(e,t){k.pendingNodes.add(e.id);try{const n=t();return k.pendingNodes.delete(e.id),n}catch(t){throw k.pendingNodes.delete(e.id),t}}function F(t){var n,r,s,g,h,f;let C=t;for(e.checkForCancellation();;){const x=P(C);if(x){if(!x.isIncomplete)return x;if(x.generationCount===T)return{type:x.type?(0,y.cleanIncompleteUnknown)(x.type):void 0,isIncomplete:!0}}if(k.pendingNodes.has(C.id))return{type:null!==(n=null==x?void 0:x.type)&&void 0!==n?n:m.UnknownType.create(!0),isIncomplete:!0};if(C.flags&i.FlowFlags.Unreachable)return A(C,m.NeverType.createNever(),!1);if(C.flags&i.FlowFlags.VariableAnnotation){C=C.antecedent}else if(C.flags&i.FlowFlags.Call){const t=C;if(I(e,t))return A(C,void 0,!1);C=t.antecedent}else if(C.flags&i.FlowFlags.Assignment){const n=C,a=n.node;if(o){if((null==l?void 0:l.targetSymbolId)===n.targetSymbolId&&(0,p.isMatchingExpression)(o,a)){if(C.flags&i.FlowFlags.Unbind)return 24===o.nodeType||35===o.nodeType?A(C,void 0,!1):A(C,m.UnboundType.create(),!1);let r=D(C,(()=>N(n)));if(r){if((0,y.isTypeAliasPlaceholder)(r.type))return{type:r.type,isIncomplete:!0};35===o.nodeType&&e.isAsymmetricAccessorAssignment(a)&&(r=void 0)}return r&&!_(t)&&(r=void 0),A(C,null==r?void 0:r.type,!!(null==r?void 0:r.isIncomplete))}if(24===a.nodeType&&(0,p.isMatchingExpression)(o,a.baseExpression)&&3===(null===(r=a.parent)||void 0===r?void 0:r.nodeType)&&1===a.items.length&&!a.trailingComma&&!a.items[0].name&&0===a.items[0].argumentCategory&&48===a.items[0].valueExpression.nodeType&&1===a.items[0].valueExpression.strings.length&&49===a.items[0].valueExpression.strings[0].nodeType){const e=a.items[0].valueExpression.strings[0].value,t=D(n,(()=>{const t=F(n.antecedent);return t.type&&(t.type=(0,y.mapSubtypes)(t.type,(t=>(0,m.isClass)(t)&&m.ClassType.isTypedDictClass(t)?(0,d.narrowForKeyAssignment)(t,e):t))),t}));return A(C,null==t?void 0:t.type,!!(null==t?void 0:t.isIncomplete))}if((0,p.isPartialMatchingExpression)(o,a))return{type:null===(s=null==l?void 0:l.typeAtStart)||void 0===s?void 0:s.type,isIncomplete:!!(null===(g=null==l?void 0:l.typeAtStart)||void 0===g?void 0:g.isIncomplete)}}C=n.antecedent}else{if(C.flags&i.FlowFlags.BranchLabel){const t=C;if(C.flags&i.FlowFlags.PostContextManager){const t=C;if(t.expressions.some((n=>w(e,n,t.isAsync)))===t.blockIfSwallowsExceptions)return A(C,void 0,!1)}if(o&&t.preBranchAntecedent&&t.affectedExpressions&&(b||(b=(0,i.createKeysForReferenceSubexpressions)(o)),!b.some((e=>t.affectedExpressions.has(e)))&&_(C,t.preBranchAntecedent))){C=t.preBranchAntecedent;continue}return E(C)}if(C.flags&i.FlowFlags.LoopLabel){const e=C;if(o&&(b||(b=(0,i.createKeysForReferenceSubexpressions)(o)),!b.some((t=>e.affectedExpressions.has(t))))){C=e.antecedents[0];continue}return M(e,x)}if(C.flags&(i.FlowFlags.TrueCondition|i.FlowFlags.FalseCondition)){const t=C;if(!(null==l?void 0:l.skipConditionalNarrowing)&&o){const n=D(C,(()=>{const n=(0,u.getTypeNarrowingCallback)(e,o,t.expression,!!(t.flags&(i.FlowFlags.TrueCondition|i.FlowFlags.TrueNeverCondition)));if(n){const e=F(t.antecedent);let a=e.type,r=e.isIncomplete;if(a){const e=n(a);e&&(a=e.type,e.isIncomplete&&(r=!0))}return A(C,a,r)}}));if(n)return n}C=t.antecedent}else if(C.flags&(i.FlowFlags.TrueNeverCondition|i.FlowFlags.FalseNeverCondition)){const t=C;if(!(null==l?void 0:l.skipConditionalNarrowing)&&t.reference&&(0,i.createKeyForReference)(t.reference)!==v){const n=e.lookUpSymbolRecursive(t.reference,t.reference.value,!1);if(n&&n.symbol.hasTypedDeclarations()){const n=D(C,(()=>{const n=(0,u.getTypeNarrowingCallback)(e,t.reference,t.expression,!!(t.flags&(i.FlowFlags.TrueCondition|i.FlowFlags.TrueNeverCondition)));if(n){const a=e.getTypeOfExpression(t.reference);let r=a.type,s=!!a.isIncomplete;const i=n(a.type);if(i&&(r=i.type,i.isIncomplete&&(s=!0)),(0,m.isNever)(r))return A(C,void 0,s)}}));if(n)return n}}C=t.antecedent}else if(C.flags&i.FlowFlags.ExhaustedMatch){const t=C,n=e.evaluateTypeForSubnode(t.node,(()=>{e.evaluateTypesForMatchStatement(t.node)}));if(n){if((0,m.isNever)(n.type))return A(C,n.type,!!n.isIncomplete);if(o){const a=(0,c.getPatternSubtypeNarrowingCallback)(e,o,t.subjectExpression);if(a){const e=a(n.type);if(e)return A(C,e.type,!!n.isIncomplete||!!e.isIncomplete)}}}C=t.antecedent}else if(C.flags&i.FlowFlags.NarrowForPattern){const t=C;if(!o||(0,p.isMatchingExpression)(o,t.subjectExpression)){const n=e.evaluateTypeForSubnode(t.statement,(()=>{64===t.statement.nodeType?e.evaluateTypesForCaseStatement(t.statement):e.evaluateTypesForMatchStatement(t.statement)}));if(n){if(o)return A(C,n.type,!!n.isIncomplete);if((0,m.isNever)(n.type))return A(C,void 0,!!n.isIncomplete)}}else if(64===t.statement.nodeType){const n=t.statement,a=(0,c.getPatternSubtypeNarrowingCallback)(e,o,t.subjectExpression);if(a){const t=e.evaluateTypeForSubnode(n,(()=>{e.evaluateTypesForCaseStatement(n)}));if(t){const e=a(t.type);if(e)return A(C,e.type,!!t.isIncomplete||!!e.isIncomplete)}}}C=t.antecedent}else{if(C.flags&i.FlowFlags.PreFinallyGate)return O(C);if(C.flags&i.FlowFlags.PostFinally)return z(C);if(C.flags&i.FlowFlags.Start)return A(C,null===(h=null==l?void 0:l.typeAtStart)||void 0===h?void 0:h.type,!!(null===(f=null==l?void 0:l.typeAtStart)||void 0===f?void 0:f.isIncomplete));if(C.flags&i.FlowFlags.WildcardImport){const e=C;if(o&&38===o.nodeType){const t=o.value;if(e.names.some((e=>e===t)))return D(C,(()=>{const n=S(e,t);return A(C,n,!1)}))}C=e.antecedent}else(0,a.fail)("Unexpected flow node flags")}}}}function E(e){const t=[];let n=!1;for(const a of e.antecedents){const r=F(a);if(void 0===o&&r.type&&!(0,m.isNever)(r.type))return A(e,m.UnknownType.create(),!1);r.isIncomplete&&(n=!0),r.type&&t.push(r.type)}return A(e,t.length>0?(0,m.combineTypes)(t):void 0,n)}function M(e,t){var n;const a=e.antecedents.length;if(void 0===t)t=A(e,o?void 0:m.UnknownType.create(),!0);else if(t.incompleteSubtypes&&t.incompleteSubtypes.length===e.antecedents.length&&t.incompleteSubtypes.some((e=>e.isPending)))return{type:t.type?(0,y.cleanIncompleteUnknown)(t.type):void 0,isIncomplete:!0};let r=0;for(;;){let i=!1,l=!1,p=void 0===o&&(null===(n=t.incompleteSubtypes)||void 0===n?void 0:n.some((e=>void 0!==e.type))),c=!1,d=!1;if(e.antecedents.forEach(((n,a)=>{var r,s;if(void 0===o&&p)return;if(d&&a>0)return;if((t=P(e)).incompleteSubtypes&&a<t.incompleteSubtypes.length&&t.incompleteSubtypes[a].isPending){if(0!==a)return i=!0,void(l=!0);d=!0}const u=void 0!==t.incompleteSubtypes&&a<t.incompleteSubtypes.length?t.incompleteSubtypes[a]:void 0;if(void 0===u||!(null==u?void 0:u.isPending)&&(null==u?void 0:u.isIncomplete)){const o=void 0===u?0:u.evaluationCount;t=x(e,a,null!==(r=null==u?void 0:u.type)&&void 0!==r?r:m.UnknownType.create(!0),!0,!0,o);try{const r=F(n);r.isIncomplete&&(i=!0,0===a&&(c=!0)),t=x(e,a,null!==(s=r.type)&&void 0!==s?s:r.isIncomplete?m.UnknownType.create(!0):m.NeverType.createNever(),r.isIncomplete,d,o+1)}catch(n){throw t=x(e,a,m.UnknownType.create(!0),!0,d,o+1),n}}void 0===o&&void 0!==(null==t?void 0:t.type)&&(p=!0)})),p)return l?{type:m.UnknownType.create(),isIncomplete:!1}:A(e,m.UnknownType.create(),!1);let u=t.type;if(i&&u){const e=(0,y.cleanIncompleteUnknown)(u);e!==u&&(u=e)}if(!i||r>=a){let t=i;return!i||l||s(C)||!u||(0,y.isIncompleteUnknown)(u)||c||(t=!1),l||i?(t||T++,{type:u,isIncomplete:t}):d?{type:u,isIncomplete:!0}:A(e,u,!1)}r++}}function O(e){if(k.closedFinallyGateNodes.has(e.id))return{type:void 0,isIncomplete:!1};const t=F(e.antecedent);return function(e){k.cache.delete(e.id)}(e),{type:t.type,isIncomplete:t.isIncomplete}}function z(t){const n=k.closedFinallyGateNodes.has(t.preFinallyGate.id);try{let n;return k.closedFinallyGateNodes.add(t.preFinallyGate.id),e.useSpeculativeMode(t.finallyNode,(()=>{n=F(t.antecedent)})),n.isIncomplete?n:A(t,n.type,!1)}finally{n||k.closedFinallyGateNodes.delete(t.preFinallyGate.id)}}return n?F(n):{type:null===(h=null==l?void 0:l.typeAtStart)||void 0===h?void 0:h.type,isIncomplete:!!(null===(f=null==l?void 0:l.typeAtStart)||void 0===f?void 0:f.isIncomplete)}}}},isFlowNodeReachable:_,narrowConstrainedTypeVar:function(t,n){(0,a.assert)(!n.details.isParamSpec),(0,a.assert)(!n.details.isVariadic),(0,a.assert)(!n.details.boundType),(0,a.assert)(n.details.constraints.length>0);const r=new Set,s=[];for(const e of n.details.constraints){if(!(0,m.isClassInstance)(e))return;s.push(e)}const o=function t(n,o){let l=n;for(;;){if(r.has(l.id))return s;if(l.flags&(i.FlowFlags.Unreachable|i.FlowFlags.Start))return s;if(l.flags&(i.FlowFlags.VariableAnnotation|i.FlowFlags.Assignment|i.FlowFlags.WildcardImport|i.FlowFlags.TrueNeverCondition|i.FlowFlags.FalseNeverCondition|i.FlowFlags.ExhaustedMatch|i.FlowFlags.PostFinally|i.FlowFlags.PreFinallyGate|i.FlowFlags.Call)){l=l.antecedent}else if(l.flags&i.FlowFlags.NarrowForPattern){const n=l;if(64===n.statement.nodeType){if(C(e.getTypeOfExpression(n.subjectExpression).type,o)){const a=n.statement.pattern;if(66===a.nodeType&&1===a.orPatterns.length&&68===a.orPatterns[0].nodeType){const r=a.orPatterns[0],s=e.getTypeOfExpression(r.className,2).type;if((0,m.isInstantiableClass)(s)){return t(n.antecedent,o).filter((e=>m.ClassType.isSameGenericClass(e,s)))}}}}l=n.antecedent}else{if(!(l.flags&(i.FlowFlags.TrueCondition|i.FlowFlags.FalseCondition))){if(l.flags&(i.FlowFlags.BranchLabel|i.FlowFlags.LoopLabel)){const e=l,n=[];r.add(l.id);for(const a of e.antecedents){const e=t(a,o);for(const t of e)n.some((e=>(0,m.isTypeSame)(e,t)))||n.push(t)}return r.delete(l.id),n}return(0,a.fail)("Unexpected flow node flags"),s}{const n=l,a=n.expression,s=0!=(l.flags&i.FlowFlags.TrueCondition);if(9===a.nodeType&&38===a.leftExpression.nodeType&&"isinstance"===a.leftExpression.value&&2===a.arguments.length){const i=a.arguments[0].valueExpression;if(C(e.getTypeOfExpression(i).type,o)){r.add(l.id);const i=t(n.antecedent,o);r.delete(l.id);const p=a.arguments[1].valueExpression,c=e.getTypeOfExpression(p,634).type;if((0,m.isInstantiableClass)(c))return i.filter((e=>m.ClassType.isSameGenericClass(e,c)?s:!s))}}l=n.antecedent}}}}(t,n);return 1===o.length?o[0]:void 0},printControlFlowGraph:A}}},31508:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wildcardImportReferenceKey=t.createKeysForReferenceSubexpressions=t.createKeyForReference=t.isCodeFlowSupportedForReference=t.getUniqueFlowNodeId=t.FlowFlags=void 0;const a=n(83181);var r;!function(e){e[e.Unreachable=1]="Unreachable",e[e.Start=2]="Start",e[e.BranchLabel=4]="BranchLabel",e[e.LoopLabel=8]="LoopLabel",e[e.Assignment=16]="Assignment",e[e.Unbind=32]="Unbind",e[e.WildcardImport=64]="WildcardImport",e[e.TrueCondition=128]="TrueCondition",e[e.FalseCondition=512]="FalseCondition",e[e.Call=1024]="Call",e[e.PreFinallyGate=2048]="PreFinallyGate",e[e.PostFinally=4096]="PostFinally",e[e.VariableAnnotation=16384]="VariableAnnotation",e[e.PostContextManager=32768]="PostContextManager",e[e.TrueNeverCondition=65536]="TrueNeverCondition",e[e.FalseNeverCondition=131072]="FalseNeverCondition",e[e.NarrowForPattern=262144]="NarrowForPattern",e[e.ExhaustedMatch=524288]="ExhaustedMatch"}(r||(t.FlowFlags=r={}));let s=1;function i(e){let t;if(38===e.nodeType)t=e.value;else if(35===e.nodeType){t=`${i(e.leftExpression)}.${e.memberName.value}`}else if(24===e.nodeType){const n=i(e.baseExpression);(0,a.assert)(1===e.items.length);const r=e.items[0].valueExpression;if(40===r.nodeType)t=`${n}[${r.value.toString()}]`;else if(48===r.nodeType){const e=r;(0,a.assert)(1===e.strings.length&&49===e.strings[0].nodeType),t=`${n}["${e.strings[0].value}"]`}else 55===r.nodeType&&33===r.operator&&40===r.expression.nodeType?t=`${n}[-${r.expression.value.toString()}]`:(0,a.fail)("createKeyForReference received unexpected index type")}else(0,a.fail)("createKeyForReference received unexpected expression type");return t}t.getUniqueFlowNodeId=function(){return s++},t.isCodeFlowSupportedForReference=function e(t){if(38===t.nodeType)return!0;if(35===t.nodeType)return e(t.leftExpression);if(24===t.nodeType){if(1!==t.items.length||t.trailingComma||void 0!==t.items[0].name||0!==t.items[0].argumentCategory)return!1;const n=t.items[0].valueExpression,a=40===n.nodeType&&!n.isImaginary&&n.isInteger,r=55===n.nodeType&&33===n.operator&&40===n.expression.nodeType&&!n.expression.isImaginary&&n.expression.isInteger,s=48===n.nodeType&&1===n.strings.length&&49===n.strings[0].nodeType;return!!(a||r||s)&&e(t.baseExpression)}return!1},t.createKeyForReference=i,t.createKeysForReferenceSubexpressions=function e(t){return 38===t.nodeType?[i(t)]:35===t.nodeType?[...e(t.leftExpression),i(t)]:24===t.nodeType?[...e(t.baseExpression),i(t)]:void(0,a.fail)("createKeyForReference received unexpected expression type")},t.wildcardImportReferenceKey="*"},48816:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatControlFlowGraph=void 0;const a=n(96193),r=n(9316),s=n(31508);t.formatControlFlowGraph=function(e){const t=Object.create(null),n=[],i=[],o=d(e,new Set);for(const e of n)e.text=g(e.flowNode,e.circular),m(e);const l=function(e){const t=f(Array(e),0);for(const e of n)t[e.level]=Math.max(t[e.level],e.text.length);return t}(function e(t){let n=0;for(const a of p(t))n=Math.max(n,e(a));return n+1}(o));return function e(t,n){if(-1===t.lane){t.lane=n,t.endLane=n;const a=p(t);for(let r=0;r<a.length;r++){r>0&&n++;const s=a[r];e(s,n),s.endLane>t.endLane&&(n=s.endLane)}t.endLane=n}}(o,0),function(){const e=l.length,t=n.reduce(((e,t)=>Math.max(e,t.lane)),0)+1,a=f(Array(t),""),r=l.map((()=>Array(t))),s=l.map((()=>f(Array(t),0)));for(const e of n){r[e.level][e.lane]=e;const t=p(e);for(let n=0;n<t.length;n++){const a=t[n];let r=8;a.lane===e.lane&&(r|=4),n>0&&(r|=1),n<t.length-1&&(r|=2),s[e.level][a.lane]|=r}0===t.length&&(s[e.level][e.lane]|=16);const n=c(e);for(let t=0;t<n.length;t++){const a=n[t];let r=4;t>0&&(r|=1),t<n.length-1&&(r|=2),s[e.level-1][a.lane]|=r}}for(let n=0;n<e;n++)for(let e=0;e<t;e++){const t=n>0?s[n-1][e]:0,a=e>0?s[n][e-1]:0;let r=s[n][e];r||(r=0,8&t&&(r|=12),2&a&&(r|=3),s[n][e]=r)}for(let t=0;t<e;t++)for(let n=0;n<a.length;n++){const a=s[t][n],o=4&a?"─":" ",p=r[t][n];p?(i(n,p.text),t<e-1&&(i(n," "),i(n,T(o,l[t]-p.text.length)))):t<e-1&&i(n,T(o,l[t]+1)),i(n,h(a)),i(n,8&a&&t<e-1&&!r[t+1][n]?"─":" ")}return`${a.join("\n")}\n`;function i(e,t){a[e]+=t}}();function p(e){const t=[];for(const n of e.edges)n.source===e&&t.push(n.target);return t}function c(e){const t=[];for(const n of e.edges)n.target===e&&t.push(n.source);return t}function d(e,a){const r=e.id;let i=t[r];if(i&&a.has(e))return i={id:-1,flowNode:e,edges:[],text:"",lane:-1,endLane:-1,level:-1,circular:!0},n.push(i),i;if(a.add(e),!i){t[r]=i={id:r,flowNode:e,edges:[],text:"",lane:-1,endLane:-1,level:-1,circular:!1},n.push(i);const o=function(e){if(e.flags&(s.FlowFlags.LoopLabel|s.FlowFlags.BranchLabel))return e.antecedents;if(e.flags&(s.FlowFlags.Assignment|s.FlowFlags.VariableAnnotation|s.FlowFlags.WildcardImport|s.FlowFlags.TrueCondition|s.FlowFlags.FalseCondition|s.FlowFlags.TrueNeverCondition|s.FlowFlags.FalseNeverCondition|s.FlowFlags.NarrowForPattern|s.FlowFlags.ExhaustedMatch|s.FlowFlags.Call|s.FlowFlags.PreFinallyGate|s.FlowFlags.PostFinally))return[e.antecedent];return[]}(e);for(const e of o)u(i,e,a)}return a.delete(e),i}function u(e,t,n){const a=d(t,n),r={source:e,target:a};i.push(r),e.edges.push(r),a.edges.push(r)}function m(e){if(-1!==e.level)return e.level;let t=0;for(const n of c(e))t=Math.max(t,m(n)+1);return e.level=t}function y(e){const t=function(e){return e.flags&s.FlowFlags.Assignment||e.flags&s.FlowFlags.WildcardImport?e.node:e.flags&(s.FlowFlags.TrueCondition|s.FlowFlags.FalseCondition)?e.expression:e.flags&s.FlowFlags.NarrowForPattern?e.statement:e.flags&s.FlowFlags.Call?e.node:void 0}(e);if(!t)return;const n=(0,r.getFileInfo)(t),i=(0,a.convertOffsetToPosition)(t.start,n.lines);return`[${i.line+1}:${i.character+1}]`}function g(e,t){const n=`${function(e){if(e&s.FlowFlags.Start)return"Start";if(e&s.FlowFlags.BranchLabel)return"Branch";if(e&s.FlowFlags.LoopLabel)return"Loop";if(e&s.FlowFlags.Unbind)return"Unbind";if(e&s.FlowFlags.Assignment)return"Assign";if(e&s.FlowFlags.TrueCondition)return"True";if(e&s.FlowFlags.FalseCondition)return"False";if(e&s.FlowFlags.Call)return"Call";if(e&s.FlowFlags.Unreachable)return"Unreachable";if(e&s.FlowFlags.WildcardImport)return"Wildcard";if(e&s.FlowFlags.PreFinallyGate)return"PreFinal";if(e&s.FlowFlags.PostFinally)return"PostFinal";if(e&s.FlowFlags.VariableAnnotation)return"Annotate";if(e&s.FlowFlags.TrueNeverCondition)return"TrueNever";if(e&s.FlowFlags.FalseNeverCondition)return"FalseNever";if(e&s.FlowFlags.NarrowForPattern)return"Pattern";if(e&s.FlowFlags.ExhaustedMatch)return"Exhaust";throw new Error}(e.flags)}@${e.id}${y(e)||""}`;return t?`Circular(${n})`:n}function h(e){switch(e){case 3:return"│";case 12:return"─";case 5:return"╯";case 9:return"╰";case 6:return"╮";case 10:return"╭";case 7:return"┤";case 11:return"├";case 13:return"┴";case 14:return"┬";case 15:return"╫"}return" "}function f(e,t){if(e.fill)e.fill(t);else for(let n=0;n<e.length;n++)e[n]=t;return e}function T(e,t){if(e.repeat)return t>0?e.repeat(t):"";let n="";for(;n.length<t;)n+=e;return n}}},63516:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getFileLevelDirectives=void 0;const a=n(55484),r=n(83181),s=n(72484),i=n(96193),o=n(95960),l="strict",p="standard",c="basic";function d(e){!function(e,t,n){const r=(0,a.getBooleanDiagnosticRules)(),s=(0,a.getDiagLevelDiagnosticRules)();for(const a of r)n.find((e=>e===a))||t[a]&&(e[a]=!0);for(const a of s){if(n.find((e=>e===a)))continue;const r=t[a],s=e[a];("error"===r||"warning"===r&&"error"!==s||"information"===r&&"error"!==s&&"warning"!==s)&&(e[a]=r)}}(e,(0,a.getStrictDiagnosticRuleSet)(),(0,a.getStrictModeNotOverriddenRules)())}function u(e,t){const n=(0,a.getBooleanDiagnosticRules)(),r=(0,a.getDiagLevelDiagnosticRules)();for(const a of n)e[a]=t[a];for(const n of r)e[n]=t[n]}function m(e,t,n,r,i){const m="pyright:";if(e.startsWith(m)){const m=e.substring(8);if(m.trim().startsWith("ignore"))return r;if(!n()){const e=new s.DiagnosticAddendum;e.addMessage(o.LocAddendum.pyrightCommentIgnoreTip());const n={message:o.LocMessage.pyrightCommentNotOnOwnLine()+e.getString(),range:t};i.push(n)}const h=m.split(",");h.some((e=>e.trim()===l))?d(r):h.some((e=>e.trim()===p))?function(e){u(e,(0,a.getStandardDiagnosticRuleSet)())}(r):h.some((e=>e.trim()===c))&&function(e){u(e,(0,a.getBasicDiagnosticRuleSet)())}(r);let f=0;for(const e of h){const[n,a]=g(e,{start:t.start+8+f,length:e.length});r=y(n,a,r,i),f+=e.length+1}}return r}function y(e,t,n,r){const s=e.split("="),[i,p]=g(s[0],{start:t.start,length:s[0].length});if(1===s.length&&i&&[l,c].some((e=>i===e)))return n;const d=(0,a.getDiagLevelDiagnosticRules)(),u=(0,a.getBooleanDiagnosticRules)(),m=s.length>0?s.slice(1).join("="):"",[y,h]=g(m,{start:t.start+s[0].length+1,length:m.length});if(d.find((e=>e===i))){const e=function(e){switch(e){case"false":case"none":return"none";case"true":case"error":return"error";case"warning":return"warning";case"information":return"information";default:return}}(y);if(void 0!==e)n[i]=e;else{const e={message:o.LocMessage.pyrightCommentInvalidDiagnosticSeverityValue(),range:y?h:p};r.push(e)}}else if(u.find((e=>e===i))){const e=function(e){if("false"===e)return!1;if("true"===e)return!0;return}(y);if(void 0!==e)n[i]=e;else{const e={message:o.LocMessage.pyrightCommentInvalidDiagnosticBoolValue(),range:y?h:p};r.push(e)}}else if(i){const e={message:y?o.LocMessage.pyrightCommentUnknownDiagnosticRule().format({rule:i}):o.LocMessage.pyrightCommentUnknownDirective().format({directive:i}),range:p};r.push(e)}else{const e={message:o.LocMessage.pyrightCommentMissingDirective(),range:p};r.push(e)}return n}function g(e,t){(0,r.assert)(e.length===t.length);const n=e.trimStart();let a=t;if(n!==e){const t=e.length-n.length;a={start:a.start+t,length:a.length-t}}const s=n.trimEnd();return s!==n&&(a={start:a.start,length:a.length-n.length+s.length}),(0,r.assert)(s.length===a.length),[s,a]}t.getFileLevelDirectives=function(e,t,n,r,s){let o=(0,a.cloneDiagnosticRuleSet)(n);r&&d(o);for(let n=0;n<e.count;n++){const a=e.getItemAt(n);if(a.comments)for(const e of a.comments){const[n,a]=g(e.value,{start:e.start,length:e.length});o=m(n,a,(()=>(0,i.convertOffsetToPosition)(e.start,t).character<=1),o,s)}}return o}},99868:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.populateTypeVarContextBasedOnExpectedType=t.updateTypeVarType=t.assignTypeToTypeVar=void 0;const a=n(72484),r=n(95960),s=n(90549),i=n(8312),o=n(808),l=n(97632),p=!1;function c(e,t,n,a,r,s=void 0,o=!1){let l;if(a&&!o){const t=(0,i.isVariadicTypeVar)(n)?d(e,a):e.stripLiteralValue(a);t!==a&&(r&&!e.assignType(r,t)||(l=t))}t.setTypeVarType(n,a,l,r,s)}function d(e,t){if(!(0,i.isUnpackedClass)(t)||!t.tupleTypeArguments)return t;let n=!1;const a=t.tupleTypeArguments.map((t=>{const a=e.stripLiteralValue(t.type);return a!==t.type&&(n=!0),{isUnbounded:t.isUnbounded,isOptional:t.isOptional,type:a}}));return n?(0,o.specializeTupleClass)(t,a,!0,!0):t}function u(e,t,n){const a=t.getSignatureContexts().length;0===a?console.log(`${n}  no signatures`):1===a?m(e,t.getSignatureContexts()[0],`${n}  `):t.doForEachSignatureContext(((t,a)=>{console.log(`${n}  signature ${a}`),m(e,t,`${n}    `)}))}function m(e,t,n){let a=!1;t.getTypeVars().forEach((t=>{var r;const s=`${n}${t.typeVar.details.name}`,o=null!==(r=t.narrowBoundNoLiterals)&&void 0!==r?r:t.narrowBound,l=t.wideBound;o&&l&&(0,i.isTypeSame)(o,l)?(console.log(`${s} = ${e.printType(o)}`),a=!0):(o&&(console.log(`${s} ≤ ${e.printType(o)}`),a=!0),l&&(console.log(`${s} ≥ ${e.printType(l)}`),a=!0))})),a||console.log(`${n}no constraints`)}t.assignTypeToTypeVar=function(e,t,n,m,y,g=0,h=0){if(p){const a=" ".repeat(2*h);console.log(`${a}`),console.log(`${a}assignTypeToTypeVar called with`),console.log(`${a}destType: ${e.printType(t)}`),console.log(`${a}srcType: ${e.printType(n)}`),console.log(`${a}flags: ${g}`),console.log(`${a}scopes: ${(y.getSolveForScopes()||[]).join(", ")}`),console.log(`${a}pre-call context #${y.getId()}: `),u(e,y,a)}let f=!0;const T=0!=(1&g),v=0!=(2&g);if(!t.scopeId)return!0;if(i.TypeBase.isInstantiable(t)&&(0,i.isInstantiableClass)(n)&&e.isSpecialFormClass(n,g))return!1;if(!y.hasSolveForScope(t.scopeId)){if((0,i.isAnyOrUnknown)(n)||(0,i.isClass)(n)&&i.ClassType.derivesFromAnyOrUnknown(n))return!0;if((0,i.isClassInstance)(n)&&i.ClassType.isBuiltIn(n,"type")&&(!n.typeArguments||n.typeArguments.length<1||(0,i.isAnyOrUnknown)(n.typeArguments[0]))&&i.TypeBase.isInstantiable(t))return!0;if(t.details.isParamSpec&&(0,i.isFunction)(n)&&i.FunctionType.isParamSpecValue(n)&&i.FunctionType.shouldSkipArgsKwargsCompatibilityCheck(n))return!0;if((0,i.isNever)(n)&&!T)return!0;if(0!=(1024&g))return!0;if(f=!1,!t.details.isSynthesized||t.details.isSynthesizedSelf)return null==m||m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(n,t))),!1}if((0,i.isTypeSame)(t,n)&&t.isInScopePlaceholder)return!0;if(0!=(8&g))return e.assignType(e.makeTopLevelTypeVarsConcrete(t),e.makeTopLevelTypeVarsConcrete(n),m,void 0,void 0,g,h);if(t.details.isParamSpec)return function(e,t,n,a,s,l=0){let c=!0;if(s.doForEachSignature((p=>{if((0,i.isTypeVar)(n)&&n.details.isParamSpec){const e=p.getParamSpecType(t);if(!e)return void(!s.isLocked()&&s.hasSolveForScope(t.scopeId)&&p.setTypeVarType(t,(0,o.convertTypeToParamSpecValue)(n)));if(0===e.details.parameters.length&&e.details.paramSpec&&(0,i.isTypeSame)(e.details.paramSpec,n,{},l))return}else if((0,i.isFunction)(n)){const a=n,r=n.details.parameters.map(((e,t)=>({category:e.category,name:e.name,isNameSynthesized:e.isNameSynthesized,hasDefault:!!e.hasDefault,defaultValueExpression:e.defaultValueExpression,hasDeclaredType:e.hasDeclaredType,type:i.FunctionType.getEffectiveParameterType(a,t)}))),c=i.FunctionType.createInstance("","","",65536|n.details.flags);r.forEach((e=>{i.FunctionType.addParameter(c,e)})),c.details.typeVarScopeId=n.details.typeVarScopeId,c.details.constructorTypeVarScopeId=n.details.constructorTypeVarScopeId,i.FunctionType.addHigherOrderTypeVarScopeIds(c,n.details.higherOrderTypeVarScopeIds),c.details.docString=n.details.docString,c.details.deprecatedMessage=n.details.deprecatedMessage,c.details.paramSpec=n.details.paramSpec,c.details.methodClass=n.details.methodClass;let d=!1;const u=p.getParamSpecType(t);if(u){const t=(0,o.convertParamSpecValueToType)(u),n=e.assignType(t,c,void 0,void 0,void 0,64,l),a=e.assignType(c,t,void 0,void 0,void 0,64,l);if(n&&a){if(i.FunctionType.shouldSkipArgsKwargsCompatibilityCheck(c))return;d=!0}else if(a)d=!0;else if(n)return}else d=!0;if(d)return void(!s.isLocked()&&s.hasSolveForScope(t.scopeId)&&p.setTypeVarType(t,c))}else if((0,i.isAnyOrUnknown)(n))return;null==a||a.addMessage(r.LocAddendum.typeParamSpec().format({type:e.printType(n),name:t.details.name})),c=!1})),p){const t=" ".repeat(2*l);console.log(`${t}`),console.log(`${t}post-call typeVarContext: `),u(e,s,t)}return c}(e,t,n,m,y,h);if(t.details.isVariadic&&!t.isVariadicInUnion&&!(0,i.isUnpacked)(n)){const t=e.getTupleClassType();n=t&&(0,i.isInstantiableClass)(t)?(0,o.convertToInstance)((0,o.specializeTupleClass)(t,[{type:n,isUnbounded:!1}],!0,!0)):i.UnknownType.create()}if((0,i.isTypeVar)(n)&&n.details.isVariadic&&n.isVariadicUnpacked&&!n.isVariadicInUnion&&!t.details.isVariadic&&(n=i.TypeVarType.cloneForUnpacked(n,!0)),t.details.constraints.length>0)return function(e,t,n,a,s,p,d,u){let m;const y=e.makeTopLevelTypeVarsConcrete(n),g=s.getPrimarySignature().getTypeVar(t),h=null==g?void 0:g.wideBound,f=null==g?void 0:g.narrowBound;let T=!1;if((0,i.isTypeVar)(n))e.assignType(t,y,void 0,new l.TypeVarContext(t.scopeId),void 0,0,u)&&(m=n,i.TypeBase.isInstantiable(n)&&(m=(0,o.convertToInstance)(n,!1)));else{let n,a=!0;m=(0,o.mapSubtypes)(y,(r=>{let s,l;return(0,i.isAnyOrUnknown)(r)?r:(t.details.constraints.forEach(((n,a)=>{const p=i.TypeBase.isInstantiable(t)?(0,o.convertToInstantiable)(n):n;e.assignType(p,r,void 0,void 0,void 0,0,u)&&(s&&!e.assignType(i.TypeBase.isInstantiable(t)?(0,o.convertToInstantiable)(s):s,p,void 0,void 0,void 0,0,u)||(s=(0,o.addConditionToType)(n,(0,o.getTypeCondition)(r)),l=a))})),s||0==(2&p)&&(a=!1),void 0===l||(0,o.getTypeCondition)(r)||(void 0!==n&&n!==l&&(a=!1),n=l),s)})),!(0,i.isNever)(m)&&a||(m=void 0),!m&&(0,i.isUnion)(y)&&(m=t.details.constraints.find((n=>{const a=i.TypeBase.isInstantiable(t)?(0,o.convertToInstantiable)(n):n;return e.assignType(a,y,void 0,void 0,void 0,0,u)})))}if(!m)return null==a||a.addMessage(r.LocAddendum.typeConstrainedTypeVar().format({type:e.printType(n),name:t.details.name})),!1;(0,o.isLiteralTypeOrUnion)(m)&&(T=!0);if(f&&!(0,i.isAnyOrUnknown)(f)){if(!e.assignType(f,m,void 0,void 0,void 0,0,u)){if(!e.assignType(m,f,void 0,void 0,void 0,0,u))return null==a||a.addMessage(r.LocAddendum.typeConstrainedTypeVar().format({type:e.printType(m),name:e.printType(f)})),!1;!s.isLocked()&&d&&c(e,s,t,m,h)}}else!s.isLocked()&&d&&c(e,s,t,m,h,void 0,T);return!0}(e,t,n,m,y,g,f,h);const b=y.getPrimarySignature().getTypeVar(t);let _=null==b?void 0:b.wideBound;_||t.details.isSynthesizedSelf||(_=t.details.boundType);let C=null==b?void 0:b.narrowBound,I=C,k=_;const w=m?new a.DiagnosticAddendum:void 0;let S=n;if(0==(8192&g)&&(0,i.isClass)(S)&&S.includeSubclasses&&(S=(0,o.specializeWithDefaultTypeArgs)(S)),i.TypeBase.isInstantiable(t))if((0,o.isEffectivelyInstantiable)(S))S=(0,o.convertToInstance)(S,!1);else{const a=e.makeTopLevelTypeVarsConcrete(S);if(!(0,o.isEffectivelyInstantiable)(a))return null==m||m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(n,t))),!1;S=(0,o.convertToInstance)(a)}else if((0,i.isTypeVar)(n)&&i.TypeBase.isInstantiable(n)&&(0,i.isTypeSame)((0,o.convertToInstance)(n),t))return null==m||m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(S,t))),!1;if(0!=(2048&g)){if(0!=(4096&g)&&(0,i.isUnknown)(S))return!0;b||(T?(I=S,k=S):v?I=S:k=S)}else if(v){if(!_||(0,i.isTypeSame)(t,_))k=S;else if(!(0,i.isTypeSame)(_,S,{},h))if(e.assignType(_,e.makeTopLevelTypeVarsConcrete(S),w,void 0,void 0,1024&g,h))(0,i.isAnyOrUnknown)(_)||(k=S);else if(!e.assignType(S,_,w,void 0,void 0,1024&g,h))return m&&w&&(m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(_,S))),m.addAddendum(w)),!1;if(C&&!e.assignType(k,C,void 0,void 0,void 0,1024&g,h))return m&&w&&(m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(C,k))),m.addAddendum(w)),!1}else{if(!C||(0,i.isTypeSame)(t,C))I=S;else if((0,i.isTypeSame)(C,S,{},h))!k&&T&&(null==b?void 0:b.narrowBoundNoLiterals)&&(I=b.narrowBoundNoLiterals);else if((0,i.isAnyOrUnknown)(S)&&(null==b?void 0:b.tupleTypes))I=S;else if(e.assignType(C,S,w,y,void 0,g,h))I=(0,o.isPartlyUnknown)(C)&&!(0,i.isUnknown)(S)&&e.assignType(S,C,void 0,y,void 0,1024&g,h)?S:(0,o.applySolvedTypeVars)(C,y);else if((0,i.isTypeVar)(C)&&!(0,i.isTypeVar)(S)&&e.assignType(e.makeTopLevelTypeVarsConcrete(C),S,w,y,void 0,g,h))I=S;else{if(y.isLocked())return null==m||m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(S,C))),!1;if(e.assignType(S,C,void 0,y,void 0,1024&g,h))I=S;else if((0,i.isVariadicTypeVar)(t)){const t=function(e,t,n){if(!(0,i.isUnpackedClass)(t)||!(0,i.isUnpackedClass)(n))return;if(!t.tupleTypeArguments||!n.tupleTypeArguments||t.tupleTypeArguments.length!==n.tupleTypeArguments.length)return;const a=d(e,t),r=d(e,n);if((0,i.isTypeSame)(a,r))return a;return}(e,C,S);if(!t)return null==m||m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(C,S))),!1;I=t}else{const n=e.getObjectType();!k&&T&&(null==b?void 0:b.narrowBoundNoLiterals)&&(C=b.narrowBoundNoLiterals);const a=(0,o.applySolvedTypeVars)(C,y);I=(0,i.isUnion)(a)&&a.subtypes.length>s.maxSubtypesForInferredType&&void 0!==t.details.boundType&&(0,i.isClassInstance)(n)?(0,i.combineTypes)([a,n],64):(0,i.combineTypes)([a,S],64)}}if(_&&I&&!(0,i.isTypeSame)(_,I,{},h)){let t=e.makeTopLevelTypeVarsConcrete(_,!0);if(t=(0,o.transformExpectedType)(t,[],void 0),!e.assignType(t,I,null==m?void 0:m.createAddendum(),void 0,void 0,1024,h))return m&&w&&m.addMessage(r.LocAddendum.typeAssignmentMismatch().format(e.printSrcDestTypes(I,t))),!1}}if(!k&&T&&(k=I),t.details.boundType){const a=I||k;if(i.TypeBase.isInstantiable(t)&&!i.TypeBase.isInstantiable(n))return!1;const s=t.details.isSynthesizedSelf?y:new l.TypeVarContext(t.scopeId);if(!e.assignType(t.details.boundType,e.makeTopLevelTypeVarsConcrete(a),null==m?void 0:m.createAddendum(),s,void 0,1024&g,h))return t.details.isSynthesized||null==m||m.addMessage(r.LocAddendum.typeBound().format({sourceType:e.printType(a),destType:e.printType(t.details.boundType),name:i.TypeVarType.getReadableName(t)})),!1}let A=null==b?void 0:b.tupleTypes;if(A){const e=null!=I?I:k;e&&(A=[{type:e,isUnbounded:!0}])}if(!y.isLocked()&&f&&c(e,y,t,I,k,A,0!=(2304&g)),p){const t=" ".repeat(2*h);console.log(`${t}`),console.log(`${t}post-call context #${y.getId()}: `),u(e,y,t)}return!0},t.updateTypeVarType=c,t.populateTypeVarContextBasedOnExpectedType=function(e,t,n,a,r,s=void 0){if((0,i.isAny)(n))return t.details.typeParameters.forEach((t=>{c(e,a,t,n,n)})),!0;if((0,i.isTypeVar)(n)&&n.details.isSynthesizedSelf&&n.details.boundType&&(n=n.details.boundType),!(0,i.isClass)(n))return!1;const p=n.typeArguments;if(!p)return e.assignType(t,n,void 0,a,void 0,2048);if(e.inferTypeParameterVarianceForClass(t),i.ClassType.isSameGenericClass(n,t)){const t=(0,o.buildTypeVarContextFromSpecializedClass)(n);return t.getPrimarySignature().getTypeVars().forEach((n=>{let l=t.getPrimarySignature().getTypeVarType(n.typeVar);if(l&&r&&(l=(0,o.transformExpectedType)(l,r,s)),l){const t=i.TypeVarType.getVariance(n.typeVar);c(e,a,n.typeVar,3===t?void 0:l,4===t?void 0:l),n.tupleTypes&&a.setTupleTypeVar(n.typeVar,n.tupleTypes.map((e=>{let t=e.type;return r&&(t=(0,o.transformExpectedType)(e.type,r,s)),{type:t,isUnbounded:e.isUnbounded,isOptional:e.isOptional}})))}})),!0}const d=(0,o.getTypeVarScopeId)(n),u=i.ClassType.getTypeParameters(n).map(((e,t)=>{const n=i.TypeVarType.createInstance(`__dest${t}`);return n.details.isSynthesized=!0,e.details.isParamSpec&&(n.details.isParamSpec=!0),n.details.declaredVariance=2,n.scopeId=d,n})),m=i.ClassType.cloneForSpecialization(n,u,!0),y=i.ClassType.getTypeParameters(t).map(((e,t)=>{const n=i.TypeVarType.createInstance(`__source${t}`);return n.details.isSynthesized=!0,n.details.synthesizedIndex=t,n.details.isExemptFromBoundCheck=!0,e.details.isParamSpec&&(n.details.isParamSpec=!0),i.TypeVarType.cloneAsInScopePlaceholder(n)})),g=i.ClassType.cloneForSpecialization(t,y,!0),h=new l.TypeVarContext(d);if(e.assignType(m,g,void 0,h,void 0,2048)){let t=!0;return u.forEach(((n,l)=>{let d=h.getPrimarySignature().getTypeVarType(n);const u=[];if(d&&(n.details.isParamSpec&&(0,i.isFunction)(d)&&(d=(0,o.convertParamSpecValueToType)(d)),(0,i.isUnion)(d))){let e;(0,o.sortTypes)(d.subtypes).forEach((t=>{(0,i.isTypeVar)(t)&&t.details.isSynthesized&&void 0!==t.details.synthesizedIndex&&!e?e=t:u.push(t)})),e&&(d=e)}if(d&&(0,i.isTypeVar)(d)&&d.details.isSynthesized&&void 0!==d.details.synthesizedIndex){const m=i.ClassType.getTypeParameters(g)[d.details.synthesizedIndex];if(l<p.length){let d=(0,o.transformPossibleRecursiveTypeAlias)(p[l]);if(u.length>0&&(d=(0,i.combineTypes)([d,...u])),r&&(d=(0,o.transformExpectedType)(d,r,s)),d){const r=i.TypeVarType.getVariance(n);a.getPrimarySignature().getTypeVarType(m)&&(t=!1,d=i.UnknownType.create()),c(e,a,m,3===r?void 0:d,4===r?void 0:d)}else t=!1}}})),t}return!1}},28580:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyConstructorTransform=t.hasConstructorTransform=void 0;const a=n(28040),r=n(72484),s=n(97652),i=n(95960),o=n(90272),l=n(92488),p=n(52328),c=n(8312),d=n(808),u=n(97632);function m(e,t,n,o,p){const m=new Map,y=(0,l.getParameterListDetails)(p);let g=!1,h=!1;const f=new u.TypeVarContext((0,d.getTypeVarScopeId)(p));n.slice(1).forEach(((n,a)=>{var o,u,T,v,b,_,C,I;if(n.valueExpression)if(n.name){const a=y.params.find((e=>{var t;return e.param.name===(null===(t=n.name)||void 0===t?void 0:t.value)&&e.source!==l.ParameterSource.PositionOnly}));if(a){const o=a.param.name,l=c.FunctionType.getEffectiveParameterType(p,a.index);if(m.has(o))t&&e.addDiagnostic(s.DiagnosticRule.reportCallIssue,i.LocMessage.paramAlreadyAssigned().format({name:n.name.value}),n.name),g=!0;else{const a=new r.DiagnosticAddendum,c=e.getTypeOfExpression(n.valueExpression,void 0,(0,d.makeInferenceContext)(l));e.assignType(l,c.type,a,f)||(t&&e.addDiagnostic(s.DiagnosticRule.reportArgumentType,i.LocMessage.argAssignmentParamFunction().format({argType:e.printType(c.type),paramType:e.printType(l),functionName:p.details.name,paramName:o}),null!==(I=n.valueExpression)&&void 0!==I?I:t),g=!0),m.set(o,!0)}}else if(void 0===y.kwargsIndex)t&&e.addDiagnostic(s.DiagnosticRule.reportCallIssue,i.LocMessage.paramNameMissing().format({name:n.name.value}),n.name),g=!0;else{const a=c.FunctionType.getEffectiveParameterType(p,y.params[y.kwargsIndex].index),o=new r.DiagnosticAddendum,l=e.getTypeOfExpression(n.valueExpression,void 0,(0,d.makeInferenceContext)(a));e.assignType(a,l.type,o,f)||(t&&e.addDiagnostic(s.DiagnosticRule.reportArgumentType,i.LocMessage.argAssignmentParamFunction().format({argType:e.printType(l.type),paramType:e.printType(a),functionName:p.details.name,paramName:null!==(_=y.params[y.kwargsIndex].param.name)&&void 0!==_?_:""}),null!==(C=n.valueExpression)&&void 0!==C?C:t),g=!0)}}else if(a>=y.params.length||y.params[a].source===l.ParameterSource.KeywordOnly)if(void 0!==y.argsIndex){const a=c.FunctionType.getEffectiveParameterType(p,y.params[y.argsIndex].index),l=new r.DiagnosticAddendum,m=e.getTypeOfExpression(n.valueExpression,void 0,(0,d.makeInferenceContext)(a));e.assignType(a,m.type,l,f)||(t&&e.addDiagnostic(s.DiagnosticRule.reportArgumentType,i.LocMessage.argAssignmentParamFunction().format({argType:e.printType(m.type),paramType:e.printType(a),functionName:p.details.name,paramName:null!==(o=y.params[y.argsIndex].param.name)&&void 0!==o?o:""}),null!==(u=n.valueExpression)&&void 0!==u?u:t),g=!0)}else h||t&&e.addDiagnostic(s.DiagnosticRule.reportCallIssue,1===y.positionParamCount?i.LocMessage.argPositionalExpectedOne():i.LocMessage.argPositionalExpectedCount().format({expected:y.positionParamCount}),null!==(T=n.valueExpression)&&void 0!==T?T:t),h=!0,g=!0;else{const o=c.FunctionType.getEffectiveParameterType(p,a),l=new r.DiagnosticAddendum,u=null!==(v=y.params[a].param.name)&&void 0!==v?v:"",h=e.getTypeOfExpression(n.valueExpression,void 0,(0,d.makeInferenceContext)(o));e.assignType(o,h.type,l,f)||(t&&e.addDiagnostic(s.DiagnosticRule.reportArgumentType,i.LocMessage.argAssignmentParamFunction().format({argType:e.printType(h.type),paramType:e.printType(o),functionName:p.details.name,paramName:u}),null!==(b=n.valueExpression)&&void 0!==b?b:t),g=!0),m.set(u,!1)}}));const T=(0,d.applySolvedTypeVars)(p,f);if(!(0,c.isFunction)(T))return;const v=T.details.parameters.map(((e,t)=>{const n={...e};return n.type=c.FunctionType.getEffectiveParameterType(T,t),e.name&&m.get(e.name)&&(n.hasDefault=!0),n})),b=v.filter((e=>2!==e.category&&(1===e.category||(!e.name||!m.has(e.name))))),_=v.filter((e=>e.name&&m.get(e.name))),C=v.filter((e=>2===e.category)),I=[];(0,a.appendArray)(I,b),(0,a.appendArray)(I,_),(0,a.appendArray)(I,C);const k=c.FunctionType.createInstance(o.details.name,o.details.fullName,o.details.moduleName,o.details.flags,T.details.docString);return o.details.parameters.length>0&&c.FunctionType.addParameter(k,o.details.parameters[0]),I.forEach((e=>{c.FunctionType.addParameter(k,e)})),k.details.declaredReturnType=T.details.declaredReturnType?c.FunctionType.getSpecializedReturnType(T):T.inferredReturnType,k.details.declaration=o.details.declaration,k.details.typeVarScopeId=T.details.typeVarScopeId,{returnType:k,isTypeIncomplete:!1,argumentErrors:g}}t.hasConstructorTransform=function(e){return"functools.partial"===e.details.fullName},t.applyConstructorTransform=function(e,t,n,a,r,l){return"functools.partial"===a.details.fullName?function(e,t,n,a,r){if(!(0,c.isClassInstance)(a.returnType)||"functools.partial"!==a.returnType.details.fullName)return a;const l=(0,d.lookUpObjectMember)(a.returnType,"__call__",16);if(!l||!(0,c.isTypeSame)((0,d.convertToInstance)(l.classType),a.returnType))return a;const u=e.getTypeOfMember(l);if(!(0,c.isFunction)(u)||u.details.parameters.length<1)return a;if(n.length<1)return a;const y=e.getTypeOfArgument(n[0],void 0,r);let g=y.type;const h=e.makeTopLevelTypeVarsConcrete(g);if((0,c.isInstantiableClass)(h)){const t=(0,o.createFunctionFromConstructor)(e,h,(0,c.isTypeVar)(g)?(0,d.convertToInstance)(g):void 0);t&&(g=t)}if(e.inferReturnTypeIfNecessary(g),n.some((e=>0!==e.argumentCategory)))return a;if((0,c.isFunction)(g)){const r=m(e,t,n,u,g);if(!r)return a;const s=c.ClassType.cloneForSymbolTableUpdate(a.returnType);return c.ClassType.getSymbolTable(s).set("__call__",p.Symbol.createWithType(4,r.returnType)),{returnType:s,isTypeIncomplete:a.isTypeIncomplete,argumentErrors:r.argumentErrors}}if((0,c.isOverloadedFunction)(g)){const r=[];let o=!1;if(c.OverloadedFunctionType.getOverloads(g).forEach((t=>{const a=m(e,void 0,n,u,t);a&&(a.argumentErrors?o=!0:(0,c.isFunction)(a.returnType)&&r.push(a.returnType))})),0===r.length)return o&&e.addDiagnostic(s.DiagnosticRule.reportCallIssue,i.LocMessage.noOverload().format({name:g.overloads[0].details.name}),t),a;const l=c.ClassType.cloneForSymbolTableUpdate(a.returnType);let d;return d=1===r.length?r[0]:c.OverloadedFunctionType.create(r.map((e=>c.FunctionType.cloneWithNewFlags(e,256|e.details.flags)))),c.ClassType.getSymbolTable(l).set("__call__",p.Symbol.createWithType(4,d)),{returnType:l,isTypeIncomplete:a.isTypeIncomplete,argumentErrors:!1}}return a}(e,t,n,r,l):r}},90272:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createFunctionFromConstructor=t.validateConstructorArguments=t.getBoundCallMethod=t.getBoundInitMethod=t.getBoundNewMethod=void 0;const a=n(28040),r=n(72484),s=n(97652),i=n(95960),o=n(99868),l=n(28580),p=n(28340),c=n(808),d=n(97632),u=n(8312);function m(e,t,n,a=void 0,r=4){const s=800|r;return e.getTypeOfBoundMember(t,n,"__new__",{method:"get"},a,s)}function y(e,t,n,a=void 0,r=4){const s=528|r;return e.getTypeOfBoundMember(t,n,"__init__",{method:"get"},a,s)}function g(e,t,n){return e.getTypeOfBoundMember(t,n,"__call__",{method:"get"},void 0,536)}function h(e,t,n,l,m,g,h,b){var C,I;let k,w=!1,S=!1,A=!1;const x=[];let P,N;if(b){const r=f(e,t,n,l,m,g,h,b,!0);r.argumentErrors?S=!0:(0,a.appendArray)(x,null!==(C=r.overloadsUsedForCall)&&void 0!==C?C:[]),r.isTypeIncomplete&&(A=!0),P=r.returnType}if(!P||function(e){var t;if(!e||!(0,u.isFunction)(e))return!1;if(e.details.paramSpec)return!1;const n=e.details.parameters;if(2!==n.length)return!1;if(1!==n[0].category||2!==n[1].category)return!1;const a=null!==(t=e.details.declaredReturnType)&&void 0!==t?t:e.inferredReturnType;if(!a||!(0,u.isTypeVar)(a)||!a.details.isSynthesizedSelf)return!1;return!0}(null==b?void 0:b.type)?P=u.ClassType.cloneAsInstance(l):(0,u.isAnyOrUnknown)(P)&&(P=(0,c.applySolvedTypeVars)(u.ClassType.cloneAsInstance(l),new d.TypeVarContext((0,c.getTypeVarScopeId)(l)),{unknownIfNotFound:!0})),!S&&!(0,u.isNever)(P)&&!_(e,l,P)&&(0,u.isClassInstance)(P)){let i=P;i.typeArguments&&i.typeArguments.some((e=>(0,u.isUnknown)(e)))&&(i=u.ClassType.cloneAsInstance(l));const f=new r.DiagnosticAddendum;if(N=y(e,t,i,f),(null==N?void 0:N.typeErrors)&&e.addDiagnostic(s.DiagnosticRule.reportGeneralTypeIssues,f.getString(),t),N){const r=function(e,t,n,r,s,i,l,m){let y,g=!1,h=!1;const f=[];l&&(m=(0,c.ensureFunctionSignaturesAreUnique)(m,l,t.start));if(i){let v=!1;y=(0,c.mapSubtypes)(i.expectedType,(i=>{if(v)return;if(i=(0,c.transformPossibleRecursiveTypeAlias)(i),(0,u.isClassInstance)(i)&&u.ClassType.isSameGenericClass(r,i)&&r.typeArguments)return;const y=new d.TypeVarContext((0,c.getTypeVarScopeId)(r));if(y.addSolveForScope((0,c.getTypeVarScopeId)(m)),(0,o.populateTypeVarContextBasedOnExpectedType)(e,u.ClassType.cloneAsInstance(r),i,y,(0,p.getTypeVarScopesForNode)(t),t.start)){const o=(0,c.applySolvedTypeVars)(m,y);let p;if(p=e.useSpeculativeMode(t,(()=>e.validateCallArguments(t,n,{type:o},y.clone(),s,void 0,l))),!p.argumentErrors)return p=e.validateCallArguments(t,n,{type:o},y,s,void 0,l),p.isTypeIncomplete&&(g=!0),p.argumentErrors&&(h=!0),p.overloadsUsedForCall&&(0,a.appendArray)(f,p.overloadsUsedForCall),v=!0,T(e,r,i,y)}}),!0),((0,u.isNever)(y)||h)&&(y=void 0)}if(!y){const a=r.typeArguments?(0,c.buildTypeVarContextFromSpecializedClass)(r):new d.TypeVarContext((0,c.getTypeVarScopeId)(r));a.addSolveForScope((0,c.getTypeVarScopeId)(m));const i=e.validateCallArguments(t,n,{type:m},a,s,void 0,l);let o=r;i.specializedInitSelfType&&(0,u.isClassInstance)(i.specializedInitSelfType)&&u.ClassType.isSameGenericClass(i.specializedInitSelfType,o)&&(o=u.ClassType.cloneAsInstantiable(i.specializedInitSelfType)),y=v(e,o,void 0,a),i.isTypeIncomplete&&(g=!0),i.argumentErrors?h=!0:i.overloadsUsedForCall&&f.push(...i.overloadsUsedForCall)}return{argumentErrors:h,returnType:y,isTypeIncomplete:g,overloadsUsedForCall:f}}(e,t,n,i,m,g,h,N.type);r.argumentErrors?S=!0:r.overloadsUsedForCall&&x.push(...r.overloadsUsedForCall),r.isTypeIncomplete&&(A=!0),k=r.returnType,w=!0,m=!0}}if(!w&&b&&(e.isSpeculativeModeInUse(t)||f(e,t,n,l,m,g,h,b,!1),w=!0,k=P),!b&&!N){const r=function(e,t,n,a,r){let l=!1;n.length>0&&n.some((e=>0===e.argumentCategory))&&(e.addDiagnostic(s.DiagnosticRule.reportCallIssue,i.LocMessage.constructorNoArgs().format({type:a.aliasName||a.details.name}),t),l=!0);if(!r&&a.typeArguments)return{argumentErrors:l,overloadsUsedForCall:[],returnType:(0,c.convertToInstance)(a)};const m=new d.TypeVarContext((0,c.getTypeVarScopeId)(a));if(r){let n=r.expectedType;(0,u.isUnion)(n)&&(n=(0,u.findSubtype)(n,(t=>!(0,u.isAnyOrUnknown)(t)&&!(0,u.isNever)(t)&&!(!(0,u.isClass)(t)||!e.assignType(t,u.ClassType.cloneAsInstance(a)))))),n&&(0,o.populateTypeVarContextBasedOnExpectedType)(e,u.ClassType.cloneAsInstance(a),n,m,(0,p.getTypeVarScopesForNode)(t),t.start)}return{argumentErrors:l,overloadsUsedForCall:[],returnType:v(e,a,r,m)}}(e,t,n,l,g);r.argumentErrors?S=!0:r.overloadsUsedForCall&&(0,a.appendArray)(x,r.overloadsUsedForCall),r.isTypeIncomplete&&(A=!0),k=null!==(I=r.returnType)&&void 0!==I?I:u.UnknownType.create()}return{argumentErrors:S,returnType:k,isTypeIncomplete:A,overloadsUsedForCall:x}}function f(e,t,n,a,r,s,i,o,l){let p,m=!1,y=!1;const g=[];i&&(o.type=(0,c.ensureFunctionSignaturesAreUnique)(o.type,i,t.start));const h=new d.TypeVarContext((0,c.getTypeVarScopeId)(a));h.addSolveForScope((0,c.getTypeVarScopeId)(o.type)),a.typeAliasInfo&&h.addSolveForScope(a.typeAliasInfo.typeVarScopeId);const f=e.useSpeculativeMode(l?t:void 0,(()=>e.validateCallArguments(t,n,o,h,r,s,i)));return f.isTypeIncomplete&&(m=!0),f.argumentErrors?(y=!0,h.unlock(),e.validateCallArguments(t,n,o,h,r,s,i)):(p=f.returnType,0===g.length&&f.overloadsUsedForCall&&g.push(...f.overloadsUsedForCall)),p?(0,u.isClassInstance)(p)&&(0,c.isTupleClass)(p)&&!p.tupleTypeArguments&&(p.typeArguments&&1===p.typeArguments.length&&(p=(0,c.specializeTupleClass)(p,[{type:p.typeArguments[0],isUnbounded:!0}])),p=function(e,t){let n=e;t&&(0,u.isClassInstance)(t.expectedType)&&(0,c.isTupleClass)(t.expectedType)&&t.expectedType.tupleTypeArguments&&(n=(0,c.specializeTupleClass)(e,t.expectedType.tupleTypeArguments));return n}(p,s)):p=v(e,a,s,h),{argumentErrors:y,returnType:p,isTypeIncomplete:m,overloadsUsedForCall:g}}function T(e,t,n,a){const r=(0,c.applySolvedTypeVars)(u.ClassType.cloneAsInstance(t),a,{applyInScopePlaceholders:!0});if(e.assignType(n,r))return(0,u.isAny)(n)?n:r}function v(e,t,n,a){let r=!0;if(0===t.details.typeParameters.length||t.typeArguments)return(0,c.applySolvedTypeVars)(u.ClassType.cloneAsInstance(t),a,{applyInScopePlaceholders:!0});if(n){const s=(0,c.mapSubtypes)(n.expectedType,(n=>T(e,t,n,a)));if(!(0,u.isNever)(s))return s;t.typeArguments&&(r=!1)}const s=(0,c.applySolvedTypeVars)(t,a,{unknownIfNotFound:r});return u.ClassType.cloneAsInstance(s)}function b(e,t,n){return!(e.assignType((0,c.convertToInstance)(t),n)&&!(0,u.isNever)(n)&&!(0,u.findSubtype)(n,(e=>(0,u.isAny)(e))))||!!u.ClassType.isEnumClass(t)}function _(e,t,n){const a=e.makeTopLevelTypeVarsConcrete(n);let r=!1;return(0,c.doForEachSubtype)(a,(e=>{if(!(0,u.isUnknown)(e))if((0,u.isClassInstance)(e)){const n=[];u.ClassType.isDerivedFrom(e,t,n)||(r=!0)}else r=!0})),r}t.getBoundNewMethod=m,t.getBoundInitMethod=y,t.getBoundCallMethod=g,t.validateConstructorArguments=function(e,t,n,a,i,o,p){var c;const d=function(e,t,n,a,r,s,i){const o=g(e,t,a);if(!o)return;const l=e.validateCallArguments(t,n,o,void 0,r,s,i),p=o.type;if((0,u.isFunction)(p)&&!p.details.declaredReturnType)return;if(l.returnType&&(0,u.isUnknown)(l.returnType))return;return l}(e,t,n,a,i,o,p);if(d){const t=null!==(c=d.returnType)&&void 0!==c?c:u.UnknownType.create();if(d.argumentErrors||b(e,a,t))return d}const y=new r.DiagnosticAddendum,f=m(e,t,a,y);(null==f?void 0:f.typeErrors)&&e.addDiagnostic(s.DiagnosticRule.reportGeneralTypeIssues,y.getString(),t);const T=(0,l.hasConstructorTransform)(a),v=e.useSpeculativeMode(T?t:void 0,(()=>h(e,t,n,a,i,o,p,f)));let _=!T||v.argumentErrors;if(T)if(v.argumentErrors)h(e,t,n,a,i,o,p,f),_=!0;else if(v.returnType){const r=(0,l.applyConstructorTransform)(e,t,n,a,{argumentErrors:!!v.argumentErrors,returnType:v.returnType,isTypeIncomplete:!!v.isTypeIncomplete},p);v.returnType=r.returnType,r.isTypeIncomplete&&(v.isTypeIncomplete=!0),r.argumentErrors&&(v.argumentErrors=!0),_=!0}return _||n.forEach((t=>{t.valueExpression&&!e.isSpeculativeModeInUse(t.valueExpression)&&e.getTypeOfExpression(t.valueExpression)})),v},t.createFunctionFromConstructor=function(e,t,n=void 0,a=0){const r=function(e,t,n){const a=t.details.effectiveMetaclass;if(!a||!(0,u.isClass)(a))return;const r=(0,c.lookUpClassMember)(a,"__call__",536);if(!r)return;const s=e.getTypeOfMember(r);if(!(0,u.isFunction)(s)&&!(0,u.isOverloadedFunction)(s))return;const i=e.bindFunctionToClassOrObject(t,s,r&&(0,u.isInstantiableClass)(r.classType)?r.classType:void 0,!1,u.ClassType.cloneAsInstantiable(t),void 0,n);if(!i)return;let o=!1;return(0,c.doForEachSignature)(i,(n=>{if(n.details.declaredReturnType){const a=u.FunctionType.getSpecializedReturnType(n);a&&b(e,t,a)&&(o=!0)}})),o?i:void 0}(e,t,a);if(r)return r;const s=function(e,t,n,a){const r=(0,c.lookUpClassMember)(t,"__new__",532);if(!r)return;const s=e.getTypeOfMember(r),i=s=>{const i=s.details.parameters.some(((e,n)=>{if(0===n||!e.name)return!1;const a=u.FunctionType.getEffectiveParameterType(s,n);return(0,c.getTypeVarArgumentsRecursive)(a).some((e=>e.scopeId===(0,c.getTypeVarScopeId)(t)))})),o=e.bindFunctionToClassOrObject(i?(0,c.selfSpecializeClass)(t):t,s,r&&(0,u.isInstantiableClass)(r.classType)?r.classType:void 0,!0,n,void 0,a);if(!o)return;const l=u.FunctionType.clone(o);return l.details.typeVarScopeId=s.details.typeVarScopeId,!l.details.docString&&t.details.docString&&(l.details.docString=t.details.docString),l.details.flags&=-6,l.details.constructorTypeVarScopeId=(0,c.getTypeVarScopeId)(t),l};if((0,u.isFunction)(s))return i(s);if(!(0,u.isOverloadedFunction)(s))return;const o=[];if(s.overloads.forEach((e=>{const t=i(e);t&&o.push(t)})),0===o.length)return;if(1===o.length)return o[0];return u.OverloadedFunctionType.create(o)}(e,t,n,a);if(s){let n=!1;if((0,c.doForEachSignature)(s,(a=>{const r=u.FunctionType.getSpecializedReturnType(a);r&&_(e,t,r)&&(n=!0)})),n)return s}const i=function(e,t,n,a){const r=(0,c.lookUpClassMember)(t,"__init__",532);if(!r)return;const s=e.getTypeOfMember(r),i=u.ClassType.cloneAsInstance(t);function o(s){var o,l;const p=e.bindFunctionToClassOrObject(i,s,r&&(0,u.isInstantiableClass)(r.classType)?r.classType:void 0,void 0,n,void 0,a);if(!p)return;const d=u.FunctionType.clone(p);return d.details.declaredReturnType=null!==(l=null!==(o=p.strippedFirstParamType)&&void 0!==o?o:n)&&void 0!==l?l:i,d.details.name="",d.details.fullName="",d.specializedTypes&&(d.specializedTypes.returnType=null!=n?n:i),!d.details.docString&&t.details.docString&&(d.details.docString=t.details.docString),d.details.flags&=-5,d.details.constructorTypeVarScopeId=(0,c.getTypeVarScopeId)(t),d}if((0,u.isFunction)(s))return o(s);if(!(0,u.isOverloadedFunction)(s))return;const l=[];if(s.overloads.forEach((e=>{const t=o(e);t&&l.push(t)})),0===l.length)return;if(1===l.length)return l[0];return u.OverloadedFunctionType.create(l)}(e,t,n,a);return s&&i?(0,u.combineTypes)([i,s]):s||i?null!=s?s:i:null!=s?s:function(e){const t=u.FunctionType.createSynthesizedInstance("__new__",0);t.details.declaredReturnType=u.ClassType.cloneAsInstance(e),(e.includeSubclasses||u.ClassType.isProtocolClass(e))&&u.FunctionType.addDefaultParameters(t);!t.details.docString&&e.details.docString&&(t.details.docString=e.details.docString);return t}(t)}},33215:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.applyDataClassDecorator=t.applyDataClassDefaultBehaviors=t.applyDataClassClassBehaviorOverrides=t.getDataclassDecoratorBehaviors=t.validateDataClassTransformDecorator=t.synthesizeDataClassMethods=void 0;const i=n(83181),o=n(72484),l=n(97652),p=n(95960),c=s(n(9316)),d=n(9316),u=n(90272),m=n(37356),y=n(28340),g=n(21084),h=n(52328),f=n(80944),T=n(8312),v=n(808),b=n(97632);function _(e,t,n,a){const r=n.type;let s;if((0,T.isFunction)(r))s=r;else if((0,T.isOverloadedFunction)(r))s=e.getBestOverloadForArguments(t,{type:r,isIncomplete:n.isIncomplete},t.arguments);else if((0,T.isInstantiableClass)(r)){const n=(0,u.getBoundInitMethod)(e,t,r);n&&((0,T.isFunction)(n.type)?s=n.type:(0,T.isOverloadedFunction)(n.type)&&(s=e.getBestOverloadForArguments(t,{type:n.type},t.arguments)))}if(s){const e=s.details.parameters.find((e=>e.name===a));if(e){if(e.hasDeclaredType&&(0,T.isClass)(e.type)&&"boolean"==typeof e.type.literalValue)return e.type.literalValue;if(e.defaultValueExpression&&e.defaultType&&(0,T.isClass)(e.defaultType)&&"boolean"==typeof e.defaultType.literalValue)return e.defaultType.literalValue}}}function C(e,t){let n;return(0,T.isFunction)(e)?n=e.details.fullName:(0,T.isOverloadedFunction)(e)?n=e.overloads[0].details.fullName:(0,T.isInstantiableClass)(e)&&(n=e.details.fullName),!!n&&t.some((e=>e===n))}function I(e,t,n,a,r){switch(a){case"order":!0===r?n.details.flags|=64:!1===r&&(n.details.flags&=-65);break;case"kw_only":!1===r?n.details.flags&=-4194305:!0===r&&(n.details.flags|=4194304);break;case"frozen":{let a=!1,s=!1;!1===r?n.details.flags&=-9:!0===r&&(n.details.flags|=8),n.details.baseClasses.forEach((e=>{(0,T.isInstantiableClass)(e)&&T.ClassType.isDataClass(e)&&(T.ClassType.isFrozenDataClass(e)?s=!0:e.details.classDataClassTransform||e.details.declaredMetaclass&&(0,T.isInstantiableClass)(e.details.declaredMetaclass)&&e.details.declaredMetaclass.details.classDataClassTransform||(a=!0))})),r?a&&e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassBaseClassNotFrozen(),t):s&&e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassBaseClassFrozen(),t);break}case"init":!1===r?n.details.flags|=16:!0===r&&(n.details.flags&=-17);break;case"eq":!1===r?n.details.flags|=32:!0===r&&(n.details.flags&=-33);break;case"slots":!0===r?(n.details.flags|=67108864,n.details.localSlotsNames&&e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassSlotsOverwrite(),t)):!1===r&&(n.details.flags&=-67108865);break;case"hash":case"unsafe_hash":!0===r&&(n.details.flags|=134217728)}}function k(e,t,n,a,r){let s=!1;a.forEach((t=>{t.valueExpression&&t.name&&(!function(e,t,n,a,r){const s=c.getFileInfo(t);I(e,t,n,a,(0,g.evaluateStaticBoolExpression)(r,s.executionEnvironment,s.definedConstants))}(e,t.name,n,t.name.value,t.valueExpression),"frozen"===t.name.value&&(s=!0))})),s||I(e,t,n,"frozen",r.frozen)}function w(e,t){e.details.dataClassBehaviors=t,e.details.flags|=4,t.keywordOnlyParams&&(e.details.flags|=4194304),t.generateEq||(e.details.flags|=32),t.generateOrder&&(e.details.flags|=64),t.frozen&&(e.details.flags|=8)}t.synthesizeDataClassMethods=function(e,t,n,a,r,s,I){var k;(0,i.assert)(T.ClassType.isDataClass(n));const w=(0,v.synthesizeTypeVarForSelfCls)(n,!0),S=T.FunctionType.createSynthesizedInstance("__new__",1);S.details.constructorTypeVarScopeId=n.details.typeVarScopeId;const A=T.FunctionType.createSynthesizedInstance("__init__");A.details.constructorTypeVarScopeId=n.details.typeVarScopeId,T.FunctionType.addParameter(S,{category:0,name:"cls",type:w,hasDeclaredType:!0}),a||T.FunctionType.addDefaultParameters(S),S.details.declaredReturnType=(0,v.convertToInstance)(w);const x={category:0,name:"self",type:(0,v.synthesizeTypeVarForSelfCls)(n,!1),hasDeclaredType:!0};T.FunctionType.addParameter(A,x),a&&T.FunctionType.addDefaultParameters(A),A.details.declaredReturnType=e.getNoneType();const P=[],N=[],D=function(e,t){let n=!0;return T.ClassType.getReverseMro(e).forEach((e=>{if((0,T.isInstantiableClass)(e)){const n=(0,v.buildTypeVarContextFromSpecializedClass)(e);T.ClassType.getDataClassEntries(e).forEach((e=>{const a=t.findIndex((t=>t.name===e.name)),r={...e};r.type=(0,v.applySolvedTypeVars)(r.type,n),e.isClassVar?a>=0&&t.splice(a,1):a>=0?t[a]=r:t.push(r)}))}else n=!1})),n}(n,N);D||T.FunctionType.addDefaultParameters(A);const F=a?S:A,E=[];let M=!1;T.ClassType.getSymbolTable(n).forEach(((s,i)=>{var o,d,u,m,h,f,b;if(s.isIgnoredForProtocolMatch())return;if("__hash__"===i)return;const I=s.getTypedDeclarations().find((e=>{if(1!==e.type)return!1;const t=(0,y.getEnclosingClassOrFunction)(e.node);return!(!t||10!==t.nodeType)}));if(I){let s,i,y,b=I.node;for(;b&&3!==b.nodeType;){if(54===b.nodeType){3===(null===(o=b.parent)||void 0===o?void 0:o.nodeType)&&(b=b.parent);break}b=b.parent}if(!b)return;let k,w,S=!1,A=T.ClassType.isDataClassKeywordOnlyParams(n)||M,x=!0;if(3===b.nodeType){if(54===b.leftExpression.nodeType&&38===b.leftExpression.valueExpression.nodeType){s=b.leftExpression.valueExpression;const t=b;y=()=>e.getTypeOfAnnotation(t.leftExpression.typeAnnotation,{isVariableAnnotation:!0,allowFinal:!0,allowClassVar:!0})}if(S=!0,k=b.rightExpression,9===b.rightExpression.nodeType){const r=e.getTypeOfExpression(b.rightExpression.leftExpression,2),s=r.type;if(!a&&C(s,(null===(d=n.details.dataClassBehaviors)||void 0===d?void 0:d.fieldDescriptorNames)||[])){const n=b.rightExpression.arguments.find((e=>{var t;return"init"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(n&&n.valueExpression){const e=c.getFileInfo(t);x=null!==(u=(0,g.evaluateStaticBoolExpression)(n.valueExpression,e.executionEnvironment,e.definedConstants))&&void 0!==u?u:x}else x=null!==(m=_(e,b.rightExpression,r,"init"))&&void 0!==m?m:x;const a=b.rightExpression.arguments.find((e=>{var t;return"kw_only"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(a&&a.valueExpression){const e=c.getFileInfo(t);A=null!==(h=(0,g.evaluateStaticBoolExpression)(a.valueExpression,e.executionEnvironment,e.definedConstants))&&void 0!==h?h:A}else A=null!==(f=_(e,b.rightExpression,r,"kw_only"))&&void 0!==f?f:A;const s=b.rightExpression.arguments.find((e=>{var t,n,a;return"default"===(null===(t=e.name)||void 0===t?void 0:t.value)||"default_factory"===(null===(n=e.name)||void 0===n?void 0:n.value)||"factory"===(null===(a=e.name)||void 0===a?void 0:a.value)}));S=!!s,(null==s?void 0:s.valueExpression)&&(k=s.valueExpression);const o=b.rightExpression.arguments.find((e=>{var t;return"alias"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(o){const t=e.getTypeOfExpression(o.valueExpression).type;(0,T.isClassInstance)(t)&&T.ClassType.isBuiltIn(t,"str")&&(0,v.isLiteralType)(t)&&(i=t.literalValue)}const l=b.rightExpression.arguments.find((e=>{var t;return"converter"===(null===(t=e.name)||void 0===t?void 0:t.value)}));l&&l.valueExpression&&c.getFileInfo(t).diagnosticRuleSet.enableExperimentalFeatures&&(w=l)}}}else if(54===b.nodeType&&38===b.valueExpression.nodeType){s=b.valueExpression;const t=b;if(y=()=>e.getTypeOfAnnotation(t.typeAnnotation,{isVariableAnnotation:!0,allowFinal:!0,allowClassVar:!0}),!a&&"_"===b.valueExpression.value){const e=y();(0,T.isClassInstance)(e)&&T.ClassType.isBuiltIn(e,"KW_ONLY")&&(M=!0,s=void 0,y=void 0)}}if(s&&y){const t=s.value,a=T.ClassType.getSymbolTable(n).get(t);if((null==a?void 0:a.isClassVar())&&!(null==a?void 0:a.isFinalVarInClassBody())){const e=N.findIndex((e=>e.name===t));e>=0&&N.splice(e,1);const a={name:t,classType:n,alias:i,isKeywordOnly:!1,hasDefault:S,defaultValueExpression:k,includeInInit:x,nameNode:s,type:T.UnknownType.create(),isClassVar:!0,converter:w};P.push(a)}else{const a={name:t,classType:n,alias:i,isKeywordOnly:A,hasDefault:S,defaultValueExpression:k,includeInInit:x,nameNode:s,type:T.UnknownType.create(),isClassVar:!1,converter:w};E.push({entry:a,evaluator:y});let o=P.findIndex((e=>e.name===t));if(o>=0?P[o]=a:P.push(a),o=N.findIndex((e=>e.name===t)),o>=0){const n=N[o];!a.hasDefault&&n.hasDefault&&n.includeInInit&&(a.hasDefault=!0,a.defaultValueExpression=n.defaultValueExpression,S=!0,e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassFieldInheritedDefault().format({fieldName:t}),s)),N[o]=a}else N.push(a),o=N.length-1;if(!A&&x&&!r&&!S){const t=N.findIndex((e=>e.hasDefault&&e.includeInInit&&!e.isKeywordOnly));t>=0&&t<o&&e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassFieldWithDefault(),s)}}}}else{const t=s.getDeclarations();if(0===t.length)return;const a=t[t.length-1];if(1!==a.type)return;const r=a.node.parent;if(!r||3!==r.nodeType)return;if(9===r.rightExpression.nodeType){C(e.getTypeOfExpression(r.rightExpression.leftExpression,2).type,(null===(b=n.details.dataClassBehaviors)||void 0===b?void 0:b.fieldDescriptorNames)||[])&&e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassFieldWithoutAnnotation(),r.rightExpression)}}})),a||(n.details.dataClassEntries=P),E.forEach((e=>{e.entry.type=e.evaluator()}));const O=T.ClassType.getSymbolTable(n),z=[];r||s||(D&&(N.forEach((a=>{if(a.includeInInit){let r=a.type;if(a.classType!==n&&(0,v.requiresSpecialization)(r)){const e=new b.TypeVarContext((0,v.getTypeVarScopeId)(a.classType));(0,v.populateTypeVarContextForSelfType)(e,a.classType,n),r=(0,v.applySolvedTypeVars)(r,e)}if(r=function(e,t){if(!(0,T.isClassInstance)(t)||(0,v.isMetaclassInstance)(t))return t;const n=e.getBoundMagicMethod(t,"__set__");if(!n)return t;if(!(0,T.isFunction)(n))return t;return T.FunctionType.getEffectiveParameterType(n,1)}(e,r),a.converter){const n=r;r=function(e,t,n,a){var r;const s=function(e,t){if((0,T.isFunction)(t)||(0,T.isOverloadedFunction)(t))return t;if((0,T.isClassInstance)(t))return e.getBoundMagicMethod(t,"__call__");if((0,T.isInstantiableClass)(t)){let n=(0,u.createFunctionFromConstructor)(e,t);if(n&&((0,T.isUnion)(n)&&(n=n.subtypes[0]),(0,T.isFunction)(n)||(0,T.isOverloadedFunction)(n)))return n}return}(e,e.getTypeOfExpression(t.valueExpression).type);if(!s)return n;const i=T.TypeVarType.createInstance("__converterInput");i.scopeId=(0,y.getScopeIdForNode)(t);const c=T.FunctionType.createSynthesizedInstance("");if(c.details.typeVarScopeId=i.scopeId,c.details.declaredReturnType=n,T.FunctionType.addParameter(c,{category:0,name:"__input",type:i,hasDeclaredType:!0}),T.FunctionType.addPositionOnlyParameterSeparator(c),(0,T.isFunction)(s)||(0,T.isOverloadedFunction)(s)){const d=[],u=new o.DiagnosticAddendum;if((0,v.doForEachSignature)(s,(t=>{var a;const r=new b.TypeVarContext((0,v.getTypeVarScopeIds)(t));e.assignType(null!==(a=T.FunctionType.getSpecializedReturnType(t))&&void 0!==a?a:T.UnknownType.create(),n,void 0,r)&&(t=(0,v.applySolvedTypeVars)(t,r));const s=new b.TypeVarContext(i.scopeId);if(e.assignType(c,t,u,s)){const e=(0,v.applySolvedTypeVars)(i,s,{unknownIfNotFound:!0});d.push(e)}})),d.length>0)return(0,T.combineTypes)(d);(0,T.isFunction)(s)?e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassConverterFunction().format({argType:e.printType(s),fieldType:e.printType(n),fieldName:a})+u.getString(),t,null!==(r=u.getEffectiveTextRange())&&void 0!==r?r:t):e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassConverterOverloads().format({funcName:s.overloads[0].details.name||"<anonymous function>",fieldType:e.printType(n),fieldName:a})+u.getString(),t)}return n}(e,a.converter,r,a.name),O.set(a.name,function(e,t,n,a,r,s){const i=(0,d.getFileInfo)(t),o=e.getBuiltInType(t,"type"),l=`__converterDescriptor_${a}`,p=T.ClassType.createInstantiable(l,(0,y.getClassFullName)(n,i.moduleName,l),i.moduleName,i.fileUri,0,(0,y.getTypeSourceId)(n),void 0,(0,T.isInstantiableClass)(o)?o:T.UnknownType.create());p.details.baseClasses.push(e.getBuiltInType(t,"object")),(0,v.computeMroLinearization)(p);const c=T.ClassType.getSymbolTable(p),u=(0,v.synthesizeTypeVarForSelfCls)(p,!1),m=T.FunctionType.createSynthesizedInstance("__set__");T.FunctionType.addParameter(m,{category:0,name:"self",type:u,hasDeclaredType:!0}),T.FunctionType.addParameter(m,{category:0,name:"obj",type:T.AnyType.create(),hasDeclaredType:!0}),T.FunctionType.addParameter(m,{category:0,name:"value",type:s,hasDeclaredType:!0}),m.details.declaredReturnType=e.getNoneType();const g=h.Symbol.createWithType(4,m);c.set("__set__",g);const f=T.FunctionType.createSynthesizedInstance("__get__");T.FunctionType.addParameter(f,{category:0,name:"self",type:u,hasDeclaredType:!0}),T.FunctionType.addParameter(f,{category:0,name:"obj",type:T.AnyType.create(),hasDeclaredType:!0}),T.FunctionType.addParameter(f,{category:0,name:"objtype",type:T.AnyType.create(),hasDeclaredType:!0}),f.details.declaredReturnType=r;const b=h.Symbol.createWithType(4,f);return c.set("__get__",b),h.Symbol.createWithType(4,T.ClassType.cloneAsInstance(p))}(e,t,a.converter,a.name,n,r))}const s=a.alias||a.name;!a.alias&&a.nameNode&&(0,f.isPrivateName)(a.nameNode.value)&&e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassFieldWithPrivateName(),a.nameNode);const i={category:0,name:s,hasDefault:a.hasDefault,defaultValueExpression:a.defaultValueExpression,type:r,hasDeclaredType:!0};a.isKeywordOnly?z.push(i):T.FunctionType.addParameter(F,i)}})),z.length>0&&(T.FunctionType.addKeywordOnlyParameterSeparator(F),z.forEach((e=>{T.FunctionType.addParameter(F,e)})))),O.set("__init__",h.Symbol.createWithType(4,A)),O.set("__new__",h.Symbol.createWithType(4,S)));const V=e.getBuiltInType(t,"str"),U=e.getBuiltInType(t,"tuple");if(U&&(0,T.isInstantiableClass)(U)&&V&&(0,T.isInstantiableClass)(V)&&!O.has("__match_args__")){const e=[];N.forEach((t=>{t.includeInInit&&!t.isKeywordOnly&&e.push(t.name)}));const t=e.map((e=>({type:T.ClassType.cloneAsInstance(T.ClassType.cloneWithLiteral(V,e)),isUnbounded:!1}))),n=T.ClassType.cloneAsInstance((0,v.specializeTupleClass)(U,t));O.set("__match_args__",h.Symbol.createWithType(4,n))}const R=(n,a)=>{const r=T.FunctionType.createSynthesizedInstance(n);T.FunctionType.addParameter(r,x),T.FunctionType.addParameter(r,{category:0,name:"other",type:a,hasDeclaredType:!0}),r.details.declaredReturnType=e.getBuiltInObject(t,"bool"),O.get(n)||O.set(n,h.Symbol.createWithType(4,r))};if(T.ClassType.isSkipSynthesizedDataClassEq(n)||R("__eq__",e.getBuiltInObject(t,"object")),T.ClassType.isSynthesizedDataclassOrder(n)){const e=T.ClassType.cloneAsInstance(n);["__lt__","__le__","__gt__","__ge__"].forEach((t=>{R(t,e)}))}let L=T.ClassType.isFrozenDataClass(n);const j=!T.ClassType.isSkipSynthesizedDataClassEq(n)&&!T.ClassType.isFrozenDataClass(n);if(I&&(L=!1),T.ClassType.isSynthesizeDataClassUnsafeHash(n)&&(L=!0),L){const n=T.FunctionType.createSynthesizedInstance("__hash__");T.FunctionType.addParameter(n,x),n.details.declaredReturnType=e.getBuiltInObject(t,"int"),O.set("__hash__",h.Symbol.createWithType(4100,n))}else j&&!I&&O.set("__hash__",h.Symbol.createWithType(4100,e.getNoneType()));let B=e.getBuiltInType(t,"dict");if((0,T.isInstantiableClass)(B)&&(B=T.ClassType.cloneAsInstance(T.ClassType.cloneForSpecialization(B,[e.getBuiltInObject(t,"str"),T.AnyType.create()],!0))),O.set("__dataclass_fields__",h.Symbol.createWithType(132,B)),T.ClassType.isGeneratedDataClassSlots(n)&&void 0===n.details.localSlotsNames&&(n.details.localSlotsNames=P.map((e=>e.name))),T.ClassType.isGeneratedDataClassSlots(n)){let n=null!==(k=e.getTypingType(t,"Iterable"))&&void 0!==k?k:T.UnknownType.create();(0,T.isInstantiableClass)(n)&&(n=T.ClassType.cloneAsInstance(T.ClassType.cloneForSpecialization(n,[e.getBuiltInObject(t,"str")],!0))),O.set("__slots__",h.Symbol.createWithType(132,n))}(0,m.updateNamedTupleBaseClass)(n,N.map((e=>e.type)),!0)&&(0,v.computeMroLinearization)(n)},t.validateDataClassTransformDecorator=function(e,t){const n={keywordOnlyParams:!1,generateEq:!0,generateOrder:!1,frozen:!1,fieldDescriptorNames:[]},a=c.getFileInfo(t);return t.arguments.forEach((t=>{if(t.name&&0===t.argumentCategory)switch(t.name.value){case"kw_only_default":{const r=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===r)return void e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.keywordOnlyParams=r;break}case"eq_default":{const r=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===r)return void e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.generateEq=r;break}case"order_default":{const r=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===r)return void e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.generateOrder=r;break}case"frozen_default":{const r=(0,g.evaluateStaticBoolExpression)(t.valueExpression,a.executionEnvironment,a.definedConstants);if(void 0===r)return void e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassTransformExpectedBoolLiteral(),t.valueExpression);n.frozen=r;break}case"field_descriptors":case"field_specifiers":{const a=e.getTypeOfExpression(t.valueExpression).type;if(!(0,T.isClassInstance)(a)||!T.ClassType.isBuiltIn(a,"tuple")||!a.tupleTypeArguments||a.tupleTypeArguments.some((e=>!(0,T.isInstantiableClass)(e.type)&&!(0,T.isFunction)(e.type)&&!(0,T.isOverloadedFunction)(e.type))))return void e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassTransformFieldSpecifier().format({type:e.printType(a)}),t.valueExpression);n.fieldDescriptorNames||(n.fieldDescriptorNames=[]),a.tupleTypeArguments.forEach((e=>{(0,T.isInstantiableClass)(e.type)||(0,T.isFunction)(e.type)?n.fieldDescriptorNames.push(e.type.details.fullName):(0,T.isOverloadedFunction)(e.type)&&n.fieldDescriptorNames.push(e.type.overloads[0].details.fullName)}));break}default:e.addDiagnostic(l.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.dataClassTransformUnknownArgument().format({name:t.name.value}),t.valueExpression)}else e.addDiagnostic(l.DiagnosticRule.reportCallIssue,p.LocMessage.dataClassTransformPositionalParam(),t)})),n},t.getDataclassDecoratorBehaviors=function(e){var t;let n;if((0,T.isFunction)(e)?n=e:(0,T.isOverloadedFunction)(e)&&(n=null!==(t=e.overloads.find((e=>!!e.details.decoratorDataClassBehaviors)))&&void 0!==t?t:e.overloads[0]),n)return n.details.decoratorDataClassBehaviors?n.details.decoratorDataClassBehaviors:"dataclasses.dataclass"===n.details.fullName?{keywordOnlyParams:!1,generateEq:!0,generateOrder:!1,frozen:!1,fieldDescriptorNames:["dataclasses.field","dataclasses.Field"]}:void 0},t.applyDataClassClassBehaviorOverrides=k,t.applyDataClassDefaultBehaviors=w,t.applyDataClassDecorator=function(e,t,n,a,r){var s;w(n,a),k(e,t,n,null!==(s=null==r?void 0:r.arguments)&&void 0!==s?s:[],a)}},65392:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUnresolvedAliasDeclaration=t.isIntrinsicDeclaration=t.isSpecialBuiltInClassDeclaration=t.isAliasDeclaration=t.isVariableDeclaration=t.isTypeAliasDeclaration=t.isTypeParameterDeclaration=t.isParameterDeclaration=t.isClassDeclaration=t.isFunctionDeclaration=t.UnresolvedModuleMarker=void 0;const a=n(55084);function r(e){return 8===e.type}t.UnresolvedModuleMarker=a.Uri.constant("*** unresolved module ***"),t.isFunctionDeclaration=function(e){return 5===e.type},t.isClassDeclaration=function(e){return 6===e.type},t.isParameterDeclaration=function(e){return 2===e.type},t.isTypeParameterDeclaration=function(e){return 3===e.type},t.isTypeAliasDeclaration=function(e){return 4===e.type},t.isVariableDeclaration=function(e){return 1===e.type},t.isAliasDeclaration=r,t.isSpecialBuiltInClassDeclaration=function(e){return 7===e.type},t.isIntrinsicDeclaration=function(e){return 0===e.type},t.isUnresolvedAliasDeclaration=function(e){return r(e)&&e.uri.equals(t.UnresolvedModuleMarker)}},61340:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resolveAliasDeclaration=t.createSynthesizedAliasDeclaration=t.getDeclarationsWithUsesLocalNameRemoved=t.isDefinedInFile=t.getNameNodeForDeclaration=t.getNameFromDeclaration=t.areDeclarationsSame=t.hasTypeForDeclaration=void 0;const a=n(55164),r=n(65392),s=n(28340);t.hasTypeForDeclaration=function(e){switch(e.type){case 0:case 6:case 7:case 5:case 3:case 4:return!0;case 2:{if(e.node.typeAnnotation||e.node.typeAnnotationComment)return!0;const t=e.node.parent;if(28===(null==t?void 0:t.nodeType)&&t.functionAnnotationComment&&!t.functionAnnotationComment.isParamListEllipsis){const n=t.functionAnnotationComment.paramTypeAnnotations;return!(t.parameters.length>n.length&&e.node===t.parameters[0])}return!1}case 1:return!!e.typeAnnotationNode;case 8:return!1}},t.areDeclarationsSame=function(e,t,n=!1,a=!1){if(e.type!==t.type)return!1;if(!e.uri.equals(t.uri))return!1;if(!(a&&8===e.type||e.range.start.line===t.range.start.line&&e.range.start.character===t.range.start.character))return!1;if(8===e.type&&8===t.type){if(e.symbolName!==t.symbolName||e.usesLocalName!==t.usesLocalName)return!1;if(n)return!0;if(e.node!==t.node)return!1}return!0},t.getNameFromDeclaration=function(e){var t;switch(e.type){case 8:return e.symbolName;case 6:case 5:case 3:case 4:return e.node.name.value;case 2:return null===(t=e.node.name)||void 0===t?void 0:t.value;case 1:return 38===e.node.nodeType?e.node.value:void 0;case 0:case 7:return 54===e.node.nodeType&&38===e.node.valueExpression.nodeType?e.node.valueExpression.value:void 0}throw new Error("Shouldn't reach here")},t.getNameNodeForDeclaration=function(e){var t,n;switch(e.type){case 8:return 21===e.node.nodeType?null!==(t=e.node.alias)&&void 0!==t?t:e.node.module.nameParts[0]:23===e.node.nodeType?null!==(n=e.node.alias)&&void 0!==n?n:e.node.name:e.node.module.nameParts[0];case 6:case 5:case 3:case 2:case 4:return e.node.name;case 1:return 38===e.node.nodeType?e.node:void 0;case 0:case 7:return}throw new Error("Shouldn't reach here")},t.isDefinedInFile=function(e,t){var n;return(0,r.isAliasDeclaration)(e)?null===(n=(0,s.getFileInfoFromNode)(e.node))||void 0===n?void 0:n.fileUri.equals(t):e.uri.equals(t)},t.getDeclarationsWithUsesLocalNameRemoved=function(e){return e.map((e=>{if(8!==e.type)return e;const t={...e};return t.usesLocalName=!1,t}))},t.createSynthesizedAliasDeclaration=function(e){return{type:8,node:void 0,uri:e,loadSymbolsFromPath:!1,range:(0,a.getEmptyRange)(),implicitImports:new Map,usesLocalName:!1,moduleName:"",isInExceptSuite:!1}},t.resolveAliasDeclaration=function e(t,n,a){let r=n;const s=[];let i,o,l=!1,p=!1;for(;;){if(8!==r.type||!r.symbolName)return{declaration:r,isPrivate:l,privatePyTypedImported:i,privatePyTypedImporter:o};if(!a.resolveLocalNames&&r.usesLocalName)return{declaration:r,isPrivate:l,privatePyTypedImported:i,privatePyTypedImporter:o};let c;!r.uri.isEmpty()&&r.loadSymbolsFromPath&&(c=t(r.uri,{skipFileNeededCheck:a.skipFileNeededCheck}));const d=c?c.symbolTable.get(r.symbolName):void 0;if(!d){if(r.submoduleFallback){if(r.symbolName&&!r.uri.isEmpty()&&8===r.submoduleFallback.type&&!r.submoduleFallback.uri.isEmpty()){if(!t(r.submoduleFallback.uri,{skipFileNeededCheck:a.skipFileNeededCheck,skipParsing:!0}))return}let n=r.submoduleFallback;if(r.symbolName){n={...r.submoduleFallback};let e=n.moduleName;e&&(e=`${e}.`),n.moduleName=`${e}${r.symbolName}`}return e(t,n,a)}return r.isNativeLib?{declaration:void 0,isPrivate:l}:void 0}if(d.isPrivateMember()&&!p&&(l=!0),d.isExternallyHidden()&&!a.allowExternallyHiddenAccess)return;let u=d.getTypedDeclarations();if(u=u.filter((e=>!e.isInExceptSuite)),0===u.length&&(u=d.getDeclarations(),u=u.filter((e=>!e.isInExceptSuite))),0===u.length&&(u=d.getDeclarations()),0===u.length)return;const m=r,y=u.filter((e=>!s.includes(e)));if(r=y.length>0?y[y.length-1]:u[u.length-1],(null==c?void 0:c.isInPyTypedPackage)&&(p?d.isPrivatePyTypedImport()||(i=null!=i?i:null==r?void 0:r.moduleName):(d.isPrivatePyTypedImport()&&(o=null==m?void 0:m.moduleName),p=!0)),s.find((e=>e===r)))return r.uri.equals(n.uri)&&8===r.type&&r.submoduleFallback?e(t,r.submoduleFallback,a):{declaration:n,isPrivate:l,privatePyTypedImported:i,privatePyTypedImporter:o};s.push(r)}}},91720:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addOverloadsToFunctionType=t.applyClassDecorator=t.applyFunctionDecorator=t.getFunctionInfoFromDecorators=void 0;const a=n(28040),r=n(97652),s=n(95960),i=n(9316),o=n(33215),l=n(74124),p=n(50520),c=n(808),d=n(8312);function u(e,t,n){var a,r;let s=(0,i.getFileInfo)(t).isStubFile?4:0;9!==t.expression.nodeType&&(s|=2);const o=e.getTypeOfExpression(t.expression,s);if((0,d.isInstantiableClass)(o.type)&&d.ClassType.isBuiltIn(o.type,"classmethod")&&(0,c.isProperty)(n))return n;const l=[{argumentCategory:0,typeResult:{type:n}}],p=e.validateCallArguments(t.expression,l,o,void 0,!0,void 0,void 0);e.setTypeResultForNode(t,{type:null!==(a=p.returnType)&&void 0!==a?a:d.UnknownType.create(),overloadsUsedForCall:p.overloadsUsedForCall,isIncomplete:p.isTypeIncomplete});const u=null!==(r=p.returnType)&&void 0!==r?r:d.UnknownType.create();return!(0,d.isFunction)(u)||u.details.declaredReturnType||u.details.parameters.some(((e,t)=>!(e.name&&!e.hasDeclaredType)||0===e.category&&(0!==t||!e.isTypeInferred)))?(0,c.isPartlyUnknown)(u)&&(0,d.isFunction)(o.type)&&!o.type.details.parameters.find((e=>void 0!==e.typeAnnotation))&&void 0===o.type.details.declaredReturnType?n:u:n}function m(e){if(9===e.expression.nodeType&&e.expression.arguments.length>0&&0===e.expression.arguments[0].argumentCategory&&48===e.expression.arguments[0].valueExpression.nodeType){const t=e.expression.arguments[0].valueExpression.strings.map((e=>e.value)).join("");return(0,l.convertDocStringToPlainText)(t)}return""}t.getFunctionInfoFromDecorators=function(e,t,n){const a=(0,i.getFileInfo)(t);let r,s=0;if(n){"__new__"===t.name.value&&(s|=1);["__init_subclass__","__class_getitem__"].some((e=>t.name.value===e))&&(s|=2)}for(const i of t.decorators){let t=a.isStubFile?4:0;if(9!==i.expression.nodeType)t|=2;else if(9===i.expression.nodeType){const n=e.getTypeOfExpression(i.expression.leftExpression,2|t).type;(0,c.isBuiltInDeprecatedType)(n)&&(r=m(i))}const o=e.getTypeOfExpression(i.expression,t).type;(0,d.isFunction)(o)?"abstractmethod"===o.details.builtInName?n&&(s|=8):"final"===o.details.builtInName?s|=8192:"override"===o.details.builtInName?s|=262144:"type_check_only"===o.details.builtInName?s|=128:"no_type_check"===o.details.builtInName?s|=524288:"overload"===o.details.builtInName&&(s|=256):(0,d.isInstantiableClass)(o)&&(d.ClassType.isBuiltIn(o,"staticmethod")?n&&(s|=4):d.ClassType.isBuiltIn(o,"classmethod")&&n&&(s|=2)),(0,c.isBuiltInDeprecatedType)(o)&&(r=m(i))}return{flags:s,deprecationMessage:r}},t.applyFunctionDecorator=function(e,t,n,a,r){let s=(0,i.getFileInfo)(a).isStubFile?4:0;9!==a.expression.nodeType&&(s|=2);const l=e.getTypeOfExpression(a.expression,s).type;if(((0,d.isInstantiableClass)(l)&&d.ClassType.isSpecialBuiltIn(l,"overload")||(0,d.isFunction)(l)&&"overload"===l.details.builtInName)&&(0,d.isFunction)(t))return t.details.flags|=256,n.details.flags|=256,t;if(9===a.expression.nodeType){const r=e.getTypeOfExpression(a.expression.leftExpression,2|s).type;if((0,d.isFunction)(r)&&("__dataclass_transform__"===r.details.name||"dataclass_transform"===r.details.builtInName))return n.details.decoratorDataClassBehaviors=(0,o.validateDataClassTransformDecorator)(e,a.expression),t;if((0,c.isBuiltInDeprecatedType)(r))return t}let m=u(e,a,t);if((0,d.isFunction)(l)){if("abstractmethod"===l.details.builtInName)return t;if("type_check_only"===l.details.builtInName)return n.details.flags|=128,t;if(35===a.expression.nodeType){const n=e.getTypeOfExpression(a.expression.leftExpression,2|s).type;if((0,c.isProperty)(n)){const s=a.expression.memberName.value;if("setter"===s)return(0,d.isFunction)(t)?((0,p.validatePropertyMethod)(e,t,a),(0,p.clonePropertyWithSetter)(e,n,t,r)):t;if("deleter"===s)return(0,d.isFunction)(t)?((0,p.validatePropertyMethod)(e,t,a),(0,p.clonePropertyWithDeleter)(e,n,t,r)):t}}}else if((0,d.isInstantiableClass)(l)){if(d.ClassType.isBuiltIn(l))switch(l.details.name){case"classmethod":case"staticmethod":{const e="classmethod"===l.details.name?2:4;if((0,d.isFunction)(t)&&0==(t.details.flags&e)){const n=d.FunctionType.clone(t);return n.details.flags&=-8,n.details.flags|=e,n}return t}}if((0,c.isBuiltInDeprecatedType)(l))return t;if(d.ClassType.isPropertyClass(l)){if((0,d.isFunction)(t))return(0,p.validatePropertyMethod)(e,t,a),(0,p.createProperty)(e,a,l,t);if((0,d.isClassInstance)(t)){const n=e.getBoundMagicMethod(t,"__call__");return n&&(0,d.isFunction)(n)?(0,p.createProperty)(e,a,l,n):d.UnknownType.create()}}}return(0,d.isFunction)(t)&&(0,d.isFunction)(m)&&(m=d.FunctionType.clone(m),d.FunctionType.isOverloaded(t)&&(m.details.flags|=256),m.details.docString||(m.details.docString=t.details.docString)),m},t.applyClassDecorator=function(e,t,n,a){let r=(0,i.getFileInfo)(a).isStubFile?4:0;9!==a.expression.nodeType&&(r|=2);const s=e.getTypeOfExpression(a.expression,r).type;if(9===a.expression.nodeType){const s=e.getTypeOfExpression(a.expression.leftExpression,2|r).type;if((0,d.isFunction)(s)&&("__dataclass_transform__"!==s.details.name&&"dataclass_transform"!==s.details.builtInName||(n.details.classDataClassTransform=(0,o.validateDataClassTransformDecorator)(e,a.expression))),(0,c.isBuiltInDeprecatedType)(s))return n.details.deprecatedMessage=m(a),t}if((0,d.isOverloadedFunction)(s)){const r=(0,o.getDataclassDecoratorBehaviors)(s);if(r)return(0,o.applyDataClassDecorator)(e,a,n,r,void 0),t}else if((0,d.isFunction)(s)){if("final"===s.details.builtInName)return n.details.flags|=8192,t;if("type_check_only"===s.details.builtInName)return n.details.flags|=268435456,t;if("runtime_checkable"===s.details.builtInName)return n.details.flags|=65536,t;let i,l;if(9===a.expression.nodeType){l=a.expression;const t=e.getTypeOfExpression(l.leftExpression,2|r).type;i=(0,o.getDataclassDecoratorBehaviors)(t)}else{const t=e.getTypeOfExpression(a.expression,r).type;i=(0,o.getDataclassDecoratorBehaviors)(t)}if(i)return(0,o.applyDataClassDecorator)(e,a,n,i,l),t}return u(e,a,t)},t.addOverloadsToFunctionType=function(e,t,n){let o;const l=(0,i.getDeclaration)(t);l&&(o=l);const p=e.lookUpSymbolRecursive(t,t.name.value,!1);if(p){const i=p.symbol.getDeclarations(),l=i.findIndex((e=>e===o));if(l>0){for(let t=0;t<l;t++){const n=i[t];5===n.type&&e.getTypeOfFunction(n.node)}let o=[];const p=i[l-1];if(5===p.type){const t=e.getTypeOfFunction(p.node);t&&((0,d.isFunction)(t.decoratedType)?d.FunctionType.isOverloaded(t.decoratedType)&&o.push(t.decoratedType):(0,d.isOverloadedFunction)(t.decoratedType)&&(0,a.appendArray)(o,t.decoratedType.overloads))}if(o.push(n),1===o.length)return o[0];const c=o.find((e=>!d.FunctionType.isOverloaded(e)));(null==c?void 0:c.details.docString)&&(o=o.map((e=>d.FunctionType.isOverloaded(e)&&!e.details.docString?d.FunctionType.cloneWithDocString(e,c.details.docString):e))),c&&void 0!==c.details.deprecatedMessage&&(o=o.map((e=>d.FunctionType.isOverloaded(e)&&void 0===e.details.deprecatedMessage?d.FunctionType.cloneWithDeprecatedMessage(e,c.details.deprecatedMessage):e)));const u=d.OverloadedFunctionType.create(o),m=o[o.length-2];return d.FunctionType.isAbstractMethod(m)!==d.FunctionType.isAbstractMethod(n)&&e.addDiagnostic(r.DiagnosticRule.reportInconsistentOverload,s.LocMessage.overloadAbstractMismatch().format({name:t.name.value}),t.name),u}}return n}},27884:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deprecatedSpecialForms=t.deprecatedAliases=void 0;const a=n(61328);t.deprecatedAliases=new Map([["Tuple",{version:a.pythonVersion3_9,fullName:"builtins.tuple",replacementText:"tuple"}],["List",{version:a.pythonVersion3_9,fullName:"builtins.list",replacementText:"list"}],["Dict",{version:a.pythonVersion3_9,fullName:"builtins.dict",replacementText:"dict"}],["Set",{version:a.pythonVersion3_9,fullName:"builtins.set",replacementText:"set"}],["FrozenSet",{version:a.pythonVersion3_9,fullName:"builtins.frozenset",replacementText:"frozenset"}],["Type",{version:a.pythonVersion3_9,fullName:"builtins.type",replacementText:"type"}],["Deque",{version:a.pythonVersion3_9,fullName:"collections.deque",replacementText:"collections.deque"}],["DefaultDict",{version:a.pythonVersion3_9,fullName:"collections.defaultdict",replacementText:"collections.defaultdict"}],["OrderedDict",{version:a.pythonVersion3_9,fullName:"collections.OrderedDict",replacementText:"collections.OrderedDict",typingImportOnly:!0}],["Counter",{version:a.pythonVersion3_9,fullName:"collections.Counter",replacementText:"collections.Counter",typingImportOnly:!0}],["ChainMap",{version:a.pythonVersion3_9,fullName:"collections.ChainMap",replacementText:"collections.ChainMap",typingImportOnly:!0}],["Awaitable",{version:a.pythonVersion3_9,fullName:"typing.Awaitable",replacementText:"collections.abc.Awaitable",typingImportOnly:!0}],["Coroutine",{version:a.pythonVersion3_9,fullName:"typing.Coroutine",replacementText:"collections.abc.Coroutine",typingImportOnly:!0}],["AsyncIterable",{version:a.pythonVersion3_9,fullName:"typing.AsyncIterable",replacementText:"collections.abc.AsyncIterable",typingImportOnly:!0}],["AsyncIterator",{version:a.pythonVersion3_9,fullName:"typing.AsyncIterator",replacementText:"collections.abc.AsyncIterator",typingImportOnly:!0}],["AsyncGenerator",{version:a.pythonVersion3_9,fullName:"typing.AsyncGenerator",replacementText:"collections.abc.AsyncGenerator",typingImportOnly:!0}],["Iterable",{version:a.pythonVersion3_9,fullName:"typing.Iterable",replacementText:"collections.abc.Iterable",typingImportOnly:!0}],["Iterator",{version:a.pythonVersion3_9,fullName:"typing.Iterator",replacementText:"collections.abc.Iterator",typingImportOnly:!0}],["Generator",{version:a.pythonVersion3_9,fullName:"typing.Generator",replacementText:"collections.abc.Generator",typingImportOnly:!0}],["Reversible",{version:a.pythonVersion3_9,fullName:"typing.Reversible",replacementText:"collections.abc.Reversible",typingImportOnly:!0}],["Container",{version:a.pythonVersion3_9,fullName:"typing.Container",replacementText:"collections.abc.Container",typingImportOnly:!0}],["Collection",{version:a.pythonVersion3_9,fullName:"typing.Collection",replacementText:"collections.abc.Collection",typingImportOnly:!0}],["AbstractSet",{version:a.pythonVersion3_9,fullName:"typing.AbstractSet",replacementText:"collections.abc.Set",typingImportOnly:!0}],["MutableSet",{version:a.pythonVersion3_9,fullName:"typing.MutableSet",replacementText:"collections.abc.MutableSet",typingImportOnly:!0}],["Mapping",{version:a.pythonVersion3_9,fullName:"typing.Mapping",replacementText:"collections.abc.Mapping",typingImportOnly:!0}],["MutableMapping",{version:a.pythonVersion3_9,fullName:"typing.MutableMapping",replacementText:"collections.abc.MutableMapping",typingImportOnly:!0}],["Sequence",{version:a.pythonVersion3_9,fullName:"typing.Sequence",replacementText:"collections.abc.Sequence",typingImportOnly:!0}],["MutableSequence",{version:a.pythonVersion3_9,fullName:"typing.MutableSequence",replacementText:"collections.abc.MutableSequence",typingImportOnly:!0}],["ByteString",{version:a.pythonVersion3_9,fullName:"typing.ByteString",replacementText:"collections.abc.ByteString",typingImportOnly:!0}],["MappingView",{version:a.pythonVersion3_9,fullName:"typing.MappingView",replacementText:"collections.abc.MappingView",typingImportOnly:!0}],["KeysView",{version:a.pythonVersion3_9,fullName:"typing.KeysView",replacementText:"collections.abc.KeysView",typingImportOnly:!0}],["ItemsView",{version:a.pythonVersion3_9,fullName:"typing.ItemsView",replacementText:"collections.abc.ItemsView",typingImportOnly:!0}],["ValuesView",{version:a.pythonVersion3_9,fullName:"typing.ValuesView",replacementText:"collections.abc.ValuesView",typingImportOnly:!0}],["ContextManager",{version:a.pythonVersion3_9,fullName:"typing.ContextManager",replacementText:"contextlib.AbstractContextManager"}],["AsyncContextManager",{version:a.pythonVersion3_9,fullName:"typing.AsyncContextManager",replacementText:"contextlib.AbstractAsyncContextManager"}],["Pattern",{version:a.pythonVersion3_9,fullName:"re.Pattern",replacementText:"re.Pattern",typingImportOnly:!0}],["Match",{version:a.pythonVersion3_9,fullName:"re.Match",replacementText:"re.Match",typingImportOnly:!0}]]),t.deprecatedSpecialForms=new Map([["Optional",{version:a.pythonVersion3_10,fullName:"typing.Optional",replacementText:"| None"}],["Union",{version:a.pythonVersion3_10,fullName:"typing.Union",replacementText:"|"}],["Callable",{version:a.pythonVersion3_9,fullName:"typing.Callable",replacementText:"collections.abc.Callable",typingImportOnly:!0}]])},74124:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertDocStringToPlainText=t.convertDocStringToMarkdown=void 0;const a=n(99216);t.convertDocStringToMarkdown=function(e){return new E(e).convert()},t.convertDocStringToPlainText=function(e){const t=(0,a.cleanAndSplitDocString)(e),n=[];for(const e of t){const t=n.length>0?n[n.length-1]:void 0;O(e)&&O(t)||n.push(e)}return n.join("\n").trimEnd()};const r=/\S|$/,s=/\S/,i=/^\s*~~~+$/,o=/^\s*\+\+\++$/,l=/^\s*===+\s+===+$/,p=/^\s*---+\s+---+$/,c=/^(\s*)-\s/,d=/^(\s*)\*\s/,u=/^(\s*)\d+\.\s/,m=/^(\s+\* )(.*)$/,y=/^\s*\.\. /,g=/^\s*\.\.\s+(.*)::\s*(.*)$/,h=/ *>>> /,f=/^\s*:(param|arg|type|return|rtype|raise|except|var|ivar|cvar|copyright|license)/,T=/^\.[\s\t]+(@\w)/gm,v=/^(\.\s{3})|^(\.)/,b=[{exp:/^\s*=+(\s+=+)+$/,replacement:"="},{exp:/^\s*-+(\s+-+)+$/,replacement:"-"},{exp:/^\s*~+(\s+-+)+$/,replacement:"~"},{exp:/^\s*\++(\s+\++)+$/,replacement:"+"}],_=/\s/g,C=/``/g,I=/~/g,k=/\+/g,w=/(?<!\\)([_*~[\]])/g,S=/(\[.*\]\(.*\))/g,A=/^\s*(?<block>`{3}(?!`)|~{3}(?!~))(\w*)/,x=/^\s*(?<block>`{3}(?!`)|~{3}(?!~))/,P=[{exp:/</g,replacement:"&lt;"},{exp:/>/g,replacement:"&gt;"}],N="  \n",D=/^\s*::$/,F=[{exp:/\s+::$/g,replacement:""},{exp:/(\S)\s*::$/g,replacement:"$1:"},{exp:/:[\w_\-+:.]+:`/g,replacement:"`"},{exp:/`:[\w_\-+:.]+:/g,replacement:"`"}];class E{constructor(e){this._builder="",this._skipAppendEmptyLine=!0,this._insideInlineCode=!1,this._appendDirectiveBlock=!1,this._stateStack=[],this._lineNum=0,this._blockIndent=0,this._state=this._parseText,this._input=e,this._lines=(0,a.cleanAndSplitDocString)(e)}convert(){for(T.test(this._input)&&(this._lines=this._lines.map((e=>e.replace(v,""))));void 0!==this._currentLineOrUndefined();){const e=this._state,t=this._lineNum;if(this._state(),this._state===e&&this._lineNum===t)break}return this._state===this._parseBacktickBlock||this._state===this._parseDocTest||this._state===this._parseLiteralBlock?this._trimOutputAndAppendLine(this._lastBacktickString||"```"):this._insideInlineCode&&this._trimOutputAndAppendLine("`",!0),this._builder.trim()}_eatLine(){this._lineNum++}_currentLineOrUndefined(){return this._lineNum<this._lines.length?this._lines[this._lineNum]:void 0}_currentLine(){return this._currentLineOrUndefined()||""}_currentIndent(){return M(this._currentLine())}_prevIndent(){var e;return M(null!==(e=this._lineAt(this._lineNum-1))&&void 0!==e?e:"")}_lineAt(e){return e<this._lines.length?this._lines[e]:void 0}_nextBlockIndent(){return M(this._lines.slice(this._lineNum+1).find((e=>!O(e)))||"")}_currentLineIsOutsideBlock(){return this._currentIndent()<this._blockIndent}_currentLineWithinBlock(){return this._currentLine().substr(this._blockIndent)}_pushAndSetState(e){this._state===this._parseText&&(this._insideInlineCode=!1),this._stateStack.push(this._state),this._state=e}_popState(){this._state=this._stateStack.splice(0,1)[0],this._state===this._parseText&&(this._insideInlineCode=!1)}_parseText(){if(O(this._currentLineOrUndefined()))return void(this._state=this._parseEmpty);if(this._beginBacktickBlock())return;if(this._beginLiteralBlock())return;if(this._beginDocTest())return;if(this._beginDirective())return;if(this._beginList())return;if(this._beginFieldList())return;if(this._beginTableBlock())return;const e=this._formatPlainTextIndent(this._currentLine());this._appendTextLine(e),this._eatLine()}_formatPlainTextIndent(e){const t=this._lineAt(this._lineNum-1),n=this._prevIndent(),a=this._currentIndent();return!(a>n)||O(t)||this._builder.endsWith(N)||this._builder.endsWith("\n\n")||z(t)||(this._builder=this._builder.slice(0,-1)+N),n>a&&!O(t)&&!this._builder.endsWith(N)&&!this._builder.endsWith("\n\n")&&(this._builder=this._builder.slice(0,-1)+N),e=0===n||this._builder.endsWith(N)||this._builder.endsWith("\n\n")?this._convertIndent(e):e.trimStart()}_convertIndent(e){return e=e.replace(/^([ \t]+)(.+)$/g,((e,t,n)=>"&nbsp;".repeat(t.length)+n))}_escapeHtml(e){return P.forEach((t=>{e=e.replace(t.exp,t.replacement)})),e}_appendTextLine(e){const t=(e=this._preprocessTextLine(e)).split("`");for(let e=0;e<t.length;e++){let n=t[e];if(e>0&&(this._insideInlineCode=!this._insideInlineCode,this._append("`")),this._insideInlineCode){this._append(n);continue}if(n=this._escapeHtml(n),0===e){if(1===t.length){for(const e of b)if(e.exp.test(n)){n=n.replace(_,e.replacement);break}if(i.test(n)){this._append(n.replace(I,"-"));continue}if(o.test(n)){this._append(n.replace(k,"-"));continue}}const e=m.exec(n);null!==e&&3===e.length&&(this._append(e[1]),n=e[2])}n.split(S).forEach((e=>{S.test(e)?this._append(e):this._append(e.replace(w,"\\$1"))}))}this._builder+="\n"}_preprocessTextLine(e){return D.test(e)?"":(F.forEach((t=>e=e.replace(t.exp,t.replacement))),e=e.replace(C,"`"))}_parseEmpty(){if(O(this._currentLineOrUndefined()))return this._appendLine(),void this._eatLine();this._state=this._parseText}_beginMinIndentCodeBlock(e){this._appendLine("```"),this._pushAndSetState(e),this._blockIndent=this._currentIndent()}_beginBacktickBlock(){const e=this._currentLine().match(A);return null!==e&&(this._blockIndent=this._currentIndent(),this._lastBacktickString=e[1],this._appendLine(e[1]+e[2]),this._pushAndSetState(this._parseBacktickBlock),this._eatLine(),!0)}_parseBacktickBlock(){if(x.test(this._currentLine())&&this._currentIndent()===this._blockIndent){const e=this._currentLine().match(x);this._lastBacktickString=e?e[1]:"```",this._appendLine(this._lastBacktickString),this._appendLine(),this._popState()}else this._appendLine(this._currentLine());this._eatLine()}_beginDocTest(){return!!h.test(this._currentLine())&&(this._beginMinIndentCodeBlock(this._parseDocTest),this._appendLine(this._currentLineWithinBlock()),this._eatLine(),!0)}_parseDocTest(){if(this._currentLineIsOutsideBlock()||O(this._currentLine()))return this._trimOutputAndAppendLine("```"),this._appendLine(),void this._popState();this._appendLine(this._currentLineWithinBlock()),this._eatLine()}_beginLiteralBlock(){const e=this._lineAt(this._lineNum-1);if(void 0===e)return!1;if(!O(e))return!1;let t=this._lineNum-2;for(;t>=0;t--){const e=this._lineAt(t);if(!O(e)){if(e.endsWith("::"))break;return!1}}return!(t<0)&&(0===this._currentIndent()?(this._appendLine("```"),this._pushAndSetState(this._parseLiteralBlockSingleLine),!0):(this._beginMinIndentCodeBlock(this._parseLiteralBlock),!0))}_parseLiteralBlock(){if(O(this._currentLineOrUndefined()))return this._appendLine(),void this._eatLine();const e=this._lineAt(this._lineNum-1);if(this._currentLineIsOutsideBlock()&&O(e))return this._trimOutputAndAppendLine("```"),this._appendLine(),void this._popState();this._appendLine(this._currentLine()),this._eatLine()}_parseLiteralBlockSingleLine(){this._appendLine(this._currentLine()),this._appendLine("```"),this._appendLine(),this._popState(),this._eatLine()}_beginDirective(){return!!y.test(this._currentLine())&&(this._pushAndSetState(this._parseDirective),this._blockIndent=this._nextBlockIndent(),this._appendDirectiveBlock=!1,!0)}_beginFieldList(){if(this._insideInlineCode)return!1;let e=this._currentLine();if(e.startsWith("@"))return this._appendLine(),this._appendTextLine(e),this._eatLine(),!0;const t=!(null==e?void 0:e.endsWith(":"))&&!(null==e?void 0:e.endsWith("::"))&&!!e.match(/.*?\s*:\s*(.+)/gu),n=f.test(e);if(t||n){const t=this._lineAt(this._lineNum-1);return this._builder.endsWith(N)||this._builder.endsWith("\n\n")||z(t)||(this._builder=this._builder.slice(0,-1)+N),e=this._convertIndent(e),this._appendTextLine(e),this._eatLine(),!0}return!1}_beginTableBlock(){if(this._insideInlineCode)return!1;const e=this._currentLine();return!!l.test(e)&&(this._tableState={header:e.trimStart(),inHeader:!0},this._eatLine(),this._pushAndSetState(this._parseTableBlock),!0)}_parseTableBlock(){if(O(this._currentLineOrUndefined())||!this._tableState)return this._tableState=void 0,void this._popState();let e=this._currentLine();if(l.test(e))return this._eatLine(),this._appendLine("\n<br/>\n"),this._popState(),void(this._tableState=void 0);{let t="|";const n=this._tableState.header.split(" "),a=[];if(this._tableState.inHeader){do{let t=0;for(let r=0;r<n.length;r++){const s=n[r].length+1,i=e.slice(t,t+s);void 0===a[r]?a[r]=`${i} `:a[r]=a[r].concat(`<br>${i} `),t+=s}this._eatLine(),e=this._currentLine()}while(!O(this._currentLineOrUndefined())&&!p.test(e)&&!l.test(e));this._tableState.inHeader=!1,a.forEach((e=>{t+=`${e}|`})),this._appendLine(t);const r=e.trimStart().replace(/=/g,"-").replace(" ","|");this._appendLine(`|${r}|`),this._eatLine()}else{let a=0;n.forEach((n=>{const r=n.length+1,s=e.slice(a,a+r);t+=`${s}|`,a+=r})),this._appendLine(t),this._eatLine()}}}_beginList(){if(this._insideInlineCode)return!1;let e=this._currentLine();const t=c.exec(e);if(2===(null==t?void 0:t.length))return t[1].length>=4&&(e=" ".repeat(t[1].length/2)+e.trimLeft()),this._appendTextLine(e),this._eatLine(),this._state!==this._parseList&&this._pushAndSetState(this._parseList),!0;const n=d.exec(e);if(2===(null==n?void 0:n.length))return 0===n[1].length?e=e=" "+e:n[1].length>=4&&(e=" ".repeat(n[1].length/2)+e.trimLeft()),this._appendTextLine(e),this._eatLine(),this._state!==this._parseList&&this._pushAndSetState(this._parseList),!0;const a=u.exec(e);return 2===(null==a?void 0:a.length)&&(this._appendTextLine(e),this._eatLine(),!0)}_parseList(){if(O(this._currentLineOrUndefined())||this._currentLineIsOutsideBlock())return void this._popState();if(!this._beginList()){const e=this._currentLine().trimStart();this._appendTextLine(e),this._eatLine()}}_parseDirective(){const e=g.exec(this._currentLine());if(null!==e&&3===e.length){const t=e[1],n=e[2];if("class"===t)this._appendDirectiveBlock=!0,this._appendLine(),this._appendLine("```"),this._appendLine(n),this._appendLine("```"),this._appendLine();else if("code-block"===t)return this._appendDirectiveBlock=!0,this._beginMinIndentCodeBlock(this._parseLiteralBlock),void this._eatLine()}0===this._blockIndent?this._popState():this._state=this._parseDirectiveBlock,this._eatLine()}_parseDirectiveBlock(){O(this._currentLineOrUndefined())||!this._currentLineIsOutsideBlock()?(this._appendDirectiveBlock&&this._appendTextLine(this._currentLine().trimLeft()),this._eatLine()):this._popState()}_appendLine(e){O(e)?this._skipAppendEmptyLine||(this._builder+="\n",this._skipAppendEmptyLine=!0):(this._builder+=e+"\n",this._skipAppendEmptyLine=!1)}_append(e){this._builder+=e,this._skipAppendEmptyLine=!1}_trimOutputAndAppendLine(e,t=!1){this._builder=this._builder.trimRight(),this._skipAppendEmptyLine=!1,t||this._appendLine(),this._appendLine(e)}}function M(e){return e.search(r)}function O(e){return void 0===e||!s.test(e)}function z(e){var t,n;return void 0!==e&&(null!==(n=null===(t=e.match(/^\s*[#`~=-]{3,}/))||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0}},99216:(e,t)=>{function n(e){const t=e.replace(/\r/g,"").replace(/\t/g,"        ").split("\n");let n=Number.MAX_VALUE;t.forEach(((e,a)=>{if(t.length<=1||a>0){const t=e.trimLeft();t&&(n=Math.min(n,e.length-t.length))}})),n>=Number.MAX_VALUE&&(n=0);const a=[];for(t.forEach(((e,t)=>{0===t?a.push(e.trim()):a.push(e.substr(n).trimRight())}));a.length>0&&0===a[0].length;)a.shift();for(;a.length>0&&0===a[a.length-1].length;)a.pop();return a}Object.defineProperty(t,"__esModule",{value:!0}),t.extractParameterDocumentation=t.cleanAndSplitDocString=t.cleanDocString=void 0,t.cleanDocString=function(e){return n(e).join("\n")},t.cleanAndSplitDocString=n,t.extractParameterDocumentation=function(e,t){if(!e||!t)return;const a=n(e);for(const e of a){const n=e.trim();let a=n.indexOf("@param "+t);if(a>=0)return n.substr(a+7);if(a=n.indexOf(":param "+t),a>=0)return n.substr(a+7);if(a=n.indexOf(t+": "),a>=0)return n.substr(a);if(a=n.indexOf(t+" ("),a>=0)return n.substr(a)}}},62744:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEnumAutoValueType=t.getTypeOfEnumMember=t.getEnumDeclaredValueType=t.isDeclInEnumClass=t.transformTypeForEnumMember=t.createEnumType=t.isEnumClassWithMembers=t.isEnumMetaclass=void 0;const a=n(83181),r=n(9316),s=n(28340),i=n(52328),o=n(80944),l=n(46048),p=n(808),c=n(8312);function d(e,t,n,a=0){var s,i,l,u,m,y,g,h;if(a>c.maxTypeRecursionCount)return;if(a++,!c.ClassType.isEnumClass(t))return;const f=(0,p.lookUpClassMember)(t,n);if(!f||!(0,c.isClass)(f.classType)||!c.ClassType.isEnumClass(f.classType))return;const T=f.symbol.getDeclarations();if(T.length<1)return;const v=T[0];let b,_,C,I=!1,k=!1;if(38===v.node.nodeType)C=v.node;else{if(28!==v.node.nodeType)return;C=v.node.name}if(3===(null===(s=C.parent)||void 0===s?void 0:s.nodeType)&&C.parent.leftExpression===C?(I=!0,b=C.parent.rightExpression):52===(null===(i=C.parent)||void 0===i?void 0:i.nodeType)&&3===(null===(l=C.parent.parent)||void 0===l?void 0:l.nodeType)?(I=!0,k=!0,b=C.parent.parent.rightExpression):(0,r.getFileInfo)(C).isStubFile&&54===(null===(u=C.parent)||void 0===u?void 0:u.nodeType)&&C.parent.valueExpression===C&&(I=!0,_=C.parent.typeAnnotation),(0,o.isSingleDunderName)(C.value))return;if("name"===C.value||"value"===C.value)return;const w=_?e.getTypeOfAnnotation(_):void 0;let S;if(b){const t=(0,r.getFileInfo)(b).isStubFile?1:void 0;S=e.getTypeOfExpression(b,t).type}if(38===(null==b?void 0:b.nodeType)&&b.value!==n){const n=d(e,t,b.value,a);if(n&&(0,c.isClassInstance)(n)&&c.ClassType.isSameGenericClass(n,c.ClassType.cloneAsInstance(f.classType))&&void 0!==n.literalValue)return n}if(28===v.node.nodeType){const t=e.getTypeOfFunction(v.node);t&&(S=t.decoratedType)}let A=null!==(m=null!=w?w:S)&&void 0!==m?m:c.UnknownType.create();if(k&&(A=null!==(g=null===(y=e.getTypeOfIterator({type:A},!1,C,!1))||void 0===y?void 0:y.type)&&void 0!==g?g:c.UnknownType.create()),(0,c.isClassInstance)(A)&&c.ClassType.getSymbolTable(A).get("__get__"))return;if((0,o.isPrivateName)(C.value))return;if(!(0,c.findSubtype)(A,(e=>!(0,c.isFunction)(e)&&!(0,c.isOverloadedFunction)(e))))return;if(S||3!==(null===(h=C.parent)||void 0===h?void 0:h.nodeType)||C.parent.leftExpression!==C||(S=e.getTypeOfExpression(C.parent.rightExpression,void 0,(0,p.makeInferenceContext)(w)).type),S&&(0,c.isClassInstance)(S)&&c.ClassType.isBuiltIn(S)){if("enum.nonmember"===S.details.fullName){const t=S.typeArguments&&S.typeArguments.length>0?S.typeArguments[0]:c.UnknownType.create();return w&&e.assignType(w,t)?w:t}"enum.member"===S.details.fullName&&(A=S.typeArguments&&S.typeArguments.length>0?S.typeArguments[0]:c.UnknownType.create(),I=!0)}if(!I)return;const x=new c.EnumLiteral(f.classType.details.fullName,f.classType.details.name,C.value,A);return c.ClassType.cloneAsInstance(c.ClassType.cloneWithLiteral(f.classType,x))}function u(e,t,n=!1){let a;const r=(0,p.lookUpClassMember)(t,"_value_",n?64:0);return r&&r.classType&&(0,c.isClass)(r.classType)&&!c.ClassType.isBuiltIn(r.classType,"Enum")&&(a=e.getTypeOfMember(r)),a}t.isEnumMetaclass=function(e){return e.details.mro.some((e=>(0,c.isClass)(e)&&c.ClassType.isBuiltIn(e,["EnumMeta","EnumType"])))},t.isEnumClassWithMembers=function(e,t){if(!(0,c.isClass)(t)||!c.ClassType.isEnumClass(t))return!1;let n=!1;return c.ClassType.getSymbolTable(t).forEach(((a,r)=>{const s=d(e,t,r);s&&(0,c.isClassInstance)(s)&&c.ClassType.isSameGenericClass(s,t)&&(n=!0)})),n},t.createEnumType=function(e,t,n,a){const o=(0,r.getFileInfo)(t);if(0===a.length)return;const l=a[0];if(0!==l.argumentCategory||!l.valueExpression||48!==l.valueExpression.nodeType||1!==l.valueExpression.strings.length||49!==l.valueExpression.strings[0].nodeType)return;const d=l.valueExpression.strings.map((e=>e.value)).join(""),u=c.ClassType.createInstantiable(d,(0,s.getClassFullName)(t,o.moduleName,d),o.moduleName,o.fileUri,1075838976,(0,s.getTypeSourceId)(t),void 0,n.details.effectiveMetaclass);u.details.baseClasses.push(n),(0,p.computeMroLinearization)(u);const m=c.ClassType.getSymbolTable(u);if(m.set("__class__",i.Symbol.createWithType(68,u)),a.length<2)return;const y=a[1];if(0!==y.argumentCategory||!y.valueExpression)return;const g=e.getBuiltInType(t,"int");if(!g||!(0,c.isInstantiableClass)(g))return;const h=c.ClassType.cloneAsInstance(u);if(48===y.valueExpression.nodeType){if(!y.valueExpression.strings.every((e=>49===e.nodeType)))return;const e=y.valueExpression.strings.map((e=>e.value)).join("").trim().split(/[\s,]+/);for(const[t,n]of e.entries()){if(!n)return;const e=c.ClassType.cloneWithLiteral(c.ClassType.cloneAsInstance(g),t+1),a=new c.EnumLiteral(u.details.fullName,u.details.name,n,e),r=i.Symbol.createWithType(4,c.ClassType.cloneWithLiteral(h,a));m.set(n,r)}return u}if(31===y.valueExpression.nodeType||52===y.valueExpression.nodeType){const t=31===y.valueExpression.nodeType?y.valueExpression.entries:y.valueExpression.expressions;if(0===t.length)return;let n=!1;for(const[a,r]of t.entries()){let t,s;if(0===a&&(n=48===r.nodeType),48===r.nodeType){if(!n)return;t=r,s=c.ClassType.cloneWithLiteral(c.ClassType.cloneAsInstance(g),a+1)}else{if(52!==r.nodeType)return;if(n)return;if(2!==r.expressions.length)return;t=r.expressions[0],s=e.getTypeOfExpression(r.expressions[1]).type}if(48!==t.nodeType||1!==t.strings.length||49!==t.strings[0].nodeType)return;const o=t.strings[0].value,l=new c.EnumLiteral(u.details.fullName,u.details.name,o,s),p=i.Symbol.createWithType(4,c.ClassType.cloneWithLiteral(h,l));m.set(o,p)}}if(15===y.valueExpression.nodeType){const t=y.valueExpression.entries;if(0===t.length)return;for(const n of t){if(17!==n.nodeType)return;const t=n.keyExpression,a=e.getTypeOfExpression(n.valueExpression).type;if(48!==t.nodeType||1!==t.strings.length||49!==t.strings[0].nodeType)return;const r=t.strings[0].value,s=new c.EnumLiteral(u.details.fullName,u.details.name,r,a),o=i.Symbol.createWithType(4,c.ClassType.cloneWithLiteral(h,s));m.set(r,o)}}return u},t.transformTypeForEnumMember=d,t.isDeclInEnumClass=function(e,t){const n=(0,s.getEnclosingClass)(t.node,!0);if(!n)return!1;const a=e.getTypeOfClass(n);return!!a&&c.ClassType.isEnumClass(a.classType)},t.getEnumDeclaredValueType=u,t.getTypeOfEnumMember=function(e,t,n,r,s){if(!c.ClassType.isEnumClass(n))return;const i=d(e,n,r);if(i)return{type:i,isIncomplete:s};if(c.TypeBase.isInstantiable(n))return;const o=n.literalValue;if("name"===r||"_name_"===r){const i=(0,p.lookUpClassMember)(n,r);if(i&&(0,c.isClass)(i.classType)&&!c.ClassType.isBuiltIn(i.classType,"Enum"))return;const d=e.getBuiltInType(t,"str");if(!(0,c.isInstantiableClass)(d))return;const u=e=>c.ClassType.cloneAsInstance(c.ClassType.cloneWithLiteral(d,e.itemName));if(o)return(0,a.assert)(o instanceof c.EnumLiteral),{type:u(o),isIncomplete:s};const m=(0,l.enumerateLiteralsForType)(e,n);if(m&&m.length>0)return{type:(0,c.combineTypes)(m.map((e=>{const t=e.literalValue;return(0,a.assert)(t instanceof c.EnumLiteral),u(t)}))),isIncomplete:s}}const m=u(e,n);if("value"===r||"_value_"===r){const t=(0,p.lookUpClassMember)(n,r);if(t&&(0,c.isClass)(t.classType)&&!c.ClassType.isBuiltIn(t.classType,"Enum"))return;const i=n.details.effectiveMetaclass;if(i&&(0,c.isClass)(i)&&!c.ClassType.isBuiltIn(i))return{type:null!=m?m:c.AnyType.create(),isIncomplete:s};const d=(0,p.lookUpClassMember)(n,"__new__",4),u=(0,p.lookUpClassMember)(n,"__init__",4);if(d&&(0,c.isClass)(d.classType)&&!c.ClassType.isBuiltIn(d.classType))return{type:null!=m?m:c.AnyType.create(),isIncomplete:s};if(u&&(0,c.isClass)(u.classType)&&!c.ClassType.isBuiltIn(u.classType))return{type:null!=m?m:c.AnyType.create(),isIncomplete:s};if(o)return(0,a.assert)(o instanceof c.EnumLiteral),(0,c.isAny)(o.itemType)?m?{type:m,isIncomplete:s}:void 0:{type:o.itemType,isIncomplete:s};const y=(0,l.enumerateLiteralsForType)(e,n);if(y&&y.length>0)return{type:(0,c.combineTypes)(y.map((e=>{const t=e.literalValue;return(0,a.assert)(t instanceof c.EnumLiteral),t.itemType}))),isIncomplete:s}}},t.getEnumAutoValueType=function(e,t){const n=(0,s.getEnclosingClass)(t);if(n){const a=e.getTypeOfClass(n);if(a){const n=e.getTypeOfBoundMember(t,c.ClassType.cloneAsInstance(a.classType),"_generate_next_value_");if(n&&!n.typeErrors&&(0,c.isFunction)(n.type)&&n.classType&&(0,c.isClass)(n.classType)&&!c.ClassType.isBuiltIn(n.classType,"Enum")&&n.type.details.declaredReturnType)return n.type.details.declaredReturnType}}return e.getBuiltInObject(t,"int")}},60092:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyFunctionTransform=void 0;const a=n(97652),r=n(95960),s=n(52328),i=n(8312),o=n(808);t.applyFunctionTransform=function(e,t,n,l,p){return(0,i.isFunction)(l)&&"functools.total_ordering"===l.details.fullName?function(e,t,n,l){var p;if(1!==n.length)return l;const c=null===(p=n[0].typeResult)||void 0===p?void 0:p.type;if(!c||!(0,i.isInstantiableClass)(c)||c.includeSubclasses)return l;const d=["__lt__","__le__","__gt__","__ge__"],u=i.ClassType.cloneAsInstance(c);let m;const y=d.filter((e=>{const t=(0,o.lookUpObjectMember)(u,e,16);return t&&!m&&(m=t),!t}));if(!m)return e.addDiagnostic(a.DiagnosticRule.reportGeneralTypeIssues,r.LocMessage.totalOrderingMissingMethod(),t),l;let g;const h=e.getTypeOfMember(m);(0,i.isFunction)(h)&&h.details.parameters.length>=2&&h.details.parameters[1].hasDeclaredType&&(g=h.details.parameters[1].type);if(!g){const n=e.getBuiltInObject(t,"object");if(!n||!(0,i.isClassInstance)(n))return l;g=n}const f=e.getBuiltInObject(t,"bool");if(!f||!(0,i.isClassInstance)(f))return l;const T={category:0,name:"self",type:(0,o.synthesizeTypeVarForSelfCls)(c,!1),hasDeclaredType:!0},v={category:0,name:"__value",type:g,hasDeclaredType:!0};return y.forEach((e=>{const t=i.FunctionType.createSynthesizedInstance(e);i.FunctionType.addParameter(t,T),i.FunctionType.addParameter(t,v),t.details.declaredReturnType=f,i.ClassType.getSymbolTable(c).set(e,s.Symbol.createWithType(4,t))})),l}(e,t,n,p):p}},29332:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ImportResolver=t.supportedFileExtensions=t.createImportedModuleDescriptor=void 0;const i=n(28040),o=n(55484),l=n(93924),p=n(11699),c=n(61328),d=n(37636),u=s(n(50356)),m=n(50356),y=n(55084),g=n(80636),h=n(34296),f=n(21440),T=n(88288),v=n(65940),b=s(n(58700)),_=s(n(80944)),C=n(80944);t.createImportedModuleDescriptor=function(e){if(0===e.length)return{leadingDots:0,nameParts:[],importedSymbols:new Set};let t=0,n=0;for(;t<e.length&&"."===e[t];t++)n++;return{leadingDots:n,nameParts:e.slice(t).split("."),importedSymbols:new Set}};const I=[".pyd",".so",".dylib"],k=[".py",".pyi"];t.supportedFileExtensions=[...k,...I];class w{constructor(e,t,n){this.serviceProvider=e,this._configOptions=t,this.host=n,this._cachedImportResults=new Map,this._cachedModuleNameResults=new Map,this._cachedEntriesForPath=new Map,this._cachedFilesForPath=new Map,this._cachedDirExistenceForRoot=new Map,this.cachedParentImportResults=new T.ParentDirectoryCache((()=>this.getPythonSearchPaths([])))}get fileSystem(){return this.serviceProvider.fs()}get tmp(){return this.serviceProvider.tmp()}get partialStubs(){return this.serviceProvider.tryGet(d.ServiceKeys.partialStubs)}static isSupportedImportSourceFile(e){const t=e.lastExtension.toLowerCase();return k.some((e=>t===e))}static isSupportedImportFile(e){const n=e.lastExtension.toLowerCase();return t.supportedFileExtensions.some((e=>n===e))}invalidateCache(){var e;this._cachedImportResults=new Map,this._cachedModuleNameResults=new Map,this.cachedParentImportResults.reset(),this._stdlibModules=void 0,this._invalidateFileSystemCache(),null===(e=this.partialStubs)||void 0===e||e.clearPartialStubs()}resolveImport(e,t,n){return this.resolveImportInternal(e,t,n)}getCompletionSuggestions(e,t,n){const a=this._getCompletionSuggestionsStrict(e,t,n);if(n.leadingDots>0)return a;const r=this.getParentImportResolutionRoot(e,t.root);let s=e.getDirectory();for(;this._shouldWalkUp(s,r,t)&&s;)this._getCompletionSuggestionsAbsolute(e,t,s,n,a,!1),s=this._tryWalkUp(s);return a}getConfigOptions(){return this._configOptions}setConfigOptions(e){this._configOptions=e,this.invalidateCache()}getSourceFilesFromStub(e,t,n){const a=[];if(this._cachedImportResults.forEach((t=>{t.forEach((t=>{if(t.isStubFile&&t.isImportFound&&t.nonStubImportResult&&t.resolvedUris[t.resolvedUris.length-1].equals(e)&&t.nonStubImportResult.isImportFound){const e=t.nonStubImportResult.resolvedUris[t.nonStubImportResult.resolvedUris.length-1];(e.hasExtension(".py")||e.hasExtension(".pyi"))&&a.push(e)}}))})),0===a.length){const t=e.replaceExtension(".py");this.dirExistsCached(t)&&a.push(t)}if(0===a.length){const n=this.getImportRoots(t),r=[];for(const t of n)if(e.isChild(t)){const n=Array.from(t.getRelativePathComponents(e));n.length>=1&&(n[0].endsWith(l.stubsSuffix)&&(n[0]=n[0].slice(0,n[0].length-l.stubsSuffix.length)),r.push(n.join("/")))}for(const e of r)for(const t of n){let n=t.resolvePaths(e).replaceExtension(".py");if(this.fileExistsCached(n))a.push(n);else{const e=n.stripExtension();e.pathEndsWith("__init__")?(n=e.getDirectory().packageUri,this.fileExistsCached(n)&&a.push(n)):(n=e.initPyUri,this.fileExistsCached(n)&&a.push(n))}}}return a}getModuleNameForImport(e,t,n=!1,a=!1){var r;const s=(0,i.getOrAdd)(this._cachedModuleNameResults,null===(r=t.root)||void 0===r?void 0:r.key,(()=>new Map)),o=`${n}.${a}.${e.key}`;return(0,i.getOrAdd)(s,o,(()=>this._getModuleNameForImport(e,t,n,a)))}getTypeshedStdLibPath(e){return this._getStdlibTypeshedPath(this._configOptions.typeshedPath,e.pythonVersion,e.pythonPlatform,[])}getTypeshedThirdPartyPath(e){return this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,[])}isStdlibModule(e,t){return this._stdlibModules||(this._stdlibModules=this._buildStdlibCache(this.getTypeshedStdLibPath(t))),this._stdlibModules.has(e.nameParts.join("."))}getImportRoots(e,t=!1){const n=[],a=[],r=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,e.pythonVersion,e.pythonPlatform,n);if(r&&a.push(r),e.root&&a.push(e.root),(0,i.appendArray)(a,e.extraPaths),this._configOptions.stubPath&&a.push(this._configOptions.stubPath),t){const e=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,n);e&&a.push(e.resolvePaths("..."))}else{const e=this._getThirdPartyTypeshedPackageRoots(n);(0,i.appendArray)(a,e)}const s=this.getTypeshedPathEx(e,n);s&&a.push(s);const o=this.getPythonSearchPaths(n);return o.length>0&&(0,i.appendArray)(a,o),a}ensurePartialStubPackages(e){var t;if(!this.partialStubs)return!1;if(this.partialStubs.isPartialStubPackagesScanned(e))return!1;const n=this.partialStubs,a=[],r=[],s=this.getTypeshedPathEx(e,a);return i(this._configOptions.stubPath),i(null!==(t=e.root)&&void 0!==t?t:this._configOptions.projectRoot),e.extraPaths.forEach((e=>i(e))),i(s),this.getPythonSearchPaths(a).forEach((e=>i(e))),this.partialStubs.processPartialStubPackages(r,this.getImportRoots(e),s),this._invalidateFileSystemCache(),!0;function i(e){e&&!n.isPathScanned(e)&&r.push(e)}}getPythonSearchPaths(e){if(!this._cachedPythonSearchPaths){const e=[],t=(b.findPythonSearchPaths(this.fileSystem,this._configOptions,this.host,e)||[]).map((e=>this.fileSystem.realCasePath(e)));this._cachedPythonSearchPaths={paths:Array.from(new Set(t)),failureInfo:e}}return e.push(...this._cachedPythonSearchPaths.failureInfo),this._cachedPythonSearchPaths.paths}getTypeshedStdlibExcludeList(e,t,n){const a=this._getStdlibTypeshedPath(e,t,n,[]),r=[];return a?(this._cachedTypeshedStdLibModuleVersionInfo||(this._cachedTypeshedStdLibModuleVersionInfo=this._readTypeshedStdLibVersions(e,[])),this._cachedTypeshedStdLibModuleVersionInfo.forEach(((e,s)=>{let i=!1;if(void 0!==e.max&&t.isGreaterThan(e.max)&&(i=!0),void 0!==n){const t=n.toLowerCase();e.supportedPlatforms&&e.supportedPlatforms.every((e=>e.toLowerCase()!==t))&&(i=!0),e.unsupportedPlatforms&&e.unsupportedPlatforms.some((e=>e.toLowerCase()===t))&&(i=!0)}if(i){const e=a.combinePaths(...s.split("."));r.push(e);const t=e.replaceExtension(".pyi");r.push(t)}})),r):r}readdirEntriesCached(e){const t=this._cachedEntriesForPath.get(e.key);if(t)return t;let n;try{n=this.fileSystem.readdirEntriesSync(e)}catch{n=[]}return this._cachedEntriesForPath.set(e.key,n),n}resolveImportInternal(e,t,n){const a=this.formatImportName(n),r=this._resolveImportStrict(a,e,t,n,[]);if(r.isImportFound||n.leadingDots>0)return r;const s=e.getDirectory(),i=this.cachedParentImportResults.getImportResult(s,a,r);if(i)return this.filterImplicitImports(i,n.importedSymbols);const o=this.getParentImportResolutionRoot(e,t.root);if(!this.cachedParentImportResults.checkValidPath(this.fileSystem,e,o))return r;const l=[`Attempting to resolve using local imports: ${a}`],p={importPath:void 0};let c=s;for(;this._shouldWalkUp(c,o,t)&&c;){const r=this.resolveAbsoluteImport(e,c,t,n,a,l,void 0,void 0,!1,!0);if(this.cachedParentImportResults.checked(c,a,p),r.isImportFound)return p.importPath=c,this.cachedParentImportResults.add({importResult:r,path:c,importName:a}),this.filterImplicitImports(r,n.importedSymbols);c=this._tryWalkUp(c)}if(c&&this.cachedParentImportResults.checked(c,a,p),this._configOptions.verboseOutput){const e=this.serviceProvider.console();l.forEach((t=>e.log(t)))}return r}fileExistsCached(e){const t=e.getDirectory();if(t.equals(e))return!1;const n=e.fileName,a=this.readdirEntriesCached(t).find((e=>e.name===n));if(null==a?void 0:a.isFile())return!0;if(null==a?void 0:a.isSymbolicLink()){const t=(0,g.tryRealpath)(this.fileSystem,e);if(t&&this.fileSystem.existsSync(t)&&(0,g.isFile)(this.fileSystem,t))return!0}return!1}dirExistsCached(e){var t,n;const a=e.getDirectory();if(a.equals(e)){let a=this._cachedDirExistenceForRoot.get(e.key);return void 0===a&&(a=null!==(n=null===(t=(0,g.tryStat)(this.fileSystem,e))||void 0===t?void 0:t.isDirectory())&&void 0!==n&&n,this._cachedDirExistenceForRoot.set(e.key,a)),a}const r=e.fileName,s=this.readdirEntriesCached(a).find((e=>e.name===r));if(null==s?void 0:s.isDirectory())return!0;if(null==s?void 0:s.isSymbolicLink()){const t=(0,g.tryRealpath)(this.fileSystem,e);if(t&&this.fileSystem.existsSync(t)&&(0,g.isDirectory)(this.fileSystem,t))return!0}return!1}addResultsToCache(e,t,n,a,r,s){var o;const l=r&&r.leadingDots>0?e:void 0;return(0,i.getOrAdd)(this._cachedImportResults,null===(o=t.root)||void 0===o?void 0:o.key,(()=>new Map)).set(this._getImportCacheKey(l,n,s),a),this.filterImplicitImports(a,null==r?void 0:r.importedSymbols)}resolveAbsoluteImport(e,t,n,a,r,s,i=!1,o=!1,l=!1,p=!0,c=!1){if(p&&l){const e=this._resolveAbsoluteImport(t,n,a,r,s,i,!1,!0,!0,!0);if(e.packageDirectory&&(!e.isNamespacePackage||e.isImportFound))return e}return this._resolveAbsoluteImport(t,n,a,r,s,i,o,!1,p,c)}getTypeshedPathEx(e,t){}resolveImportEx(e,t,n,a,r=[],s=!0){}resolveNativeImportEx(e,t,n=[]){}getNativeModuleName(e){const t=e.lastExtension.toLowerCase();if(this._isNativeModuleFileExtension(t))return(0,p.stripFileExtension)(e.fileName,!0)}getModuleNameFromPath(e,t,n=!1){const a=this.getModuleNameInfoFromPath(e,t,n);if(a&&!a.containsInvalidCharacters)return a.moduleName}getModuleNameInfoFromPath(e,t,n=!1){let a=t.stripExtension();if(this._isNativeModuleFileExtension(t.lastExtension)&&(a=a.stripExtension()),!a.startsWith(e))return;a.pathEndsWith("__init__")&&(a=a.getDirectory());const r=Array.from(e.getRelativePathComponents(a));if(n){if(0===r.length)return;r.shift()}if(0===r.length)return;r[0].endsWith(l.stubsSuffix)&&(r[0]=r[0].substr(0,r[0].length-l.stubsSuffix.length));const s=r.some((e=>!this._isIdentifier(e)));return{moduleName:r.join("."),containsInvalidCharacters:s}}filterImplicitImports(e,t){if(void 0===t){const t=Object.assign({},e);return t.filteredImplicitImports=new Map,t}if(0===t.size)return e;if(0===e.implicitImports.size)return e;const n=new Map;if(e.implicitImports.forEach((e=>{t.has(e.name)&&n.set(e.name,e)})),n.size===e.implicitImports.size)return e;const a=Object.assign({},e);return a.filteredImplicitImports=n,a}formatImportName(e){return".".repeat(e.leadingDots)+e.nameParts.join(".")}getParentImportResolutionRoot(e,t){return this._isDefaultWorkspace(t)?e.getDirectory():t}_isDefaultWorkspace(e){return!e||e.isEmpty()||y.Uri.isDefaultWorkspace(e)}_resolveImportStrict(e,t,n,a,r){const s=(0,o.matchFileSpecs)(this._configOptions,t),i={importName:e,isRelative:!1,isImportFound:!1,isPartlyResolved:!1,isNamespacePackage:!1,isInitFilePresent:!1,isStubPackage:!1,importFailureInfo:r,resolvedUris:[],importType:2,isStubFile:!1,isNativeLib:!1,implicitImports:new Map,filteredImplicitImports:new Map,nonStubImportResult:void 0};if(this.ensurePartialStubPackages(n),a.leadingDots>0){const i=this._lookUpResultsInCache(t,n,e,a,s);if(i)return i;const o=this._resolveRelativeImport(t,n,a,e,r);if(o)return o.isRelative=!0,this.addResultsToCache(t,n,e,o,a,s)}else{const r=this._lookUpResultsInCache(t,n,e,a,s);if(r){if(!(r.isImportFound&&r.isNamespacePackage&&!this._isNamespacePackageResolved(a,r.implicitImports)))return r}const o=this._resolveBestAbsoluteImport(t,n,a,!0);if(o)return o.isStubFile&&(o.nonStubImportResult=this._resolveBestAbsoluteImport(t,n,a,!1)||i),this.addResultsToCache(t,n,e,o,a,s)}return this.addResultsToCache(t,n,e,i,void 0,s)}_getCompletionSuggestionsStrict(e,t,n){const a=[],r=new Map;if(n.leadingDots>0)this._getCompletionSuggestionsRelative(e,t,n,r);else{n.nameParts.length>0&&this._getCompletionSuggestionsTypeshedPath(e,t,n,!0,r),t.root&&this._getCompletionSuggestionsAbsolute(e,t,t.root,n,r);for(const a of t.extraPaths)this._getCompletionSuggestionsAbsolute(e,t,a,n,r);this._configOptions.stubPath&&this._getCompletionSuggestionsAbsolute(e,t,this._configOptions.stubPath,n,r),this._getCompletionSuggestionsTypeshedPath(e,t,n,!1,r);const s=this.getPythonSearchPaths(a);for(const a of s)this._getCompletionSuggestionsAbsolute(e,t,a,n,r)}return r}_getModuleNameForImport(e,t,n,a){let r,s=0,i=!1,o=!1,l=!1;const p=[];let c;const d=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,t.pythonVersion,t.pythonPlatform,p);if(d&&(r=this.getModuleNameFromPath(d,e),r)){const e={leadingDots:0,nameParts:r.split("."),importedSymbols:void 0};if(this._isStdlibTypeshedStubValidForVersion(e,this._configOptions.typeshedPath,t.pythonVersion,t.pythonPlatform,[]))return{moduleName:r,importType:s,isTypeshedFile:!0,isLocalTypingsFile:i,isThirdPartyPyTypedPresent:o}}if(t.root){const n=this.getModuleNameInfoFromPath(t.root,e);n&&(n.containsInvalidCharacters?c=n.moduleName:r=n.moduleName),s=2}for(const n of t.extraPaths){const t=this.getModuleNameInfoFromPath(n,e);if(t)if(t.containsInvalidCharacters)c=t.moduleName;else{const e=t.moduleName;(!r||e&&e.length<r.length)&&(r=e,s=2)}}if(this._configOptions.stubPath){const t=this.getModuleNameInfoFromPath(this._configOptions.stubPath,e);if(t)if(t.containsInvalidCharacters)c=t.moduleName;else{const e=t.moduleName;(!r||e&&e.length<r.length)&&(r=e,s=2,i=!0)}}const u=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,p);if(u){const t=this.getModuleNameFromPath(u,e,!0);(!r||t&&t.length<r.length)&&(r=t,s=1,l=!0)}const m=this.getTypeshedPathEx(t,p);if(m){const t=this.getModuleNameFromPath(m,e);(!r||t&&t.length<r.length)&&(r=t,s=1,l=!0)}const y=this.getPythonSearchPaths(p);for(const t of y){const n=this.getModuleNameInfoFromPath(t,e);if(n)if(n.containsInvalidCharacters)c=n.moduleName;else{const e=n.moduleName;(!r||e&&e.length<r.length)&&(r=e,s=1,l=!1)}}if(a&&1===s){const n=this.getParentImportResolutionRoot(e,t.root);let a=e.getDirectory();for(;this._shouldWalkUp(a,n,t);){const e=this._getPyTypedInfo(a);e&&!e.isPartiallyTyped&&(o=!0);break}}return r?{moduleName:r,importType:s,isTypeshedFile:l,isLocalTypingsFile:i,isThirdPartyPyTypedPresent:o}:n&&c?{moduleName:c,isTypeshedFile:l,importType:s,isLocalTypingsFile:i,isThirdPartyPyTypedPresent:o}:{moduleName:"",isTypeshedFile:l,importType:2,isLocalTypingsFile:i,isThirdPartyPyTypedPresent:o}}_invalidateFileSystemCache(){this._cachedEntriesForPath.clear(),this._cachedFilesForPath.clear(),this._cachedDirExistenceForRoot.clear()}_resolveAbsoluteImport(e,t,n,a,r,s,i,o,p,c){o?r.push(`Attempting to resolve stub package using root path '${e}'`):r.push(`Attempting to resolve using root path '${e}'`);const d=[];let u,m,g,h=e,f=!1,T=!1,v=!1,b=!1,_=!1,C=new Map;if(0===n.nameParts.length){const e=h.initPyUri,t=h.initPyiUri;p&&this.fileExistsCached(t)?(r.push(`Resolved import with file '${t}'`),d.push(t),b=!0):this.fileExistsCached(e)?(r.push(`Resolved import with file '${e}'`),d.push(e)):(r.push(`Partially resolved import with directory '${h}'`),d.push(y.Uri.empty()),f=!0),C=this._findImplicitImports(a,h,[e,t])}else for(let e=0;e<n.nameParts.length;e++){const s=0===e,g=e===n.nameParts.length-1;h=h.combinePaths(n.nameParts[e]),o&&s&&(h=h.addPath(l.stubsSuffix),v=!0);const I=this.dirExistsCached(h);if(I){s&&(u=h);const e=h.initPyUri,t=h.initPyiUri;if(T=!1,p&&this.fileExistsCached(t)?(r.push(`Resolved import with file '${t}'`),d.push(t),g&&(b=!0),T=!0):this.fileExistsCached(e)&&(r.push(`Resolved import with file '${e}'`),d.push(e),T=!0),!m&&c&&(m=this._getPyTypedInfo(h)),!g){T||(d.push(y.Uri.empty()),f=!0,m=void 0);continue}if(T){C=this._findImplicitImports(n.nameParts.join("."),h,[e,t]);break}}const k=h.packageUri,w=h.packageStubUri,S=h.getDirectory();if(p&&this.fileExistsCached(w))r.push(`Resolved import with file '${w}'`),d.push(w),g&&(b=!0);else if(this.fileExistsCached(k))r.push(`Resolved import with file '${k}'`),d.push(k);else{if(i&&this.dirExistsCached(S)){const e=this._getFilesInDirectory(S),s=h.fileName,i=e.find((e=>this._isNativeModuleFileName(s,e)));i&&(_=this._resolveNativeModuleStub(i,t,a,n,r,d))}!_&&I?(r.push(`Partially resolved import with directory '${h}'`),d.push(y.Uri.empty()),g&&(C=this._findImplicitImports(a,h,[k,w]),f=!0)):_&&r.push(`Did not find file '${w}' or '${k}'`)}!m&&c&&(m=this._getPyTypedInfo(S));break}const I=d.length>0&&d.length<n.nameParts.length;return g=s?d.length>0:d.length>=n.nameParts.length,{importName:a,isRelative:!1,isNamespacePackage:f,isInitFilePresent:T,isStubPackage:v,isImportFound:g,isPartlyResolved:I,importFailureInfo:r,importType:2,resolvedUris:d,searchPath:e,isStubFile:b,isNativeLib:_,implicitImports:C,pyTypedInfo:m,filteredImplicitImports:C,packageDirectory:u}}_getImportCacheKey(e,t,n){var a;return`${null!==(a=null==e?void 0:e.key)&&void 0!==a?a:""}-${t}-${n}`}_lookUpResultsInCache(e,t,n,a,r){var s,i;const o=this._cachedImportResults.get(null!==(i=null===(s=t.root)||void 0===s?void 0:s.key)&&void 0!==i?i:"");if(!o)return;const l=a.leadingDots>0?e:void 0,p=o.get(this._getImportCacheKey(l,n,r));return p?this.filterImplicitImports(p,a.importedSymbols):void 0}_isNamespacePackageResolved(e,t){if(e.importedSymbols){if(!Array.from(e.importedSymbols.keys()).some((e=>t.has(e))))return!1}else if(0===t.size)return!1;return!0}_resolveBestAbsoluteImport(e,t,n,a){const r=this.formatImportName(n),s=[];if(a&&this._configOptions.stubPath){s.push(`Looking in stubPath '${this._configOptions.stubPath}'`);const i=this.resolveAbsoluteImport(e,this._configOptions.stubPath,t,n,r,s,void 0,!1,!0,a,!1);if(i.isImportFound){if(i.importType=2,i.isLocalTypingsFile=!0,!i.isNamespacePackage||!i.resolvedUris[i.resolvedUris.length-1].isEmpty())return i;if(this._isNamespacePackageResolved(n,i.implicitImports))return i}}let i,o;t.root&&(s.push(`Looking in root directory of execution environment '${t.root}'`),o=this.resolveAbsoluteImport(e,t.root,t,n,r,s,void 0,!0,!0,a,!1),i=o);for(const l of t.extraPaths)s.push(`Looking in extraPath '${l}'`),o=this.resolveAbsoluteImport(e,l,t,n,r,s,void 0,!0,!0,a,!1),i=this._pickBestImport(i,o,n);const l=this.getPythonSearchPaths(s);if(l.length>0)for(const o of l){s.push(`Looking in python search path '${o}'`);const l=this.resolveAbsoluteImport(e,o,t,n,r,s,false,!0,!0,a,!0);l&&(l.importType=1,i=this._pickBestImport(i,l,n))}else s.push("No python interpreter search path");if(t.root!==this._getTypeshedRoot(this._configOptions.typeshedPath,s)&&(null==i?void 0:i.pyTypedInfo)&&!i.isPartlyResolved)return i;const p=this.resolveImportEx(e,t,n,r,s,a);if(p)return p;if(a&&n.nameParts.length>0){s.push("Looking for typeshed stdlib path");const e=this._findTypeshedPath(t,n,r,!0,s);if(e)return e.isStdlibTypeshedFile=!0,e;s.push("Looking for typeshed third-party path");const a=this._findTypeshedPath(t,n,r,!1,s);a&&(a.isThirdPartyTypeshedFile=!0,i=this._pickBestImport(i,a,n))}return i}_pickBestImport(e,t,n){if(!e)return t;if(!t)return e;if(t.isImportFound){const a=e.resolvedUris.findIndex((e=>!e.isEmpty())),r=t.resolvedUris.findIndex((e=>!e.isEmpty()));if(a!==r)return a<0?t:r<0||a<r?e:t;if(!e.isImportFound)return t;if(e.isNamespacePackage&&t.isNamespacePackage&&n.importedSymbols&&!this._isNamespacePackageResolved(n,e.implicitImports)){if(this._isNamespacePackageResolved(n,t.implicitImports))return t;if(e.isInitFilePresent&&!t.isInitFilePresent)return e;if(!e.isInitFilePresent&&t.isInitFilePresent)return t}if(2===e.importType&&1===t.importType)return e;if(e.pyTypedInfo&&!t.pyTypedInfo)return e;if(!e.pyTypedInfo&&t.pyTypedInfo&&e.importType===t.importType)return t;if(e.isStubFile&&!t.isStubFile)return e;if(!e.isStubFile&&t.isStubFile)return t;if(e.resolvedUris.length>t.resolvedUris.length)return t}else if(t.isPartlyResolved){const n=e.resolvedUris.findIndex((e=>!e.isEmpty())),a=t.resolvedUris.findIndex((e=>!e.isEmpty()));if(n!==a)return n<0?t:a<0||n<a?e:t}return e}_isIdentifier(e){for(let t=0;t<e.length;t++)if(0===t?!(0,h.isIdentifierStartChar)(e.charCodeAt(t)):!(0,h.isIdentifierChar)(e.charCodeAt(t)))return!1;return!0}_findTypeshedPath(e,t,n,a,r){let s;if(r.push(`Looking for typeshed ${a?b.stdLibFolderName:b.thirdPartyFolderName} path`),a){const n=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,e.pythonVersion,e.pythonPlatform,r,t);n&&(s=[n])}else s=this._getThirdPartyTypeshedPackagePaths(t,r);if(s)for(const i of s)if(this.dirExistsCached(i)){const s=this.resolveAbsoluteImport(void 0,i,e,t,n,r);if(s.isImportFound){let e=a?0:1;return"typing_extensions"===n&&(e=1),s.importType=e,s}}r.push("Typeshed path not found")}_buildStdlibCache(e){const t=new Set;if(e){const n=(e,a)=>{this.readdirEntriesCached(e).forEach((r=>{if(r.isDirectory()){const t=e.combinePaths(r.name);n(t,a?`${a}.${r.name}`:r.name)}else if(r.name.includes(".py")){const e=(0,p.stripFileExtension)(r.name);e.startsWith("_")||t.add(a?`${a}.${e}`:e)}}))};n(e,void 0)}return t}_buildTypeshedThirdPartyPackageMap(e){this._cachedTypeshedThirdPartyPackagePaths=new Map,e&&this.readdirEntriesCached(e).forEach((t=>{if(t.isDirectory()){const n=e.combinePaths(t.name);this.readdirEntriesCached(n).forEach((e=>{if("@python2"!==e.name)if(e.isDirectory()){const t=this._cachedTypeshedThirdPartyPackagePaths.get(e.name);t?t.push(n):this._cachedTypeshedThirdPartyPackagePaths.set(e.name,[n])}else if(e.isFile()&&e.name.endsWith(".pyi")){const t=(0,p.stripFileExtension)(e.name),a=this._cachedTypeshedThirdPartyPackagePaths.get(t);a?a.push(n):this._cachedTypeshedThirdPartyPackagePaths.set(t,[n])}}))}}));const t=Array.from(this._cachedTypeshedThirdPartyPackagePaths.values()).flatMap((e=>e));this._cachedTypeshedThirdPartyPackageRoots=Array.from(new Set(t)).sort()}_getCompletionSuggestionsTypeshedPath(e,t,n,a,r){const s=[];let i;if(a){const e=this._getStdlibTypeshedPath(this._configOptions.typeshedPath,t.pythonVersion,t.pythonPlatform,s,n);e&&(i=[e])}else{i=this._getThirdPartyTypeshedPackagePaths(n,s,!1);const e=this.getTypeshedPathEx(t,s);e&&(i=null!=i?i:[],i.push(e))}i&&i.forEach((a=>{this.dirExistsCached(a)&&this._getCompletionSuggestionsAbsolute(e,t,a,n,r)}))}_getStdlibTypeshedPath(e,t,n,a,r){const s=this._getTypeshedSubdirectory(!0,e,a);if(!s||!r||this._isStdlibTypeshedStubValidForVersion(r,e,t,n,a))return s}_getThirdPartyTypeshedPath(e,t){return this._getTypeshedSubdirectory(!1,e,t)}_isStdlibTypeshedStubValidForVersion(e,t,n,a,r){this._cachedTypeshedStdLibModuleVersionInfo||(this._cachedTypeshedStdLibModuleVersionInfo=this._readTypeshedStdLibVersions(t,r));for(let t=1;t<=e.nameParts.length;t++){const r=e.nameParts.slice(0,t),s=this._cachedTypeshedStdLibModuleVersionInfo.get(r.join("."));if(s){if(n.isLessThan(s.min))return!1;if(void 0!==s.max&&n.isGreaterThan(s.max))return!1;if(void 0!==a){const e=a.toLowerCase();if(s.supportedPlatforms&&s.supportedPlatforms.every((t=>t.toLowerCase()!==e)))return!1;if(s.unsupportedPlatforms&&s.unsupportedPlatforms.some((t=>t.toLowerCase()===e)))return!1}}}return!0}_readTypeshedStdLibVersions(e,t){const n=new Map,a=this._getTypeshedSubdirectory(!0,e,t);if(a){const e=a.combinePaths("VERSIONS");try{const a=this.fileSystem.statSync(e);if(a.size>0&&a.size<262144){this.fileSystem.readFileSync(e,"utf8").split(/\r?\n/).forEach((e=>{const t=e.split("#")[0].split(";").map((e=>e.trim())),a=t[0].split(":");if(2!==a.length)return;const r=a[1].split("-");if(r.length>2)return;const s=a[0].trim();if(!s)return;let i=r[0].trim();i.endsWith("+")&&(i=i.substr(0,i.length-1));let o,l,p,d=c.PythonVersion.fromString(i);d||(d=c.pythonVersion3_0),r.length>1&&(o=c.PythonVersion.fromString(r[1].trim()));const u="platforms=";let m=t.slice(1).find((e=>e.startsWith(u)));if(m){m=m.trim().substring(10);const e=m.split(",");for(let t of e){t=t.trim();let e=!1;t.startsWith("!")&&(e=!0,t=t.substring(1)),e?(p=null!=p?p:[],p.push(t)):(l=null!=l?l:[],l.push(t))}}n.set(s,{min:d,max:o,supportedPlatforms:l,unsupportedPlatforms:p})}))}else t.push("Typeshed stdlib VERSIONS file is unexpectedly large")}catch(e){t.push(`Could not read typeshed stdlib VERSIONS file: '${JSON.stringify(e)}'`)}}return n}_getThirdPartyTypeshedPackagePaths(e,t,n=!0){const a=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,t);this._cachedTypeshedThirdPartyPackagePaths||this._buildTypeshedThirdPartyPackageMap(a);const r=e.nameParts.length>0?e.nameParts[0]:"";return n?this._cachedTypeshedThirdPartyPackagePaths.get(r):r?(0,i.flatten)((0,i.getMapValues)(this._cachedTypeshedThirdPartyPackagePaths,(e=>e.startsWith(r)))):[]}_getThirdPartyTypeshedPackageRoots(e){const t=this._getThirdPartyTypeshedPath(this._configOptions.typeshedPath,e);return this._cachedTypeshedThirdPartyPackagePaths||this._buildTypeshedThirdPartyPackageMap(t),this._cachedTypeshedThirdPartyPackageRoots}_getTypeshedRoot(e,t){var n;if(void 0===this._cachedTypeshedRoot){let t;e&&this.dirExistsCached(e)&&(t=e),t||(t=null!==(n=b.getTypeShedFallbackPath(this.fileSystem))&&void 0!==n?n:y.Uri.empty()),this._cachedTypeshedRoot=t}return this._cachedTypeshedRoot.isEmpty()?void 0:this._cachedTypeshedRoot}_getTypeshedSubdirectory(e,t,n){if(e){if(void 0!==this._cachedTypeshedStdLibPath)return this._cachedTypeshedStdLibPath}else if(void 0!==this._cachedTypeshedThirdPartyPath)return this._cachedTypeshedThirdPartyPath;let a=this._getTypeshedRoot(t,n);if(void 0!==a&&(a=b.getTypeshedSubdirectory(a,e),this.dirExistsCached(a)))return e?this._cachedTypeshedStdLibPath=a:this._cachedTypeshedThirdPartyPath=a,a}_resolveRelativeImport(e,t,n,a,r){r.push("Attempting to resolve relative import");const s=(0,f.getDirectoryLeadingDotsPointsTo)(e.getDirectory(),n.leadingDots);if(!s)return void r.push(`Invalid relative path '${a}'`);const i=this.resolveAbsoluteImport(e,s,t,n,a,r,!1,!0);return i&&i.isStubFile&&(i.nonStubImportResult=this.resolveAbsoluteImport(e,s,t,n,a,r,!1,!0,!1,!1)||{importName:a,isRelative:!0,isImportFound:!1,isPartlyResolved:!1,isNamespacePackage:!1,isStubPackage:!1,importFailureInfo:r,resolvedUris:[],importType:2,isStubFile:!1,isNativeLib:!1,implicitImports:[],filteredImplicitImports:[],nonStubImportResult:void 0}),i}_getCompletionSuggestionsRelative(e,t,n,a){const r=(0,f.getDirectoryLeadingDotsPointsTo)(e.getDirectory(),n.leadingDots);r&&this._getCompletionSuggestionsAbsolute(e,t,r,n,a)}_getFilesInDirectory(e){const t=this._cachedFilesForPath.get(e.key);if(t)return t;let n=[];try{const t=this.readdirEntriesCached(e),a=t.filter((e=>e.isFile()));t.forEach((t=>{var n;t.isSymbolicLink()&&(null===(n=(0,g.tryStat)(this.fileSystem,e.combinePaths(t.name)))||void 0===n?void 0:n.isFile())&&a.push(t)})),n=a.map((t=>e.combinePaths(t.name)))}catch{n=[]}return this._cachedFilesForPath.set(e.key,n),n}_getCompletionSuggestionsAbsolute(e,t,n,a,r,s=!0){let i=n;const o=a.nameParts.map((e=>e));a.hasTrailingDot&&o.push("");const l=a.leadingDots,p=o.slice(0,-1);if(0===o.length)this._addFilteredSuggestionsAbsolute(e,t,i,"",r,l,p,s);else for(let n=0;n<o.length&&(n===o.length-1&&this._addFilteredSuggestionsAbsolute(e,t,i,o[n],r,l,p,s),i=i.combinePaths(o[n]),this.dirExistsCached(i));n++);}_addFilteredSuggestionsAbsolute(e,t,n,a,r,s,i,o){const l=(0,g.getFileSystemEntriesFromDirEntries)(this.readdirEntriesCached(n),this.fileSystem,n);l.files.forEach((n=>{const l=n.stripAllExtensions().fileName;if(w.isSupportedImportFile(n)){if("__init__"===l)return;if(a&&!u.isPatternInSymbol(a,l))return;if(!this._isUniqueValidSuggestion(l,r)||!this._isResolvableSuggestion(l,s,i,e,t,o))return;r.set(l,n)}})),l.directories.forEach((n=>{const l=n.fileName;if(a&&!l.startsWith(a))return;if(!this._isUniqueValidSuggestion(l,r)||!this._isResolvableSuggestion(l,s,i,e,t,o))return;const p=n.initPyiUri;if(this.fileExistsCached(p))return void r.set(l,p);const c=n.initPyUri;this.fileExistsCached(c)?r.set(l,c):r.set(l,y.Uri.empty())}))}_isResolvableSuggestion(e,t,n,a,r,s){const i={leadingDots:t,nameParts:[...n,e],importedSymbols:new Set};let o;if(s){const e=this.formatImportName(i),t=[];o=this._resolveImportStrict(e,a,r,i,t)}else o=this.resolveImportInternal(a,r,i);return!(!o||!o.isImportFound||_.isPrivateOrProtectedName(e)&&void 0!==o.pyTypedInfo)}_isUniqueValidSuggestion(e,t){return!t.has(e)&&(!/[.-]/.test(e)&&(!(0,C.isDunderName)(e)||"__future__"===e))}_findImplicitImports(e,t,n){const a=new Map,r=(0,g.getFileSystemEntriesFromDirEntries)(this.readdirEntriesCached(t),this.fileSystem,t);for(const t of r.files){const r=t.lastExtension;let s,i=!1;if(".py"===r||".pyi"===r)s=(0,p.stripFileExtension)(t.fileName);else{if(!this._isNativeModuleFileExtension(r)||this.fileExistsCached(t.packageUri)||this.fileExistsCached(t.packageStubUri))continue;s=t.stripAllExtensions().fileName,i=!0}if(!n.find((e=>e.equals(t)))){const n={isStubFile:t.hasExtension(".pyi"),isNativeLib:i,name:s,uri:t},r=a.get(n.name);if(!r||!r.isStubFile){if(i){const a=t,r=this.resolveNativeImportEx(a,`${e}.${s}`,[]);r&&(n.uri=r,n.isNativeLib=!1)}a.set(n.name,n)}}}for(const e of r.directories){const t=e.initPyUri,r=e.initPyiUri;let s,i=!1;if(this.fileExistsCached(r)?(i=!0,s=r):this.fileExistsCached(t)&&(s=t),s&&!n.find((e=>e.equals(s)))){const t={isStubFile:i,isNativeLib:!1,name:e.fileName,uri:s,pyTypedInfo:this._getPyTypedInfo(e)};a.set(t.name,t)}}return a}_getPyTypedInfo(e){if(this.fileExistsCached(e.pytypedUri))return(0,v.getPyTypedInfoForPyTypedFile)(this.fileSystem,e.pytypedUri)}_resolveNativeModuleStub(e,t,n,a,r,s){let i=n;if(a.leadingDots>0){const n=this.getModuleNameForImport(e,t);i=n.moduleName.length>0?n.moduleName:i}const o=this.resolveNativeImportEx(e,i,r);return o?(r.push(`Resolved native import ${n} with stub '${o}'`),s.push(o),!1):(r.push(`Resolved import with file '${e}'`),s.push(e),!0)}_isNativeModuleFileName(e,t){const n=t.lastExtension.toLowerCase(),a=(0,p.stripFileExtension)(t.fileName,!0);return this._isNativeModuleFileExtension(n)&&(0,m.equateStringsCaseInsensitive)(e,a)}_isNativeModuleFileExtension(e){return I.some((t=>t===e))}_tryWalkUp(e){if(!e||e.isEmpty()||e.isRoot())return;const t=e.resolvePaths("..");return t.equals(e)?void 0:t}_shouldWalkUp(e,t,n){return e&&!e.isEmpty()&&(e.isChild(t)||e.equals(t)&&this._isDefaultWorkspace(n.root))}}t.ImportResolver=w},21440:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.haveSameParentModule=t.getResolvedFilePath=t.getDirectoryLeadingDotsPointsTo=t.getRelativeModuleName=t.getTextRangeForImportNameDeletion=t.getImportGroupFromModuleNameAndType=t.getAllImportNames=t.getContainingImportStatement=t.getTextEditsForAutoImportInsertion=t.getTextEditsForAutoImportInsertions=t.getTextEditsForAutoImportSymbolAddition=t.getTopLevelImports=t.compareImportStatements=t.getImportGroup=void 0;const i=n(64704),o=n(28040),l=n(96193),p=n(50356),c=n(55164),d=n(55084),u=n(80636),m=s(n(9316)),y=n(28340),g=s(n(80944));function h(e){return e.importResult?0===e.importResult.importType?0:1===e.importResult.importType||e.importResult.isLocalTypingsFile?1:e.importResult.isRelative?3:2:2}function f(e){return g.isConstantName(e)?0:g.isTypeAliasName(e)?1:2}function T(e,t){const n=f(e)-f(t);if(0!==n)return n;const a=e.replace(/_/g,"="),r=t.replace(/_/g,"=");return(0,p.compareStringsCaseSensitive)(a,r)}function v(e,t,n,a){let r;for(const t of n.imports){if(T(t.name.value,e)>0)break;r=t}let s=!1,i="";if(n.imports.length>0){const e=(0,l.convertOffsetToPosition)(n.start,a.tokenizerOutput.lines),t=(0,l.convertOffsetToPosition)(n.imports[0].start,a.tokenizerOutput.lines),r=n.imports.length>1?(0,l.convertOffsetToPosition)(n.imports[1].start,a.tokenizerOutput.lines):void 0;if(t.line>e.line&&(void 0===r||r.line>t.line)){const e=a.tokenizerOutput.lines.getItemAt(t.line);i=a.text.substr(e.start,t.character),/^\s*$/.test(i)&&(s=!0)}}const o=r?c.TextRange.getEnd(r):n.imports.length>0?n.imports[0].start:n.start+n.length,p=(0,l.convertOffsetToPosition)(o,a.tokenizerOutput.lines),d=t?`${e} as ${t}`:`${e}`;let u;if(s){const e=a.tokenizerOutput.predominantEndOfLineSequence;u=r?`,${e}${i}${d}`:`${d},${e}${i}`}else u=r?`, ${d}`:`${d}, `;return{range:{start:p,end:p},importName:e,replacementText:u}}function b(e,t){if(t.length<2)return t.map((e=>r(e)));const n=[...(0,o.createMapFromItems)(t,(e=>`${e.importGroup} ${c.Range.print(e.range)}`))].sort(((e,t)=>(0,p.compareStringsCaseSensitive)(e[0],t[0]))).map((e=>e[1])),a=[];for(const t of n)1===t.length?a.push(r(t[0])):a.push({range:t[0].range,replacementText:t[0].preChange+t.map((e=>e.importStatement)).sort(((e,t)=>s(e,t))).join(e.tokenizerOutput.predominantEndOfLineSequence)+t[0].postChange});return a;function r(e){return{range:e.range,replacementText:e.preChange+e.importStatement+e.postChange}}function s(e,t){const n=e.startsWith("import");return n===t.startsWith("import")?e<t?-1:1:n?-1:1}}function _(e,t,n,a,r,s){const i=[];0===(e=Array.isArray(e)?e:[e]).length&&e.push({});const p=(0,o.createMapFromItems)(e,(e=>e.name?"from":"import")),d=p.get("import");d&&m(d,(e=>`import ${e.join(", ")}`));const u=p.get("from");return u&&m(u,(e=>{var n;return`from ${null!==(n=t.nameForImportFrom)&&void 0!==n?n:t.name} import ${e.join(", ")}`})),i;function m(e,p){const d=e.map((e=>function(e,t){const n=e.name?e.name:t;return{sortText:n,text:e.alias?`${n} as ${e.alias}`:n}}(e,t.name))).sort(((e,t)=>T(e.sortText,t.sortText))).reduce(((e,t)=>(0,o.addIfUnique)(e,t.text)),[]);i.push(function(e,t,n,a,r,s){let i,o="",p="";const d=(0,l.convertPositionToOffset)(s,r.tokenizerOutput.lines);if(t.orderedImports.length>0&&d>t.orderedImports[0].node.start){let e=!0,s=t.orderedImports[0],d=0;for(const i of t.orderedImports){const l=i.importResult?h(i):d;if(a<l){!e&&d<a&&(o=r.tokenizerOutput.predominantEndOfLineSequence+o);break}if(a===l&&i.moduleName>n){e=!0,s=i;break}if(i.followsNonImportStatement){a>d&&(o=r.tokenizerOutput.predominantEndOfLineSequence+o);break}i===t.orderedImports[t.orderedImports.length-1]&&a>l&&(o=r.tokenizerOutput.predominantEndOfLineSequence+o),e=!e&&a<d&&a===l,d=l,s=i}s?(e?p+=r.tokenizerOutput.predominantEndOfLineSequence:o=r.tokenizerOutput.predominantEndOfLineSequence+o,i=(0,l.convertOffsetToPosition)(e?s.node.start:c.TextRange.getEnd(s.node),r.tokenizerOutput.lines)):i={line:0,character:0}}else{i={line:0,character:0};let e=!1;for(const t of r.parserOutput.parseTree.statements){let n=!0;if(47===t.nodeType&&1===t.statements.length){const e=t.statements[0];(48===e.nodeType||3===e.nodeType&&38===e.leftExpression.nodeType&&g.isDunderName(e.leftExpression.value))&&(n=!1)}if(n){i=(0,l.convertOffsetToPosition)(t.start,r.tokenizerOutput.lines),e=!1;break}i=(0,l.convertOffsetToPosition)(t.start+t.length,r.tokenizerOutput.lines),e=!0}p=p+r.tokenizerOutput.predominantEndOfLineSequence+r.tokenizerOutput.predominantEndOfLineSequence,e?o=r.tokenizerOutput.predominantEndOfLineSequence+o:p+=r.tokenizerOutput.predominantEndOfLineSequence}return{range:{start:i,end:i},preChange:o,importStatement:e,postChange:p,importGroup:a}}(p(d),n,t.name,a,r,s))}}function C(e){let t="";for(let n=0;n<e.leadingDots;n++)t+=".";return t+=e.nameParts.map((e=>e.value)).join("."),t}function I(e){let t=2;return e.isLocalTypingsFile||1===e.importType?t=1:0===e.importType&&(t=0),t}function k(e,t,n,a){const r=c.TextRange.getEnd(t),s=(0,y.getTokenAt)(e.tokenizerOutput.tokens,n.start);if(!s||!s.comments||0===s.comments.length){return[{start:r,length:c.TextRange.getEnd(a)-r}]}const i=(0,y.findTokenAfter)(e.tokenizerOutput,c.TextRange.getEnd(t),(e=>12===e.type));if(!i){return[{start:r,length:c.TextRange.getEnd(a)-r}]}const o=c.TextRange.getEnd(i)-r,l=c.TextRange.getEnd(s.comments[s.comments.length-1]);return[{start:r,length:o},{start:l,length:c.TextRange.getEnd(a)-l}]}t.getImportGroup=h,t.compareImportStatements=function(e,t){const n=h(e),a=h(t);return n<a?-1:n>a?1:e.moduleName<t.moduleName?-1:1},t.getTopLevelImports=function(e,t=!1){const n={orderedImports:[],mapByFilePath:new Map};let a=!1,r=!1;return e.statements.forEach((e=>{47===e.nodeType?e.statements.forEach((e=>{20===e.nodeType?(r=!0,function(e,t,n){e.list.forEach((a=>{const r=m.getImportInfo(a.module);let s;r&&r.isImportFound&&(s=r.resolvedUris[r.resolvedUris.length-1]);const i={node:e,subnode:a,importResult:r,resolvedPath:s,moduleName:C(a.module),followsNonImportStatement:n};t.orderedImports.push(i),s&&!s.isEmpty()&&(t.mapByFilePath.has(s.key)||t.mapByFilePath.set(s.key,i))}))}(e,n,a),a=!1):22===e.nodeType?(r=!0,function(e,t,n,a){var r;const s=m.getImportInfo(e.module);let i;s&&s.isImportFound&&(i=s.resolvedUris[s.resolvedUris.length-1]);if(a&&s){t.implicitImports=null!==(r=t.implicitImports)&&void 0!==r?r:new Map;for(const n of s.implicitImports.values()){const a=e.imports.find((e=>e.name.value===n.name));a&&t.implicitImports.set(n.uri.key,a)}}const o={node:e,importResult:s,resolvedPath:i,moduleName:C(e.module),followsNonImportStatement:n};if(t.orderedImports.push(o),i&&!i.isEmpty()){const e=t.mapByFilePath.get(i.key);(!e||20===e.node.nodeType||e.moduleName.length>o.moduleName.length)&&t.mapByFilePath.set(i.key,o)}}(e,n,a,t),a=!1):a=r})):a=r})),n},t.getTextEditsForAutoImportSymbolAddition=function(e,t,n){const a=[];if(!t.node||22!==t.node.nodeType||t.node.isWildcardImport)return a;const r=t.node;if(0===(e=(Array.isArray(e)?e:[e]).filter((e=>!!e.name&&!r.imports.some((t=>{var n;return t.name.value===e.name&&(null===(n=t.alias)||void 0===n?void 0:n.value)===e.alias}))))).length)return a;for(const r of e)a.push(v(r.name,r.alias,t.node,n));const s=(0,o.createMapFromItems)(a,(e=>c.Range.print(e.range))),i=[];for(const e of s.values())1===e.length?i.push(e[0]):i.push({range:e[0].range,replacementText:e.sort(((e,t)=>T(e.importName,t.importName))).map((e=>e.replacementText)).join("")});return i},t.getTextEditsForAutoImportInsertions=function(e,t,n,a){const r=[];if(0===(e=Array.isArray(e)?e:[e]).length)return[];const s=(0,o.createMapFromItems)(e,(e=>{var t;return`${e.module.moduleName}-${null!==(t=e.nameForImportFrom)&&void 0!==t?t:""}`}));for(const e of s.values())(0,o.appendArray)(r,_(e,{name:e[0].module.moduleName,nameForImportFrom:e[0].nameForImportFrom},t,I(e[0].module),n,a));return b(n,r)},t.getTextEditsForAutoImportInsertion=function(e,t,n,a,r,s){return b(r,_(e,t,n,a,r,s))},t.getContainingImportStatement=function(e,t){for(;e&&((0,i.throwIfCancellationRequested)(t),20!==e.nodeType&&22!==e.nodeType);)e=e.parent;return e},t.getAllImportNames=function(e){if(20===e.nodeType){return e.list}return e.imports},t.getImportGroupFromModuleNameAndType=I,t.getTextRangeForImportNameDeletion=function(e,t,...n){const a=[];for(const r of function(e){if(0===e.length)return[];if(1===e.length)return[{start:e[0],end:e[0]}];const t=[];let n=e[0],a=n;for(const r of e)a!==r&&(a+1!==r?(t.push({start:n,end:a}),n=r,a=r):a=r);return t.push({start:n,end:a}),t}(n)){const n=t[r.start],s=t[r.end];if(0===r.start&&t.length===r.end+1)a.push(c.TextRange.fromBounds(n.start,c.TextRange.getEnd(s)));else if(r.end===t.length-1){const i=t[r.start-1];a.push(...k(e,i,n,s))}else{const e=n.start,s=t[r.end+1].start-e;a.push({start:e,length:s})}}return a},t.getRelativeModuleName=function(e,t,n,a,r=!1,s){let i,o=t;(s=void 0!==s?s:(0,u.isFile)(e,t))&&(o=t.getDirectory());let l=n;if(a.stubPath&&l.isChild(a.stubPath)||a.typeshedPath&&l.isChild(a.typeshedPath))return;if(s){l=n.getDirectory();const e=n.stripAllExtensions().fileName;"__init__"!==e?i=e:r&&(i=l.fileName,l=l.getDirectory())}const p=o.getRelativePathComponents(l);let c=".";for(let e=0;e<p.length;e++){const t=p[e];c+=".."===t?".":t,".."!==t&&e!==p.length-1&&(c+=".")}return i&&(c="."===c[c.length-1]?c+i:c+"."+i),c},t.getDirectoryLeadingDotsPointsTo=function(e,t){let n=e;for(let e=1;e<t;e++){if(n.isRoot())return;n=n.getDirectory()}return n},t.getResolvedFilePath=function(e){if(e&&e.isImportFound&&0!==e.resolvedUris.length)return 1===e.resolvedUris.length&&e.resolvedUris[0].equals(d.Uri.empty())?e.packageDirectory?e.packageDirectory:e.searchPath?e.searchPath:void 0:e.resolvedUris[e.resolvedUris.length-1]},t.haveSameParentModule=function(e,t){if(e.length!==t.length)return!1;let n=0;for(n=0;n<e.length-1&&e[n]===t[n];n++);return n===e.length-1}},37356:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.updateNamedTupleBaseClass=t.createNamedTupleType=void 0;const i=n(97652),o=n(96193),l=n(55164),p=n(95960),c=n(71424),d=n(9316),u=s(n(28340)),m=n(21084),y=n(52328),g=n(808),h=n(8312);function f(e,t,n){let a=!1;return e.details.baseClasses=e.details.baseClasses.map((e=>{if(!(0,h.isInstantiableClass)(e)||!h.ClassType.isBuiltIn(e,"NamedTuple"))return e;const r=[];n?t.forEach((e=>{r.push({type:e,isUnbounded:!1})})):r.push({type:t.length>0?(0,h.combineTypes)(t):h.UnknownType.create(),isUnbounded:!0});const s=h.ClassType.cloneForSpecialization(e,void 0,n);return s.details={...s.details},s.details.baseClasses=s.details.baseClasses.map((e=>(0,h.isInstantiableClass)(e)&&h.ClassType.isBuiltIn(e,"tuple")?(0,g.specializeTupleClass)(e,r,n):e)),(0,g.computeMroLinearization)(s),a=!0,s})),a}function T(e,t,n,a,r){return c.Tokenizer.isPythonKeyword(t)?n?`_${r}`:(e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.namedTupleNameKeyword(),a),t):t}t.createNamedTupleType=function(e,t,n,a){var r,s,c;const v=(0,d.getFileInfo)(t);let b="namedtuple",_=!1;if(!a){const e=n.find((e=>{var t;return 0===e.argumentCategory&&"rename"===(null===(t=e.name)||void 0===t?void 0:t.value)}));if(null==e?void 0:e.valueExpression){!0===(0,m.evaluateStaticBoolExpression)(e.valueExpression,v.executionEnvironment,v.definedConstants)&&(_=!0)}}if(0===n.length)e.addDiagnostic(i.DiagnosticRule.reportCallIssue,p.LocMessage.namedTupleFirstArg(),t);else{const a=n[0];0!==a.argumentCategory?e.addDiagnostic(i.DiagnosticRule.reportArgumentType,p.LocMessage.namedTupleFirstArg(),n[0].valueExpression||t):a.valueExpression&&48===a.valueExpression.nodeType&&(b=a.valueExpression.strings.map((e=>e.value)).join(""))}const C=n.find((e=>{var t;return"defaults"===(null===(t=e.name)||void 0===t?void 0:t.value)}));let I=0;if(C&&C.valueExpression){const t=e.getTypeOfExpression(C.valueExpression).type;I=(0,h.isClassInstance)(t)&&(0,g.isTupleClass)(t)&&!(0,g.isUnboundedTupleClass)(t)&&t.tupleTypeArguments?t.tupleTypeArguments.length:void 0}const k=e.getTypingType(t,"NamedTuple")||h.UnknownType.create(),w=h.ClassType.createInstantiable(b,u.getClassFullName(t,v.moduleName,b),v.moduleName,v.fileUri,1107296256,u.getTypeSourceId(t),void 0,(0,h.isInstantiableClass)(k)?k.details.effectiveMetaclass:h.UnknownType.create());w.details.baseClasses.push(k),w.details.typeVarScopeId=u.getScopeIdForNode(t);const S=h.ClassType.getSymbolTable(w);S.set("__class__",y.Symbol.createWithType(68,w));const A=(0,g.synthesizeTypeVarForSelfCls)(w,!0),x=h.FunctionType.createSynthesizedInstance("__new__",1);x.details.declaredReturnType=(0,g.convertToInstance)(A),x.details.constructorTypeVarScopeId=w.details.typeVarScopeId,u.isAssignmentToDefaultsFollowingNamedTuple(t)&&(x.details.flags|=32),x.details.typeVarScopeId=w.details.typeVarScopeId,h.FunctionType.addParameter(x,{category:0,name:"cls",type:A,hasDeclaredType:!0});const P=[],N={category:0,name:"self",type:(0,g.synthesizeTypeVarForSelfCls)(w,!1),hasDeclaredType:!0};let D=!1;const F=[];if(n.length<2)e.addDiagnostic(i.DiagnosticRule.reportCallIssue,p.LocMessage.namedTupleSecondArg(),t),D=!0;else{const t=n[1];if(0!==t.argumentCategory)D=!0;else{if(!a&&t.valueExpression&&48===t.valueExpression.nodeType){const n=t.valueExpression.strings.map((e=>e.value)).join("").split(/[,\s]+/),r=void 0===I?0:Math.max(0,n.length-I);n.forEach(((n,s)=>{if(n=n.trim()){n=T(e,n,_,t.valueExpression,s);const i=h.UnknownType.create(),p={category:0,name:n,type:i,hasDeclaredType:a,hasDefault:s>=r};h.FunctionType.addParameter(x,p);const c=y.Symbol.createWithType(8,i);P.push(n);const d=t.valueExpression,u={type:1,node:d,isRuntimeTypeExpression:!0,uri:v.fileUri,range:(0,o.convertOffsetsToRange)(d.start,l.TextRange.getEnd(d),v.lines),moduleName:v.moduleName,isInExceptSuite:!1};c.addDeclaration(u),S.set(n,c),F.push(i)}}))}else if(31===(null===(r=t.valueExpression)||void 0===r?void 0:r.nodeType)||52===(null===(s=t.valueExpression)||void 0===s?void 0:s.nodeType)){const n=t.valueExpression,r=new Map,s=31===(null===(c=t.valueExpression)||void 0===c?void 0:c.nodeType)?t.valueExpression.entries:t.valueExpression.expressions,d=void 0===I?0:Math.max(0,s.length-I);s.forEach(((t,n)=>{let s,c,u,m="";if(a?52===t.nodeType&&2===t.expressions.length?(u=t.expressions[0],s=t.expressions[1],c=(0,g.convertToInstance)(e.getTypeOfExpressionExpectingType(s).type)):e.addDiagnostic(i.DiagnosticRule.reportArgumentType,p.LocMessage.namedTupleNameType(),t):(u=t,c=h.UnknownType.create()),u){const t=e.getTypeOfExpression(u);(0,h.isClassInstance)(t.type)&&h.ClassType.isBuiltIn(t.type,"str")&&(0,g.isLiteralType)(t.type)?(m=t.type.literalValue,m?m=T(e,m,_,u,n):e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.namedTupleEmptyName(),u)):D=!0}else D=!0;m||(m=`_${n.toString()}`),r.has(m)&&e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,p.LocMessage.namedTupleNameUnique(),u||t),r.set(m,m),c||(c=h.UnknownType.create());const f={category:0,name:m,type:c,hasDeclaredType:a,hasDefault:n>=d};h.FunctionType.addParameter(x,f),F.push(c),P.push(m);const b=y.Symbol.createWithType(2056,c);if(u&&48===u.nodeType){const e={type:1,node:u,uri:v.fileUri,typeAnnotationNode:s,range:(0,o.convertOffsetsToRange)(u.start,l.TextRange.getEnd(u),v.lines),moduleName:v.moduleName,isInExceptSuite:!1};b.addDeclaration(e)}S.set(m,b)})),e.setTypeResultForNode(n,{type:h.UnknownType.create()})}else D=!0;t.valueExpression&&!D&&e.setTypeResultForNode(t.valueExpression,{type:h.AnyType.create()})}}D&&(x.details.parameters=[],h.FunctionType.addDefaultParameters(x),F.push(h.AnyType.create(!1)),F.push(h.AnyType.create(!0)));const E=h.FunctionType.createSynthesizedInstance("__init__");h.FunctionType.addParameter(E,N),h.FunctionType.addDefaultParameters(E),E.details.declaredReturnType=e.getNoneType(),E.details.constructorTypeVarScopeId=w.details.typeVarScopeId,S.set("__new__",y.Symbol.createWithType(4,x)),S.set("__init__",y.Symbol.createWithType(4,E));const M=h.FunctionType.createSynthesizedInstance("__len__");if(M.details.declaredReturnType=e.getBuiltInObject(t,"int"),h.FunctionType.addParameter(M,N),S.set("__len__",y.Symbol.createWithType(4,M)),D){const n=h.FunctionType.createSynthesizedInstance("__getattribute__");n.details.declaredReturnType=h.AnyType.create(),h.FunctionType.addParameter(n,N),h.FunctionType.addParameter(n,{category:0,name:"name",type:e.getBuiltInObject(t,"str")}),S.set("__getattribute__",y.Symbol.createWithType(4,n))}const O=e.getBuiltInType(t,"tuple"),z=e.getBuiltInType(t,"str");if(!D&&z&&(0,h.isInstantiableClass)(z)&&O&&(0,h.isInstantiableClass)(O)){const e=P.map((e=>({type:h.ClassType.cloneAsInstance(h.ClassType.cloneWithLiteral(z,e)),isUnbounded:!1}))),t=h.ClassType.cloneAsInstance((0,g.specializeTupleClass)(O,e));S.set("__match_args__",y.Symbol.createWithType(4,t))}return f(w,F,!D),(0,g.computeMroLinearization)(w),w},t.updateNamedTupleBaseClass=f},86084:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTypeOfTernaryOperation=t.getTypeOfUnaryOperation=t.getTypeOfAugmentedAssignment=t.getTypeOfBinaryOperation=t.validateBinaryOperation=void 0;const a=n(72484),r=n(97652),s=n(61328),i=n(95960),o=n(9316),l=n(28340),p=n(69160),c=n(21084),d=n(808),u=n(8312),m={0:["__add__","__radd__"],33:["__sub__","__rsub__"],26:["__mul__","__rmul__"],13:["__floordiv__","__rfloordiv__"],10:["__truediv__","__rtruediv__"],24:["__mod__","__rmod__"],29:["__pow__","__rpow__"],22:["__matmul__","__rmatmul__"],3:["__and__","__rand__"],6:["__or__","__ror__"],8:["__xor__","__rxor__"],17:["__lshift__","__rlshift__"],31:["__rshift__","__rrshift__"],12:["__eq__","__eq__"],28:["__ne__","__ne__"],20:["__lt__","__gt__"],21:["__le__","__ge__"],15:["__gt__","__lt__"],16:["__ge__","__le__"]},y={36:!0,37:!0,39:!0,40:!0,41:!0,42:!0},g=64;function h(e,t,n,a,r,s,o,p){const c=n.type,h=a.type;let f,v=e.makeTopLevelTypeVarsConcrete(c);if(void 0!==y[t]){if(36===t){if(!e.canBeTruthy(v))return c;if(!e.canBeFalsy(v))return h;if(v=e.removeTruthinessFromType(v),(0,u.isNever)(h))return v}else if(37===t){if(!e.canBeFalsy(v))return c;if(!e.canBeTruthy(v))return h;if(v=e.removeFalsinessFromType(v),(0,u.isNever)(h))return v}if((0,u.isNever)(c)||(0,u.isNever)(h))return u.NeverType.createNever();41===t||42===t?(f=e.mapSubtypesExpandTypeVars(h,void 0,((s,p)=>e.mapSubtypesExpandTypeVars(v,{conditionFilter:(0,d.getTypeCondition)(s)},(c=>{var m;if((0,u.isAnyOrUnknown)(c)||(0,u.isAnyOrUnknown)(p))return(0,d.preserveUnknown)(c,s);let y=e.getTypeOfMagicMethodCall(s,"__contains__",[{type:c,isIncomplete:n.isIncomplete}],r,void 0);if(!y){const t=null===(m=e.getTypeOfIterator({type:s,isIncomplete:a.isIncomplete},!1,r,!1))||void 0===m?void 0:m.type;t&&e.assignType(t,c)&&(y=e.getBuiltInObject(r,"bool"))}return y||o.addMessage(i.LocMessage.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(t),leftType:e.printType(c),rightType:e.printType(s)})),y})))),f&&!(0,u.isNever)(f)&&(f=e.getBuiltInObject(r,"bool"))):f=e.mapSubtypesExpandTypeVars(v,void 0,((n,a)=>e.mapSubtypesExpandTypeVars(h,{conditionFilter:(0,d.getTypeCondition)(n)},((n,s)=>36===t||37===t?(0,u.combineTypes)([a,s]):e.getBuiltInObject(r,"bool")))))}else if(m[t]){if((0,u.isNever)(c)||(0,u.isNever)(h))return u.NeverType.createNever();if(p.isLiteralMathAllowed){const e=(0,d.getLiteralTypeClassName)(c);if(e&&!(0,d.getTypeCondition)(c)){if(e===(0,d.getLiteralTypeClassName)(h)&&!(0,d.getTypeCondition)(h)&&(0,d.getUnionSubtypeCount)(c)*(0,d.getUnionSubtypeCount)(h)<g)if("str"===e||"bytes"===e)0===t&&(f=(0,d.mapSubtypes)(c,(e=>(0,d.mapSubtypes)(h,(t=>{const n=e,a=t;return u.ClassType.cloneWithLiteral(n,n.literalValue+a.literalValue)})))));else if("int"===e&&(0===t||33===t||26===t||13===t||24===t)){let e=!0;f=(0,d.mapSubtypes)(c,(n=>(0,d.mapSubtypes)(h,(a=>{try{const r=n,s=a,i=BigInt(r.literalValue),o=BigInt(s.literalValue);let l;return 0===t?l=i+o:33===t?l=i-o:26===t?l=i*o:13===t?o!==BigInt(0)&&(l=i/o):24===t&&o!==BigInt(0)&&(l=i%o),void 0===l||"number"==typeof l&&isNaN(l)?void(e=!1):(l>=Number.MIN_SAFE_INTEGER&&l<=Number.MAX_SAFE_INTEGER&&(l=Number(l)),u.ClassType.cloneWithLiteral(r,l))}catch{return void(e=!1)}})))),e||(f=void 0)}}}f||(f=e.mapSubtypesExpandTypeVars(c,void 0,((c,y)=>e.mapSubtypesExpandTypeVars(h,{conditionFilter:(0,d.getTypeCondition)(c)},((g,h)=>{if((0,u.isAnyOrUnknown)(y)||(0,u.isAnyOrUnknown)(h))return(0,d.preserveUnknown)(y,h);const f=e.getTupleClassType();if(p.isTupleAddAllowed&&0===t&&(0,u.isClassInstance)(c)&&(0,d.isTupleClass)(c)&&c.tupleTypeArguments&&(0,u.isClassInstance)(g)&&(0,d.isTupleClass)(g)&&g.tupleTypeArguments&&f&&(0,u.isInstantiableClass)(f)&&(!(0,d.isUnboundedTupleClass)(c)||!(0,d.isUnboundedTupleClass)(g)))return u.ClassType.cloneAsInstance((0,d.specializeTupleClass)(f,[...c.tupleTypeArguments,...g.tupleTypeArguments]));const v=m[t][0];let b=e.getTypeOfMagicMethodCall(T(e,y),v,[{type:h,isIncomplete:a.isIncomplete}],r,s);if(b||y===c||(b=e.getTypeOfMagicMethodCall(T(e,c),v,[{type:h,isIncomplete:a.isIncomplete}],r,s)),b||h===g||(b=e.getTypeOfMagicMethodCall(T(e,c),v,[{type:g,isIncomplete:a.isIncomplete}],r,s)),!b){const a=m[t][1];b=e.getTypeOfMagicMethodCall(T(e,h),a,[{type:y,isIncomplete:n.isIncomplete}],r,s),b||h===g||(b=e.getTypeOfMagicMethodCall(T(e,g),a,[{type:y,isIncomplete:n.isIncomplete}],r,s)),b||y===c||(b=e.getTypeOfMagicMethodCall(T(e,g),a,[{type:c,isIncomplete:n.isIncomplete}],r,s))}return b||(s?o.addMessage(i.LocMessage.typeNotSupportBinaryOperatorBidirectional().format({operator:(0,l.printOperator)(t),leftType:e.printType(c),rightType:e.printType(g),expectedType:e.printType(s.expectedType)})):o.addMessage(i.LocMessage.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(t),leftType:e.printType(c),rightType:e.printType(g)}))),b})))))}return null!=f?f:u.UnknownType.create()}function f(e,t){if(!(0,u.isInstantiableClass)(e))return!1;const n=e.details.effectiveMetaclass;if(!n||!(0,u.isInstantiableClass)(n))return!1;if(u.ClassType.isBuiltIn(n,"type"))return!1;const a=(0,d.lookUpClassMember)(n,t);return!!a&&(!(0,u.isAnyOrUnknown)(a.classType)&&(!(0,u.isInstantiableClass)(a.classType)||!u.ClassType.isBuiltIn(a.classType,"type")))}function T(e,t){return(0,u.isFunction)(t)||(0,u.isOverloadedFunction)(t)?e.getObjectType():t}t.validateBinaryOperation=h,t.getTypeOfBinaryOperation=function e(t,n,p,c){const m=n.leftExpression;let g=n.rightExpression,T=!1,v=!1;(0,l.operatorSupportsChaining)(n.operator)&&7===g.nodeType&&!g.parenthesized&&(0,l.operatorSupportsChaining)(g.operator)&&(e(t,g,p,c),g=g.leftExpression);let b,_=37===n.operator||36===n.operator?null==c?void 0:c.expectedType:void 0;26===n.operator&&c&&(0,u.isClassInstance)(c.expectedType)&&u.ClassType.isBuiltIn(c.expectedType,"list")&&c.expectedType.typeArguments&&c.expectedType.typeArguments.length>=1&&31===n.leftExpression.nodeType&&(b=c.expectedType);const C=null!=_?_:b,I=t.getTypeOfExpression(m,p,(0,d.makeInferenceContext)(C));let k=I.type;_||(37===n.operator||36===n.operator?(0,d.someSubtypes)(k,(e=>!!(0,u.isClassInstance)(e)&&(u.ClassType.isTypedDictClass(e)||e.details.typeParameters.length>0)))&&(_=k):(0===n.operator&&31===n.rightExpression.nodeType||6===n.operator&&(0,u.isClassInstance)(k)&&u.ClassType.isTypedDictClass(k))&&(_=k));const w=t.getTypeOfExpression(g,p,(0,d.makeInferenceContext)(_));let S=w.type;if((I.isIncomplete||w.isIncomplete)&&(T=!0),6===n.operator&&!f(k,"__or__")&&!f(S,"__ror__")){let e=S,a=k;if(!(0,d.isNoneInstance)(k)&&(0,d.isNoneInstance)(S)?e=(0,d.convertToInstantiable)(t.getNoneType()):!(0,d.isNoneInstance)(S)&&(0,d.isNoneInstance)(k)&&(a=(0,d.convertToInstantiable)(t.getNoneType())),(0,d.isUnionableType)([a,e])){const l=(0,o.getFileInfo)(n);l.isStubFile||0!=(4&p)||l.executionEnvironment.pythonVersion.isGreaterOrEqualTo(s.pythonVersion3_10)||(0,u.isAnyOrUnknown)(a)||t.addDiagnostic(r.DiagnosticRule.reportGeneralTypeIssues,i.LocMessage.unionSyntaxIllegal(),n,n.operatorToken);const c=t.validateTypeArg({...I,node:m}),d=t.validateTypeArg({...w,node:g});if(!c||!d)return{type:u.UnknownType.create()};a=t.reportMissingTypeArguments(n.leftExpression,a,128|p),e=t.reportMissingTypeArguments(n.rightExpression,e,128|p);let y=(0,u.combineTypes)([a,e]);const h=t.getUnionClassType();if(h&&(0,u.isInstantiableClass)(h)&&(y=u.TypeBase.cloneAsSpecialForm(y,u.ClassType.cloneAsInstance(h))),!l.isStubFile){let e,n,a;if(48===m.nodeType?(e=m,n=g,a=S):48===g.nodeType&&(e=g,n=m,a=k),e&&n&&a){let n=!0;(0,u.isClass)(a)&&(a.isTypeArgumentExplicit&&!(0,u.isClassInstance)(a)||(n=!1)),n||t.addDiagnostic(r.DiagnosticRule.reportGeneralTypeIssues,i.LocMessage.unionForwardReferenceNotAllowed(),e)}}return{type:y}}}if(0!=(256&p)&&6!==n.operator)return t.addDiagnostic(r.DiagnosticRule.reportInvalidTypeForm,i.LocMessage.binaryOperationNotAllowed(),n),{type:u.UnknownType.create()};let A=!1;void 0===y[n.operator]&&(12===n.operator||28===n.operator?k=(0,d.removeNoneFromUnion)(k):A=(0,d.isOptionalType)(k),12!==n.operator&&28!==n.operator||(S=(0,d.removeNoneFromUnion)(S)));const x=new a.DiagnosticAddendum,P=!(0,l.isWithinLoop)(n)&&!(0,l.getEnclosingLambda)(n),N=!(0,u.isUnion)(k);let D=h(t,n.operator,{type:k,isIncomplete:I.isIncomplete},{type:S,isIncomplete:w.isIncomplete},n,c,x,{isLiteralMathAllowed:P,isTupleAddAllowed:N});if(!x.isEmpty()){if(v=!0,!T)if(A&&1===x.getMessages().length)t.addDiagnostic(r.DiagnosticRule.reportOptionalOperand,i.LocMessage.noneOperator().format({operator:(0,l.printOperator)(n.operator)}),n.leftExpression);else{let e="";((0,u.isUnion)(t.makeTopLevelTypeVarsConcrete(k))||(0,u.isUnion)(t.makeTopLevelTypeVarsConcrete(S)))&&(e=x.getString()),t.addDiagnostic(r.DiagnosticRule.reportOperatorIssue,i.LocMessage.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(n.operator),leftType:t.printType(k),rightType:t.printType(S)})+e,n)}D=u.UnknownType.create()}return{type:D,isIncomplete:T,typeErrors:v}},t.getTypeOfAugmentedAssignment=function(e,t,n){const s={1:["__iadd__",0],34:["__isub__",33],27:["__imul__",26],14:["__ifloordiv__",13],11:["__itruediv__",10],25:["__imod__",24],30:["__ipow__",29],23:["__imatmul__",22],4:["__iand__",3],7:["__ior__",6],9:["__ixor__",8],18:["__ilshift__",17],32:["__irshift__",31]};let o,c;const m=new a.DiagnosticAddendum,y=e.getTypeOfExpression(t.leftExpression),f=y.type;let T;7===t.operator&&(T=f);const v=e.getTypeOfExpression(t.rightExpression,void 0,(0,d.makeInferenceContext)(T)),b=v.type,_=!!v.isIncomplete||!!y.isIncomplete;return(0,u.isNever)(f)||(0,u.isNever)(b)?c={type:u.NeverType.createNever(),isIncomplete:_}:(o=e.mapSubtypesExpandTypeVars(f,void 0,((a,r)=>e.mapSubtypesExpandTypeVars(b,{conditionFilter:(0,d.getTypeCondition)(a)},((i,o)=>{if((0,u.isAnyOrUnknown)(r)||(0,u.isAnyOrUnknown)(o))return(0,d.preserveUnknown)(r,o);const c=s[t.operator][0];let T=e.getTypeOfMagicMethodCall(r,c,[{type:o,isIncomplete:v.isIncomplete}],t,n);if(T||r===a||(T=e.getTypeOfMagicMethodCall(a,c,[{type:o,isIncomplete:v.isIncomplete}],t,n)),T||o===i||(T=e.getTypeOfMagicMethodCall(a,c,[{type:i,isIncomplete:v.isIncomplete}],t,n)),!T){const a=s[t.operator][1],i=!(0,l.isWithinLoop)(t)&&function(e,t){if(38!==t.nodeType)return!1;const n=e.lookUpSymbolRecursive(t,t.value,!1);if(!n)return!1;const a=(0,p.getScopeForNode)(t);return a===n.scope}(e,t.leftExpression)&&(0,d.getUnionSubtypeCount)(f)*(0,d.getUnionSubtypeCount)(b)<g,c=!(0,u.isUnion)(f);T=h(e,a,{type:r,isIncomplete:y.isIncomplete},{type:o,isIncomplete:v.isIncomplete},t,n,m,{isLiteralMathAllowed:i,isTupleAddAllowed:c})}return T})))),m.isEmpty()&&o&&!(0,u.isNever)(o)||(_||e.addDiagnostic(r.DiagnosticRule.reportOperatorIssue,i.LocMessage.typeNotSupportBinaryOperator().format({operator:(0,l.printOperator)(t.operator),leftType:e.printType(f),rightType:e.printType(b)})+m.getString(),t),o=u.UnknownType.create()),c={type:o,isIncomplete:_}),e.assignTypeToExpression(t.destExpression,c.type,!!c.isIncomplete,t.rightExpression),c},t.getTypeOfUnaryOperation=function(e,t,n,a){if(0!=(256&n))return e.addDiagnostic(r.DiagnosticRule.reportInvalidTypeForm,i.LocMessage.unaryOperationNotAllowed(),t),{type:u.UnknownType.create()};const s=e.getTypeOfExpression(t.expression);let o=e.makeTopLevelTypeVarsConcrete((0,d.transformPossibleRecursiveTypeAlias)(s.type));const p=s.isIncomplete;if((0,u.isNever)(o))return{type:u.NeverType.createNever(),isIncomplete:p};const c={0:"__pos__",33:"__neg__",5:"__invert__"};let m;if(38!==t.operator&&(0,d.isOptionalType)(o)&&(e.addDiagnostic(r.DiagnosticRule.reportOptionalOperand,i.LocMessage.noneOperator().format({operator:(0,l.printOperator)(t.operator)}),t.expression),o=(0,d.removeNoneFromUnion)(o)),!s.isIncomplete){const e=(0,d.getLiteralTypeClassName)(o);"int"===e?0===t.operator?m=o:33===t.operator&&(m=(0,d.mapSubtypes)(o,(e=>{const t=e;return u.ClassType.cloneWithLiteral(t,-t.literalValue)}))):"bool"===e&&38===t.operator&&(m=(0,d.mapSubtypes)(o,(e=>{const t=e;return u.ClassType.cloneWithLiteral(t,!t.literalValue)})))}if(!m)if(38===t.operator)m=e.getBuiltInObject(t,"bool"),m||(m=u.UnknownType.create());else{if((0,u.isAnyOrUnknown)(o))m=o;else{const n=c[t.operator];let r=!0;m=e.mapSubtypesExpandTypeVars(o,void 0,(s=>{const i=e.getTypeOfMagicMethodCall(s,n,[],t,a);return i||(r=!1),i})),r||(m=void 0)}m||(p||(a?e.addDiagnostic(r.DiagnosticRule.reportOperatorIssue,i.LocMessage.typeNotSupportUnaryOperatorBidirectional().format({operator:(0,l.printOperator)(t.operator),type:e.printType(o),expectedType:e.printType(a.expectedType)}),t):e.addDiagnostic(r.DiagnosticRule.reportOperatorIssue,i.LocMessage.typeNotSupportUnaryOperator().format({operator:(0,l.printOperator)(t.operator),type:e.printType(o)}),t)),m=u.UnknownType.create())}return{type:m,isIncomplete:p}},t.getTypeOfTernaryOperation=function(e,t,n,a){const s=(0,o.getFileInfo)(t);if(0!=(256&n))return e.addDiagnostic(r.DiagnosticRule.reportInvalidTypeForm,i.LocMessage.ternaryNotAllowed(),t),{type:u.UnknownType.create()};e.getTypeOfExpression(t.testExpression);const l=[];let p=!1,d=!1;const m=(0,c.evaluateStaticBoolExpression)(t.testExpression,s.executionEnvironment,s.definedConstants);if(!1!==m&&e.isNodeReachable(t.ifExpression)){const r=e.getTypeOfExpression(t.ifExpression,n,a);l.push(r.type),r.isIncomplete&&(p=!0),r.typeErrors&&(d=!0)}if(!0!==m&&e.isNodeReachable(t.elseExpression)){const r=e.getTypeOfExpression(t.elseExpression,n,a);l.push(r.type),r.isIncomplete&&(p=!0),r.typeErrors&&(d=!0)}return{type:(0,u.combineTypes)(l),isIncomplete:p,typeErrors:d}}},92488:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isParamSpecKwargsArgument=t.isParamSpecArgsArgument=t.getParameterListDetails=t.firstParametersExcludingSelf=t.ParameterSource=t.isTypedKwargs=void 0;const a=n(80944),r=n(8312),s=n(808);var i;t.isTypedKwargs=function(e){return 2===e.category&&(0,r.isClassInstance)(e.type)&&(0,r.isUnpackedClass)(e.type)&&r.ClassType.isTypedDictClass(e.type)&&!!e.type.details.typedDictEntries},function(e){e[e.PositionOnly=0]="PositionOnly",e[e.PositionOrKeyword=1]="PositionOrKeyword",e[e.KeywordOnly=2]="KeywordOnly"}(i||(t.ParameterSource=i={})),t.firstParametersExcludingSelf=function(e){return e.details.parameters.find((e=>!((0,r.isTypeVar)(e.type)&&e.type.details.isSynthesizedSelf)))},t.getParameterListDetails=function(e){const t={firstPositionOrKeywordIndex:0,positionParamCount:0,positionOnlyParamCount:0,params:[],hasUnpackedVariadicTypeVar:!1,hasUnpackedTypedDict:!1,paramSpec:e.details.paramSpec};let n=e.details.parameters.findIndex((e=>(0,r.isPositionOnlySeparator)(e)));if(n<0)for(let t=0;t<e.details.parameters.length;t++){const s=e.details.parameters[t];if(0!==s.category)break;if(!s.name)break;if(!(0,a.isDunderName)(s.name)&&s.name.startsWith("__"))n=t+1;else if(t>0||r.FunctionType.isStaticMethod(e))break}for(let a=0;a<n&&!e.details.parameters[a].hasDefault;a++)t.positionOnlyParamCount++;let o=!1;const l=(a,s,l,p,c)=>{if(a.name){let d;d=void 0!==c?c:1===a.category?i.PositionOnly:o?i.KeywordOnly:n>=0&&s<n?i.PositionOnly:i.PositionOrKeyword,t.params.push({param:a,index:s,type:null!=l?l:r.FunctionType.getEffectiveParameterType(e,s),defaultArgType:p,source:d})}};if(e.details.parameters.forEach(((a,p)=>{var c,d;if(1===a.category){const s=r.FunctionType.getEffectiveParameterType(e,p);if(a.name&&(0,r.isUnpackedClass)(s)&&s.tupleTypeArguments){const e=p<t.positionOnlyParamCount;s.tupleTypeArguments.forEach(((n,s)=>{const o=(0,r.isVariadicTypeVar)(n.type)||n.isUnbounded?1:0;1===o&&(t.argsIndex=t.params.length),(0,r.isVariadicTypeVar)(a.type)&&(t.hasUnpackedVariadicTypeVar=!0),l({category:o,name:`${a.name}[${s.toString()}]`,isNameSynthesized:!0,type:n.type,hasDeclaredType:!0},p,n.type,void 0,i.PositionOnly),0===o&&t.positionParamCount++,s>0&&e&&t.positionOnlyParamCount++})),!o&&(n<0||p>=n)&&(t.firstKeywordOnlyIndex=t.params.length,o=!0)}else a.name&&void 0===t.argsIndex&&(t.argsIndex=t.params.length,(0,r.isVariadicTypeVar)(a.type)&&(t.hasUnpackedVariadicTypeVar=!0)),!o&&(n<0||p>=n)&&(t.firstKeywordOnlyIndex=t.params.length,a.name&&t.firstKeywordOnlyIndex++,o=!0),l(a,p)}else if(2===a.category){o=!0;const n=r.FunctionType.getEffectiveParameterType(e,p);if((0,r.isClassInstance)(n)&&(0,r.isUnpackedClass)(n)&&n.details.typedDictEntries){void 0===t.firstKeywordOnlyIndex&&(t.firstKeywordOnlyIndex=t.params.length);const e=n;n.details.typedDictEntries.knownItems.forEach(((t,n)=>{const a=(0,s.partiallySpecializeType)(t.valueType,e);l({category:0,name:n,type:a,hasDeclaredType:!0,hasDefault:!t.isRequired},p,a)})),n.details.typedDictEntries.extraItems&&(l({category:2,name:"kwargs",type:n.details.typedDictEntries.extraItems.valueType,hasDeclaredType:!0,hasDefault:!1},p,n.details.typedDictEntries.extraItems.valueType),t.kwargsIndex=t.params.length-1),t.hasUnpackedTypedDict=!0,t.unpackedKwargsTypedDictType=n}else a.name&&(void 0===t.kwargsIndex&&(t.kwargsIndex=t.params.length),void 0===t.firstKeywordOnlyIndex&&(t.firstKeywordOnlyIndex=t.params.length),l(a,p))}else 0===a.category&&(a.name&&!o&&t.positionParamCount++,l(a,p,void 0,(null===(c=e.specializedTypes)||void 0===c?void 0:c.parameterDefaultArgs)?null===(d=e.specializedTypes)||void 0===d?void 0:d.parameterDefaultArgs[p]:void 0))})),t.params.length>=2){const e=t.params[t.params.length-2].param,n=t.params[t.params.length-1].param;1===e.category&&(0,r.isTypeVar)(e.type)&&"args"===e.type.paramSpecAccess&&2===n.category&&(0,r.isTypeVar)(n.type)&&"kwargs"===n.type.paramSpecAccess&&(t.paramSpec=r.TypeVarType.cloneForParamSpecAccess(e.type,void 0))}return t.firstPositionOrKeywordIndex=t.params.findIndex((e=>e.source!==i.PositionOnly)),t.firstPositionOrKeywordIndex<0&&(t.firstPositionOrKeywordIndex=t.params.length),t},t.isParamSpecArgsArgument=function(e,t){let n=!0;return(0,s.doForEachSubtype)(t,(t=>{(0,r.isParamSpec)(t)&&"args"===t.paramSpecAccess&&(0,r.isTypeSame)(t,e,{ignoreTypeFlags:!0})||(0,r.isClassInstance)(t)&&t.tupleTypeArguments&&1===t.tupleTypeArguments.length&&t.tupleTypeArguments[0].isUnbounded&&(0,r.isAnyOrUnknown)(t.tupleTypeArguments[0].type)||(0,r.isAnyOrUnknown)(t)||(n=!1)})),n},t.isParamSpecKwargsArgument=function(e,t){let n=!0;return(0,s.doForEachSubtype)(t,(t=>{(0,r.isParamSpec)(t)&&"kwargs"===t.paramSpecAccess&&(0,r.isTypeSame)(t,e,{ignoreTypeFlags:!0})||(0,r.isClassInstance)(t)&&r.ClassType.isBuiltIn(t,"dict")&&t.typeArguments&&2===t.typeArguments.length&&(0,r.isClassInstance)(t.typeArguments[0])&&r.ClassType.isBuiltIn(t.typeArguments[0],"str")&&(0,r.isAnyOrUnknown)(t.typeArguments[1])||(0,r.isAnyOrUnknown)(t)||(n=!1)})),n}},88288:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParentDirectoryCache=void 0;const a=n(28040);t.ParentDirectoryCache=class{constructor(e){this._importRootGetter=e,this._importChecked=new Map,this._cachedResults=new Map,this._libPathCache=void 0}getImportResult(e,t,n){var a,r,s,i;const o=null===(a=this._cachedResults.get(t))||void 0===a?void 0:a.get(e.key);if(o)return o;const l=null===(r=this._importChecked.get(t))||void 0===r?void 0:r.get(e.key);return l?l.importPath&&null!==(i=null===(s=this._cachedResults.get(t))||void 0===s?void 0:s.get(l.importPath.key))&&void 0!==i?i:n:void 0}checkValidPath(e,t,n){var a;return!!t.startsWith(n)&&(this._libPathCache=null!==(a=this._libPathCache)&&void 0!==a?a:this._importRootGetter().map((t=>e.realCasePath(t))).filter((e=>e!==n)).filter((e=>e.startsWith(n))),!this._libPathCache.some((e=>t.startsWith(e))))}checked(e,t,n){(0,a.getOrAdd)(this._importChecked,t,(()=>new Map)).set(e.key,n)}add(e){(0,a.getOrAdd)(this._cachedResults,e.importName,(()=>new Map)).set(e.path.key,e.importResult)}reset(){this._importChecked.clear(),this._cachedResults.clear(),this._libPathCache=void 0}}},75108:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTreeCleanerWalker=void 0;const i=s(n(9316)),o=n(78232);class l extends o.ParseTreeWalker{constructor(e){super(),this._parseTree=e}clean(){this.walk(this._parseTree)}visitNode(e){return i.cleanNodeAnalysisInfo(e),super.visitNode(e)}}t.ParseTreeCleanerWalker=l},28340:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getTokenIndexAtLeft=t.getCallNodeAndActiveParameterIndex=t.getEnclosingParameter=t.CallNodeWalker=t.NameNodeWalker=t.isAssignmentToDefaultsFollowingNamedTuple=t.isDocString=t.getDocString=t.isWithinAssertExpression=t.isWithinLoop=t.isWithinAnnotationComment=t.isWithinTypeAnnotation=t.isWithinDefaultParamInitializer=t.isPartialMatchingExpression=t.isMatchingExpression=t.containsAwaitNode=t.isSuiteEmpty=t.isNodeContainedWithinNodeType=t.getParentAnnotationNode=t.getParentNodeOfType=t.isNodeContainedWithin=t.isRequiredAllowedForAssignmentTarget=t.isClassVarAllowedForAssignmentTarget=t.isFinalAllowedForAssignmentTarget=t.getArgumentsByRuntimeOrder=t.getTypeAnnotationNode=t.getExecutionScopeNode=t.getTypeVarScopeNode=t.getEvaluationScopeNode=t.getEvaluationNodeForAssignmentExpression=t.getEnclosingSuiteOrModule=t.getEnclosingClassOrFunction=t.getEnclosingLambda=t.getEnclosingFunctionEvaluationScope=t.getEnclosingFunction=t.getEnclosingClassOrModule=t.getEnclosingModule=t.getEnclosingClass=t.getEnclosingSuite=t.getDecoratorForName=t.getCallForName=t.printOperator=t.printExpression=t.printArgument=t.getTypeSourceId=t.getClassFullName=t.isCompliantWithNodeRangeRules=t.findNodeByOffset=t.findNodeByPosition=t.getNodeDepth=void 0,t.isSimpleDefault=t.checkDecorator=t.getTypeVarScopesForNode=t.getScopeIdForNode=t.getVariableDocStringNode=t.operatorSupportsChaining=t.isValidLocationForFutureImport=t.isUnannotatedFunction=t.isBlankLine=t.getFullStatementRange=t.getStringValueRange=t.getStringNodeValueRange=t.isLastNameOfDottedName=t.isFirstNameOfDottedName=t.getFirstNameOfDottedName=t.getDottedName=t.getDecoratorName=t.getDottedNameWithGivenNodeAsLastName=t.getFirstAncestorOrSelf=t.getFirstAncestorOrSelfOfKind=t.getAncestorsIncludingSelf=t.isLastNameOfModuleName=t.isFromImportAlias=t.isFromImportName=t.isFromImportModuleName=t.isImportAlias=t.isImportModuleName=t.getTypeAnnotationForParameter=t.isFunctionSuiteEmpty=t.getFileInfoFromNode=t.getModuleNode=t.isWriteAccess=t.printParseNodeType=t.getCommentsAtTokenIndex=t.findTokenAfter=t.getIndexOfTokenOverlapping=t.getTokenOverlapping=t.getTokenAt=t.getTokenAtIndex=t.isWhitespace=t.getTokenAtLeft=void 0;const i=s(n(9316)),o=n(86016),l=n(83181),p=n(96193),c=n(55164),d=n(48256),u=n(79428),m=n(9316),y=n(78232);function g(e,t){if(t<e.start||t>c.TextRange.getEnd(e))return;let n=(0,y.getChildNodes)(e);if(h(e)&&n.length>20){const e=(0,d.getIndexContaining)(n,t);e>=0&&(n=[n[e]])}for(const a of n){if(!a)continue;const n=g(a,t);if(n)return 5===e.nodeType&&n===e.leftExpression?e.destExpression:n}return e}function h(e){return 3!==e.nodeType&&48!==e.nodeType}function f(e,t){let n="";return 1===e.argumentCategory?n="*":2===e.argumentCategory&&(n="**"),e.name&&(n+=e.name.value+"="),n+=T(e.valueExpression,t),n}function T(e,t=0){switch(e.nodeType){case 38:return e.value;case 35:return T(e.leftExpression,t)+"."+e.memberName.value;case 9:{let n=T(e.leftExpression,t);return 35!==e.leftExpression.nodeType&&38!==e.leftExpression.nodeType&&24!==e.leftExpression.nodeType&&9!==e.leftExpression.nodeType&&(n=`(${n})`),n+"("+e.arguments.map((e=>f(e,t))).join(", ")+")"}case 24:return T(e.baseExpression,t)+"["+e.items.map((e=>f(e,t))).join(", ")+(e.trailingComma?",":"")+"]";case 55:{const n=v(e.operator)+T(e.expression,t);return e.parenthesized?`(${n})`:n}case 7:{const n=T(e.leftExpression,t)+" "+v(e.operator)+" "+T(e.rightExpression,t);return e.parenthesized?`(${n})`:n}case 40:{let t=e.value.toString();return t.endsWith("n")&&(t=t.substring(0,t.length-1)),e.isImaginary&&(t+="j"),t}case 48:return 1&t&&e.typeAnnotation?T(e.typeAnnotation,t):e.strings.map((e=>T(e,t))).join(" ");case 49:{let n="";8&e.token.flags&&(n+="r"),16&e.token.flags&&(n+="u"),32&e.token.flags&&(n+="b"),64&e.token.flags&&(n+="f");let a=e.token.escapedValue;if(0==(2&t)){const e=32;a=a.slice(0,e)}return 4&e.token.flags?1&e.token.flags?n+=`'''${a}'''`:n+=`"""${a}"""`:1&e.token.flags?n+=`'${a}'`:n+=`"${a}"`,n}case 27:{let t="f",n="";const a=[...e.middleTokens,...e.fieldExpressions].sort(((e,t)=>e.start-t.start));for(;a.length>0;){const e=a.shift();n+="nodeType"in e?`{${T(e)}}`:e.escapedValue}return 4&e.token.flags?1&e.token.flags?t+=`'''${n}'''`:t+=`"""${n}"""`:1&e.token.flags?t+=`'${n}'`:t+=`"${n}"`,t}case 3:return T(e.leftExpression,t)+" = "+T(e.rightExpression,t);case 4:return T(e.name,t)+" := "+T(e.rightExpression,t);case 54:return T(e.valueExpression,t)+": "+T(e.typeAnnotation,t);case 5:return T(e.leftExpression,t)+" "+v(e.operator)+" "+T(e.rightExpression,t);case 6:{const n="await "+T(e.expression,t);return e.parenthesized?`(${n})`:n}case 51:return T(e.ifExpression,t)+" if "+T(e.testExpression,t)+" else "+T(e.elseExpression,t);case 31:return`[${e.entries.map((e=>T(e,t))).join(", ")}]`;case 56:return"*"+T(e.expression,t);case 52:{const n=e.expressions.map((e=>T(e,t)));return 1===n.length?`(${n[0]}, )`:`(${n.join(", ")})`}case 60:return e.expression?"yield "+T(e.expression,t):"yield";case 61:return"yield from "+T(e.expression,t);case 18:return"...";case 32:{let n="<ListExpression>";if((0,u.isExpressionNode)(e.expression))n=T(e.expression,t);else if(17===e.expression.nodeType){n=`${T(e.expression.keyExpression,t)}: ${T(e.expression.valueExpression,t)}`}return n=n+" "+e.forIfNodes.map((e=>33===e.nodeType?(e.isAsync?"async ":"")+"for "+T(e.targetExpression,t)+` in ${T(e.iterableExpression,t)}`:`if ${T(e.testExpression,t)}`)).join(" "),e.isParenthesized?`(${n})`:n}case 46:{let n="";return e.startValue||e.endValue||e.stepValue?(e.startValue&&(n+=T(e.startValue,t)),e.endValue&&(n+=": "+T(e.endValue,t)),e.stepValue&&(n+=": "+T(e.stepValue,t))):n+=":",n}case 30:return"lambda "+e.parameters.map((e=>{let n="";return 1===e.category?n+="*":2===e.category&&(n+="**"),e.name?n+=e.name.value:0===e.category&&(n+="/"),e.defaultValue&&(n+=" = "+T(e.defaultValue,t)),n})).join(", ")+": "+T(e.expression,t);case 11:if(33===e.constType)return"True";if(15===e.constType)return"False";if(9===e.constType)return"__debug__";if(26===e.constType)return"None";break;case 15:{const n=`${e.entries.map((e=>17===e.nodeType?`${T(e.keyExpression,t)}: ${T(e.valueExpression,t)}`:16===e.nodeType?`**${T(e.expandExpression,t)}`:T(e,t)))}`;return n?`{ ${n} }`:"{}"}case 45:return e.entries.map((e=>T(e,t))).join(", ");case 0:return"<Parse Error>";default:(0,l.assertNever)(e)}return"<Expression>"}function v(e){const t={0:"+",1:"+=",2:"=",3:"&",4:"&=",5:"~",6:"|",7:"|=",8:"^",9:"^=",10:"/",11:"/=",12:"==",13:"//",14:"//=",15:">",16:">=",17:"<<",18:"<<=",19:"<>",20:"<",21:"<=",22:"@",23:"@=",24:"%",25:"%=",26:"*",27:"*=",28:"!=",29:"**",30:"**=",31:">>",32:">>=",33:"-",34:"-=",36:"and",37:"or",38:"not ",39:"is",40:"is not",41:"in",42:"not in"};return t[e]?t[e]:"unknown"}function b(e,t=!1){let n=e.parent;for(;n;){if(10===n.nodeType)return n;if(36===n.nodeType)return;if(28===n.nodeType&&t)return;n=n.parent}}function _(e){let t,n=e.parent;for(;n;){if(28===n.nodeType&&!n.decorators.some((e=>e===t)))return n;if(10===n.nodeType)return;t=n,n=n.parent}}function C(e){let t,n,a=e,r=!1,s=!1;for(;a;){switch(41===a.nodeType&&(t===a.name?r=!0:t===a.defaultValue&&(s=!0)),a.nodeType){case 76:return{node:a,useProxyScope:!0};case 28:if(!t)break;if(a.decorators.some((e=>e===t)))break;if(a.parameters.some((e=>e===t))){if(s)break;if(r&&void 0!==(0,m.getScope)(a))return{node:a}}if(t===a.suite&&void 0!==(0,m.getScope)(a))return{node:a};if(a.typeParameters){const e=a.typeParameters;if(void 0!==(0,m.getScope)(e))return{node:e,useProxyScope:!0}}break;case 30:if(a.parameters.some((e=>e===t))){if(r&&void 0!==(0,m.getScope)(a))return{node:a}}else if((!t||t===a.expression)&&void 0!==(0,m.getScope)(a))return{node:a};break;case 10:if(!t)break;if(a.decorators.some((e=>e===t)))break;if(t===a.suite&&void 0!==(0,m.getScope)(a))return{node:a};if(a.typeParameters){const e=a.typeParameters;if(void 0!==(0,m.getScope)(e))return{node:e,useProxyScope:!0}}break;case 32:if(void 0!==(0,m.getScope)(a)){if(!(t===a.forIfNodes[0]&&33===a.forIfNodes[0].nodeType&&a.forIfNodes[0].iterableExpression===n))return{node:a}}break;case 77:if(t===a.expression&&a.typeParameters){const e=a.typeParameters;if(void 0!==(0,m.getScope)(e))return{node:e}}break;case 36:if(void 0!==(0,m.getScope)(a))return{node:a}}n=t,t=a,a=a.parent}(0,l.fail)("Did not find evaluation scope")}function I(e){let t,n=e;for(;n;){switch(n.nodeType){case 28:case 10:if(!n.decorators.some((e=>e===t)))return n;break;case 77:return n}t=n,n=n.parent}}function k(e,t){let n=e;for(;n;){if(n.nodeType===t)return n;n=n.parent}}function w(e,t){if(38===e.nodeType)return 38===t.nodeType?e.value===t.value:4===t.nodeType&&e.value===t.name.value;if(35===e.nodeType&&35===t.nodeType)return w(e.leftExpression,t.leftExpression)&&e.memberName.value===t.memberName.value;if(24===e.nodeType&&24===t.nodeType){if(!w(e.baseExpression,t.baseExpression))return!1;if(1!==t.items.length||t.trailingComma||t.items[0].name||0!==t.items[0].argumentCategory)return!1;const n=e.items[0].valueExpression;if(40===n.nodeType){const e=t.items[0].valueExpression;return!(40!==e.nodeType||e.isImaginary||!e.isInteger)&&n.value===e.value}if(55===n.nodeType&&33===n.operator&&40===n.expression.nodeType){const e=t.items[0].valueExpression;return!(55!==e.nodeType||33!==e.operator||40!==e.expression.nodeType||e.expression.isImaginary||!e.expression.isInteger)&&n.expression.value===e.expression.value}if(48===n.nodeType){const e=n,a=t.items[0].valueExpression;if(1===e.strings.length&&49===e.strings[0].nodeType&&48===a.nodeType&&1===a.strings.length&&49===a.strings[0].nodeType)return e.strings[0].value===a.strings[0].value}return!1}return!1}function S(e){if(0===e.statements.length||48!==e.statements[0].nodeType)return!1;const t=e.statements[0].strings;return 0!==t.length&&!t.some((e=>27===e.nodeType))}t.getNodeDepth=function(e){let t=0,n=e;for(;n;)t++,n=n.parent;return t},t.findNodeByPosition=function(e,t,n){const a=(0,p.convertPositionToOffset)(t,n);if(void 0!==a)return g(e,a)},t.findNodeByOffset=g,t.isCompliantWithNodeRangeRules=h,t.getClassFullName=function(e,t,n){const a=[n];let r=e;for(;r;)r=b(r),r&&a.push(r.name.value);return a.push(t),a.reverse().join(".")},t.getTypeSourceId=function(e){return e.start},t.printArgument=f,t.printExpression=T,t.printOperator=v,t.getCallForName=function(e){var t,n,a;return 9===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.leftExpression===e?e.parent:35===(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&e.parent.memberName===e&&9===(null===(a=e.parent.parent)||void 0===a?void 0:a.nodeType)&&e.parent.parent.leftExpression===e.parent?e.parent.parent:void 0},t.getDecoratorForName=function(e){var t,n,a;return 13===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.expression===e?e.parent:35===(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&e.parent.memberName===e&&13===(null===(a=e.parent.parent)||void 0===a?void 0:a.nodeType)&&e.parent.parent.expression===e.parent?e.parent.parent:void 0},t.getEnclosingSuite=function(e){let t=e.parent;for(;t;){if(50===t.nodeType)return t;t=t.parent}},t.getEnclosingClass=b,t.getEnclosingModule=function(e){let t=e.parent;for(;t;){if(36===t.nodeType)return t;t=t.parent}(0,l.fail)("Module node not found")},t.getEnclosingClassOrModule=function(e,t=!1){let n=e.parent;for(;n;){if(10===n.nodeType)return n;if(36===n.nodeType)return n;if(28===n.nodeType&&t)return;n=n.parent}},t.getEnclosingFunction=_,t.getEnclosingFunctionEvaluationScope=function(e){let t=C(e).node;for(;t;){if(28===t.nodeType)return t;if(10===t.nodeType||!t.parent)return;t=C(t.parent).node}},t.getEnclosingLambda=function(e){let t=e.parent;for(;t;){if(30===t.nodeType)return t;if(50===t.nodeType)return;t=t.parent}},t.getEnclosingClassOrFunction=function(e){let t=e.parent;for(;t;){if(28===t.nodeType)return t;if(10===t.nodeType)return t;t=t.parent}},t.getEnclosingSuiteOrModule=function(e,t=!1,n=!0){let a=e.parent;for(;a;){if(50===a.nodeType)return a;if(36===a.nodeType)return a;if(30===a.nodeType&&n)return;if(28===a.nodeType&&t)return;a=a.parent}},t.getEvaluationNodeForAssignmentExpression=function(e){let t=!1,n=C(e).node;for(;void 0!==n;)switch(n.nodeType){case 28:case 30:case 36:return n;case 10:return t?void 0:n;case 32:t=!0,n=C(n.parent).node;break;default:return}},t.getEvaluationScopeNode=C,t.getTypeVarScopeNode=I,t.getExecutionScopeNode=function(e){let t=C(e).node;for(;10===t.nodeType||32===t.nodeType;)t=C(t.parent).node;return t},t.getTypeAnnotationNode=function(e){let t=e,n=e.parent;for(;n;){if(54===n.nodeType){if(n.typeAnnotation===t)return n;break}t=n,n=n.parent}},t.getArgumentsByRuntimeOrder=function(e){const t=e.arguments.filter((e=>!e.name&&2!==e.argumentCategory)),n=e.arguments.filter((e=>!!e.name||2===e.argumentCategory));return t.concat(n)},t.isFinalAllowedForAssignmentTarget=function(e){if(38===e.nodeType)return!0;if(35===e.nodeType){if(38!==e.leftExpression.nodeType)return!1;if(!b(e))return!1;const t=_(e);return!!t&&"__init__"===t.name.value}return!1},t.isClassVarAllowedForAssignmentTarget=function(e){return!!b(e,!0)},t.isRequiredAllowedForAssignmentTarget=function(e){return!!b(e,!0)},t.isNodeContainedWithin=function(e,t){let n=e;for(;n;){if(n===t)return!0;n=n.parent}return!1},t.getParentNodeOfType=k,t.getParentAnnotationNode=function(e){let t,n=e;for(;n;){if(28===n.nodeType)return t===n.returnTypeAnnotation?t:void 0;if(41===n.nodeType)return t===n.typeAnnotation||t===n.typeAnnotationComment?t:void 0;if(3===n.nodeType)return t===n.typeAnnotationComment?t:void 0;if(54===n.nodeType)return t===n.typeAnnotation?t:void 0;if(62===n.nodeType)return t===n.returnTypeAnnotation||n.paramTypeAnnotations.some((e=>e===t))?((0,l.assert)(!t||(0,u.isExpressionNode)(t)),t):void 0;t=n,n=n.parent}},t.isNodeContainedWithinNodeType=function(e,t){return void 0!==k(e,t)},t.isSuiteEmpty=function(e){let t=!1;for(const n of e.statements){if(47!==n.nodeType)return!1;for(const e of n.statements)if(18===e.nodeType)t=!0;else if(48!==e.nodeType)return!1}return t},t.containsAwaitNode=function(e){let t=!1;class n extends y.ParseTreeWalker{visitAwait(e){return t=!0,!1}}return(new n).walk(e),t},t.isMatchingExpression=w,t.isPartialMatchingExpression=function e(t,n){return 35===t.nodeType?w(t.leftExpression,n)||e(t.leftExpression,n):24===t.nodeType&&(w(t.baseExpression,n)||e(t.baseExpression,n))},t.isWithinDefaultParamInitializer=function(e){let t,n=e;for(;n;){if(41===n.nodeType&&t===n.defaultValue)return!0;if(30===n.nodeType||28===n.nodeType||10===n.nodeType||36===n.nodeType)return!1;t=n,n=n.parent}return!1},t.isWithinTypeAnnotation=function(e,t){let n,a=e,r=!1;for(;a;){if(41===a.nodeType&&(n===a.typeAnnotation||n===a.typeAnnotationComment))return r||!t;if(28===a.nodeType&&n===a.returnTypeAnnotation)return r||!t;if(28===a.nodeType&&n===a.functionAnnotationComment)return!0;if(54===a.nodeType&&n===a.typeAnnotation)return r||!t;if(3===a.nodeType&&n===a.typeAnnotationComment)return!0;if(48===a.nodeType&&n===a.typeAnnotation&&(r=!0),30===a.nodeType||28===a.nodeType||10===a.nodeType||36===a.nodeType)return!1;n=a,a=a.parent}return!1},t.isWithinAnnotationComment=function(e){let t,n=e;for(;n;){if(28===n.nodeType&&t===n.functionAnnotationComment)return!0;if(3===n.nodeType&&t===n.typeAnnotationComment)return!0;if(30===n.nodeType||28===n.nodeType||10===n.nodeType||36===n.nodeType)return!1;t=n,n=n.parent}return!1},t.isWithinLoop=function(e){let t=e;for(;t;){switch(t.nodeType){case 26:case 57:return!0}t=t.parent}return!1},t.isWithinAssertExpression=function(e){let t,n=e;for(;n;){if(2===n.nodeType)return n.testExpression===t;t=n,n=n.parent}return!1},t.getDocString=function(e){if(0===e.length)return;if(47!==e[0].nodeType)return;if(!S(e[0]))return;const t=e[0].statements[0].strings;return 1===t.length?t[0].value:t.map((e=>e.value)).join("")},t.isDocString=S,t.isAssignmentToDefaultsFollowingNamedTuple=function(e){var t,n;if(9!==e.nodeType||!e.parent||3!==e.parent.nodeType||38!==e.parent.leftExpression.nodeType||!e.parent.parent||47!==e.parent.parent.nodeType)return!1;const a=e.parent.leftExpression.value,r=e.parent.parent;if(r.statements[0]!==e.parent||!r.parent||36!==r.parent.nodeType&&50!==r.parent.nodeType)return!1;const s=r.parent;let i=s.statements.findIndex((e=>e===r));if(i<0)return!1;for(i++;i<s.statements.length;){const e=s.statements[i];if(47!==e.nodeType)break;if(48!==(null===(t=e.statements[0])||void 0===t?void 0:t.nodeType)){if(3===(null===(n=e.statements[0])||void 0===n?void 0:n.nodeType)){const t=e.statements[0];if(35===t.leftExpression.nodeType&&"__defaults__"===t.leftExpression.memberName.value){const e=t.leftExpression.leftExpression;if(35===e.nodeType&&"__new__"===e.memberName.value&&38===e.leftExpression.nodeType&&e.leftExpression.value===a)return!0}}break}i++}return!1};class A extends y.ParseTreeWalker{constructor(e){super(),this._callback=e}visitName(e){return this._callback(e,this._subscriptIndex,this._baseExpression),!0}visitIndex(e){this.walk(e.baseExpression);const t=this._subscriptIndex,n=this._baseExpression;return this._baseExpression=e.baseExpression,e.items.forEach(((e,t)=>{this._subscriptIndex=t,this.walk(e)})),this._subscriptIndex=t,this._baseExpression=n,!1}}t.NameNodeWalker=A;class x extends y.ParseTreeWalker{constructor(e){super(),this._callback=e}visitCall(e){return this._callback(e),!0}}function P(e,t,n=!1,a=!1){const r=e.getItemAtPosition(t);if(r<0)return-1;for(let s=r;s>=0;s--){const r=e.getItemAt(s);if((a||0!==r.length)&&((n||!N(r))&&c.TextRange.getEnd(r)<=t))return s}return-1}function N(e){return 2===e.type||3===e.type||4===e.type}function D(e,t){if(!(t<0))return e.getItemAt(t)}function F(e,t){return D(e,e.getItemAtPosition(t))}function E(e,t){const n=e.getItemAtPosition(t);if(n<0)return-1;const a=e.getItemAt(n);return c.TextRange.overlaps(a,t)?n:-1}function M(e){let t=e;for(;t&&36!==t.nodeType;)t=t.parent;return t}function*O(e){for(;void 0!==e;)yield e,e=e.parent}function z(e,t){return V(e,(e=>e.nodeType===t))}function V(e,t){for(const n of O(e))if(t(n))return n}function U(e){if(38===e.nodeType)return[e];const t=[];return function e(t,n){if(38===t.nodeType)return n.push(t),!0;if(n.push(t.memberName),38===t.leftExpression.nodeType||35===t.leftExpression.nodeType)return e(t.leftExpression,n);return!1}(e,t)?t.reverse():void 0}function R(e){const t=e.quoteMarkLength,n=!(65536&e.flags);return c.TextRange.create(e.start+t,e.length-t-(n?t:0))}function L(e,t,n){const a=e.lines.getItemAt(n);return(0,o.containsOnlyWhitespace)(t,a)}function j(e){let t="";(10===e.nodeType||28===e.nodeType)&&(t=e.name.value);return`${i.getFileInfo(e).fileUri.key}.${e.start.toString()}-${t}`}t.CallNodeWalker=x,t.getEnclosingParameter=function(e){let t=e;for(;t;){if(41===t.nodeType)return t;if(28===t.nodeType)return;t=t.parent}},t.getCallNodeAndActiveParameterIndex=function(e,t,n){let a,r=e;for(;void 0!==r;){if(9===r.nodeType&&d(n,r,t)){a=r;break}r=r.parent}if(!a||!a.arguments)return;const s=c.TextRange.getEnd(a);if(t>s)return;const i=F(n,s-1);if(t===s&&14===(null==i?void 0:i.type))return;let o=!1,l=-1,p=!1;return a.arguments.forEach(((e,a)=>{if(o)return;let r=e.start;const s=n.getItemAtPosition(r);s>=0&&(r=c.TextRange.getEnd(n.getItemAt(s-1)));let i=c.TextRange.getEnd(e);const d=n.getItemAtPosition(i);if(d>=0)for(let e=d;e<n.count;e++){const t=n.getItemAt(e);switch(t.type){case 12:case 14:break;default:continue}i=c.TextRange.getEnd(t);break}t<i&&(l=a,p=t>=r,o=!0)})),o||(l=a.arguments.length+1),{callNode:a,activeIndex:l,activeOrFake:p};function d(e,t,n){const a=t.leftExpression.length>0?c.TextRange.getEnd(t.leftExpression)-1:t.leftExpression.start,r=c.TextRange.getEnd(t);if(n<a||r<n)return!1;if(t.arguments.length>0){const e=t.arguments[0].start,a=c.TextRange.getEnd(t.arguments[t.arguments.length-1]);if(e<=n&&n<a)return!0}const s=e.getItemAtPosition(a);if(s<0||e.count<=s)return!0;const i=e.getItemAt(s+1);return!(13===i.type&&n<c.TextRange.getEnd(i))}},t.getTokenIndexAtLeft=P,t.getTokenAtLeft=function(e,t,n=!1,a=!1){const r=P(e,t,n,a);if(!(r<0))return e.getItemAt(r)},t.isWhitespace=N,t.getTokenAtIndex=D,t.getTokenAt=F,t.getTokenOverlapping=function(e,t){return D(e,E(e,t))},t.getIndexOfTokenOverlapping=E,t.findTokenAfter=function(e,t,n){const a=e.tokens,r=a.getItemAtPosition(t);if(!(r<0))for(let e=r;e<a.length;e++){const t=a.getItemAt(e);if(n(t))return t}},t.getCommentsAtTokenIndex=function(e,t){let n=D(e,t);if(n){for(let a=t-1;a>=0;--a){const t=D(e,a);if(!t||t.start!==n.start)break;n=t}return n.comments}},t.printParseNodeType=function(e){switch(e){case 0:return"Error";case 1:return"Argument";case 2:return"Assert";case 3:return"Assignment";case 4:return"AssignmentExpression";case 5:return"AugmentedAssignment";case 6:return"Await";case 7:return"BinaryOperation";case 8:return"Break";case 9:return"Call";case 10:return"Class";case 11:return"Constant";case 12:return"Continue";case 13:return"Decorator";case 14:return"Del";case 15:return"Dictionary";case 16:return"DictionaryExpandEntry";case 17:return"DictionaryKeyEntry";case 18:return"Ellipsis";case 19:return"If";case 20:return"Import";case 21:return"ImportAs";case 22:return"ImportFrom";case 23:return"ImportFromAs";case 24:return"Index";case 25:return"Except";case 26:return"For";case 27:return"FormatString";case 28:return"Function";case 29:return"Global";case 30:return"Lambda";case 31:return"List";case 32:return"ListComprehension";case 33:return"ListComprehensionFor";case 34:return"ListComprehensionIf";case 35:return"MemberAccess";case 36:return"Module";case 37:return"ModuleName";case 38:return"Name";case 39:return"Nonlocal";case 40:return"Number";case 41:return"Parameter";case 42:return"Pass";case 43:return"Raise";case 44:return"Return";case 45:return"Set";case 46:return"Slice";case 47:return"StatementList";case 48:return"StringList";case 49:return"String";case 50:return"Suite";case 51:return"Ternary";case 52:return"Tuple";case 53:return"Try";case 54:return"TypeAnnotation";case 55:return"UnaryOperation";case 56:return"Unpack";case 57:return"While";case 58:return"With";case 59:return"WithItem";case 60:return"Yield";case 61:return"YieldFrom";case 62:return"FunctionAnnotation";case 63:return"Match";case 64:return"Case";case 65:return"PatternSequence";case 66:return"PatternAs";case 67:return"PatternLiteral";case 68:return"PatternClass";case 69:return"PatternCapture";case 70:return"PatternMapping";case 71:return"PatternMappingKeyEntry";case 72:return"PatternMappingExpandEntry";case 73:return"PatternValue";case 74:return"PatternClassArgument";case 75:return"TypeParameter";case 76:return"TypeParameterList";case 77:return"TypeAlias"}(0,l.assertNever)(e)},t.isWriteAccess=function(e){let t=e,n=t.parent;for(;n;){switch(n.nodeType){case 3:case 5:return t===n.leftExpression;case 4:case 25:return t===n.name;case 14:return!0;case 26:case 33:return t===n.targetExpression;case 21:return t===n.alias||n.module.nameParts.length>0&&t===n.module.nameParts[0];case 23:return t===n.alias||!n.alias&&t===n.name;case 35:if(t!==n.memberName)return!1;break;case 58:return n.withItems.some((e=>e===t));case 54:if(t===n.typeAnnotation)return!1;break;case 28:case 10:case 36:return!1}t=n,n=n.parent}return!1},t.getModuleNode=M,t.getFileInfoFromNode=function(e){const t=M(e);return t?i.getFileInfo(t):void 0},t.isFunctionSuiteEmpty=function(e){let t=!0;return e.suite.statements.forEach((e=>{0!==e.nodeType&&(47===e.nodeType?e.statements.forEach((e=>{18!==e.nodeType&&48!==e.nodeType&&42!==e.nodeType&&(t=!1)})):t=!1)})),t},t.getTypeAnnotationForParameter=function(e,t){if(t>=e.parameters.length)return;const n=e.parameters[t];if(n.typeAnnotation)return n.typeAnnotation;if(n.typeAnnotationComment)return n.typeAnnotationComment;if(!e.functionAnnotationComment||e.functionAnnotationComment.isParamListEllipsis)return;let a=0;const r=e.functionAnnotationComment.paramTypeAnnotations;r.length<e.parameters.length&&(a=1);const s=t-a;return s<0||s>=r.length?void 0:r[s]},t.isImportModuleName=function(e){var t,n;return 21===(null===(n=null===(t=z(e,37))||void 0===t?void 0:t.parent)||void 0===n?void 0:n.nodeType)},t.isImportAlias=function(e){var t;return 21===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.alias===e},t.isFromImportModuleName=function(e){var t,n;return 22===(null===(n=null===(t=z(e,37))||void 0===t?void 0:t.parent)||void 0===n?void 0:n.nodeType)},t.isFromImportName=function(e){var t;return 23===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.name===e},t.isFromImportAlias=function(e){var t;return 23===(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&e.parent.alias===e},t.isLastNameOfModuleName=function(e){var t;if(37!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType))return!1;const n=e.parent;return 0!==n.nameParts.length&&n.nameParts[n.nameParts.length-1]===e},t.getAncestorsIncludingSelf=O,t.getFirstAncestorOrSelfOfKind=z,t.getFirstAncestorOrSelf=V,t.getDottedNameWithGivenNodeAsLastName=function(e){var t;return 35!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)||e.parent.leftExpression===e?e:e.parent},t.getDecoratorName=function(e){return function e(t){var n;return 38===t.nodeType||35===t.nodeType?null===(n=U(t))||void 0===n?void 0:n.map((e=>e.value)).join("."):9===t.nodeType?e(t.leftExpression):void 0}(e.expression)},t.getDottedName=U,t.getFirstNameOfDottedName=function e(t){return 38===t.nodeType?t:38===t.leftExpression.nodeType||35===t.leftExpression.nodeType?e(t.leftExpression):void 0},t.isFirstNameOfDottedName=function(e){var t;return 35!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)||e.parent.leftExpression===e},t.isLastNameOfDottedName=function(e){var t,n;return 35!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)||(38===e.parent.leftExpression.nodeType||35===e.parent.leftExpression.nodeType)&&(e.parent.leftExpression!==e&&35!==(null===(n=e.parent.parent)||void 0===n?void 0:n.nodeType))},t.getStringNodeValueRange=function(e){return R(e.token)},t.getStringValueRange=R,t.getFullStatementRange=function(e,t,n){var a;const r=(0,p.convertTextRangeToRange)(e,t.tokenizerOutput.lines),s=null!==(a=function(e,t,n){const a=n.tokens.getItemAtPosition(t);if(a<0)return;let r=a;for(;r>0;r--){const t=n.tokens.getItemAt(r);if((0,p.convertTextRangeToRange)(t,n.lines).end.line!==e.start.line)break}for(let t=a-1;t>r;t--){const a=n.tokens.getItemAt(t);if(3!==a.type&&4!==a.type){if(2===a.type)return;return e.start}}return}(r,e.start,t.tokenizerOutput))&&void 0!==a?a:{line:r.start.line,character:0},i=function(e,t,n){const a=n.tokens.getItemAtPosition(t);if(a<0)return;let r=a;for(;r<n.tokens.count;r++){const t=n.tokens.getItemAt(r),a=(0,p.convertTextRangeToRange)(t,n.lines);if(e.end.line!==a.start.line)break}let s=!1;for(let e=a;e<r;e++){const t=n.tokens.getItemAt(e);if(11===t.type||2===t.type){s=!0;continue}if(!s)continue;return(0,p.convertTextRangeToRange)(t,n.lines).start}return}(r,c.TextRange.getEnd(e),t.tokenizerOutput);if(i)return{start:s,end:i};if(r.end.line===t.tokenizerOutput.lines.count-1)return{start:s,end:r.end};let o=1;if(n&&n.includeTrailingBlankLines)for(let e=o;r.end.line+e<t.tokenizerOutput.lines.count;e++)if(!L(t.tokenizerOutput,t.text,r.end.line+e)){o=e;break}return{start:s,end:{line:r.end.line+o,character:0}}},t.isBlankLine=L,t.isUnannotatedFunction=function(e){return void 0===e.returnTypeAnnotation&&e.parameters.every((e=>void 0===e.typeAnnotation&&void 0===e.typeAnnotationComment))},t.isValidLocationForFutureImport=function(e){const t=M(e);(0,l.assert)(t);let n=!1;for(const a of t.statements){if(47!==a.nodeType)return!1;for(const t of a.statements){if(t===e)return!0;if(48===t.nodeType){if(n)return!1;n=!0}else{if(22!==t.nodeType)return!1;if(0!==t.module.leadingDots||1!==t.module.nameParts.length||"__future__"!==t.module.nameParts[0].value)return!1}}}return!1},t.operatorSupportsChaining=function(e){switch(e){case 12:case 28:case 20:case 21:case 15:case 16:case 39:case 40:case 41:case 42:return!0}return!1},t.getVariableDocStringNode=function(e){var t,n,a,r;let s,i=e;for(;i&&3!==i.nodeType&&77!==i.nodeType;)54!==i.nodeType||s||(s=i),i=i.parent;if(3!==(null==i?void 0:i.nodeType)&&77!==(null==i?void 0:i.nodeType)){if(!s)return;i=s}const o=i.parent;if(47!==(null==o?void 0:o.nodeType))return;const l=o.parent;if(!l||36!==l.nodeType&&50!==l.nodeType)return;const p=l.statements.findIndex((e=>e===o));if(p<0||p===l.statements.length-1)return;const c=l.statements[p+1];if(47!==c.nodeType||!S(c))return;let d=!1;if(36===(null===(t=null==o?void 0:o.parent)||void 0===t?void 0:t.nodeType))d=!0;else if(50===(null===(n=null==o?void 0:o.parent)||void 0===n?void 0:n.nodeType)&&10===(null===(r=null===(a=null==o?void 0:o.parent)||void 0===a?void 0:a.parent)||void 0===r?void 0:r.nodeType))d=!0;else{const e=_(o);e&&"__init__"===e.name.value&&b(e,!0)&&(d=!0)}return d?c.statements[0]:void 0},t.getScopeIdForNode=j,t.getTypeVarScopesForNode=function(e){const t=[];let n=e;for(;n&&(n=I(n),n);)t.push(j(n)),n=n.parent;return t},t.checkDecorator=function(e,t){return 38===e.expression.nodeType&&e.expression.value===t},t.isSimpleDefault=function e(t){switch(t.nodeType){case 40:case 11:case 35:return!0;case 49:return 0==(64&t.token.flags);case 48:return t.strings.every(e);case 55:return e(t.expression);case 7:return e(t.leftExpression)&&e(t.rightExpression);default:return!1}}},78232:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTreeWalker=t.ParseTreeVisitor=t.getChildNodes=void 0;const i=s(n(83181));function o(e){var t,n;switch(e.nodeType){case 0:return[e.child,...null!==(t=e.decorators)&&void 0!==t?t:[]];case 1:return[e.name,e.valueExpression];case 2:return[e.testExpression,e.exceptionExpression];case 4:return[e.name,e.rightExpression];case 3:return[e.leftExpression,e.rightExpression,e.typeAnnotationComment];case 5:case 7:return[e.leftExpression,e.rightExpression];case 6:case 13:case 67:case 73:case 55:case 56:case 60:case 61:return[e.expression];case 8:case 11:case 12:case 18:case 38:case 40:case 42:case 49:return[];case 9:return[e.leftExpression,...e.arguments];case 64:return[e.pattern,e.guardExpression,e.suite];case 10:return[...e.decorators,e.name,e.typeParameters,...e.arguments,e.suite];case 14:case 52:return e.expressions;case 15:case 31:case 45:return e.entries;case 16:return[e.expandExpression];case 17:return[e.keyExpression,e.valueExpression];case 19:return[e.testExpression,e.ifSuite,e.elseSuite];case 20:return e.list;case 21:return[e.module,e.alias];case 22:return[e.module,...e.imports];case 23:return[e.name,e.alias];case 24:return[e.baseExpression,...e.items];case 25:return[e.typeExpression,e.name,e.exceptSuite];case 26:return[e.targetExpression,e.iterableExpression,e.forSuite,e.elseSuite];case 27:return[...e.fieldExpressions,...null!==(n=e.formatExpressions)&&void 0!==n?n:[]];case 28:return[...e.decorators,e.name,e.typeParameters,...e.parameters,e.returnTypeAnnotation,e.functionAnnotationComment,e.suite];case 62:return[...e.paramTypeAnnotations,e.returnTypeAnnotation];case 29:case 39:return e.nameList;case 30:return[...e.parameters,e.expression];case 32:return[e.expression,...e.forIfNodes];case 33:return[e.targetExpression,e.iterableExpression];case 34:return[e.testExpression];case 63:return[e.subjectExpression,...e.cases];case 35:return[e.leftExpression,e.memberName];case 37:return e.nameParts;case 36:case 50:return[...e.statements];case 41:return[e.name,e.typeAnnotation,e.typeAnnotationComment,e.defaultValue];case 66:return[...e.orPatterns,e.target];case 68:return[e.className,...e.arguments];case 74:return[e.name,e.pattern];case 69:case 72:return[e.target];case 71:return[e.keyPattern,e.valuePattern];case 70:case 65:return[...e.entries];case 43:return[e.typeExpression,e.valueExpression,e.tracebackExpression];case 44:return[e.returnExpression];case 46:return[e.startValue,e.endValue,e.stepValue];case 47:return e.statements;case 48:return[e.typeAnnotation,...e.strings];case 51:return[e.ifExpression,e.testExpression,e.elseExpression];case 53:return[e.trySuite,...e.exceptClauses,e.elseSuite,e.finallySuite];case 77:return[e.name,e.typeParameters,e.expression];case 54:return[e.valueExpression,e.typeAnnotation];case 75:return[e.name,e.boundExpression,e.defaultExpression];case 76:return[...e.parameters];case 57:return[e.testExpression,e.whileSuite,e.elseSuite];case 58:return[...e.withItems,e.suite];case 59:return[e.expression,e.target];default:i.assertNever(e,`Unknown node type ${e}`)}}t.getChildNodes=o;class l{constructor(e){this._default=e}visit(e){switch(e.nodeType){case 0:return this.visitError(e);case 1:return this.visitArgument(e);case 2:return this.visitAssert(e);case 4:return this.visitAssignmentExpression(e);case 3:return this.visitAssignment(e);case 5:return this.visitAugmentedAssignment(e);case 6:return this.visitAwait(e);case 7:return this.visitBinaryOperation(e);case 8:return this.visitBreak(e);case 9:return this.visitCall(e);case 64:return this.visitCase(e);case 10:return this.visitClass(e);case 11:return this.visitConstant(e);case 12:return this.visitContinue(e);case 13:return this.visitDecorator(e);case 14:return this.visitDel(e);case 15:return this.visitDictionary(e);case 16:return this.visitDictionaryExpandEntry(e);case 17:return this.visitDictionaryKeyEntry(e);case 18:return this.visitEllipsis(e);case 19:return this.visitIf(e);case 20:return this.visitImport(e);case 21:return this.visitImportAs(e);case 22:return this.visitImportFrom(e);case 23:return this.visitImportFromAs(e);case 24:return this.visitIndex(e);case 25:return this.visitExcept(e);case 26:return this.visitFor(e);case 27:return this.visitFormatString(e);case 28:return this.visitFunction(e);case 62:return this.visitFunctionAnnotation(e);case 29:return this.visitGlobal(e);case 30:return this.visitLambda(e);case 31:return this.visitList(e);case 32:return this.visitListComprehension(e);case 33:return this.visitListComprehensionFor(e);case 34:return this.visitListComprehensionIf(e);case 63:return this.visitMatch(e);case 35:return this.visitMemberAccess(e);case 37:return this.visitModuleName(e);case 36:return this.visitModule(e);case 38:return this.visitName(e);case 39:return this.visitNonlocal(e);case 40:return this.visitNumber(e);case 41:return this.visitParameter(e);case 42:return this.visitPass(e);case 66:return this.visitPatternAs(e);case 68:return this.visitPatternClass(e);case 74:return this.visitPatternClassArgument(e);case 69:return this.visitPatternCapture(e);case 67:return this.visitPatternLiteral(e);case 72:return this.visitPatternMappingExpandEntry(e);case 71:return this.visitPatternMappingKeyEntry(e);case 70:return this.visitPatternMapping(e);case 65:return this.visitPatternSequence(e);case 73:return this.visitPatternValue(e);case 43:return this.visitRaise(e);case 44:return this.visitReturn(e);case 45:return this.visitSet(e);case 46:return this.visitSlice(e);case 47:return this.visitStatementList(e);case 48:return this.visitStringList(e);case 49:return this.visitString(e);case 50:return this.visitSuite(e);case 51:return this.visitTernary(e);case 52:return this.visitTuple(e);case 53:return this.visitTry(e);case 77:return this.visitTypeAlias(e);case 54:return this.visitTypeAnnotation(e);case 75:return this.visitTypeParameter(e);case 76:return this.visitTypeParameterList(e);case 55:return this.visitUnaryOperation(e);case 56:return this.visitUnpack(e);case 57:return this.visitWhile(e);case 58:return this.visitWith(e);case 59:return this.visitWithItem(e);case 60:return this.visitYield(e);case 61:return this.visitYieldFrom(e);default:i.assertNever(e,`Unknown node type ${e}`)}}visitArgument(e){return this._default}visitAssert(e){return this._default}visitAssignment(e){return this._default}visitAssignmentExpression(e){return this._default}visitAugmentedAssignment(e){return this._default}visitAwait(e){return this._default}visitBinaryOperation(e){return this._default}visitBreak(e){return this._default}visitCall(e){return this._default}visitCase(e){return this._default}visitClass(e){return this._default}visitTernary(e){return this._default}visitContinue(e){return this._default}visitConstant(e){return this._default}visitDecorator(e){return this._default}visitDel(e){return this._default}visitDictionary(e){return this._default}visitDictionaryKeyEntry(e){return this._default}visitDictionaryExpandEntry(e){return this._default}visitError(e){return this._default}visitEllipsis(e){return this._default}visitIf(e){return this._default}visitImport(e){return this._default}visitImportAs(e){return this._default}visitImportFrom(e){return this._default}visitImportFromAs(e){return this._default}visitIndex(e){return this._default}visitExcept(e){return this._default}visitFor(e){return this._default}visitFormatString(e){return this._default}visitFunction(e){return this._default}visitFunctionAnnotation(e){return this._default}visitGlobal(e){return this._default}visitLambda(e){return this._default}visitList(e){return this._default}visitListComprehension(e){return this._default}visitListComprehensionFor(e){return this._default}visitListComprehensionIf(e){return this._default}visitMatch(e){return this._default}visitMemberAccess(e){return this._default}visitModule(e){return this._default}visitModuleName(e){return this._default}visitName(e){return this._default}visitNonlocal(e){return this._default}visitNumber(e){return this._default}visitParameter(e){return this._default}visitPass(e){return this._default}visitPatternCapture(e){return this._default}visitPatternClass(e){return this._default}visitPatternClassArgument(e){return this._default}visitPatternAs(e){return this._default}visitPatternLiteral(e){return this._default}visitPatternMappingExpandEntry(e){return this._default}visitPatternSequence(e){return this._default}visitPatternValue(e){return this._default}visitPatternMappingKeyEntry(e){return this._default}visitPatternMapping(e){return this._default}visitRaise(e){return this._default}visitReturn(e){return this._default}visitSet(e){return this._default}visitSlice(e){return this._default}visitStatementList(e){return this._default}visitString(e){return this._default}visitStringList(e){return this._default}visitSuite(e){return this._default}visitTuple(e){return this._default}visitTry(e){return this._default}visitTypeAlias(e){return this._default}visitTypeAnnotation(e){return this._default}visitTypeParameter(e){return this._default}visitTypeParameterList(e){return this._default}visitUnaryOperation(e){return this._default}visitUnpack(e){return this._default}visitWhile(e){return this._default}visitWith(e){return this._default}visitWithItem(e){return this._default}visitYield(e){return this._default}visitYieldFrom(e){return this._default}}t.ParseTreeVisitor=l;t.ParseTreeWalker=class extends l{constructor(){super(!0)}walk(e){const t=this.visitNode(e);t.length>0&&this.walkMultiple(t)}walkMultiple(e){e.forEach((e=>{e&&this.walk(e)}))}visitNode(e){return this.visit(e)?o(e):[]}}},3573:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPatternSubtypeNarrowingCallback=t.validateClassPattern=t.assignTypeToPatternTargets=t.checkForUnusedPattern=t.narrowTypeBasedOnPattern=void 0;const a=n(28040),r=n(83181),s=n(72484),i=n(97652),o=n(95960),l=n(99868),p=n(28340),c=n(45468),d=n(46048),u=n(8312),m=n(808),y=n(97632),g=["builtins.bool","builtins.bytearray","builtins.bytes","builtins.dict","builtins.float","builtins.frozenset","builtins.int","builtins.list","builtins.set","builtins.str","builtins.tuple"];function h(e,t,n,r){switch(n.nodeType){case 65:return function(e,t,n,r){t=(0,m.transformPossibleRecursiveTypeAlias)(t);let s=_(e,n,t);return s=s.filter((t=>{var s;if(t.isDefiniteNoMatch)return!r;let i=!0,o=!0;const l=[];let p=t.isTuple;!r&&t.isIndeterminateLength&&(p=!1),t.isIndeterminateLength&&(1===n.entries.length&&0===n.starEntryIndex||(o=!1));let c=0;if(n.entries.forEach(((s,d)=>{const y=C(e,n,t,d,n.entries.length,n.starEntryIndex,!0),g=h(e,y,s,r);r?d===n.starEntryIndex?(0,u.isClassInstance)(g)&&g.tupleTypeArguments&&!(0,m.isUnboundedTupleClass)(g)&&g.tupleTypeArguments?(0,a.appendArray)(l,g.tupleTypeArguments.map((e=>e.type))):(l.push(g),p=!1):(l.push(g),(0,u.isNever)(g)&&(i=!1)):(t.isPotentialNoMatch&&(o=!1),(0,u.isNever)(g)?l.push(y):(o=!1,c++,l.push(g)),d===n.starEntryIndex&&(p=!1))})),0===n.entries.length&&(t.entryTypes.length>0&&l.push((0,u.combineTypes)(t.entryTypes)),t.isPotentialNoMatch&&(o=!1)),!r){if(o)return!1;if(p&&1===c){const a=e.getBuiltInType(n,"tuple");a&&(0,u.isInstantiableClass)(a)&&(t.subtype=u.ClassType.cloneAsInstance((0,m.specializeTupleClass)(a,l.map((e=>({type:e,isUnbounded:!1}))))))}return!0}if(i){if(p){const a=e.getBuiltInType(n,"tuple");a&&(0,u.isInstantiableClass)(a)&&(t.subtype=u.ClassType.cloneAsInstance((0,m.specializeTupleClass)(a,l.map((e=>({type:e,isUnbounded:!1}))))))}if(t.isPotentialNoMatch&&!t.isTuple){const a=e.getTypingType(n,"Sequence");if(a&&(0,u.isInstantiableClass)(a)){let n=e.stripLiteralValue((0,u.combineTypes)(l));n=null!==(s=(0,m.containsAnyOrUnknown)(n,!1))&&void 0!==s?s:n,t.subtype=u.ClassType.cloneAsInstance(u.ClassType.cloneForSpecialization(a,[n],!0))}}}return i})),(0,u.combineTypes)(s.map((e=>e.subtype)))}(e,t,n,r);case 67:return function(e,t,n,a){const r=e.getTypeOfExpression(n.expression).type;if(!a)return e.mapSubtypesExpandTypeVars(t,void 0,((t,n)=>{if(!((0,u.isClassInstance)(r)&&(0,m.isLiteralType)(r)&&(0,u.isClassInstance)(t)&&(0,m.isLiteralType)(t)&&e.assignType(r,t)||(0,m.isNoneInstance)(t)&&(0,m.isNoneInstance)(r)))return(0,u.isClassInstance)(t)&&u.ClassType.isBuiltIn(t,"bool")&&void 0===t.literalValue&&(0,u.isClassInstance)(r)&&u.ClassType.isBuiltIn(r,"bool")&&void 0!==r.literalValue?u.ClassType.cloneWithLiteral(r,!r.literalValue):t}));return e.mapSubtypesExpandTypeVars(t,void 0,((t,n)=>e.assignType(t,r)?r:(0,u.isClassInstance)(r)&&(0,m.isLiteralType)(r)&&(0,u.isClassInstance)(t)&&!(0,m.isLiteralType)(t)&&e.assignType(u.ClassType.cloneWithLiteral(r,void 0),t)?t:void 0))}(e,t,n,r);case 68:return function(e,t,n,a){let r=e.getTypeOfExpression(n.className,2).type;(0,u.isClass)(r)&&!r.typeAliasInfo&&(r=u.ClassType.cloneRemoveTypePromotions(r),r=(0,m.specializeWithUnknownTypeArgs)(r));let s=[];n.arguments.some((e=>!e.name))&&(0,u.isInstantiableClass)(r)&&(s=f(e,r));if(!a){if(!(0,u.isInstantiableClass)(r))return t;let i=r;i.details.typeParameters.length>0&&(i=u.ClassType.cloneForSpecialization(i,void 0,!1));const o=(0,m.convertToInstance)(i),l=(0,m.isMetaclassInstance)(o);return e.mapSubtypesExpandTypeVars(t,{expandCallback:t=>e.expandPromotionTypes(n,t)},((t,r)=>{var p;if(l&&(0,u.isInstantiableClass)(t)){const n=null!==(p=t.details.effectiveMetaclass)&&void 0!==p?p:u.UnknownType.create();if((0,u.isInstantiableClass)(i)&&e.assignType(i,n))return;return t}if(!(0,m.isNoneInstance)(t)&&!(0,u.isClassInstance)(t))return r;if(!((0,m.isNoneInstance)(t)&&(0,u.isInstantiableClass)(i)&&u.ClassType.isBuiltIn(i,"NoneType"))){if(!e.assignType(o,t))return t;if(0===n.arguments.length){if((0,u.isClass)(o)&&(0,u.isClass)(t))return;return t}if(!e.assignType(t,o)&&(0,u.isClass)(t)&&!u.ClassType.isFinal(t)&&!u.ClassType.isProtocolClass(o))return t;for(let i=0;i<n.arguments.length;i++){const o=v(e,n.arguments[i],i,s,t,a);if(!(0,u.isNever)(o))return r}}}))}if(!u.TypeBase.isInstantiable(r)&&!(0,u.isNever)(r))return e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,o.LocAddendum.typeNotClass().format({type:e.printType(r)}),n.className),u.NeverType.createNever();(0,u.isInstantiableClass)(r)&&u.ClassType.isProtocolClass(r)&&!u.ClassType.isRuntimeCheckable(r)&&e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,o.LocAddendum.protocolRequiresRuntimeCheckable(),n.className);return e.mapSubtypesExpandTypeVars(r,void 0,((r,s)=>{if((0,u.isAnyOrUnknown)(r))return s;if((0,u.isInstantiableClass)(r)){const i=(0,m.convertToInstance)(r),o=(0,m.isMetaclassInstance)(i);return e.mapSubtypesExpandTypeVars(t,void 0,(t=>{var i;if((0,u.isAnyOrUnknown)(t)){if((0,u.isInstantiableClass)(r)&&u.ClassType.isBuiltIn(r,"Callable")){const e=u.FunctionType.createSynthesizedInstance("",32768);return u.FunctionType.addDefaultParameters(e,(0,u.isUnknown)(t)),e.details.declaredReturnType=t,e}return(0,m.convertToInstance)(s)}if(o&&(0,u.isInstantiableClass)(t)){const n=null!==(i=t.details.effectiveMetaclass)&&void 0!==i?i:u.UnknownType.create();return e.assignType(r,n)||e.assignType(n,r)?t:void 0}if((0,m.isNoneInstance)(t)&&(0,u.isInstantiableClass)(r)&&u.ClassType.isBuiltIn(r,"NoneType"))return t;if((0,u.isInstantiableClass)(r)&&u.ClassType.isBuiltIn(r,"Callable")){const n=(0,m.getUnknownTypeForCallable)();if(e.assignType(n,t))return t;const a=(0,m.convertToInstance)(t);return e.assignType(a,n)?n:void 0}if((0,u.isClassInstance)(t)){let i;if(e.assignType(u.ClassType.cloneAsInstance(r),t))i=t;else{if(!e.assignType(t,u.ClassType.cloneAsInstance(r)))return;if(i=(0,m.addConditionToType)((0,m.convertToInstance)(s),(0,m.getTypeCondition)(t)),(0,u.isInstantiableClass)(s)&&(0,u.isClassInstance)(t)&&(u.ClassType.isSpecialBuiltIn(s)||s.details.typeParameters.length>0)){const n=new y.TypeVarContext((0,m.getTypeVarScopeId)(s)),a=u.ClassType.cloneForSpecialization(s,void 0,!1),r=u.ClassType.cloneAsInstance(a);(0,l.populateTypeVarContextBasedOnExpectedType)(e,r,t,n,void 0,void 0)&&(i=(0,m.applySolvedTypeVars)(r,n,{unknownIfNotFound:!0}))}}let o=[];n.arguments.some((e=>!e.name))&&(o=f(e,r));let p=!0;if(n.arguments.forEach(((t,n)=>{const r=v(e,t,n,o,i,a);(0,u.isNever)(r)&&(p=!1)})),p)return i}}))}}))}(e,t,n,r);case 66:return function(e,t,n,a){let r=t;if(!a)return n.orPatterns.forEach((t=>{r=h(e,r,t,!1)})),r;const s=n.orPatterns.map((t=>{const n=h(e,r,t,!0);return r=h(e,r,t,!1),n}));return(0,u.combineTypes)(s)}(e,t,n,r);case 70:return function(e,t,n,a){if(t=(0,m.transformPossibleRecursiveTypeAlias)(t),!a){if(1!==n.entries.length||71!==n.entries[0].nodeType)return t;const a=n.entries[0].keyPattern,r=n.entries[0].valuePattern;if(67!==a.nodeType||66!==r.nodeType||!r.orPatterns.every((e=>67===e.nodeType)))return t;const s=e.getTypeOfExpression(a.expression).type;if(!(0,u.isClassInstance)(s)||!u.ClassType.isBuiltIn(s,"str")||void 0===s.literalValue)return t;const i=s.literalValue,o=r.orPatterns.map((t=>e.getTypeOfExpression(t.expression).type));return(0,m.mapSubtypes)(t,(t=>{if((0,u.isClassInstance)(t)&&u.ClassType.isTypedDictClass(t)){const n=(0,c.getTypedDictMembersForClass)(e,t,!0).knownItems.get(i);if(n&&(n.isRequired||n.isProvided)&&(0,u.isClassInstance)(n.valueType)){const e=n.valueType;if(o.some((t=>(0,u.isClassInstance)(t)&&u.ClassType.isSameGenericClass(t,e)&&t.literalValue===e.literalValue)))return}}return t}))}let r=b(e,t,n);return r=r.filter((t=>{let r=!0;return n.entries.forEach((s=>{if(t.typedDict){if(71===s.nodeType){const i=h(e,e.getBuiltInObject(n,"str"),s.keyPattern,a);(0,u.isNever)(i)&&(r=!1);const o=(0,m.mapSubtypes)(i,(n=>{var a;if((0,u.isAnyOrUnknown)(n))return n;if((0,u.isClassInstance)(n)&&u.ClassType.isBuiltIn(n,"str")){if(!(0,m.isLiteralType)(n))return u.UnknownType.create();const r=(0,c.getTypedDictMembersForClass)(e,t.typedDict).knownItems.get(n.literalValue);if(r){const i=h(e,r.valueType,s.valuePattern,!0);if(!(0,u.isNever)(i)){if(!r.isRequired&&!r.isProvided&&(0,u.isTypeSame)(t.subtype,t.typedDict)){const e=new Map(null!==(a=t.typedDict.typedDictNarrowedEntries)&&void 0!==a?a:[]);e.set(n.literalValue,{valueType:r.valueType,isReadOnly:r.isReadOnly,isRequired:!1,isProvided:!0}),t.subtype=u.ClassType.cloneAsInstance(u.ClassType.cloneForNarrowedTypedDictEntries(u.ClassType.cloneAsInstantiable(t.typedDict),e)),t.typedDict=t.subtype}return i}}}}));(0,u.isNever)(o)&&(r=!1)}}else if(t.dictTypeArgs&&71===s.nodeType){const n=h(e,t.dictTypeArgs.key,s.keyPattern,a),i=h(e,t.dictTypeArgs.value,s.valuePattern,a);((0,u.isNever)(n)||(0,u.isNever)(i))&&(r=!1)}})),r})),(0,u.combineTypes)(r.map((e=>e.subtype)))}(e,t,n,r);case 73:return function(e,t,n,a){const r=e.getTypeOfExpression(n.expression).type,s=[];return e.mapSubtypesExpandTypeVars(r,void 0,((r,i)=>{s.push(e.mapSubtypesExpandTypeVars(t,{conditionFilter:(0,m.getTypeCondition)(r)},(t=>{if(!a){if((0,u.isClassInstance)(t)&&u.ClassType.isEnumClass(t)&&!(0,m.isLiteralType)(t)&&(0,u.isClassInstance)(r)&&(0,u.isSameWithoutLiteralValue)(t,r)&&(0,m.isLiteralType)(r)){const n=(0,d.enumerateLiteralsForType)(e,t);if(n)return(0,u.combineTypes)(n.filter((e=>!u.ClassType.isLiteralValueSame(r,e))))}else if((0,u.isClassInstance)(t)&&(0,u.isClassInstance)(r)&&(0,m.isLiteralType)(t)&&u.ClassType.isLiteralValueSame(r,t))return;return t}if((0,u.isNever)(r)||(0,u.isNever)(t))return u.NeverType.createNever();if((0,u.isAnyOrUnknown)(r)||(0,u.isAnyOrUnknown)(t))return(0,u.isUnknown)(r)||(0,u.isUnknown)(t)?(0,m.preserveUnknown)(r,t):u.AnyType.create();if((0,u.isClassInstance)(t)&&(0,m.isLiteralType)(t)&&(0,u.isClassInstance)(r)&&(0,m.isLiteralType)(r))return u.ClassType.isLiteralValueSame(r,t)?i:void 0;return e.useSpeculativeMode(n.expression,(()=>e.getTypeOfMagicMethodCall(r,"__eq__",[{type:t}],n.expression,void 0)))?i:void 0})))})),(0,u.combineTypes)(s)}(e,t,n,r);case 69:return r?t:u.NeverType.createNever();case 0:return t}}function f(e,t){const n=(0,m.lookUpClassMember)(t,"__match_args__");if(n){const t=e.getTypeOfMember(n);if((0,u.isClassInstance)(t)&&(0,m.isTupleClass)(t)&&!(0,m.isUnboundedTupleClass)(t)&&t.tupleTypeArguments){const e=t.tupleTypeArguments;if(e.every((e=>(0,u.isClassInstance)(e.type)&&u.ClassType.isBuiltIn(e.type,"str")&&(0,m.isLiteralType)(e.type))))return e.map((e=>e.type.literalValue))}}return[]}function T(e){if(g.some((t=>e.details.fullName===t)))return!0;if((0,m.lookUpClassMember)(e,"__match_args__"))return!1;for(const t of e.details.mro)if((0,u.isClass)(t)&&g.some((e=>t.details.fullName===e)))return!0;return!1}function v(e,t,n,a,r,s){var i;let o;if(t.name?o=t.name.value:n<a.length&&(o=a[n]),(0,u.isAnyOrUnknown)(r))return r;if(!(0,u.isClass)(r))return u.UnknownType.create();let l,p=!1,c=r;if(!t.name&&(0,u.isClass)(r)&&0===n&&(T(r)?p=!0:0===a.length&&r.details.mro.forEach((e=>{(0,u.isClass)(e)&&T(e)&&(c=e,p=!0)}))),p)l=u.ClassType.cloneAsInstance(c);else if(o&&(l=null===(i=e.useSpeculativeMode(t,(()=>e.getTypeOfBoundMember(t,u.ClassType.cloneAsInstance(r),o))))||void 0===i?void 0:i.type),!l){if(!s)return r;if(u.ClassType.isFinal(r))return u.NeverType.createNever();l=u.UnknownType.create()}return h(e,l,t.pattern,s)}function b(e,t,n){const a=[];return(0,m.doForEachSubtype)(t,(r=>{const s=e.makeTopLevelTypeVarsConcrete(r);if((0,u.isAnyOrUnknown)(s))a.push({subtype:r,dictTypeArgs:{key:s,value:s}});else if((0,u.isClassInstance)(s)){if(u.ClassType.isTypedDictClass(s))return void a.push({subtype:r,typedDict:s});let i;for(const e of s.details.mro)if((0,u.isInstantiableClass)(e)&&u.ClassType.isBuiltIn(e,"Mapping")){i=e;break}if(i){const e=(0,m.partiallySpecializeType)(i,s);return void(e.typeArguments&&e.typeArguments.length>=2&&a.push({subtype:r,dictTypeArgs:{key:e.typeArguments[0],value:e.typeArguments[1]}}))}const o=e.getTypingType(n,"Mapping");if(o&&(0,u.isInstantiableClass)(o)){const n=u.ClassType.cloneAsInstance(o);e.assignType(t,n)&&a.push({subtype:r,dictTypeArgs:{key:u.UnknownType.create(),value:u.UnknownType.create()}})}}})),a}function _(e,t,n){const a=t.entries.length,r=t.starEntryIndex,s=[];return(0,m.doForEachSubtype)(n,(n=>{var i;const o=e.makeTopLevelTypeVarsConcrete(n);let c,d=!1;if((0,u.isClassInstance)(o)){for(const e of o.details.mro){if(!(0,u.isInstantiableClass)(e))break;if(u.ClassType.isBuiltIn(e,"str")||u.ClassType.isBuiltIn(e,"bytes")||u.ClassType.isBuiltIn(e,"bytearray"))return void s.push({subtype:n,entryTypes:[],isIndeterminateLength:!0,isDefiniteNoMatch:!0});if(u.ClassType.isBuiltIn(e,"Sequence")){c=e;break}if((0,m.isTupleClass)(e)){c=e;break}}if(c){const l=(0,m.partiallySpecializeType)(c,o);if((0,m.isTupleClass)(l)){const o=null!==(i=l.tupleTypeArguments)&&void 0!==i?i:[{type:u.UnknownType.create(),isUnbounded:!0}],p=o.findIndex((e=>e.isUnbounded||(0,u.isUnpackedVariadicTypeVar)(e.type)));if(p>=0){for(;o.length<a;)o.splice(p,0,o[p]);o.length>a&&void 0===r&&o.splice(p,1)}if(void 0!==r&&o.length>=2&&o.length>a){const e=o.length-a+1,t=o.splice(r,e);o.splice(r,0,{type:(0,u.combineTypes)(t.map((e=>e.type))),isUnbounded:t.every((e=>e.isUnbounded||(0,u.isUnpackedVariadicTypeVar)(e.type)))})}if(o.length===a){let i=!1,l=p>=0;void 0!==r&&1===a&&(l=!1);for(let n=0;n<a;n++){const a=t.entries[n],r=o[n].type,s=h(e,r,a,!0);(0,u.isNever)(s)&&(i=!0)}s.push({subtype:n,entryTypes:i?[]:o.map((e=>e.type)),isIndeterminateLength:!1,isTuple:!0,isDefiniteNoMatch:i,isPotentialNoMatch:l}),d=!0}if(void 0!==r){let i=!1;if(o.length===a-1?(i=!0,o.splice(r,0,{type:u.AnyType.create(),isUnbounded:!0})):o.length===a&&o[r].isUnbounded&&(i=!0),i){let i=!1;for(let n=0;n<a;n++){if(n===r)continue;const a=t.entries[n],s=o[n].type,l=h(e,s,a,!0);(0,u.isNever)(l)&&(i=!0)}s.push({subtype:n,entryTypes:i?[]:o.map((e=>e.type)),isIndeterminateLength:!1,isTuple:!0,isDefiniteNoMatch:i}),d=!0}}}else s.push({subtype:n,entryTypes:[l.typeArguments&&l.typeArguments.length>0?l.typeArguments[0]:u.UnknownType.create()],isIndeterminateLength:!0,isDefiniteNoMatch:!1}),d=!0}}if(!d){const a=e.getTypingType(t,"Sequence");if(a&&(0,u.isInstantiableClass)(a)){const r=new y.TypeVarContext((0,m.getTypeVarScopeId)(a));if((0,l.populateTypeVarContextBasedOnExpectedType)(e,u.ClassType.cloneAsInstance(a),n,r,(0,p.getTypeVarScopesForNode)(t),t.start)){const e=(0,m.applySolvedTypeVars)(u.ClassType.cloneAsInstantiable(a),r);if(e.typeArguments&&e.typeArguments.length>0)return void s.push({subtype:n,entryTypes:[e.typeArguments[0]],isIndeterminateLength:!0,isDefiniteNoMatch:!1,isPotentialNoMatch:!0})}if(e.assignType(n,u.ClassType.cloneForSpecialization(u.ClassType.cloneAsInstance(a),[u.UnknownType.create()],!0)))return void s.push({subtype:n,entryTypes:[u.UnknownType.create()],isIndeterminateLength:!0,isDefiniteNoMatch:!1,isPotentialNoMatch:!0})}s.push({subtype:n,entryTypes:[],isIndeterminateLength:!0,isDefiniteNoMatch:!0})}})),s}function C(e,t,n,a,s,i,o){if(n.isIndeterminateLength){let r=n.entryTypes[0];return o||a!==i||(0,u.isNever)(r)||(r=I(e,t,r)),r}if(void 0===i||a<i)return n.entryTypes[a];if(a===i){const a=n.entryTypes.slice(i,i+n.entryTypes.length-s+1).map((t=>e.stripLiteralValue(t)));let r=(0,u.combineTypes)(a);return o||(r=I(e,t,r)),r}const l=n.entryTypes.length-(s-a);return(0,r.assert)(l>=0&&l<n.entryTypes.length),n.entryTypes[l]}function I(e,t,n){var a;if((0,u.isNever)(n))return n;const r=(0,m.convertToInstance)(e.getBuiltInObject(t,"list"));return r&&(0,u.isClassInstance)(r)?(n=null!==(a=(0,m.containsAnyOrUnknown)(n,!1))&&void 0!==a?a:n,u.ClassType.cloneForSpecialization(r,[n],!0)):u.UnknownType.create()}function k(e,t,n){e.addDiagnostic(i.DiagnosticRule.reportUnnecessaryComparison,o.LocMessage.patternNeverMatches().format({type:e.printType(n)}),t)}t.narrowTypeBasedOnPattern=h,t.checkForUnusedPattern=function(e,t,n){if((0,u.isNever)(n))k(e,t,n);else if(66===t.nodeType&&t.orPatterns.length>1)t.orPatterns.forEach((t=>{const a=h(e,n,t,!0);(0,u.isNever)(a)&&k(e,t,n),n=h(e,n,t,!1)}));else{const a=h(e,n,t,!0);(0,u.isNever)(a)&&k(e,t,n)}},t.assignTypeToPatternTargets=function e(t,n,a,r){const l=h(t,n,r,!0);switch(r.nodeType){case 65:{const n=_(t,r,l).filter((e=>!e.isDefiniteNoMatch));r.entries.forEach(((s,i)=>{const o=(0,u.combineTypes)(n.map((e=>C(t,r,e,i,r.entries.length,r.starEntryIndex,!1))));e(t,o,a,s)}));break}case 66:{r.target&&t.assignTypeToExpression(r.target,l,a,r.target);let n=l;r.orPatterns.forEach((r=>{e(t,n,a,r),n=h(t,n,r,!1)}));break}case 69:if(r.isWildcard){if(!a)if((0,u.isUnknown)(l))t.addDiagnostic(i.DiagnosticRule.reportUnknownVariableType,o.LocMessage.wildcardPatternTypeUnknown(),r.target);else if((0,m.isPartlyUnknown)(l)){const e=new s.DiagnosticAddendum;e.addMessage(o.LocAddendum.typeOfSymbol().format({name:"_",type:t.printType(l,{expandTypeAlias:!0})})),t.addDiagnostic(i.DiagnosticRule.reportUnknownVariableType,o.LocMessage.wildcardPatternTypePartiallyUnknown()+e.getString(),r.target)}}else t.assignTypeToExpression(r.target,l,a,r.target);break;case 70:{const n=b(t,l,r);r.entries.forEach((s=>{const i=[],o=[];n.forEach((e=>{if(e.typedDict)if(71===s.nodeType){const n=h(t,t.getBuiltInObject(r,"str"),s.keyPattern,!0);i.push(n),(0,m.doForEachSubtype)(n,(n=>{if((0,u.isClassInstance)(n)&&u.ClassType.isBuiltIn(n,"str")&&(0,m.isLiteralType)(n)){const a=(0,c.getTypedDictMembersForClass)(t,e.typedDict).knownItems.get(n.literalValue);o.push(a?a.valueType:u.UnknownType.create())}else o.push(u.UnknownType.create())}))}else 72===s.nodeType&&(i.push(t.getBuiltInObject(r,"str")),o.push(u.UnknownType.create()));else if(e.dictTypeArgs)if(71===s.nodeType){const n=h(t,e.dictTypeArgs.key,s.keyPattern,!0);i.push(n),o.push(h(t,e.dictTypeArgs.value,s.valuePattern,!0))}else 72===s.nodeType&&(i.push(e.dictTypeArgs.key),o.push(e.dictTypeArgs.value))}));const l=(0,u.combineTypes)(i),p=(0,u.combineTypes)(o);if(71===s.nodeType)e(t,l,a,s.keyPattern),e(t,p,a,s.valuePattern);else if(72===s.nodeType){const e=t.getBuiltInType(r,"dict"),n=t.getBuiltInObject(r,"str"),i=e&&(0,u.isInstantiableClass)(e)&&(0,u.isClassInstance)(n)?u.ClassType.cloneAsInstance(u.ClassType.cloneForSpecialization(e,[l,p],!0)):u.UnknownType.create();t.assignTypeToExpression(s.target,i,a,s.target)}}));break}case 68:{const n=r.arguments.map((e=>[]));t.mapSubtypesExpandTypeVars(l,void 0,(e=>{(0,u.isClassInstance)(e)?(0,m.doForEachSubtype)(l,(a=>{const s=t.makeTopLevelTypeVarsConcrete(a);if((0,u.isAnyOrUnknown)(s))r.arguments.forEach(((e,t)=>{n[t].push(s)}));else if((0,u.isClassInstance)(s)){let a=[];r.arguments.some((e=>!e.name))&&(a=f(t,u.ClassType.cloneAsInstantiable(e))),r.arguments.forEach(((r,s)=>{const i=v(t,r,s,a,u.ClassType.cloneAsInstantiable(e),!0);n[s].push(i)}))}})):r.arguments.forEach(((e,t)=>{n[t].push(u.UnknownType.create())}))})),r.arguments.forEach(((r,s)=>{e(t,(0,u.combineTypes)(n[s]),a,r.pattern)}));break}}return l},t.validateClassPattern=function(e,t){let n=e.getTypeOfExpression(t.className,2).type;if(n.specialForm&&(n=n.specialForm),!(0,u.isAnyOrUnknown)(n))if(n.typeAliasInfo&&(0,u.isInstantiableClass)(n)&&n.typeArguments&&n.isTypeArgumentExplicit)e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,o.LocMessage.classPatternTypeAlias().format({type:e.printType(n)}),t.className);else if((0,u.isInstantiableClass)(n)){const a=T(n);a&&1===t.arguments.length&&t.arguments[0].name&&e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,o.LocMessage.classPatternBuiltInArgPositional(),t.arguments[0].name);let r=t.arguments.findIndex((e=>void 0!==e.name));r<0&&(r=t.arguments.length);let s=1;if(!a){let a=[];t.arguments.some((e=>!e.name))&&(a=f(e,n)),s=a.length}r>s&&e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,o.LocMessage.classPatternPositionalArgCount().format({type:n.details.name,expected:s,received:r}),t.arguments[s])}else(0,u.isNever)(n)||e.addDiagnostic(i.DiagnosticRule.reportGeneralTypeIssues,o.LocAddendum.typeNotClass().format({type:e.printType(n)}),t.className)},t.getPatternSubtypeNarrowingCallback=function(e,t,n){if(24===n.nodeType&&1===n.items.length&&!n.trailingComma&&0===n.items[0].argumentCategory&&(0,p.isMatchingExpression)(t,n.baseExpression)){const t=e.getTypeOfExpression(n.items[0].valueExpression),a=t.type;if((0,u.isClassInstance)(a)&&(0,m.isLiteralType)(a)&&u.ClassType.isBuiltIn(a,["int","str"])){const r=e.getTypeOfExpression(n.baseExpression,2),s=r.type;return n=>{let i=!0;const o=[];if((0,m.doForEachSubtype)(n,(t=>{t=e.makeTopLevelTypeVarsConcrete(t),(0,u.isClassInstance)(t)&&void 0!==t.literalValue?u.ClassType.isBuiltIn(a,"str")?o.push((0,d.narrowTypeForDiscriminatedDictEntryComparison)(e,s,a,t,!0)):o.push((0,d.narrowTypeForDiscriminatedTupleComparison)(e,s,a,t,!0)):(0,u.isNever)(t)||(i=!1)})),i)return{type:(0,u.combineTypes)(o),isIncomplete:t.isIncomplete||r.isIncomplete}}}}if(52===n.nodeType){const a=n.expressions.findIndex((e=>(0,p.isMatchingExpression)(t,e)));if(a>=0){const t=e.getTypeOfExpression(n.expressions[a]);return e=>{let n=!0;const r=[];return(0,m.doForEachSubtype)(e,(t=>{(0,u.isClassInstance)(t)&&u.ClassType.isBuiltIn(t,"tuple")&&t.tupleTypeArguments&&a<t.tupleTypeArguments.length&&t.tupleTypeArguments.every((e=>!e.isUnbounded))?r.push(t.tupleTypeArguments[a].type):(0,u.isNever)(e)?r.push(e):n=!1})),n?{type:(0,u.combineTypes)(r),isIncomplete:t.isIncomplete}:void 0}}}if(35===n.nodeType&&(0,p.isMatchingExpression)(t,n.leftExpression)){const t=e.getTypeOfExpression(n.leftExpression,2).type;return a=>{if((0,u.isNever)(a))return{type:u.NeverType.createNever()};if(!(0,m.isLiteralTypeOrUnion)(a))return;return{type:(0,m.mapSubtypes)(a,(a=>((0,r.assert)((0,u.isClassInstance)(a)&&void 0!==a.literalValue),(0,d.narrowTypeForDiscriminatedLiteralFieldComparison)(e,t,n.memberName.value,a,!0))))}}}}},4732:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Program=void 0;const i=n(65872),o=n(15684),l=n(64704),p=n(55484),c=n(57508),d=s(n(83181)),u=n(83181),m=n(10996),y=n(96193),g=n(37636);n(58484);const h=n(55164),f=n(6216),T=n(55084),v=n(80636),b=s(n(9316)),_=n(80232),C=n(53748),I=n(28340),k=n(41500),w=n(80068),S=n(408),A=n(76392),x=n(74068),P=n(27124),N=n(10983);class D{constructor(){this._isEditMode=!1,this._mutatedFiles=[]}get isEditMode(){return this._isEditMode}addMutatedFiles(e){this._mutatedFiles.push(e)}enable(){this._isEditMode=!0,this._mutatedFiles=[]}disable(){this._isEditMode=!1;const e=this._mutatedFiles;return this._mutatedFiles=[],e}}class F{constructor(e,t,n,a,r,s){var i;this.serviceProvider=n,this._disableChecker=r,this._sourceFileList=[],this._sourceFileMap=new Map,this._parsedFileCount=0,this._editModeTracker=new D,this._lookUpImport=(e,t)=>{var n;let a;if(T.Uri.is(e))a=this.getSourceFileInfo(e);else{const t=this._importResolver.resolveImport(e.importingFileUri,this._configOptions.findExecEnvironment(e.importingFileUri),{leadingDots:0,nameParts:e.nameParts,importedSymbols:void 0});if(t.isImportFound&&!t.isNativeLib&&t.resolvedUris.length>0){const e=t.resolvedUris[t.resolvedUris.length-1];e.isEmpty()||(a=this.getSourceFileInfo(e),a||(this.addTrackedFile(e),a=this.getSourceFileInfo(e)))}}if(!a)return;if(null==t?void 0:t.skipParsing)return{symbolTable:new Map,dunderAllNames:void 0,usesUnsupportedDunderAllForm:!1,get docString(){},isInPyTypedPackage:!1};a.sourceFile.isBindingRequired()&&f.timingStats.typeCheckerTime.subtractFromTime((()=>{this._bindFile(a,void 0,null==t?void 0:t.skipFileNeededCheck)}));const r=a.sourceFile.getModuleSymbolTable();if(!r)return;const s=a.sourceFile.getParserOutput(),i=s.parseTree,o=b.getFileInfo(i),l=b.getDunderAllInfo(s.parseTree);return{symbolTable:r,dunderAllNames:null==l?void 0:l.names,usesUnsupportedDunderAllForm:null!==(n=null==l?void 0:l.usesUnsupportedDunderAllForm)&&void 0!==n&&n,get docString(){return(0,I.getDocString)(i.statements)},isInPyTypedPackage:o.isInPyTypedPackage}},this._console=n.tryGet(g.ServiceKeys.console)||new c.StandardConsole,this._logTracker=null!=a?a:new m.LogTracker(this._console,"FG"),this._importResolver=e,this._configOptions=t,this._sourceFileFactory=n.sourceFileFactory(),this._cacheManager=null!==(i=n.tryGet(g.ServiceKeys.cacheManager))&&void 0!==i?i:new _.CacheManager,this._cacheManager.registerCacheOwner(this),this._createNewEvaluator(),this._id=null!=s?s:`Prog_${F._nextId}`,F._nextId+=1}get id(){return this._id}get console(){return this._console}get rootPath(){return this._configOptions.projectRoot}get evaluator(){return this._evaluator}get configOptions(){return this._configOptions}get importResolver(){return this._importResolver}get fileSystem(){return this._importResolver.fileSystem}dispose(){this._cacheManager.unregisterCacheOwner(this)}enterEditMode(){this._editModeTracker.enable()}exitEditMode(){const e=this._editModeTracker.disable(),t=new Set,n=[];if(e.forEach((e=>{e.isCreatedInEditMode&&t.add(e);const a=e.restore();if(a){const t=o.TextDocument.create(e.sourceFile.getUri().toString(),"python",1,e.sourceFile.getFileContent()||"");n.push({fileUri:e.sourceFile.getUri(),range:{start:{line:0,character:0},end:{line:t.lineCount,character:0}},replacementText:a})}})),t.size>0)for(let e=this._sourceFileList.length-1;e>=0;e--){const n=this._sourceFileList[e];t.has(n)&&(n.sourceFile.prepareForClose(),this._removeSourceFileFromListAndMap(n.sourceFile.getUri(),e))}return e.length>0&&this._createNewEvaluator(),n}setConfigOptions(e){this._configOptions=e,this._importResolver.setConfigOptions(e),this._createNewEvaluator()}setImportResolver(e){this._importResolver=e,this._createNewEvaluator()}setTrackedFiles(e){if(this._sourceFileList.length>0){const t=new Map;e.forEach((e=>{t.set(e.key,e)})),this._sourceFileList.forEach((e=>{const n=e.sourceFile.getUri();t.has(n.key)||(e.isTracked=!1)}))}return this.addTrackedFiles(e),this._removeUnneededFiles()}setPreCheckCallback(e){this._preCheckCallback=e}setAllowedThirdPartyImports(e){this._allowedThirdPartyImports=e}addTrackedFiles(e,t=!1,n=!1){e.forEach((e=>{this.addTrackedFile(e,t,n)}))}addInterimFile(e){let t=this.getSourceFileInfo(e);return t||(t=this._createInterimFileInfo(e),this._addToSourceFileListAndMap(t)),t}addTrackedFile(e,t=!1,n=!1){let a=this.getSourceFileInfo(e);const r=this._getModuleImportInfoForFile(e).moduleName;if(a)return a.sourceFile.setModuleName(r),a.isTracked=!0,a.sourceFile;const s=this._sourceFileFactory.createSourceFile(this.serviceProvider,e,r,t,n,this._editModeTracker,this._console,this._logTracker);return a=new w.SourceFileInfo(s,!1,t,n,this._editModeTracker,{isTracked:!0}),this._addToSourceFileListAndMap(a),s}setFileOpened(e,t,n,a){var r,s;let i=this.getSourceFileInfo(e);if(i)i.isOpenByClient=!0,i.diagnosticsVersion=0;else{const t=this._getModuleImportInfoForFile(e),n=this._sourceFileFactory.createSourceFile(this.serviceProvider,e,t.moduleName,!1,t.isThirdPartyPyTypedPresent,this._editModeTracker,this._console,this._logTracker,null!==(r=null==a?void 0:a.ipythonMode)&&void 0!==r?r:k.IPythonMode.None),o=null==a?void 0:a.chainedFileUri;i=new w.SourceFileInfo(n,!1,!1,!1,this._editModeTracker,{isTracked:null!==(s=null==a?void 0:a.isTracked)&&void 0!==s&&s,chainedSourceFile:o?this.getSourceFileInfo(o):void 0,isOpenByClient:!0}),this._addToSourceFileListAndMap(i)}(0,S.verifyNoCyclesInChainedFiles)(this,i),i.sourceFile.setClientVersion(t,n)}getChainedUri(e){var t;const n=this.getSourceFileInfo(e);return null===(t=null==n?void 0:n.chainedSourceFile)||void 0===t?void 0:t.sourceFile.getUri()}updateChainedUri(e,t){const n=this.getSourceFileInfo(e);n&&(n.chainedSourceFile=t?this.getSourceFileInfo(t):void 0,n.sourceFile.markDirty(),this._markFileDirtyRecursive(n,new Set),(0,S.verifyNoCyclesInChainedFiles)(this,n))}setFileClosed(e,t){const n=this.getSourceFileInfo(e);return n&&(n.isOpenByClient=!1,n.isTracked=null!=t?t:n.isTracked,n.sourceFile.setClientVersion(null,""),n.sourceFile.didContentsChangeOnDisk()&&(n.sourceFile.markDirty(),this._markFileDirtyRecursive(n,new Set))),this._removeUnneededFiles()}markAllFilesDirty(e){const t=new Set;this._sourceFileList.forEach((n=>{e?n.sourceFile.markDirty():n.sourceFile.didContentsChangeOnDisk()&&(n.sourceFile.markDirty(),this._markFileDirtyRecursive(n,t))})),t.size>0&&this._createNewEvaluator()}markFilesDirty(e,t){const n=new Set;e.forEach((e=>{const a=this.getSourceFileInfo(e);if(a){const r=e.fileName;if("builtins.pyi"===r||"__builtins__.pyi"===r)return void this.markAllFilesDirty(t);(t||!a.isOpenByClient&&a.sourceFile.didContentsChangeOnDisk())&&(a.sourceFile.markDirty(),this._markFileDirtyRecursive(a,n))}})),n.size>0&&this._createNewEvaluator()}getFileCount(e=!0){return e?this._sourceFileList.filter((e=>(0,S.isUserCode)(e))).length:this._sourceFileList.length}getUserFileCount(){return this._sourceFileList.filter((e=>(0,S.isUserCode)(e))).length}getUserFiles(){return this._sourceFileList.filter((e=>(0,S.isUserCode)(e)))}getOpened(){return this._sourceFileList.filter((e=>e.isOpenByClient))}getFilesToAnalyzeCount(){let e=0,t=0;return this._disableChecker?{files:0,cells:0}:(this._sourceFileList.forEach((n=>{const a=n.sourceFile;a.isCheckingRequired()&&this._shouldCheckFile(n)&&(a.getIPythonMode()===k.IPythonMode.CellDocs?t++:e++)})),{files:e,cells:t})}isCheckingOnlyOpenFiles(){return this._configOptions.checkOnlyOpenFiles||!1}functionSignatureDisplay(){return this._configOptions.functionSignatureDisplay}containsSourceFileIn(e){for(const t of this._sourceFileMap.values())if(t.sourceFile.getUri().startsWith(e))return!0;return!1}owns(e){const t=this.getSourceFileInfo(e);return t?t.isTracked:(0,p.matchFileSpecs)(this._configOptions,e)}getSourceFile(e){const t=this.getSourceFileInfo(e);if(t)return t.sourceFile}getBoundSourceFile(e){var t;return null===(t=this.getBoundSourceFileInfo(e))||void 0===t?void 0:t.sourceFile}getSourceFileInfoList(){return this._sourceFileList}getSourceFileInfo(e){if(!e.isEmpty())return this._sourceFileMap.get(e.key)}getBoundSourceFileInfo(e,t,n){const a=this.getSourceFileInfo(e);if(a)return this._bindFile(a,t,n),a}analyze(e,t=i.CancellationToken.None){return this._runEvaluatorWithCancellationToken(t,(()=>{const n=new f.Duration,a=this._sourceFileList.filter((e=>e.isOpenByClient&&e.sourceFile.isCheckingRequired()));if(a.length>0){const r=e?e.openFilesTimeInMs:Number.MAX_VALUE;for(const e of a)if(this._checkTypes(e,t)&&n.getDurationInMilliseconds()>r)return!0;if(void 0!==e)return!0}if(!this._configOptions.checkOnlyOpenFiles){const a=e?e.noOpenFilesTimeInMs:Number.MAX_VALUE;for(const e of this._sourceFileList)if((0,S.isUserCode)(e)&&this._checkTypes(e,t)&&n.getDurationInMilliseconds()>a)return!0}return!1}))}analyzeFile(e,t=i.CancellationToken.None){return this._runEvaluatorWithCancellationToken(t,(()=>{const n=this.getSourceFileInfo(e);return!(!n||!this._checkTypes(n,t))}))}run(e,t){return this._runEvaluatorWithCancellationToken(t,(()=>e(this)))}runEditMode(e,t){if(this._editModeTracker.isEditMode)return this._runEvaluatorWithCancellationToken(t,(()=>e(this)))}getSourceMapper(e,t,n,a){const r=this.getSourceFileInfo(e),s=this._configOptions.findExecEnvironment(e);return this._createSourceMapper(s,t,r,n,a)}getParserOutput(e){var t;return null===(t=this.getBoundSourceFileInfo(e,void 0,!0))||void 0===t?void 0:t.sourceFile.getParserOutput()}getParseResults(e){var t;return null===(t=this.getBoundSourceFileInfo(e,void 0,!0))||void 0===t?void 0:t.sourceFile.getParseResults()}handleMemoryHighUsage(){this._handleMemoryHighUsage()}printDetailedAnalysisTimes(){const e=this._sourceFileList.filter((e=>void 0!==e.sourceFile.getCheckTime())).sort(((e,t)=>t.sourceFile.getCheckTime()-e.sourceFile.getCheckTime()));this._console.info(""),this._console.info("Analysis time by file"),e.forEach((e=>{const t=e.sourceFile.getCheckTime();this._console.info(`${t}ms: ${e.sourceFile.getUri()}`)}))}printDependencies(e,t){const n=this._importResolver.fileSystem,a=this._sourceFileList.filter((e=>!e.isTypeshedFile)).sort(((e,t)=>n.getOriginalUri(e.sourceFile.getUri())<n.getOriginalUri(t.sourceFile.getUri())?1:-1)),r=[];a.forEach((a=>{this._console.info("");const s=n.getOriginalUri(a.sourceFile.getUri());let i=s.toString();const o=e.getRelativePathComponents(s);o&&(i=o.join("/")),this._console.info(`${i}`),this._console.info(` Imports     ${a.imports.length} file`+(1===a.imports.length?"":"s")),t&&a.imports.forEach((e=>{this._console.info(`    ${n.getOriginalUri(e.sourceFile.getUri())}`)})),this._console.info(` Imported by ${a.importedBy.length} file`+(1===a.importedBy.length?"":"s")),t&&a.importedBy.forEach((e=>{this._console.info(`    ${n.getOriginalUri(e.sourceFile.getUri())}`)})),0===a.importedBy.length&&r.push(a.sourceFile)})),r.length>0&&(this._console.info(""),this._console.info(`${r.length} file${1===r.length?"":"s"} not explicitly imported`),r.forEach((e=>{this._console.info(`    ${n.getOriginalUri(e.getUri())}`)})))}writeTypeStub(e,t,n,a){for(const r of this._sourceFileList){(0,l.throwIfCancellationRequested)(a);const s=r.sourceFile.getUri(),i=e.getRelativePath(s);if(void 0!==i){let e=n.resolvePaths(i);e=t?e.getDirectory().initPyiUri:e.replaceExtension(".pyi");const s=e.getDirectory();try{(0,v.makeDirectories)(this.fileSystem,s,n)}catch(e){throw new Error(`Could not create directory for '${s}'`)}this._bindFile(r),this._runEvaluatorWithCancellationToken(a,(()=>{new N.TypeStubWriter(e,r.sourceFile,this._evaluator).write()})),this._handleMemoryHighUsage()}}}getTypeOfSymbol(e){this._handleMemoryHighUsage();return(this._evaluator||this._createNewEvaluator()).getEffectiveTypeOfSymbol(e)}printType(e,t){this._handleMemoryHighUsage();return(this._evaluator||this._createNewEvaluator()).printType(e,t)}getTextOnRange(e,t,n){const a=this.getSourceFileInfo(e);if(!a)return;const r=a.sourceFile,s=r.getOpenFileContents();return void 0!==s?this._runEvaluatorWithCancellationToken(n,(()=>{this._parseFile(a);const e=r.getParseResults(),n=(0,y.convertRangeToTextRange)(t,e.tokenizerOutput.lines);if(n)return s.substr(n.start,n.length)})):void 0}getDiagnostics(e,t=!0){const n=this._removeUnneededFiles();return this._sourceFileList.forEach((a=>{if(this._shouldCheckFile(a)){let r=a.sourceFile.getDiagnostics(e,t?a.diagnosticsVersion:void 0);void 0!==r&&(e.disableTaggedHints&&(r=r.filter((e=>4!==e.category&&3!==e.category&&5!==e.category))),n.push({fileUri:a.sourceFile.getUri(),version:a.sourceFile.getClientVersion(),diagnostics:r}),a.diagnosticsVersion=a.sourceFile.getDiagnosticVersion())}else!a.isOpenByClient&&e.checkOnlyOpenFiles&&void 0!==a.diagnosticsVersion&&(n.push({fileUri:a.sourceFile.getUri(),version:a.sourceFile.getClientVersion(),diagnostics:[]}),a.diagnosticsVersion=void 0)})),n}getDiagnosticsForRange(e,t){const n=this.getSourceFile(e);if(!n)return[];const a=n.getDiagnostics(this._configOptions);return a?a.filter((e=>(0,h.doRangesIntersect)(e.range,t))):[]}clone(){var e,t;const n=new F(this._importResolver,this._configOptions,this.serviceProvider,new m.LogTracker(this._console,"Cloned")),a=this.getUserFiles();n.setTrackedFiles(a.map((e=>e.sourceFile.getUri()))),n.markAllFilesDirty(!0);for(const a of this.getOpened()){const r=a.sourceFile.getClientVersion();void 0!==r&&n.setFileOpened(a.sourceFile.getUri(),r,null!==(e=a.sourceFile.getOpenFileContents())&&void 0!==e?e:"",{chainedFileUri:null===(t=a.chainedSourceFile)||void 0===t?void 0:t.sourceFile.getUri(),ipythonMode:a.sourceFile.getIPythonMode(),isTracked:a.isTracked})}return n}getCacheUsage(){const e=this._evaluator.getTypeCacheEntryCount()/75e4,t=this._parsedFileCount/1e3;return Math.max(e,t)}emptyCache(){var e;this._createNewEvaluator(),this._discardCachedParseResults(),this._parsedFileCount=0,null===(e=this.serviceProvider.tryGet(g.ServiceKeys.stateMutationListeners))||void 0===e||e.forEach((e=>{var t;return null===(t=e.onClearCache)||void 0===t?void 0:t.call(e)}))}_handleMemoryHighUsage(){const e=this._cacheManager.getCacheUsage(),t=this._cacheManager.getUsedHeapRatio(this._configOptions.verboseOutput?this._console:void 0);if(e>.75||t>.9){const e=15099494.4;(this._evaluator.getTypeCacheEntryCount()>e||t>.9)&&this._cacheManager.emptyCache(this._console)}}_discardCachedParseResults(){for(const e of this._sourceFileList)e.sourceFile.dropParseAndBindInfo()}_runEvaluatorWithCancellationToken(e,t){try{return e?this._evaluator.runWithCancellationToken(e,t):t()}catch(e){throw l.OperationCanceledException.is(e)&&!e.isTypeCacheInvalid||this._createNewEvaluator(),e}}_removeUnneededFiles(){const e=[];for(let t=0;t<this._sourceFileList.length;){const n=this._sourceFileList[t];this._isFileNeeded(n)?(this._shouldCheckFile(n)||void 0===n.diagnosticsVersion||(e.push({fileUri:n.sourceFile.getUri(),version:n.sourceFile.getClientVersion(),diagnostics:[]}),n.diagnosticsVersion=void 0),t++):(void 0!==n.diagnosticsVersion&&e.push({fileUri:n.sourceFile.getUri(),version:n.sourceFile.getClientVersion(),diagnostics:[]}),n.sourceFile.prepareForClose(),this._removeSourceFileFromListAndMap(n.sourceFile.getUri(),t),n.imports.forEach((a=>{const r=a.importedBy.findIndex((e=>e===n));if(!(r<0||(a.mutate((e=>e.importedBy.splice(r,1))),this._isFileNeeded(a)))){const n=this._sourceFileList.findIndex((e=>e===a));n>=0&&n<t&&(void 0!==a.diagnosticsVersion&&e.push({fileUri:a.sourceFile.getUri(),version:a.sourceFile.getClientVersion(),diagnostics:[]}),a.sourceFile.prepareForClose(),this._removeSourceFileFromListAndMap(a.sourceFile.getUri(),n),t--)}})),n.shadowedBy.forEach((e=>{e.mutate((e=>e.shadows=e.shadows.filter((e=>e!==n))))})),n.mutate((e=>e.shadowedBy=[])))}return e}_isFileNeeded(e,t){return!e.sourceFile.isFileDeleted()&&(!!(t||e.isTracked||e.isOpenByClient)||(e.shadows.length>0||0!==e.importedBy.length&&this._isImportNeededRecursive(e,new Set)))}_isImportNeededRecursive(e,t){if(e.isTracked||e.isOpenByClient||e.shadows.length>0)return!0;const n=e.sourceFile.getUri();if(t.has(n.key))return!1;t.add(n.key);for(const n of e.importedBy)if(this._isImportNeededRecursive(n,t))return!0;return!1}_createSourceMapper(e,t,n,a,r){return new A.SourceMapper(this._importResolver,e,this._evaluator,((e,t)=>{let n=this.getSourceFileInfo(e);if(!n){if(!this.fileSystem.existsSync(e))return;n=this.addInterimFile(e)}return this._addShadowedFile(n,t),this.getBoundSourceFile(t)}),(e=>{let t=this.getBoundSourceFileInfo(e);if(!t){if(!this.fileSystem.existsSync(e))return;t=this.addInterimFile(e),this._parseFile(t,void 0,!0)}return t}),null!=a&&a,null!=r&&r,n,t)}_isImportAllowed(e,t,n){if(t.isNativeLib)return!1;let a=this._configOptions.useLibraryCodeForTypes||1===t.importType&&!!t.pyTypedInfo||2===t.importType&&e.isThirdPartyPyTypedPresent;return!((1===t.importType||e.isThirdPartyImport&&2===t.importType)&&(this._allowedThirdPartyImports?(t.isRelative||this._allowedThirdPartyImports.some((e=>t.importName===e||!!t.importName.startsWith(e+"."))))&&(a=!0):(e.isThirdPartyImport&&this._configOptions.useLibraryCodeForTypes||t.isNamespacePackage&&Array.from(t.filteredImplicitImports.values()).some((e=>!!e.pyTypedInfo)))&&(a=!0),!n))||a}_getSourceFileInfoFromKey(e){return this._sourceFileMap.get(e)}_updateSourceFileImports(e,t){const n=[],a=e.sourceFile.getImports(),r=t=>{let n=!1,a=!1;return 1===t.importType?(n=!0,t.pyTypedInfo&&(a=!0)):e.isThirdPartyImport&&2===t.importType&&(n=!0,e.isThirdPartyPyTypedPresent&&(a=!0)),{isThirdPartyImport:n,isPyTypedPresent:a}},s=new Map;if(e.chainedSourceFile)if(e.chainedSourceFile.sourceFile.isFileDeleted())e.chainedSourceFile=void 0;else{const t=e.chainedSourceFile.sourceFile.getUri();s.set(t.key,{path:t,isTypeshedFile:!1,isThirdPartyImport:!1,isPyTypedPresent:!1})}a.forEach((n=>{if(n.isImportFound){if(this._isImportAllowed(e,n,n.isStubFile)&&n.resolvedUris.length>0){const e=n.resolvedUris[n.resolvedUris.length-1];if(!e.isEmpty()){const t=r(n);s.set(e.key,{path:e,isTypeshedFile:!!n.isStdlibTypeshedFile||!!n.isThirdPartyTypeshedFile,isThirdPartyImport:t.isThirdPartyImport,isPyTypedPresent:t.isPyTypedPresent})}}n.filteredImplicitImports.forEach((t=>{if(this._isImportAllowed(e,n,t.isStubFile)&&!t.isNativeLib){const e=r(n);s.set(t.uri.key,{path:t.uri,isTypeshedFile:!!n.isStdlibTypeshedFile||!!n.isThirdPartyTypeshedFile,isThirdPartyImport:e.isThirdPartyImport,isPyTypedPresent:e.isPyTypedPresent})}})),n.nonStubImportResult&&!n.nonStubImportResult.isImportFound&&(e.sourceFile.isStubFile()||n.isStdlibTypeshedFile||t.verboseOutput&&(this._console.info(`Could not resolve source for '${n.importName}' in file '${e.sourceFile.getUri().toUserVisibleString()}'`),n.nonStubImportResult.importFailureInfo&&n.nonStubImportResult.importFailureInfo.forEach((e=>{this._console.info(`  ${e}`)}))))}else t.verboseOutput&&(this._console.info(`Could not import '${n.importName}' in file '${e.sourceFile.getUri().toUserVisibleString()}'`),n.importFailureInfo&&n.importFailureInfo.forEach((e=>{this._console.info(`  ${e}`)})))}));const i=new Map;e.imports.forEach((t=>{const n=t.sourceFile.getUri();s.has(n.key)?i.set(n.key,t):t.mutate((t=>{t.importedBy=t.importedBy.filter((t=>!t.sourceFile.getUri().equals(e.sourceFile.getUri())))}))})),s.forEach(((t,a)=>{if(!i.has(a)){let r=this.getSourceFileInfo(t.path);if(!r){const e=this._getModuleImportInfoForFile(t.path),a=this._sourceFileFactory.createSourceFile(this.serviceProvider,t.path,e.moduleName,t.isThirdPartyImport,t.isPyTypedPresent,this._editModeTracker,this._console,this._logTracker);r=new w.SourceFileInfo(a,t.isTypeshedFile,t.isThirdPartyImport,t.isPyTypedPresent,this._editModeTracker),this._addToSourceFileListAndMap(r),n.push(r)}r.mutate((t=>t.importedBy.push(e))),i.set(a,r)}})),e.mutate((e=>e.imports=[])),s.forEach(((t,n)=>{this._getSourceFileInfoFromKey(n)&&e.mutate((e=>e.imports.push(this._getSourceFileInfoFromKey(n))))})),e.builtinsImport=void 0;const o=e.sourceFile.getBuiltinsImport();if(o&&o.isImportFound){const t=o.resolvedUris[o.resolvedUris.length-1];e.builtinsImport=this.getSourceFileInfo(t)}return n}_removeSourceFileFromListAndMap(e,t){this._sourceFileMap.delete(e.key),this._sourceFileList.splice(t,1)}_addToSourceFileListAndMap(e){const t=e.sourceFile.getUri();(0,u.assert)(!this._sourceFileMap.has(t.key)),(0,u.assert)(!t.isEmpty()),this._sourceFileList.push(e),this._sourceFileMap.set(t.key,e)}static _getPrintTypeFlags(e){let t=0;return e.diagnosticRuleSet.printUnknownAsAny&&(t|=1),e.diagnosticRuleSet.omitConditionalConstraint&&(t|=64),e.diagnosticRuleSet.omitTypeArgsIfUnknown&&(t|=2),e.diagnosticRuleSet.omitUnannotatedParamType&&(t|=4),e.diagnosticRuleSet.pep604Printing&&(t|=8),t}_getModuleImportInfoForFile(e){return this._importResolver.getModuleNameForImport(e,this._configOptions.getDefaultExecEnvironment(),!0,!0)}_addShadowedFile(e,t){let n=this.getSourceFileInfo(t);return n||(n=this.addInterimFile(t)),n.shadows.includes(e)||n.mutate((t=>t.shadows.push(e))),e.shadowedBy.includes(n)||e.mutate((e=>e.shadowedBy.push(n))),n.sourceFile}_createInterimFileInfo(e){const t=this._getModuleImportInfoForFile(e),n=this._sourceFileFactory.createSourceFile(this.serviceProvider,e,t.moduleName,!1,!1,this._editModeTracker,this._console,this._logTracker);return new w.SourceFileInfo(n,!1,!1,!1,this._editModeTracker)}_createNewEvaluator(){return this._evaluator&&this._evaluator.disposeEvaluator(),this._evaluator=(0,P.createTypeEvaluatorWithTracker)(this._lookUpImport,{printTypeFlags:F._getPrintTypeFlags(this._configOptions),logCalls:this._configOptions.logTypeEvaluationTime,minimumLoggingThreshold:this._configOptions.typeEvaluationTimeThreshold,evaluateUnknownImportsAsAny:!!this._configOptions.evaluateUnknownImportsAsAny,verifyTypeCacheEvaluatorFlags:!!this._configOptions.internalTestMode},this._logTracker,this._configOptions.logTypeEvaluationTime?(0,x.createTracePrinter)(this._importResolver.getImportRoots(this._configOptions.findExecEnvironment(this._configOptions.projectRoot))):void 0),this._evaluator}_parseFile(e,t,n){if(this._isFileNeeded(e,n)&&e.sourceFile.isParseRequired()&&(e.sourceFile.parse(this._configOptions,this._importResolver,t)&&(this._parsedFileCount++,this._updateSourceFileImports(e,this._configOptions)),e.sourceFile.isFileDeleted())){e.isTracked=!1;const t=new Set;this._markFileDirtyRecursive(e,t),this._importResolver.invalidateCache()}}_getImplicitImports(e){var t;if(e.builtinsImport===e)return;return null!==(t=(e=>{if(e&&!e.sourceFile.isFileDeleted())return e})(e.chainedSourceFile))&&void 0!==t?t:e.builtinsImport}_bindImplicitImports(e,t){var n,a;const r=[],s=new Set;let i=this._getImplicitImports(e);for(;i;){const e=i.sourceFile.getUri();s.has(e.key)&&d.fail(null!==(a=null===(n=this.serviceProvider.tryGet(g.ServiceKeys.debugInfoInspector))||void 0===n?void 0:n.getCycleDetail(this,i))&&void 0!==a?a:"Found a cycle in implicit imports files"),s.add(e.key),r.push(i),this._parseFile(i,void 0,t),i=this._getImplicitImports(i)}if(0===r.length)return;let o=r.pop();for(;o;)this._bindFile(o,void 0,t,!0),o=r.pop()}_bindFile(e,t,n,a){var r;if(!this._isFileNeeded(e,n)||!e.sourceFile.isBindingRequired())return!e.sourceFile.isBindingRequired();this._parseFile(e,t,n);const s=t=>{if(!t||t===e)return;if(t.sourceFile.isFileDeleted())return;const n=t.sourceFile.getParserOutput();if(!n)return;return b.getScope(n.parseTree)};let i;e.builtinsImport&&e.builtinsImport!==e&&(a||this._bindImplicitImports(e),i=null!==(r=s(e.chainedSourceFile))&&void 0!==r?r:s(e.builtinsImport));let o=e.sourceFile.getParserOutput().futureImports;return e.chainedSourceFile&&(o=this._getEffectiveFutureImports(o,e.chainedSourceFile)),e.effectiveFutureImports=o.size>0?o:void 0,e.sourceFile.bind(this._configOptions,this._lookUpImport,i,o),!0}_getEffectiveFutureImports(e,t){var n;const a=new Set(e);return null===(n=t.effectiveFutureImports)||void 0===n||n.forEach((e=>{a.add(e)})),a}_shouldCheckFile(e){return!!e.isOpenByClient||!(this._configOptions.checkOnlyOpenFiles||!e.isTracked)}_checkTypes(e,t,n){return this._logTracker.log(`analyzing: ${e.sourceFile.getUri()}`,(a=>{if(!this._isFileNeeded(e))return a.suppress(),!1;if(!e.sourceFile.isCheckingRequired())return a.suppress(),!1;if(!this._shouldCheckFile(e))return a.suppress(),!1;const r=this._bindFile(e,void 0,e.sourceFile.isBindingRequired());if(!this._disableChecker){const a=this._checkDependentFiles(e,n,t);if(this._preCheckCallback){const t=e.sourceFile.getParserOutput();t&&this._preCheckCallback(t,this._evaluator)}if(r){const n=this._configOptions.findExecEnvironment(e.sourceFile.getUri());e.sourceFile.check(this.configOptions,this._importResolver,this._evaluator,this._createSourceMapper(n,t,e),a)}}if(this._handleMemoryHighUsage(),"none"!==this._configOptions.diagnosticRuleSet.reportImportCycles&&!this._allowedThirdPartyImports&&e.sourceFile.getIPythonMode()!==k.IPythonMode.CellDocs){const t=new Map;this._getImportsRecursive(e,t,0),t.forEach((e=>{f.timingStats.cycleDetectionTime.timeOperation((()=>{const t=new Map;this._detectAndReportImportCycles(e,t)||t.forEach((e=>{e.sourceFile.setNoCircularDependencyConfirmed()}))}))}))}return!0}))}_checkDependentFiles(e,t,n){if(e.sourceFile.getIPythonMode()!==k.IPythonMode.CellDocs)return;const a=!t,r=(t=null!=t?t:(0,S.createChainedByList)(this,e)).findIndex((t=>t===e));if(r<0)return;const s=r+1;if(s>=t.length)return;if(a){const e=this._cacheManager.pauseTracking();try{for(let e=t.length-1;e>=s;e--)this._checkTypes(t[e],n,t)}finally{e.dispose()}}const i=[];for(let e=s;e<t.length;e++){const n=t[e],a=null==n?void 0:n.sourceFile.getParserOutput();if(!a)continue;const r=b.getFileInfo(a.parseTree);r&&r.accessedSymbolSet&&i.push(a)}return i}_getImportsRecursive(e,t,n){const a=e.sourceFile.getUri();if(!t.has(a.key))if(n>256)e.sourceFile.setHitMaxImportDepth(256);else{t.set(a.key,e),(0,S.isUserCode)(e)&&this._parseFile(e);for(const a of e.imports)this._getImportsRecursive(a,t,n+1)}}_detectAndReportImportCycles(e,t,n=[],a=new Map){if(e.sourceFile.isStubFile()||e.isThirdPartyImport)return!1;if(e.sourceFile.isNoCircularDependencyConfirmed())return!1;const r=e.sourceFile.getUri();t.set(r.key,e);let s=!1;if(a.has(r.key))s=!0,n.length>1&&e===n[0]&&this._logImportCycle(n);else{if(a.has(r.key))return!1;a.set(r.key,!0),n.push(e);for(const r of e.imports)this._detectAndReportImportCycles(r,t,n,a)&&(s=!0);a.set(r.key,!1),n.pop()}return s}_logImportCycle(e){const t=new C.CircularDependency;e.forEach((e=>{t.appendPath(e.sourceFile.getUri())})),t.normalizeOrder();const n=t.getPaths()[0],a=this.getSourceFileInfo(n);(0,u.assert)(void 0!==a),a.sourceFile.addCircularDependency(this.configOptions,t)}_markFileDirtyRecursive(e,t,n=!1){const a=e.sourceFile.getUri();if(t.has(a.key))return;e.sourceFile.markReanalysisRequired(n),t.add(a.key),e.importedBy.forEach((n=>{const a=n.chainedSourceFile===e;this._markFileDirtyRecursive(n,t,a)}));let r=!1,s=e.chainedSourceFile;for(;s;){if(s.sourceFile.isCheckingRequired())return;r=!0,s.sourceFile.markReanalysisRequired(!1),s=s.chainedSourceFile}r&&this._createNewEvaluator()}}t.Program=F,F._nextId=0},23260:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ISourceFileFactory=void 0,function(e){e.is=function(e){return void 0!==e.createSourceFile}}(n||(t.ISourceFileFactory=n={}))},50520:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assignProperty=t.clonePropertyWithDeleter=t.clonePropertyWithSetter=t.createProperty=t.validatePropertyMethod=void 0;const a=n(72484),r=n(97652),s=n(95960),i=n(9316),o=n(28340),l=n(52328),p=n(8312),c=n(808);function d(e,t,n){const a=p.ClassType.getSymbolTable(t),r=p.FunctionType.createSynthesizedInstance("__get__",256);p.FunctionType.addParameter(r,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0}),p.FunctionType.addParameter(r,{category:0,name:"obj",type:e.getNoneType(),hasDeclaredType:!0}),p.FunctionType.addParameter(r,{category:0,name:"objtype",type:p.AnyType.create(),hasDeclaredType:!0,hasDefault:!0,defaultType:p.AnyType.create()}),r.details.declaredReturnType=p.FunctionType.isClassMethod(n)?p.FunctionType.getSpecializedReturnType(n):t,r.details.declaration=n.details.declaration,r.details.deprecatedMessage=n.details.deprecatedMessage,r.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n);const s=p.FunctionType.createSynthesizedInstance("__get__",256);p.FunctionType.addParameter(s,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0});const i=n.details.parameters.length>0?p.FunctionType.getEffectiveParameterType(n,0):p.AnyType.create();p.FunctionType.addParameter(s,{category:0,name:"obj",type:i,hasDeclaredType:!0}),p.FunctionType.addParameter(s,{category:0,name:"objtype",type:p.AnyType.create(),hasDeclaredType:!0,hasDefault:!0,defaultType:p.AnyType.create()}),s.details.declaredReturnType=p.FunctionType.getSpecializedReturnType(n),s.details.declaration=n.details.declaration,s.details.deprecatedMessage=n.details.deprecatedMessage,s.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n);const o=p.OverloadedFunctionType.create([s,r]),d=l.Symbol.createWithType(4,o);a.set("__get__",d)}function u(e,t,n){const a=p.ClassType.getSymbolTable(t),r=p.FunctionType.createSynthesizedInstance("__set__");p.FunctionType.addParameter(r,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0});let s=n.details.parameters.length>0?p.FunctionType.getEffectiveParameterType(n,0):p.AnyType.create();(0,p.isTypeVar)(s)&&s.details.isSynthesizedSelf&&(s=e.makeTopLevelTypeVarsConcrete(s)),p.FunctionType.addParameter(r,{category:0,name:"obj",type:(0,p.combineTypes)([s,e.getNoneType()]),hasDeclaredType:!0}),r.details.declaredReturnType=e.getNoneType(),r.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n),r.details.deprecatedMessage=n.details.deprecatedMessage;let i=p.UnknownType.create();n.details.parameters.length>=2&&0===n.details.parameters[1].category&&n.details.parameters[1].name&&(i=n.details.parameters[1].type),p.FunctionType.addParameter(r,{category:0,name:"value",type:i,hasDeclaredType:!0});const o=l.Symbol.createWithType(4,r);a.set("__set__",o)}function m(e,t,n){const a=p.ClassType.getSymbolTable(t),r=p.FunctionType.createSynthesizedInstance("__delete__");p.FunctionType.addParameter(r,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0}),r.details.typeVarScopeId=(0,c.getTypeVarScopeId)(n),r.details.deprecatedMessage=n.details.deprecatedMessage;let s=n.details.parameters.length>0?p.FunctionType.getEffectiveParameterType(n,0):p.AnyType.create();(0,p.isTypeVar)(s)&&s.details.isSynthesizedSelf&&(s=e.makeTopLevelTypeVarsConcrete(s)),p.FunctionType.addParameter(r,{category:0,name:"obj",type:(0,p.combineTypes)([s,e.getNoneType()]),hasDeclaredType:!0}),r.details.declaredReturnType=e.getNoneType();const i=l.Symbol.createWithType(4,r);a.set("__delete__",i)}function y(e,t){const n=t.fgetInfo;n&&(0,p.isFunction)(n.methodType)&&d(e,t,n.methodType);const a=t.fsetInfo;a&&(0,p.isFunction)(a.methodType)&&u(e,t,a.methodType);const r=t.fdelInfo;r&&(0,p.isFunction)(r.methodType)&&m(e,t,r.methodType)}function g(e){const t=p.ClassType.getSymbolTable(e);["getter","setter","deleter"].forEach((n=>{const a=p.FunctionType.createSynthesizedInstance(n);p.FunctionType.addParameter(a,{category:0,name:"self",type:p.AnyType.create(),hasDeclaredType:!0}),p.FunctionType.addParameter(a,{category:0,name:"accessor",type:p.AnyType.create(),hasDeclaredType:!0}),a.details.declaredReturnType=e;const r=l.Symbol.createWithType(4,a);t.set(n,r)}))}t.validatePropertyMethod=function(e,t,n){p.FunctionType.isStaticMethod(t)&&e.addDiagnostic(r.DiagnosticRule.reportGeneralTypeIssues,s.LocMessage.propertyStaticMethod(),n)},t.createProperty=function(e,t,n,a){const r=(0,i.getFileInfo)(t),s=e.getBuiltInType(t,"type"),l=p.ClassType.isBuiltIn(n,"property")?(0,o.getTypeSourceId)(t):n.details.typeSourceId,u=p.ClassType.createInstantiable(n.details.name,(0,o.getClassFullName)(t,r.moduleName,`__property_${a.details.name}`),r.moduleName,r.fileUri,4097,l,void 0,(0,p.isInstantiableClass)(s)?s:p.UnknownType.create());u.details.declaration=n.details.declaration,u.details.typeVarScopeId=n.details.typeVarScopeId;const m=e.getBuiltInType(t,"object");u.details.baseClasses.push((0,p.isInstantiableClass)(m)?m:p.UnknownType.create()),(0,c.computeMroLinearization)(u);const h=p.ClassType.getSymbolTable(u);p.ClassType.getSymbolTable(n).forEach(((e,t)=>{const n=["__get__","__set__","__delete__"];e.isIgnoredForProtocolMatch()||n.some((e=>e===t))||h.set(t,e)}));const f=p.ClassType.cloneAsInstance(u);return u.isAsymmetricDescriptor=!1,y(e,f),f.fgetInfo={methodType:p.FunctionType.cloneWithNewFlags(a,4|a.details.flags),classType:a.details.methodClass},p.FunctionType.isClassMethod(a)&&(u.details.flags|=8388608),d(e,f,a),g(f),f},t.clonePropertyWithSetter=function(e,t,n,l){if(!(0,c.isProperty)(t))return t;const d=t,m=d.details.flags;let h=!!d.isAsymmetricDescriptor;const f=(0,i.getFileInfo)(l);if(l.parameters.length>=2){const t=(0,o.getTypeAnnotationForParameter)(l,1);if(t){const n=e.getGetterTypeFromProperty(d,!1);if(n&&!(0,p.isAnyOrUnknown)(n)){const i=e.getTypeOfAnnotation(t,{associateTypeVarsWithScope:!0});if("none"!==f.diagnosticRuleSet.reportPropertyTypeMismatch){const o=new a.DiagnosticAddendum;e.assignType(n,i,o)||e.addDiagnostic(r.DiagnosticRule.reportPropertyTypeMismatch,s.LocMessage.setterGetterTypeMismatch()+o.getString(),t)}(0,p.isTypeSame)(n,i)||(h=!0)}}}const T=p.ClassType.createInstantiable(d.details.name,d.details.fullName,d.details.moduleName,(0,i.getFileInfo)(l).fileUri,m,d.details.typeSourceId,d.details.declaredMetaclass,d.details.effectiveMetaclass);T.details.declaration=d.details.declaration,T.details.typeVarScopeId=d.details.typeVarScopeId;const v=e.getBuiltInType(l,"object");T.details.baseClasses.push((0,p.isInstantiableClass)(v)?v:p.UnknownType.create()),(0,c.computeMroLinearization)(T),T.fgetInfo=d.fgetInfo,T.fdelInfo=d.fdelInfo,T.isAsymmetricDescriptor=h;const b=p.ClassType.cloneAsInstance(T),_=p.ClassType.getSymbolTable(T);return p.ClassType.getSymbolTable(d).forEach(((e,t)=>{e.isIgnoredForProtocolMatch()||_.set(t,e)})),y(e,b),b.fsetInfo={methodType:p.FunctionType.cloneWithNewFlags(n,4|n.details.flags),classType:n.details.methodClass},u(e,b,n),g(b),b},t.clonePropertyWithDeleter=function(e,t,n,a){var r;if(!(0,c.isProperty)(t))return t;const s=t,o=p.ClassType.createInstantiable(s.details.name,s.details.fullName,s.details.moduleName,(0,i.getFileInfo)(a).fileUri,s.details.flags,s.details.typeSourceId,s.details.declaredMetaclass,s.details.effectiveMetaclass);o.details.declaration=s.details.declaration,o.details.typeVarScopeId=s.details.typeVarScopeId;const l=e.getBuiltInType(a,"object");o.details.baseClasses.push((0,p.isInstantiableClass)(l)?l:p.UnknownType.create()),(0,c.computeMroLinearization)(o),o.fgetInfo=s.fgetInfo,o.fsetInfo=s.fsetInfo;const d=p.ClassType.cloneAsInstance(o);o.isAsymmetricDescriptor=null!==(r=s.isAsymmetricDescriptor)&&void 0!==r&&r;const u=p.ClassType.getSymbolTable(o);return p.ClassType.getSymbolTable(s).forEach(((e,t)=>{e.isIgnoredForProtocolMatch()||u.set(t,e)})),y(e,d),d.fdelInfo={methodType:p.FunctionType.cloneWithNewFlags(n,4|n.details.flags),classType:n.details.methodClass},m(e,d,n),g(d),d},t.assignProperty=function(e,t,n,a,r,i,o,l,d=0){const u=(0,p.isClass)(r)?p.ClassType.cloneAsInstance(r):void 0,m=p.ClassType.cloneAsInstance(a);let y=!0;return[{getFunction:e=>{var t;return null===(t=e.fgetInfo)||void 0===t?void 0:t.methodType},missingDiagMsg:s.LocAddendum.missingGetter,incompatibleDiagMsg:s.LocAddendum.incompatibleGetter},{getFunction:e=>{var t;return null===(t=e.fsetInfo)||void 0===t?void 0:t.methodType},missingDiagMsg:s.LocAddendum.missingSetter,incompatibleDiagMsg:s.LocAddendum.incompatibleSetter},{getFunction:e=>{var t;return null===(t=e.fdelInfo)||void 0===t?void 0:t.methodType},missingDiagMsg:s.LocAddendum.missingDeleter,incompatibleDiagMsg:s.LocAddendum.incompatibleDeleter}].forEach((a=>{let r=a.getFunction(t);if(r&&(0,p.isFunction)(r)){let t=a.getFunction(n);if(!t||!(0,p.isFunction)(t))return null==i||i.addMessage(a.missingDiagMsg()),void(y=!1);e.inferReturnTypeIfNecessary(t),e.inferReturnTypeIfNecessary(r),l&&(r=(0,c.applySolvedTypeVars)(r,l)),r=p.FunctionType.cloneWithNewFlags(r,-5&r.details.flags),t=p.FunctionType.cloneWithNewFlags(t,-5&t.details.flags);const s=e.bindFunctionToClassOrObject(m,r,void 0,void 0,void 0,null==i?void 0:i.createAddendum(),d),g=e.bindFunctionToClassOrObject(u,t,void 0,void 0,void 0,null==i?void 0:i.createAddendum(),d);s&&g&&e.assignType(s,g,i,o,void 0,0,d)||(y=!1)}})),y}},85636:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isProtocolUnsafeOverlap=t.isMethodOnlyProtocol=t.assignModuleToProtocol=t.assignClassToProtocol=void 0;const a=n(83181),r=n(72484),s=n(95960),i=n(99868),o=n(50520),l=n(8e4),p=n(8312),c=n(808),d=n(97632),u=[],m=64;function y(e,t,n,r,u,m,y,g){var h;if(0!=(1&y))return(0,p.isTypeSame)(t,n);const f=(0,p.isClass)(n)&&p.TypeBase.isInstantiable(n),T=function(e,t,n){const a=new d.TypeVarContext((0,c.getTypeVarScopeId)(t));return t.details.typeParameters.forEach(((r,s)=>{const o=null==n?void 0:n.getPrimarySignature().getTypeVar(r);if(o)a.setTypeVarType(r,o.narrowBound,o.narrowBoundNoLiterals,o.wideBound);else if(t.typeArguments&&s<t.typeArguments.length){let o=t.typeArguments[s],l=2048,p=(0,c.requiresSpecialization)(o);p&&n&&(o=(0,c.applySolvedTypeVars)(o,n,{useNarrowBoundOnly:!0}),l=0,p=(0,c.requiresSpecialization)(o)),p||(0,i.assignTypeToTypeVar)(e,r,o,void 0,a,l)}})),a}(e,t,u),v=new d.TypeVarContext((0,c.getTypeVarScopeId)(t));let b;if((0,p.isClass)(n)&&(b=(null===(h=n.condition)||void 0===h?void 0:h.some((e=>e.typeVar.details.isSynthesizedSelf)))?(0,c.synthesizeTypeVarForSelfCls)(p.TypeBase.cloneForCondition(n,void 0),!1):n,(0,c.populateTypeVarContextForSelfType)(v,t,b)),(0,p.isClass)(n)&&p.ClassType.isTypedDictClass(n)){const t=e.getTypedDictClassType();t&&(0,p.isInstantiableClass)(t)&&(n=t)}let _=!0;const C=new Set;let I=48&y;if(I|=(0,c.containsLiteralType)(n,!0)?256:0,t.details.mro.forEach((i=>{(0,p.isInstantiableClass)(i)&&p.ClassType.isProtocolClass(i)&&(_||r)&&p.ClassType.getSymbolTable(i).forEach(((d,u)=>{var m;if(!_&&!r)return;if(!d.isClassMember()||d.isIgnoredForProtocolMatch()||C.has(u))return;let y,h,k=!1;if(!f&&"__class_getitem__"===u)return;if("__slots__"===u)return;C.add(u);let w,S=null===(m=e.getDeclaredTypeOfSymbol(d))||void 0===m?void 0:m.type;if(!S)return;let A=!1;if((0,p.isClass)(n)){if(f&&n.details.effectiveMetaclass&&(0,p.isInstantiableClass)(n.details.effectiveMetaclass)&&(y=(0,c.lookUpClassMember)(n.details.effectiveMetaclass,u),y&&(k=!0)),y||(y=(0,c.lookUpClassMember)(n,u)),!y)return null==r||r.addMessage(s.LocAddendum.protocolMemberMissing().format({name:u})),void(_=!1);if(h=y.symbol,p.ClassType.isSameGenericClass(i,t)||(S=(0,c.partiallySpecializeType)(S,i,b)),(0,p.isInstantiableClass)(y.classType)){const t=e.getEffectiveTypeOfSymbol(y.symbol);(0,p.isFunction)(t)&&e.inferReturnTypeIfNecessary(t),w=(0,c.partiallySpecializeType)(t,y.classType,b)}else w=p.UnknownType.create();if(((0,p.isFunction)(w)||(0,p.isOverloadedFunction)(w))&&(k||(0,p.isInstantiableClass)(y.classType))){let t=!y.symbol.isClassMember();if(p.ClassType.isDataClass(n)){p.ClassType.getDataClassEntries(n).some((e=>e.name===u))&&(t=!0)}if(k&&(t=!1),!t){const t=e.bindFunctionToClassOrObject(f&&!k?n:p.ClassType.cloneAsInstance(n),w,k?void 0:y.classType,void 0,k?n:b,null==r?void 0:r.createAddendum(),g);if(!t)return void(_=!1);w=(0,c.removeParamSpecVariadicsFromSignature)(t)}}(p.ClassType.isFrozenDataClass(n)||p.ClassType.isReadOnlyInstanceVariables(n))&&(A=!0)}else{if(h=n.fields.get(u),!h)return null==r||r.addMessage(s.LocAddendum.protocolMemberMissing().format({name:u})),void(_=!1);w=e.getEffectiveTypeOfSymbol(h)}if(S=(0,c.applySolvedTypeVars)(S,v),(0,p.isFunction)(S)||(0,p.isOverloadedFunction)(S)){let s;if((0,p.isClass)(n)?((0,a.assert)(y),(k||(0,p.isInstantiableClass)(y.classType))&&(s=e.bindFunctionToClassOrObject(p.ClassType.cloneAsInstance(n),S,k?void 0:y.classType,void 0,k?n:b,r,g))):s=e.bindFunctionToClassOrObject(p.ClassType.cloneAsInstance(t),S,t,void 0,void 0,r,g),!s)return void(_=!1);S=(0,c.removeParamSpecVariadicsFromSignature)(s)}const x=null==r?void 0:r.createAddendum();if((0,p.isClassInstance)(S)&&p.ClassType.isPropertyClass(S))if((0,p.isClassInstance)(w)&&p.ClassType.isPropertyClass(w)&&!f)(0,o.assignProperty)(e,p.ClassType.cloneAsInstantiable(S),p.ClassType.cloneAsInstantiable(w),i,n,null==x?void 0:x.createAddendum(),T,v,g)||(x&&x.addMessage(s.LocAddendum.memberTypeMismatch().format({name:u})),_=!1);else{let t=e.getGetterTypeFromProperty(S,!0);t&&(t=(0,c.partiallySpecializeType)(t,i)),t&&e.assignType(t,w,null==x?void 0:x.createAddendum(),T,void 0,I,g)||(x&&x.addMessage(s.LocAddendum.memberTypeMismatch().format({name:u})),_=!1),A&&(0,c.lookUpClassMember)(S,"__set__",16)&&(x&&x.addMessage(s.LocAddendum.memberIsWritableInProtocol().format({name:u})),_=!1)}else{const t=d.getDeclarations()[0],n=1===(null==t?void 0:t.type)&&!t.isFinal,a=T.clone();a.addSolveForScope((0,c.getTypeVarScopeId)(S)),e.assignType(S,w,null==x?void 0:x.createAddendum(),a,void 0,n?1|I:I,g)?T.copyFromClone(a):(x&&(n&&x.addMessage(s.LocAddendum.memberIsInvariant().format({name:u})),x.addMessage(s.LocAddendum.memberTypeMismatch().format({name:u}))),_=!1)}const P=d.getTypedDeclarations().some((e=>1===e.type&&!!e.isFinal));P!==h.getTypedDeclarations().some((e=>1===e.type&&!!e.isFinal))&&(P?x&&x.addMessage(s.LocAddendum.memberIsFinalInProtocol().format({name:u})):x&&x.addMessage(s.LocAddendum.memberIsNotFinalInProtocol().format({name:u})),_=!1);const N=(0,l.isEffectivelyClassVar)(d,!1),D=(0,l.isEffectivelyClassVar)(h,!1),F=h.getDeclarations().some((e=>1===e.type));f?N?(null==x||x.addMessage(s.LocAddendum.memberIsClassVarInProtocol().format({name:u})),_=!1):F&&!D&&(k||(null==x||x.addMessage(s.LocAddendum.memberIsNotClassVarInClass().format({name:u})),_=!1)):N!==D&&(N?null==x||x.addMessage(s.LocAddendum.memberIsClassVarInProtocol().format({name:u})):null==x||x.addMessage(s.LocAddendum.memberIsNotClassVarInProtocol().format({name:u})),_=!1);const E=(0,l.getLastTypedDeclarationForSymbol)(d),M=(0,l.getLastTypedDeclarationForSymbol)(h);if(1===(null==E?void 0:E.type)&&1===(null==M?void 0:M.type)){const e=!!E.isConstant;let t=!!M.isConstant;y&&(0,p.isClass)(y.classType)&&(p.ClassType.isReadOnlyInstanceVariables(y.classType)||p.ClassType.isFrozenDataClass(y.classType))&&(t=!0),!e&&t&&(x&&x.addMessage(s.LocAddendum.memberIsWritableInProtocol().format({name:u})),_=!1)}}))})),_&&t.details.typeParameters.length>0){const n=p.ClassType.cloneForSpecialization(t,void 0,!1),a=(0,c.applySolvedTypeVars)(n,T);if(t.typeArguments)e.assignTypeArguments(t,a,r,u,m,y,g)||(_=!1);else if(u&&!u.isLocked())for(const e of t.details.typeParameters){const t=T.getPrimarySignature().getTypeVar(e);t&&u.setTypeVarType(e,null==t?void 0:t.narrowBound,null==t?void 0:t.narrowBoundNoLiterals,null==t?void 0:t.wideBound)}}return _}t.assignClassToProtocol=function(e,t,n,s,i,o,l,c){(0,a.assert)((0,p.isInstantiableClass)(t)&&p.ClassType.isProtocolClass(t));const d=0!=(1&l);if(u.some((e=>(0,p.isTypeSame)(e.srcType,n)&&(0,p.isTypeSame)(e.destType,t))))return!d;if(!d){const e=function(e,t,n,a){const r=t.details.protocolCompatibility,s=null==r?void 0:r.get(e.details.fullName);if(void 0===s)return;const i=s.find((r=>(0,p.isTypeSame)(r.destType,e)&&(0,p.isTypeSame)(r.srcType,t)&&r.flags===n&&function(e,t){if(!e||!t)return e===t;return e.isSame(t)}(a,r.typeVarContext)));return null==i?void 0:i.isCompatible}(t,n,l,i);if(void 0!==e){if(e&&(!i||0===t.details.typeParameters.length))return!0;if(!e&&(!s||s.getNestLevel()>r.defaultMaxDiagnosticDepth))return!1}}u.push({srcType:n,destType:t});let g=!0;const h=null==i?void 0:i.clone();try{g=y(e,t,n,s,i,o,l,c)}catch(e){throw u.pop(),e}return u.pop(),function(e,t,n,a,r){let s=t.details.protocolCompatibility;s||(s=new Map,t.details.protocolCompatibility=s);let i=s.get(e.details.fullName);i||(i=[],s.set(e.details.fullName,i));i.push({destType:e,srcType:t,flags:n,typeVarContext:a,isCompatible:r}),i.length>m&&i.shift()}(t,n,l,h,g),g},t.assignModuleToProtocol=function(e,t,n,a,r,s,i){return y(e,t,n,a,r,void 0,s,i)},t.isMethodOnlyProtocol=function e(t){if(!p.ClassType.isProtocolClass(t))return!1;for(const n of t.details.baseClasses)if((0,p.isClass)(n)&&p.ClassType.isProtocolClass(n)&&!e(n))return!1;for(const[,e]of p.ClassType.getSymbolTable(t))if(!e.isIgnoredForProtocolMatch()&&e.getDeclarations().some((e=>5!==e.type)))return!1;return!0},t.isProtocolUnsafeOverlap=function(e,t,n){if(e.assignType(t,n))return!1;let a=!0;return t.details.mro.forEach((e=>{a&&(0,p.isInstantiableClass)(e)&&p.ClassType.isProtocolClass(e)&&p.ClassType.getSymbolTable(e).forEach(((e,t)=>{if(!a||!e.isClassMember()||e.isIgnoredForProtocolMatch())return;(0,c.lookUpClassMember)(n,t)||(a=!1)}))})),a}},65940:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getPyTypedInfoForPyTypedFile=t.getPyTypedInfo=void 0;const a=n(80636);function r(e,t){let n=!1;const a=e.statSync(t);if(a.size>0&&a.size<65536){const a=e.readFileSync(t,"utf8");(a.match(/partial\n/)||a.match(/partial\r\n/))&&(n=!0)}return{pyTypedPath:t,isPartiallyTyped:n}}t.getPyTypedInfo=function(e,t){if(!e.existsSync(t)||!(0,a.isDirectory)(e,t))return;const n=t.pytypedUri;return e.existsSync(n)&&(0,a.isFile)(e,n)?r(e,n):void 0},t.getPyTypedInfoForPyTypedFile=r},58700:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getPathsFromPthFiles=t.isPythonBinary=t.findPythonSearchPaths=t.getTypeshedSubdirectory=t.getTypeShedFallbackPath=t.thirdPartyFolderName=t.stdLibFolderName=void 0;const i=n(86016),o=s(n(93924)),l=n(80636);function p(e,t){const n=[];return e.readdirEntriesSync(t).filter((e=>(e.isFile()||e.isSymbolicLink())&&e.name.endsWith(".pth"))).sort(((e,t)=>(0,i.compareComparableValues)(e.name,t.name))).forEach((a=>{const r=e.realCasePath(t.combinePaths(a.name)),s=(0,l.tryStat)(e,r);if((null==s?void 0:s.isFile())&&s.size>0&&s.size<65536){e.readFileSync(r,"utf8").split(/\r?\n/).forEach((a=>{const r=a.trim();if(r.length>0&&!r.startsWith("#")&&!r.match(/^import\s/)){const a=t.combinePaths(r);e.existsSync(a)&&(0,l.isDirectory)(e,a)&&n.push(e.realCasePath(a))}}))}})),n}function c(e,t){return!e.some((e=>e.key===t.key))&&(e.push(t),!0)}t.stdLibFolderName="stdlib",t.thirdPartyFolderName="stubs",t.getTypeShedFallbackPath=function(e){const t=e.getModulePath();if(!t||t.isEmpty())return;const n=t.combinePaths(o.typeshedFallback);if(e.existsSync(n))return e.realCasePath(n);const a=t.getDirectory().combinePaths(o.typeshedFallback);return e.existsSync(a)?e.realCasePath(a):void 0},t.getTypeshedSubdirectory=function(e,n){return e.combinePaths(n?t.stdLibFolderName:t.thirdPartyFolderName)},t.findPythonSearchPaths=function(e,t,n,a,r,s){if(a.push("Finding python search paths"),void 0!==t.venvPath&&t.venv){const n=t.venv,r=t.venvPath.combinePaths(n),s=[],i=[];if([o.lib,o.lib64,o.libAlternate].forEach((n=>{const p=function(e,t,n,a){if(!e.existsSync(t))return void a.push(`Did not find '${t}'`);a.push(`Found path '${t}'; looking for ${o.sitePackages}`);const r=t.combinePaths(o.sitePackages);if(e.existsSync(r))return a.push(`Found path '${r}'`),r;a.push(`Did not find '${r}', so looking for python subdirectory`);const s=(0,l.getFileSystemEntries)(e,t),i=s.directories.filter((t=>{if(t.fileName.startsWith("python3.")){const n=t.combinePaths(o.sitePackages);return e.existsSync(n)}return!1}));if(n){const e=i.find((e=>e.fileName===`python${n.toMajorMinorString()}`));if(e){const t=e.combinePaths(o.sitePackages);return a.push(`Found path '${t}'`),t}}if(i.length>0){const e=i[0].combinePaths(o.sitePackages);return a.push(`Found path '${e}'`),e}return}(e,r.combinePaths(n),t.defaultPythonVersion,a);p&&(c(s,p),i.push(e.realCasePath(p)))})),i.forEach((t=>{p(e,t).forEach((e=>{c(s,e)}))})),s.length>0)return a.push(`Found the following '${o.sitePackages}' dirs`),s.forEach((e=>{a.push(`  ${e}`)})),s;a.push(`Did not find any '${o.sitePackages}' dirs. Falling back on python interpreter.`)}const i=n.getPythonSearchPaths(t.pythonPath,a);if(r&&s){return i.paths.filter((e=>!e.startsWith(s)||e.startsWith(i.prefix))).map((t=>e.realCasePath(t)))}return i.paths.map((t=>e.realCasePath(t)))},t.isPythonBinary=function(e){return"python"===(e=e.trim())||"python3"===e},t.getPathsFromPthFiles=p},32700:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scope=void 0;const a=n(83181),r=n(52328);t.Scope=class{constructor(e,t,n){this.symbolTable=new Map,this.notLocalBindings=new Map,this.type=e,this.parent=t,this.proxy=n}getGlobalScope(){let e=this,t=!1;for(;e;){if(4===e.type||5===e.type)return{scope:e,isBeyondExecutionScope:t};2===e.type&&(t=!0),e=e.parent}return(0,a.fail)("failed to find scope"),{scope:this,isBeyondExecutionScope:t}}isIndependentlyExecutable(){return 4===this.type||2===this.type}lookUpSymbol(e){return this.symbolTable.get(e)}lookUpSymbolRecursive(e,t){let n,a=this,r=this.symbolTable.get(e);if(!r&&(null==t?void 0:t.useProxyScope)&&this.proxy&&(r=this.proxy.symbolTable.get(e),a=this.proxy),r){if((null==t?void 0:t.isOutsideCallerModule)&&r.isExternallyHidden())return;const e=r.getDeclarations();if(0===e.length||e.some((e=>1!==e.type||!e.isDefinedByMemberAccess)))return{symbol:r,isOutsideCallerModule:!!(null==t?void 0:t.isOutsideCallerModule),isBeyondExecutionScope:!!(null==t?void 0:t.isBeyondExecutionScope),scope:a,usesNonlocalBinding:!!(null==t?void 0:t.usesNonlocalBinding),usesGlobalBinding:!!(null==t?void 0:t.usesGlobalBinding)}}let s=(null==t?void 0:t.isBeyondExecutionScope)||this.isIndependentlyExecutable();const i=this.notLocalBindings.get(e);if(1===i){const e=this.getGlobalScope();e.scope!==this&&(n=e.scope,e.isBeyondExecutionScope&&(s=!0))}else n=this.parent;if(n)return n.lookUpSymbolRecursive(e,{isOutsideCallerModule:!!(null==t?void 0:t.isOutsideCallerModule)||4===this.type,isBeyondExecutionScope:s,usesNonlocalBinding:0===i||!!(null==t?void 0:t.usesNonlocalBinding),usesGlobalBinding:1===i||!!(null==t?void 0:t.usesGlobalBinding)})}addSymbol(e,t){const n=new r.Symbol(t);return this.symbolTable.set(e,n),n}getBindingType(e){return this.notLocalBindings.get(e)}setBindingType(e,t){return this.notLocalBindings.set(e,t)}setSlotsNames(e){this.slotsNames=e}getSlotsNames(){return this.slotsNames}}},69160:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isScopeContainedWithin=t.findTopNodeInScope=t.getScopeHierarchy=t.getScopeForNode=t.getBuiltInScope=void 0;const a=n(9316),r=n(28340);t.getBuiltInScope=function(e){let t=e;for(;5!==t.type;)t=t.parent;return t},t.getScopeForNode=function(e){const t=(0,r.getEvaluationScopeNode)(e).node;return(0,a.getScope)(t)},t.getScopeHierarchy=function(e,t){const n=[];let s=e;for(;s;){const e=(0,r.getEvaluationScopeNode)(s).node,i=(0,a.getScope)(e);if(!i)return;if(0!==n.length&&n[n.length-1]===i||n.push(i),i===t)return n;s=e.parent}return t?void 0:n},t.findTopNodeInScope=function(e,t){let n,r=e,s=!1;for(;r;){if((0,a.getScope)(r)===t)s=!0;else if(s)return n;n=r,r=r.parent}},t.isScopeContainedWithin=function(e,t){let n=e;for(;n;){if(n.parent===t)return!0;n=n.parent}return!1}},19016:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyzerService=t.getNextServiceId=t.pyprojectTomlName=t.configFileNames=void 0;const i=s(n(39496)),o=s(n(72050)),l=n(64704),p=n(55484),c=n(57508),d=n(86016),u=n(48984),m=n(33348),y=n(93924),g=n(11699),h=n(37636),f=n(6216),T=n(55084),v=n(80636),b=n(95156),_=n(29332),C=n(58700),I=n(41500);t.configFileNames=["pyrightconfig.json"],t.pyprojectTomlName="pyproject.toml";const k=(0,g.normalizeSlashes)("/.git/");let w=1;function S(e){return`${e}_${w++}`}t.getNextServiceId=S;class A{constructor(e,t,n){var a,r,s,i,o;this._typeStubTargetIsSingleFile=!1,this._requireTrackedFileUpdate=!0,this._lastUserInteractionTime=Date.now(),this._disposed=!1,this._pendingLibraryChanges={changesOnly:!0},this._instanceName=e,this._executionRootUri=T.Uri.empty(),this._options=n,this._options.serviceId=null!==(a=this._options.serviceId)&&void 0!==a?a:S(e),this._options.console=n.console||new c.StandardConsole,this._serviceProvider=t.clone(),this._options.console&&this._serviceProvider.add(h.ServiceKeys.console,this._options.console),this._options.fileSystem&&this._serviceProvider.add(h.ServiceKeys.fs,this._options.fileSystem),this._options.importResolverFactory=null!==(r=n.importResolverFactory)&&void 0!==r?r:A.createImportResolver,this._options.cancellationProvider=null!==(s=n.cancellationProvider)&&void 0!==s?s:new l.DefaultCancellationProvider,this._options.hostFactory=null!==(i=n.hostFactory)&&void 0!==i?i:()=>new m.NoAccessHost,this._options.configOptions=null!==(o=n.configOptions)&&void 0!==o?o:new p.ConfigOptions(T.Uri.file(process.cwd(),this._serviceProvider));const d=this._options.importResolverFactory(this._serviceProvider,this._options.configOptions,this._options.hostFactory());this._backgroundAnalysisProgram=void 0!==this._options.backgroundAnalysisProgramFactory?this._options.backgroundAnalysisProgramFactory(this._options.serviceId,this._serviceProvider,this._options.configOptions,d,this._options.backgroundAnalysis,this._options.maxAnalysisTime):new b.BackgroundAnalysisProgram(this._options.serviceId,this._serviceProvider,this._options.configOptions,d,this._options.backgroundAnalysis,this._options.maxAnalysisTime,void 0)}get fs(){return this._backgroundAnalysisProgram.importResolver.fileSystem}get serviceProvider(){return this._serviceProvider}get cancellationProvider(){return this._options.cancellationProvider}get librarySearchUrisToWatch(){return this._librarySearchUrisToWatch}get backgroundAnalysisProgram(){return this._backgroundAnalysisProgram}get test_program(){return this._program}get id(){return this._options.serviceId}clone(e,t,n,a){var r;const s=new A(e,this._serviceProvider,{...this._options,serviceId:t,backgroundAnalysis:n,skipScanningUserFiles:!0,fileSystem:a}),i=this.getUserFiles();s.backgroundAnalysisProgram.setTrackedFiles(i),s.backgroundAnalysisProgram.markAllFilesDirty(!0);for(const e of this.backgroundAnalysisProgram.program.getOpened()){const t=e.sourceFile.getClientVersion();void 0!==t&&s.setFileOpened(e.sourceFile.getUri(),t,e.sourceFile.getOpenFileContents(),e.sourceFile.getIPythonMode(),null===(r=e.chainedSourceFile)||void 0===r?void 0:r.sourceFile.getUri())}return s}runEditMode(e,t){let n=[];this._backgroundAnalysisProgram.enterEditMode();try{this._program.runEditMode(e,t)}finally{n=this._backgroundAnalysisProgram.exitEditMode()}return t.isCancellationRequested?[]:n}dispose(){this._disposed||this._backgroundAnalysisProgram.dispose(),this._disposed=!0,this._removeSourceFileWatchers(),this._removeConfigFileWatcher(),this._removeLibraryFileWatcher(),this._clearReloadConfigTimer(),this._clearReanalysisTimer(),this._clearLibraryReanalysisTimer()}static createImportResolver(e,t,n){return new _.ImportResolver(e,t,n)}setCompletionCallback(e){this._onCompletionCallback=e,this._backgroundAnalysisProgram.setCompletionCallback(e)}setOptions(e){this._commandLineOptions=e;const t=this._hostFactory(),n=this._getConfigOptions(t,e);n.pythonPath&&n.ensureDefaultPythonVersion(t,this._console),n.ensureDefaultPythonPlatform(t,this._console),this._backgroundAnalysisProgram.setConfigOptions(n),this._executionRootUri=n.projectRoot,this._applyConfigOptions(t)}hasSourceFile(e){return this.backgroundAnalysisProgram.hasSourceFile(e)}isTracked(e){return this._program.owns(e)}getUserFiles(){return this._program.getUserFiles().map((e=>e.sourceFile.getUri()))}getOpenFiles(){return this._program.getOpened().map((e=>e.sourceFile.getUri()))}setFileOpened(e,t,n,a=I.IPythonMode.None,r){this._backgroundAnalysisProgram.setFileOpened(e,t,n,{isTracked:this.isTracked(e)||a!==I.IPythonMode.None,ipythonMode:a,chainedFileUri:r}),this._scheduleReanalysis(!1)}getChainedUri(e){return this._backgroundAnalysisProgram.getChainedUri(e)}updateChainedUri(e,t){this._backgroundAnalysisProgram.updateChainedUri(e,t),this._scheduleReanalysis(!1)}updateOpenFileContents(e,t,n,a=I.IPythonMode.None){this._backgroundAnalysisProgram.updateOpenFileContents(e,t,n,{isTracked:this.isTracked(e),ipythonMode:a,chainedFileUri:void 0}),this._scheduleReanalysis(!1)}setFileClosed(e,t){this._backgroundAnalysisProgram.setFileClosed(e,t),this._scheduleReanalysis(!1)}addInterimFile(e){this._backgroundAnalysisProgram.addInterimFile(e)}getParserOutput(e){return this._program.getParserOutput(e)}getParseResults(e){return this._program.getParseResults(e)}getSourceFile(e){return this._program.getBoundSourceFile(e)}getTextOnRange(e,t,n){return this._program.getTextOnRange(e,t,n)}run(e,t){return this._program.run(e,t)}printStats(){this._console.info(""),this._console.info("Analysis stats");const e=this._program.getFileCount(!1);this._console.info("Total files parsed and bound: "+e.toString());const t=this._program.getUserFileCount();this._console.info("Total files checked: "+t.toString())}printDetailedAnalysisTimes(){this._program.printDetailedAnalysisTimes()}printDependencies(e){this._program.printDependencies(this._executionRootUri,e)}analyzeFile(e,t){return this._backgroundAnalysisProgram.analyzeFile(e,t)}getDiagnosticsForRange(e,t,n){return this._backgroundAnalysisProgram.getDiagnosticsForRange(e,t,n)}getConfigOptions(){return this._configOptions}getImportResolver(){return this._backgroundAnalysisProgram.importResolver}recordUserInteractionTime(){this._lastUserInteractionTime=Date.now(),this._analyzeTimer&&this._scheduleReanalysis(!1)}test_getConfigOptions(e){return this._getConfigOptions(this._backgroundAnalysisProgram.host,e)}test_getFileNamesFromFileSpecs(){return this._getFileNamesFromFileSpecs()}test_shouldHandleSourceFileWatchChanges(e,t){return this._shouldHandleSourceFileWatchChanges(e,t)}test_shouldHandleLibraryFileWatchChanges(e,t){return this._shouldHandleLibraryFileWatchChanges(e,t)}writeTypeStub(e){var t;const n=this._getTypeStubFolder();this._program.writeTypeStub(null!==(t=this._typeStubTargetUri)&&void 0!==t?t:T.Uri.empty(),this._typeStubTargetIsSingleFile,n,e)}writeTypeStubInBackground(e){var t;const n=this._getTypeStubFolder();return this._backgroundAnalysisProgram.writeTypeStub(null!==(t=this._typeStubTargetUri)&&void 0!==t?t:T.Uri.empty(),this._typeStubTargetIsSingleFile,n,e)}invalidateAndForceReanalysis(e){this._backgroundAnalysisProgram.invalidateAndForceReanalysis(e)}restart(){this._applyConfigOptions(this._hostFactory()),this._backgroundAnalysisProgram.restart()}get _console(){return this._options.console}get _hostFactory(){return this._options.hostFactory}get _importResolverFactory(){return this._options.importResolverFactory}get _program(){return this._backgroundAnalysisProgram.program}get _configOptions(){return this._backgroundAnalysisProgram.configOptions}get _watchForSourceChanges(){var e;return!!(null===(e=this._commandLineOptions)||void 0===e?void 0:e.watchForSourceChanges)}get _watchForLibraryChanges(){var e;return!!(null===(e=this._commandLineOptions)||void 0===e?void 0:e.watchForLibraryChanges)&&!!this._options.libraryReanalysisTimeProvider}get _watchForConfigChanges(){var e;return!!(null===(e=this._commandLineOptions)||void 0===e?void 0:e.watchForConfigChanges)}get _typeCheckingMode(){var e;return null===(e=this._commandLineOptions)||void 0===e?void 0:e.typeCheckingMode}get _verboseOutput(){return!!this._configOptions.verboseOutput}get _typeStubTargetImportName(){var e;return null===(e=this._commandLineOptions)||void 0===e?void 0:e.typeStubTargetImportName}_getConfigOptions(e,t){var n,a,r;const s=t.executionRoot,i=T.Uri.is(s)?s:(0,d.isString)(s)?T.Uri.file(s,this.serviceProvider,!0):T.Uri.defaultWorkspace(this.serviceProvider),o=this.fs.realCasePath(i);let l,c,u=o;t.configFilePath?(l=this.fs.realCasePath((0,g.isRootedDiskPath)(t.configFilePath)?T.Uri.file(t.configFilePath,this.serviceProvider,!0):u.resolvePaths(t.configFilePath)),this.fs.existsSync(l)?l.lastExtension.endsWith(".json")?u=l.getDirectory():(u=l,l=this._findConfigFile(l),l||this._console.info(`Configuration file not found at ${u.toUserVisibleString()}.`)):(this._console.info(`Configuration file not found at ${l.toUserVisibleString()}.`),l=u)):t.executionRoot&&(l=this._findConfigFile(u),l||t.fromVsCodeExtension||(l=this._findConfigFileHereOrUp(u)),l?u=l.getDirectory():(this._console.log("No configuration file found."),l=void 0)),l||(c=this._findPyprojectTomlFile(u),c||t.fromVsCodeExtension||(c=this._findPyprojectTomlFileHereOrUp(u)),c?(u=c.getDirectory(),this._console.log(`pyproject.toml file found at ${u.toUserVisibleString()}.`)):this._console.log("No pyproject.toml file found."));const m=new p.ConfigOptions(u,this._typeCheckingMode),h=["**/node_modules","**/__pycache__","**/.*"];let f;if(t.pythonPath&&(this._console.info(`Setting pythonPath for service "${this._instanceName}": "${t.pythonPath}"`),m.pythonPath=this.fs.realCasePath(T.Uri.file(t.pythonPath,this.serviceProvider,!0))),t.pythonEnvironmentName&&(this._console.info(`Setting environmentName for service "${this._instanceName}": "${t.pythonEnvironmentName}"`),m.pythonEnvironmentName=t.pythonEnvironmentName),m.defaultPythonPlatform=t.pythonPlatform,m.defaultPythonVersion=t.pythonVersion,m.ensureDefaultExtraPaths(this.fs,null!==(n=t.autoSearchPaths)&&void 0!==n&&n,t.extraPaths),t.includeFileSpecs.length>0&&t.includeFileSpecs.forEach((e=>{m.include.push((0,v.getFileSpec)(u,e))})),t.excludeFileSpecs.length>0&&t.excludeFileSpecs.forEach((e=>{m.exclude.push((0,v.getFileSpec)(u,e))})),t.ignoreFileSpecs.length>0&&t.ignoreFileSpecs.forEach((e=>{m.ignore.push((0,v.getFileSpec)(u,e))})),!l&&t.executionRoot&&(0===t.includeFileSpecs.length&&m.include.push((0,v.getFileSpec)(o,".")),0===t.excludeFileSpecs.length&&h.forEach((e=>{m.exclude.push((0,v.getFileSpec)(o,e))}))),this._configFileUri=l||c,m.disableTaggedHints=!!t.disableTaggedHints,l?(this._console.info(`Loading configuration file at ${l.toUserVisibleString()}`),f=this._parseJsonConfigFile(l)):c&&(this._console.info(`Loading pyproject.toml file at ${c.toUserVisibleString()}`),f=this._parsePyprojectTomlFile(c)),f){m.initializeFromJson(f,this._typeCheckingMode,this.serviceProvider,e,t);const n=this._configFileUri.getDirectory();0===m.include.length&&(this._console.info(`No include entries specified; assuming ${n.toUserVisibleString()}`),m.include.push((0,v.getFileSpec)(n,"."))),0===m.exclude.length&&(h.forEach((e=>{this._console.info(`Auto-excluding ${e}`),m.exclude.push((0,v.getFileSpec)(n,e))})),void 0===m.autoExcludeVenv&&(m.autoExcludeVenv=!0))}else m.autoExcludeVenv=!0,m.applyDiagnosticOverrides(t.diagnosticSeverityOverrides);void 0!==t.analyzeUnannotatedFunctions&&(m.diagnosticRuleSet.analyzeUnannotatedFunctions=t.analyzeUnannotatedFunctions),t.includeFileSpecsOverride&&(m.include=[],t.includeFileSpecsOverride.forEach((e=>{m.include.push((0,v.getFileSpec)(T.Uri.file(e,this.serviceProvider,!0),"."))})));const b=(e,n)=>{const a=t.fromVsCodeExtension?"the client settings":"a command-line option";this._console.warn(`The ${e} has been specified in both the config file and ${a}. The value in the config file (${n}) will take precedence`)};if(t.venvPath&&(m.venvPath?b("venvPath",m.venvPath.toUserVisibleString()):m.venvPath=u.resolvePaths(t.venvPath)),t.typeshedPath&&(m.typeshedPath?b("typeshedPath",m.typeshedPath.toUserVisibleString()):m.typeshedPath=u.resolvePaths(t.typeshedPath)),m.typeshedPath&&m.typeshedPath===u&&void 0!==m.defaultPythonVersion){const e=this.getImportResolver().getTypeshedStdlibExcludeList(m.typeshedPath,m.defaultPythonVersion,m.defaultPythonPlatform);this._console.info("Excluding typeshed stdlib stubs according to VERSIONS file:"),e.forEach((e=>{this._console.info(`    ${e}`),m.exclude.push((0,v.getFileSpec)(o,e.getFilePath()))}))}if(m.verboseOutput=null!==(a=t.verboseOutput)&&void 0!==a?a:m.verboseOutput,m.checkOnlyOpenFiles=!!t.checkOnlyOpenFiles,m.autoImportCompletions=!!t.autoImportCompletions,m.indexing=!!t.indexing,m.taskListTokens=t.taskListTokens,m.logTypeEvaluationTime=!!t.logTypeEvaluationTime,m.typeEvaluationTimeThreshold=t.typeEvaluationTimeThreshold,void 0===m.useLibraryCodeForTypes?m.useLibraryCodeForTypes=t.useLibraryCodeForTypes:void 0!==t.useLibraryCodeForTypes&&b("useLibraryCodeForTypes",m.useLibraryCodeForTypes),void 0===m.useLibraryCodeForTypes&&(m.useLibraryCodeForTypes=!0),t.stubPath&&(m.stubPath?b("stubPath",m.stubPath.toUserVisibleString()):m.stubPath=this.fs.realCasePath(u.resolvePaths(t.stubPath))),m.stubPath?this.fs.existsSync(m.stubPath)&&(0,v.isDirectory)(this.fs,m.stubPath)||this._console.warn(`stubPath ${m.stubPath} is not a valid directory.`):m.stubPath=m.projectRoot.resolvePaths(y.defaultStubsDirectory),m.venvPath&&(this.fs.existsSync(m.venvPath)&&(0,v.isDirectory)(this.fs,m.venvPath)||this._console.error(`venvPath ${m.venvPath.toUserVisibleString()} is not a valid directory.`),m.venv=null!==(r=m.venv)&&void 0!==r?r:this._configOptions.venv,m.venv&&m.venvPath)){const t=m.venvPath.resolvePaths(m.venv);if(this.fs.existsSync(t)&&(0,v.isDirectory)(this.fs,t)){const t=[];void 0===(0,C.findPythonSearchPaths)(this.fs,m,e,t)&&(this._console.error(`site-packages directory cannot be located for venvPath ${m.venvPath.toUserVisibleString()} and venv ${m.venv}.`),m.verboseOutput&&t.forEach((e=>{this._console.error(`  ${e}`)})))}else this._console.error(`venv ${m.venv} subdirectory not found in venv path ${m.venvPath.toUserVisibleString()}.`)}return m.venv&&(m.venvPath||this._console.warn("venvPath not specified, so venv settings will be ignored.")),m.typeshedPath&&(this.fs.existsSync(m.typeshedPath)&&(0,v.isDirectory)(this.fs,m.typeshedPath)||this._console.error(`typeshedPath ${m.typeshedPath.toUserVisibleString()} is not a valid directory.`)),m}_getTypeStubFolder(){var e;const t=null!==(e=this._configOptions.stubPath)&&void 0!==e?e:this.fs.realCasePath(this._configOptions.projectRoot.resolvePaths(y.defaultStubsDirectory));if(!this._typeStubTargetUri||!this._typeStubTargetImportName){const e=`Import '${this._typeStubTargetImportName}' could not be resolved`;throw this._console.error(e),new Error(e)}const n=this._typeStubTargetImportName.split(".");if(0===n[0].length){const e=`Import '${this._typeStubTargetImportName}' could not be resolved`;throw this._console.error(e),new Error(e)}try{this.fs.existsSync(t)||this.fs.mkdirSync(t)}catch(e){const n=`Could not create typings directory '${t.toUserVisibleString()}'`;throw this._console.error(n),new Error(n)}const a=t.resolvePaths(n[0]),r=t.resolvePaths(...n);try{this.fs.existsSync(r)||(0,v.makeDirectories)(this.fs,r,t)}catch(e){const t=`Could not create typings subdirectory '${r.toUserVisibleString()}'`;throw this._console.error(t),new Error(t)}return a}_findConfigFileHereOrUp(e){return(0,v.forEachAncestorDirectory)(e,(e=>this._findConfigFile(e)))}_findConfigFile(e){for(const n of t.configFileNames){const t=e.resolvePaths(n);if(this.fs.existsSync(t))return this.fs.realCasePath(t)}}_findPyprojectTomlFileHereOrUp(e){return(0,v.forEachAncestorDirectory)(e,(e=>this._findPyprojectTomlFile(e)))}_findPyprojectTomlFile(e){const n=e.resolvePaths(t.pyprojectTomlName);if(this.fs.existsSync(n))return this.fs.realCasePath(n)}_parseJsonConfigFile(e){return this._attemptParseFile(e,(e=>{const t=[],n=o.parse(e,t,{allowTrailingComma:!0});if(t.length>0)throw new Error("Errors parsing JSON file");return n}))}_parsePyprojectTomlFile(e){return this._attemptParseFile(e,((t,n)=>{try{const e=i.parse(t);if(e&&e.tool&&e.tool.pyright)return e.tool.pyright}catch(e){throw this._console.error(`Pyproject file parse attempt ${n} error: ${JSON.stringify(e)}`),e}this._console.info(`Pyproject file "${e.toUserVisibleString()}" has no "[tool.pyright]" section.`)}))}_attemptParseFile(e,t){let n="",a=0;for(;;){try{n=this.fs.readFileSync(e,"utf8")}catch{return this._console.error(`Config file "${e.toUserVisibleString()}" could not be read.`),void this._reportConfigParseError()}let r=!1;try{return t(n,a+1)}catch(e){r=!0}if(!r)break;if(a++>=5)return this._console.error(`Config file "${e.toUserVisibleString()}" could not be parsed. Verify that format is correct.`),void this._reportConfigParseError()}}_getFileNamesFromFileSpecs(){const e=new Map;return f.timingStats.findFilesTime.timeOperation((()=>{const t=this._matchFiles(this._configOptions.include,this._configOptions.exclude);for(const n of t)e.set(n.key,n)})),this._backgroundAnalysisProgram.program.getOpened().map((e=>e.sourceFile.getUri())).filter((e=>(0,p.matchFileSpecs)(this._program.configOptions,e))).forEach((t=>e.set(t.key,t))),Array.from(e.values())}_updateTrackedFileList(e){if(this._typeStubTargetImportName){const e=this._configOptions.findExecEnvironment(this._executionRootUri),t=(0,_.createImportedModuleDescriptor)(this._typeStubTargetImportName),n=this._backgroundAnalysisProgram.importResolver.resolveImport(T.Uri.empty(),e,t);if(n.isImportFound){const e=[],t=n.resolvedUris[n.resolvedUris.length-1],a=(0,v.isFile)(this.fs,t),r=a&&"__init__"===t.stripAllExtensions().fileName;let s=t;a&&(s=s.getDirectory());for(let e=n.resolvedUris.length-2;e>=0;e--)s=n.resolvedUris[e].isEmpty()?s.getDirectory():n.resolvedUris[e];(0,v.isDirectory)(this.fs,s)?this._typeStubTargetUri=s:(0,v.isFile)(this.fs,s)&&(this._typeStubTargetUri=s.getDirectory()),t.isEmpty()?this._typeStubTargetIsSingleFile=!1:(e.push(t),this._typeStubTargetIsSingleFile=1===n.resolvedUris.length&&!r),n.filteredImplicitImports.forEach((t=>{_.ImportResolver.isSupportedImportSourceFile(t.uri)&&e.push(t.uri)})),this._backgroundAnalysisProgram.setAllowedThirdPartyImports([this._typeStubTargetImportName]),this._backgroundAnalysisProgram.setTrackedFiles(e)}else this._console.error(`Import '${this._typeStubTargetImportName}' not found`)}else if(!this._options.skipScanningUserFiles){let t=[];this._console.log("Searching for source files"),t=this._getFileNamesFromFileSpecs(),this._backgroundAnalysisProgram.setConfigOptions(this._configOptions),this._backgroundAnalysisProgram.setTrackedFiles(t),this._backgroundAnalysisProgram.markAllFilesDirty(e),0===t.length?this._console.info("No source files found."):this._console.info(`Found ${t.length} source `+(1===t.length?"file":"files"))}this._requireTrackedFileUpdate=!1}_matchFiles(e,t){const n=[["bin","activate"],["Scripts","activate"],["pyvenv.cfg"],["conda-meta"]],a=[],r=Date.now();let s=!1;const i=(e,i,o)=>{if(!s){.001*(Date.now()-r)>=10&&(this._console.error('Enumeration of workspace source files is taking longer than 10 seconds.\nThis may be because:\n* You have opened your home directory or entire hard drive as a workspace\n* Your workspace contains a very large number of directories and files\n* Your workspace contains a symlink to a directory with many files\n* Your workspace is remote, and file enumeration is slow\nTo reduce this time, open a workspace directory with fewer files or add a pyrightconfig.json configuration file with an "exclude" section to exclude subdirectories from your workspace. For more details, refer to https://github.com/microsoft/pyright/blob/main/docs/configuration.md.'),s=!0)}if(this._configOptions.autoExcludeVenv&&n.some((t=>this.fs.existsSync(e.resolvePaths(...t)))))return v.FileSpec.isInPath(e,t)||t.push((0,v.getFileSpec)(this._configOptions.projectRoot,`${e}/**`)),void this._console.info(`Auto-excluding ${e.toUserVisibleString()}`);const{files:p,directories:c}=(0,v.getFileSystemEntries)(this.fs,e);for(const e of p)v.FileSpec.matchIncludeFileSpec(i,t,e)&&a.push(e);for(const e of c)(e.matchesRegex(i)||o)&&(v.FileSpec.isInPath(e,t)||l(e,i,o))},o=new Set,l=(e,t,n)=>{const a=(0,v.tryRealpath)(this.fs,e);if(a)if(o.has(a.key))this._console.warn(`Skipping recursive symlink "${e}" -> "${a}"`);else{o.add(a.key);try{i(e,t,n)}finally{o.delete(a.key)}}else this._console.warn(`Skipping broken link "${e}"`)};return e.forEach((e=>{if(!v.FileSpec.isInPath(e.wildcardRoot,t)){let t=!1;const n=(0,v.tryStat)(this.fs,e.wildcardRoot);(null==n?void 0:n.isFile())?(a.push(e.wildcardRoot),t=!0):(null==n?void 0:n.isDirectory())&&(l(e.wildcardRoot,e.regExp,e.hasDirectoryWildcard),t=!0),t||this._console.error(`File or directory "${e.wildcardRoot.toUserVisibleString()}" does not exist.`)}})),a}_removeSourceFileWatchers(){this._sourceFileWatcher&&(this._sourceFileWatcher.close(),this._sourceFileWatcher=void 0)}_updateSourceFileWatchers(){if(this._removeSourceFileWatchers(),this._watchForSourceChanges&&this._configOptions.include.length>0){const e=this._configOptions.include.map((e=>e.wildcardRoot));try{this._verboseOutput&&this._console.info(`Adding fs watcher for directories:\n ${e.join("\n")}`);const t=(0,u.ignoredWatchEventFunction)(e.map((e=>e.getFilePath())));this._sourceFileWatcher=this.fs.createFileSystemWatcher(e,((e,n)=>{if(!n)return;if(this._verboseOutput&&this._console.info(`SourceFile: Received fs event '${e}' for path '${n}'`),t(n))return;if(n.endsWith(".tmp")||n.endsWith(".git")||n.includes(k))return;let a=T.Uri.file(n,this.serviceProvider,!0);a=this.fs.realCasePath(a);const r=function(e,t,n,a,r){const s=(0,v.tryStat)(e,r);if("add"===a){if(!s)return;return{event:a,isFile:s.isFile()}}if("change"===a){if(!s){const e=!!n.getSourceFile(r);if(!e&&!n.containsSourceFileIn(r))return;return{event:"unlink",isFile:e}}return{event:a,isFile:s.isFile()}}return void t.warn(`Received unknown file change event: '${a}' for '${r}'`)}(this.fs,this._console,this._program,e,a);if(r&&this._shouldHandleSourceFileWatchChanges(a,r.isFile)){if(r.isFile&&"change"===r.event)return this._backgroundAnalysisProgram.markFilesDirty([a],!1),void this._scheduleReanalysis(!1);this.invalidateAndForceReanalysis(b.InvalidatedReason.SourceWatcherChanged),this._scheduleReanalysis(!0)}}))}catch{this._console.error(`Exception caught when installing fs watcher for:\n ${e.map((e=>e.toUserVisibleString())).join("\n")}`)}}}_shouldHandleSourceFileWatchChanges(e,t){if(t)return!(!(0,v.hasPythonExtension)(e)||function(e){const t=e.fileName,n=t.split(".");if(4===n.length&&n[3]===n[1]&&32===n[2].length)return!0;return!1}(e))&&!(!this.isTracked(e)&&!this._program.getSourceFileInfo(e));if(!(0,p.matchFileSpecs)(this._program.configOptions,e,!1))return!1;const n=e.getDirectory();return!!(n.startsWith(this._configOptions.projectRoot)&&(this.fs.existsSync(n.initPyUri)||this.fs.existsSync(n.initPyiUri))||this._program.containsSourceFileIn(e))}_removeLibraryFileWatcher(){this._libraryFileWatcher&&(this._libraryFileWatcher.close(),this._libraryFileWatcher=void 0)}_updateLibraryFileWatcher(){if(this._removeLibraryFileWatcher(),!this._watchForLibraryChanges)return void(this._librarySearchUrisToWatch=void 0);this._librarySearchUrisToWatch=(0,C.findPythonSearchPaths)(this.fs,this._backgroundAnalysisProgram.configOptions,this._backgroundAnalysisProgram.host,[],!0,this._executionRootUri);const e=this._librarySearchUrisToWatch;if(e&&e.length>0)try{this._verboseOutput&&this._console.info(`Adding fs watcher for library directories:\n ${e.join("\n")}`);const t=(0,u.ignoredWatchEventFunction)(e.map((e=>e.getFilePath())));this._libraryFileWatcher=this.fs.createFileSystemWatcher(e,((n,a)=>{if(!a)return;if(this._verboseOutput&&this._console.info(`LibraryFile: Received fs event '${n}' for path '${a}'`),t(a))return;const r=T.Uri.file(a,this.serviceProvider,!0);if(!this._shouldHandleLibraryFileWatchChanges(r,e))return;const s="change"===n&&this.fs.existsSync(r);this._scheduleLibraryAnalysis(s)}))}catch{this._console.error(`Exception caught when installing fs watcher for:\n ${e.map((e=>e.toUserVisibleString())).join("\n")}`)}}_shouldHandleLibraryFileWatchChanges(e,t){if(this._program.getSourceFileInfo(e))return!0;let n;for(const a of t)e.isChild(a)&&(!n||n.getPathLength()<a.getPathLength())&&(n=a);if(!n)return!0;const a=n.getPathComponents(),r=e.getPathComponents();for(let e=a.length;e<r.length;e++)if(r[e].startsWith("."))return!1;return!0}_clearLibraryReanalysisTimer(){var e,t,n;if(this._libraryReanalysisTimer){clearTimeout(this._libraryReanalysisTimer),this._libraryReanalysisTimer=void 0;const a=null===(e=this._backgroundAnalysisProgram)||void 0===e?void 0:e.libraryUpdated();null===(n=null===(t=this._options.libraryReanalysisTimeProvider)||void 0===t?void 0:t.libraryUpdated)||void 0===n||n.call(t,a)}}_scheduleLibraryAnalysis(e){if(this._disposed)return;this._clearLibraryReanalysisTimer();const t=this._options.libraryReanalysisTimeProvider,n=null==t?void 0:t();n&&(this._pendingLibraryChanges.changesOnly=this._pendingLibraryChanges.changesOnly&&e,this._libraryReanalysisTimer=setTimeout((()=>{var e,n;this._clearLibraryReanalysisTimer(),this.invalidateAndForceReanalysis(this._pendingLibraryChanges.changesOnly?b.InvalidatedReason.LibraryWatcherContentOnlyChanged:b.InvalidatedReason.LibraryWatcherChanged),this._scheduleReanalysis(!1),null===(n=(e=t).libraryReanalysisStarted)||void 0===n||n.call(e),this._pendingLibraryChanges.changesOnly=!0}),n))}_removeConfigFileWatcher(){this._configFileWatcher&&(this._configFileWatcher.close(),this._configFileWatcher=void 0)}_updateConfigFileWatcher(){this._removeConfigFileWatcher(),this._watchForConfigChanges&&(this._configFileUri?this._configFileWatcher=this.fs.createFileSystemWatcher([this._configFileUri],(e=>{this._verboseOutput&&this._console.info(`Received fs event '${e}' for config file`),this._scheduleReloadConfigFile()})):this._executionRootUri&&(this._configFileWatcher=this.fs.createFileSystemWatcher([this._executionRootUri],((e,n)=>{if(n&&("add"===e||"change"===e)){const a=(0,g.getFileName)(n);a&&t.configFileNames.some((e=>e===a))&&(this._verboseOutput&&this._console.info(`Received fs event '${e}' for config file`),this._commandLineOptions&&this.setOptions(this._commandLineOptions))}}))))}_clearReloadConfigTimer(){this._reloadConfigTimer&&(clearTimeout(this._reloadConfigTimer),this._reloadConfigTimer=void 0)}_scheduleReloadConfigFile(){this._clearReloadConfigTimer(),this._reloadConfigTimer=setTimeout((()=>{this._clearReloadConfigTimer(),this._reloadConfigFile()}),100)}_reloadConfigFile(){if(this._updateConfigFileWatcher(),this._configFileUri){this._console.info(`Reloading configuration file at ${this._configFileUri.toUserVisibleString()}`);const e=this._backgroundAnalysisProgram.host,t=this._getConfigOptions(e,this._commandLineOptions);this._backgroundAnalysisProgram.setConfigOptions(t),this._applyConfigOptions(e)}}_applyConfigOptions(e){var t;const n=this._importResolverFactory(this._serviceProvider,this._backgroundAnalysisProgram.configOptions,e);if(this._backgroundAnalysisProgram.setImportResolver(n),(null===(t=this._commandLineOptions)||void 0===t?void 0:t.fromVsCodeExtension)||this._configOptions.verboseOutput){const e=this._configOptions.verboseOutput?c.LogLevel.Info:c.LogLevel.Log;for(const t of this._configOptions.getExecutionEnvironments()){(0,c.log)(this._console,e,`Search paths for ${t.root||"<default>"}`);n.getImportRoots(t,!0).forEach((t=>{(0,c.log)(this._console,e,`  ${t.toUserVisibleString()}`)}))}}this._updateLibraryFileWatcher(),this._updateConfigFileWatcher(),this._updateSourceFileWatchers(),this._updateTrackedFileList(!0),this._scheduleReanalysis(!1)}_clearReanalysisTimer(){this._analyzeTimer&&(clearTimeout(this._analyzeTimer),this._analyzeTimer=void 0)}_scheduleReanalysis(e){var t,n;if(this._disposed||!(null===(t=this._commandLineOptions)||void 0===t?void 0:t.enableAmbientAnalysis))return;e&&(this._requireTrackedFileUpdate=!0),null===(n=this._backgroundAnalysisCancellationSource)||void 0===n||n.cancel(),this._clearReanalysisTimer();const a=Date.now()-this._lastUserInteractionTime,r=Math.max(250-a,20);this._analyzeTimer=setTimeout((()=>{this._analyzeTimer=void 0,this._requireTrackedFileUpdate&&this._updateTrackedFileList(!1),this._backgroundAnalysisCancellationSource=this.cancellationProvider.createCancellationTokenSource();this._backgroundAnalysisProgram.startAnalysis(this._backgroundAnalysisCancellationSource.token)&&this._scheduleReanalysis(!1)}),r)}_reportConfigParseError(){this._onCompletionCallback&&this._onCompletionCallback({diagnostics:[],filesInProgram:0,requiringAnalysisCount:{files:0,cells:0},checkingOnlyOpenFiles:!0,fatalErrorOccurred:!1,configParseErrorOccurred:!0,elapsedTime:0})}}t.AnalyzerService=A},41500:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SourceFile=t.IPythonMode=void 0;const i=n(48696),o=n(64704),l=n(28040),p=n(55484),c=n(57508),d=n(83181),u=n(72484),m=n(97652),y=n(73664),g=n(10996),h=n(11699),f=n(96193),T=n(37636),v=s(n(50356)),b=n(55164),_=n(48256),C=n(6216),I=n(95960),k=n(79428),w=n(87368),S=n(71424),A=s(n(9316)),x=n(4868),P=n(2816),N=s(n(63516)),D=n(75108),F=n(92220),E=52428800;var M;!function(e){e[e.None=0]="None",e[e.CellDocs=1]="CellDocs"}(M||(t.IPythonMode=M={}));class O{constructor(e){this.diagnosticVersion=0,this.fileContentsVersion=0,this.lastFileContentLength=void 0,this.lastFileContentHash=void 0,this.analyzedFileContentsVersion=-1,this.parseTreeNeedsCleaning=!1,this.isBindingInProgress=!1,this.parseDiagnostics=[],this.commentDiagnostics=[],this.bindDiagnostics=[],this.checkerDiagnostics=[],this.taskListDiagnostics=[],this.typeIgnoreLines=new Map,this.pyrightIgnoreLines=new Map,this.accumulatedDiagnostics=[],this.circularDependencies=[],this.noCircularDependencyConfirmed=!1,this.isBindingNeeded=!0,this.isCheckingNeeded=!0,this.isFileDeleted=!1,c.ConsoleInterface.hasLevel(e)&&(this._consoleWithLevel=e)}get parserOutput(){return this._parserOutput}set parserOutput(e){var t;this._lastCallstack=(null===(t=this._consoleWithLevel)||void 0===t?void 0:t.level)===c.LogLevel.Log&&void 0===e&&void 0!==this._parserOutput?(new Error).stack:void 0,this._parserOutput=e}debugPrint(){var e,t,n,a,r,s,i,o,l,p,c,d,u;return`WritableData: \n diagnosticVersion=${this.diagnosticVersion}, \n noCircularDependencyConfirmed=${this.noCircularDependencyConfirmed}, \n isBindingNeeded=${this.isBindingNeeded},\n isBindingInProgress=${this.isBindingInProgress},\n isCheckingNeeded=${this.isCheckingNeeded},\n isFileDeleted=${this.isFileDeleted},\n hitMaxImportDepth=${this.hitMaxImportDepth},\n parseTreeNeedsCleaning=${this.parseTreeNeedsCleaning},\n fileContentsVersion=${this.fileContentsVersion},\n analyzedFileContentsVersion=${this.analyzedFileContentsVersion},\n clientDocumentVersion=${this.clientDocumentVersion},\n lastFileContentLength=${this.lastFileContentLength},\n lastFileContentHash=${this.lastFileContentHash},\n typeIgnoreAll=${this.typeIgnoreAll},\n imports=${null===(e=this.imports)||void 0===e?void 0:e.length},\n builtinsImport=${null===(t=this.builtinsImport)||void 0===t?void 0:t.importName},\n circularDependencies=${null===(n=this.circularDependencies)||void 0===n?void 0:n.length},\n parseDiagnostics=${null===(a=this.parseDiagnostics)||void 0===a?void 0:a.length},\n commentDiagnostics=${null===(r=this.commentDiagnostics)||void 0===r?void 0:r.length},\n bindDiagnostics=${null===(s=this.bindDiagnostics)||void 0===s?void 0:s.length},\n checkerDiagnostics=${null===(i=this.checkerDiagnostics)||void 0===i?void 0:i.length},\n taskListDiagnostics=${null===(o=this.taskListDiagnostics)||void 0===o?void 0:o.length},\n accumulatedDiagnostics=${null===(l=this.accumulatedDiagnostics)||void 0===l?void 0:l.length},\n typeIgnoreLines=${null===(p=this.typeIgnoreLines)||void 0===p?void 0:p.size},\n pyrightIgnoreLines=${null===(c=this.pyrightIgnoreLines)||void 0===c?void 0:c.size},\n checkTime=${this.checkTime},\n clientDocumentContents=${null===(d=this.clientDocumentContents)||void 0===d?void 0:d.length},\n parseResults=${null===(u=this.parserOutput)||void 0===u?void 0:u.parseTree.length},\n parseResultsDropCallstack=${this._lastCallstack}`}}t.SourceFile=class{constructor(e,t,n,a,r,s,o,l,d){this.serviceProvider=e,this._diagnosticRuleSet=(0,p.getBasicDiagnosticRuleSet)(),this._ipythonMode=M.None,this.fileSystem=e.get(T.ServiceKeys.fs),this._console=o||new c.StandardConsole,this._writableData=new O(this._console),this._editMode=s,this._uri=t,this._moduleName=n,this._isStubFile=t.hasExtension(".pyi"),this._isThirdPartyImport=a,this._isThirdPartyPyTypedPresent=r;const u=t.fileName;this._isTypingStubFile=this._isStubFile&&(this._uri.pathEndsWith("stdlib/typing.pyi")||"typing_extensions.pyi"===u),this._isTypingExtensionsStubFile=this._isStubFile&&"typing_extensions.pyi"===u,this._isTypeshedStubFile=this._isStubFile&&this._uri.pathEndsWith("stdlib/_typeshed/__init__.pyi"),this._isBuiltInStubFile=!1,this._isStubFile&&(this._uri.pathEndsWith("stdlib/collections/__init__.pyi")||this._uri.pathEndsWith("stdlib/asyncio/futures.pyi")||this._uri.pathEndsWith("stdlib/asyncio/tasks.pyi")||this._uri.pathEndsWith("stdlib/builtins.pyi")||this._uri.pathEndsWith("stdlib/_importlib_modulespec.pyi")||this._uri.pathEndsWith("stdlib/dataclasses.pyi")||this._uri.pathEndsWith("stdlib/abc.pyi")||this._uri.pathEndsWith("stdlib/enum.pyi")||this._uri.pathEndsWith("stdlib/queue.pyi")||this._uri.pathEndsWith("stdlib/types.pyi"))&&(this._isBuiltInStubFile=!0),this._logTracker=null!=l?l:new g.LogTracker(o,i.isMainThread?"FG":"BG"),this._ipythonMode=null!=d?d:M.None}getIPythonMode(){return this._ipythonMode}getUri(){return this._uri}getModuleName(){return this._moduleName?this._moduleName:(0,h.stripFileExtension)(this._uri.fileName)}setModuleName(e){this._moduleName=e}getDiagnosticVersion(){return this._writableData.diagnosticVersion}isStubFile(){return this._isStubFile}isTypingStubFile(){return this._isTypingStubFile}isThirdPartyPyTypedPresent(){return this._isThirdPartyPyTypedPresent}getDiagnostics(e,t){if(this._writableData.diagnosticVersion!==t)return this._writableData.accumulatedDiagnostics}getImports(){return this._writableData.imports||[]}getBuiltinsImport(){return this._writableData.builtinsImport}getModuleSymbolTable(){return this._writableData.moduleSymbolTable}getCheckTime(){return this._writableData.checkTime}restore(){if(this._preEditData){const e=this._writableData.clientDocumentContents;return this._writableData=this._preEditData,this._preEditData=void 0,e}}didContentsChangeOnDisk(){if(this._writableData.clientDocumentContents)return!1;if(void 0===this._writableData.lastFileContentLength)return!1;try{if(!this.fileSystem.existsSync(this._uri))return!0;{const e=this.fileSystem.readFileSync(this._uri,"utf8");if(e.length!==this._writableData.lastFileContentLength)return!0;if(v.hashString(e)!==this._writableData.lastFileContentHash)return!0}}catch(e){return!0}return!1}dropParseAndBindInfo(){this._fireFileDirtyEvent(),this._writableData.parserOutput=void 0,this._writableData.tokenizerLines=void 0,this._writableData.tokenizerOutput=void 0,this._writableData.parsedFileContents=void 0,this._writableData.moduleSymbolTable=void 0,this._writableData.isBindingNeeded=!0}markDirty(){this._writableData.fileContentsVersion++,this._writableData.noCircularDependencyConfirmed=!1,this._writableData.isCheckingNeeded=!0,this._writableData.isBindingNeeded=!0,this._writableData.moduleSymbolTable=void 0,this._fireFileDirtyEvent()}markReanalysisRequired(e){this._writableData.isCheckingNeeded=!0,this._writableData.noCircularDependencyConfirmed=!1,this._writableData.parserOutput&&(this._writableData.parserOutput.containsWildcardImport||void 0!==A.getDunderAllInfo(this._writableData.parserOutput.parseTree)||e)&&(this._writableData.parseTreeNeedsCleaning=!0,this._writableData.isBindingNeeded=!0,this._writableData.moduleSymbolTable=void 0)}getFileContentsVersion(){return this._writableData.fileContentsVersion}getClientVersion(){return this._writableData.clientDocumentVersion}getOpenFileContents(){return this._writableData.clientDocumentContents}getFileContent(){const e=this.getOpenFileContents();if(void 0!==e)return e;try{const e=this.fileSystem.statSync(this._uri);if(e.size>E)throw this._console.error(`File length of "${this._uri}" is ${e.size} which exceeds the maximum supported file size of 52428800`),new Error("File larger than max");return this.fileSystem.readFileSync(this._uri,"utf8")}catch(e){return}}setClientVersion(e,t){if(this._cachePreEditState(),null===e)this._writableData.clientDocumentVersion=void 0,this._writableData.clientDocumentContents=void 0,this._writableData.tokenizerOutput=void 0;else{this._writableData.clientDocumentVersion=e,this._writableData.clientDocumentContents=t;const n=v.hashString(t);t.length===this._writableData.lastFileContentLength&&n===this._writableData.lastFileContentHash||this.markDirty(),this._writableData.lastFileContentLength=t.length,this._writableData.lastFileContentHash=n,this._writableData.isFileDeleted=!1}}prepareForClose(){this._fireFileDirtyEvent()}isFileDeleted(){return this._writableData.isFileDeleted}isParseRequired(){return!this._writableData.parserOutput||this._writableData.analyzedFileContentsVersion!==this._writableData.fileContentsVersion}isBindingRequired(){return!this._writableData.isBindingInProgress&&(!!this.isParseRequired()||this._writableData.isBindingNeeded)}isCheckingRequired(){return this._writableData.isCheckingNeeded}getParseResults(){var e;if(this.isParseRequired())return;(0,d.assert)(void 0!==this._writableData.parserOutput&&void 0!==this._writableData.parsedFileContents);const t=null!==(e=this._writableData.tokenizerOutput)&&void 0!==e?e:this._tokenizeContents(this._writableData.parsedFileContents);return{parserOutput:this._writableData.parserOutput,tokenizerOutput:t,text:this._writableData.parsedFileContents}}getParserOutput(){if(!this.isParseRequired())return(0,d.assert)(void 0!==this._writableData.parserOutput),this._writableData.parserOutput}addCircularDependency(e,t){let n=!1;this._writableData.circularDependencies.length<4&&(this._writableData.circularDependencies.some((e=>e.isEqual(t)))||(this._writableData.circularDependencies.push(t),n=!0)),n&&this._recomputeDiagnostics(e)}setNoCircularDependencyConfirmed(){this._writableData.noCircularDependencyConfirmed=!0}isNoCircularDependencyConfirmed(){return!this.isParseRequired()&&this._writableData.noCircularDependencyConfirmed}setHitMaxImportDepth(e){this._writableData.hitMaxImportDepth=e}parse(e,t,n){return this._logTracker.log(`parsing: ${this._getPathForLogging(this._uri)}`,(a=>{if(!this.isParseRequired())return a.suppress(),!1;const r=this.createDiagnosticSink();let s=this.getOpenFileContents();if(void 0===s)try{const e=C.timingStats.readFileTime.totalTime;C.timingStats.readFileTime.timeOperation((()=>{if(s=null!=n?n:this.getFileContent(),void 0===s)throw new Error("Can't get file content");this._writableData.lastFileContentLength=s.length,this._writableData.lastFileContentHash=v.hashString(s)})),a.add(`fs read ${C.timingStats.readFileTime.totalTime-e}ms`)}catch(e){r.addError("Source file could not be read",(0,b.getEmptyRange)()),s="",this.fileSystem.existsSync(this._uri)||(this._writableData.isFileDeleted=!0)}try{const n=this._parseFile(e,this._uri,s,this._ipythonMode,r);(0,d.assert)(void 0!==n&&void 0!==n.tokenizerOutput),this._writableData.parserOutput=n.parserOutput,this._writableData.tokenizerLines=n.tokenizerOutput.lines,this._writableData.parsedFileContents=s,this._writableData.typeIgnoreLines=n.tokenizerOutput.typeIgnoreLines,this._writableData.typeIgnoreAll=n.tokenizerOutput.typeIgnoreAll,this._writableData.pyrightIgnoreLines=n.tokenizerOutput.pyrightIgnoreLines,void 0!==this._writableData.clientDocumentContents&&(this._writableData.tokenizerOutput=n.tokenizerOutput);const a=e.findExecEnvironment(this._uri);C.timingStats.resolveImportsTime.timeOperation((()=>{const s=this._resolveImports(t,n.parserOutput.importedModules,a);this._writableData.imports=s.imports,this._writableData.builtinsImport=s.builtinsImportResult,this._writableData.parseDiagnostics=r.fetchAndClear(),this._writableData.taskListDiagnostics=[],this._addTaskListDiagnostics(e.taskListTokens,n.tokenizerOutput,this._writableData.taskListDiagnostics)}));const i=void 0!==e.strict.find((e=>this._uri.matchesRegex(e.regExp))),o=[];this._diagnosticRuleSet=N.getFileLevelDirectives(n.tokenizerOutput.tokens,n.tokenizerOutput.lines,e.diagnosticRuleSet,i,o),this._writableData.commentDiagnostics=[],o.forEach((e=>{this._writableData.commentDiagnostics.push(new u.Diagnostic(0,e.message,(0,f.convertTextRangeToRange)(e.range,n.tokenizerOutput.lines)))}))}catch(e){const t=(e.stack?e.stack.toString():void 0)||("string"==typeof e.message?e.message:void 0)||JSON.stringify(e);this._console.error(I.LocMessage.internalParseError().format({file:this.getUri().toUserVisibleString(),message:t})),this._writableData.parsedFileContents="",this._writableData.parserOutput={parseTree:k.ModuleNode.create({start:0,length:0}),importedModules:[],futureImports:new Set,containsWildcardImport:!1,typingSymbolAliases:new Map},this._writableData.tokenizerLines=new _.TextRangeCollection([]),this._writableData.tokenizerOutput={tokens:new _.TextRangeCollection([]),lines:this._writableData.tokenizerLines,typeIgnoreAll:void 0,typeIgnoreLines:new Map,pyrightIgnoreLines:new Map,predominantEndOfLineSequence:"\n",hasPredominantTabSequence:!1,predominantTabSequence:"    ",predominantSingleQuoteCharacter:"'"},this._writableData.imports=void 0,this._writableData.builtinsImport=void 0;const n=this.createDiagnosticSink();n.addError(I.LocMessage.internalParseError().format({file:this.getUri().toUserVisibleString(),message:t}),(0,b.getEmptyRange)()),this._writableData.parseDiagnostics=n.fetchAndClear(),this._writableData.taskListDiagnostics=n.fetchAndClear()}return this._writableData.analyzedFileContentsVersion=this._writableData.fileContentsVersion,this._writableData.isBindingNeeded=!0,this._writableData.isCheckingNeeded=!0,this._writableData.parseTreeNeedsCleaning=!1,this._writableData.hitMaxImportDepth=void 0,this._recomputeDiagnostics(e),!0}))}bind(e,t,n,a){return(0,d.assert)(!this.isParseRequired(),"Bind called before parsing"),(0,d.assert)(this.isBindingRequired(),"Bind called unnecessarily"),(0,d.assert)(!this._writableData.isBindingInProgress,"Bind called while binding in progress"),(0,d.assert)(void 0!==this._writableData.parserOutput,"Parse results not available"),this._logTracker.log(`binding: ${this._getPathForLogging(this._uri)}`,(()=>{try{C.timingStats.bindTime.timeOperation((()=>{this._cleanParseTreeIfRequired();const r=this._buildFileInfo(e,this._writableData.parsedFileContents,t,n,a);A.setFileInfo(this._writableData.parserOutput.parseTree,r);const s=new x.Binder(r,e.indexGenerationMode);if(this._writableData.isBindingInProgress=!0,s.bindModule(this._writableData.parserOutput.parseTree),e.internalTestMode){(new F.TestWalker).walk(this._writableData.parserOutput.parseTree)}this._writableData.bindDiagnostics=r.diagnosticSink.fetchAndClear();const i=A.getScope(this._writableData.parserOutput.parseTree);(0,d.assert)(void 0!==i,"Module scope not returned by binder"),this._writableData.moduleSymbolTable=i.symbolTable}))}catch(e){const t=(e.stack?e.stack.toString():void 0)||("string"==typeof e.message?e.message:void 0)||JSON.stringify(e);this._console.error(I.LocMessage.internalBindError().format({file:this.getUri().toUserVisibleString(),message:t}));const n=this.createDiagnosticSink();n.addError(I.LocMessage.internalBindError().format({file:this.getUri().toUserVisibleString(),message:t}),(0,b.getEmptyRange)()),this._writableData.bindDiagnostics=n.fetchAndClear()}finally{this._writableData.isBindingInProgress=!1}this._writableData.isCheckingNeeded=!0,this._writableData.isBindingNeeded=!1,this._recomputeDiagnostics(e)}))}check(e,t,n,a,r){return(0,d.assert)(!this.isParseRequired(),`Check called before parsing: state=${this._writableData.debugPrint()}`),(0,d.assert)(!this.isBindingRequired(),`Check called before binding: state=${this._writableData.debugPrint()}`),(0,d.assert)(!this._writableData.isBindingInProgress,"Check called while binding in progress"),(0,d.assert)(this.isCheckingRequired(),"Check called unnecessarily"),(0,d.assert)(void 0!==this._writableData.parserOutput,"Parse results not available"),this._logTracker.log(`checking: ${this._getPathForLogging(this._uri)}`,(()=>{try{C.timingStats.typeCheckerTime.timeOperation((()=>{const e=new C.Duration;new P.Checker(t,n,this._writableData.parserOutput,a,r).check(),this._writableData.isCheckingNeeded=!1;const s=A.getFileInfo(this._writableData.parserOutput.parseTree);this._writableData.checkerDiagnostics=s.diagnosticSink.fetchAndClear(),this._writableData.checkTime=e.getDurationInMilliseconds()}))}catch(e){if(!o.OperationCanceledException.is(e)){const t=(e.stack?e.stack.toString():void 0)||("string"==typeof e.message?e.message:void 0)||JSON.stringify(e);this._console.error(I.LocMessage.internalTypeCheckingError().format({file:this.getUri().toUserVisibleString(),message:t}));const n=this.createDiagnosticSink();n.addError(I.LocMessage.internalTypeCheckingError().format({file:this.getUri().toUserVisibleString(),message:t}),(0,b.getEmptyRange)()),this._writableData.checkerDiagnostics=n.fetchAndClear(),this._writableData.isCheckingNeeded=!1}throw e}finally{this._writableData.circularDependencies=[],this._recomputeDiagnostics(e)}}))}test_enableIPythonMode(e){this._ipythonMode=e?M.CellDocs:M.None}createDiagnosticSink(){return new y.DiagnosticSink}createTextRangeDiagnosticSink(e){return new y.TextRangeDiagnosticSink(e)}_recomputeDiagnostics(e){this._writableData.diagnosticVersion++;let t=!0;this._isThirdPartyImport&&(t=!1);let n=[];(0,l.appendArray)(n,this._writableData.parseDiagnostics),(0,l.appendArray)(n,this._writableData.commentDiagnostics),(0,l.appendArray)(n,this._writableData.bindDiagnostics),(0,l.appendArray)(n,this._writableData.checkerDiagnostics),(0,l.appendArray)(n,this._writableData.taskListDiagnostics);const a=n,r=new Map(this._writableData.typeIgnoreLines),s=new Map(this._writableData.pyrightIgnoreLines);this._diagnosticRuleSet.enableTypeIgnoreComments&&this._writableData.typeIgnoreLines.size>0&&(n=n.filter((e=>{if(3!==e.category&&4!==e.category&&5!==e.category)for(let t=e.range.start.line;t<=e.range.end.line;t++)if(this._writableData.typeIgnoreLines.has(t))return r.delete(t),!1;return!0}))),this._writableData.pyrightIgnoreLines.size>0&&(n=n.filter((e=>{if(3!==e.category&&4!==e.category&&5!==e.category)for(let t=e.range.start.line;t<=e.range.end.line;t++){const n=this._writableData.pyrightIgnoreLines.get(t);if(n){if(!n.rulesList)return s.delete(t),!1;const a=e.getRule();if(!a)return!0;if(n.rulesList.find((e=>e.text===a))){const e=s.get(t);if(null==e?void 0:e.rulesList){const n=e.rulesList.filter((e=>e.text!==a));0===n.length?s.delete(t):s.set(t,{range:e.range,rulesList:n})}return!1}return!0}}return!0})));const i=[];if("none"!==this._diagnosticRuleSet.reportUnnecessaryTypeIgnoreComment&&!this._writableData.isCheckingNeeded){const e=(0,u.convertLevelToCategory)(this._diagnosticRuleSet.reportUnnecessaryTypeIgnoreComment),t=a.filter((e=>0===e.category||1===e.category||2===e.category)),n=e=>a.find((t=>4===t.category&&t.range.start.line<=e.start.line&&t.range.end.line>=e.end.line));if(0===t.length&&void 0!==this._writableData.typeIgnoreAll){const t=this._writableData.typeIgnoreAll.range.start,a=t+this._writableData.typeIgnoreAll.range.length,r=(0,f.convertOffsetsToRange)(t,a,this._writableData.tokenizerLines);if(!n(r)&&this._diagnosticRuleSet.enableTypeIgnoreComments){const t=new u.Diagnostic(e,I.LocMessage.unnecessaryTypeIgnore(),r);t.setRule(m.DiagnosticRule.reportUnnecessaryTypeIgnoreComment),i.push(t)}}r.forEach((t=>{if(this._writableData.tokenizerLines){const a=t.range.start,r=a+t.range.length,s=(0,f.convertOffsetsToRange)(a,r,this._writableData.tokenizerLines);if(!n(s)&&this._diagnosticRuleSet.enableTypeIgnoreComments){const t=new u.Diagnostic(e,I.LocMessage.unnecessaryTypeIgnore(),s);t.setRule(m.DiagnosticRule.reportUnnecessaryTypeIgnoreComment),i.push(t)}}})),s.forEach((t=>{if(this._writableData.tokenizerLines)if(t.rulesList)t.rulesList.forEach((t=>{const a=t.range.start,r=a+t.range.length,s=(0,f.convertOffsetsToRange)(a,r,this._writableData.tokenizerLines);if(!n(s)){const n=new u.Diagnostic(e,I.LocMessage.unnecessaryPyrightIgnoreRule().format({name:t.text}),s);n.setRule(m.DiagnosticRule.reportUnnecessaryTypeIgnoreComment),i.push(n)}}));else{const a=t.range.start,r=a+t.range.length,s=(0,f.convertOffsetsToRange)(a,r,this._writableData.tokenizerLines);if(!n(s)){const t=new u.Diagnostic(e,I.LocMessage.unnecessaryTypeIgnore(),s);t.setRule(m.DiagnosticRule.reportUnnecessaryTypeIgnoreComment),i.push(t)}}}))}if("none"!==this._diagnosticRuleSet.reportImportCycles&&this._writableData.circularDependencies.length>0){const e=(0,u.convertLevelToCategory)(this._diagnosticRuleSet.reportImportCycles);this._writableData.circularDependencies.forEach((t=>{const a=new u.Diagnostic(e,I.LocMessage.importCycleDetected()+"\n"+t.getPaths().map((e=>"  "+e.toUserVisibleString())).join("\n"),(0,b.getEmptyRange)());a.setRule(m.DiagnosticRule.reportImportCycles),n.push(a)}))}void 0!==this._writableData.hitMaxImportDepth&&n.push(new u.Diagnostic(0,I.LocMessage.importDepthExceeded().format({depth:this._writableData.hitMaxImportDepth}),(0,b.getEmptyRange)())),this._diagnosticRuleSet.enableTypeIgnoreComments&&void 0!==this._writableData.typeIgnoreAll&&(n=n.filter((e=>0!==e.category&&1!==e.category&&2!==e.category))),n=n.concat(i),t||(n=n.filter((e=>3===e.category||4===e.category||5===e.category))),e.ignore.find((e=>this._uri.matchesRegex(e.regExp)))&&(n=[]),this._writableData.accumulatedDiagnostics=n}_cachePreEditState(){this._editMode.isEditMode&&!this._preEditData&&(this._preEditData=this._writableData,this._writableData=new O(this._console))}_addTaskListDiagnostics(e,t,n){if(e&&0!==e.length&&n)for(let a=0;a<t.tokens.count;a++){const r=t.tokens.getItemAt(a);if(r.comments&&0!==r.comments.length)for(const a of r.comments)for(const r of e){const e="^[\\s]*"+r.text+"([\\s]*$|[\\W]+)";if(!RegExp(e,"i").test(a.value))continue;let s=a.start;s+=a.value.toLowerCase().indexOf(r.text.toLowerCase());const i=b.TextRange.getEnd(a),o=(0,f.convertOffsetsToRange)(s,i,t.lines);n.push(new u.Diagnostic(6,a.value.trim(),o,r.priority))}}}_buildFileInfo(e,t,n,a,r){(0,d.assert)(void 0!==this._writableData.parserOutput,"Parse results not available");return{importLookup:n,futureImports:r,builtinsScope:a,diagnosticSink:this.createTextRangeDiagnosticSink(this._writableData.tokenizerLines),executionEnvironment:e.findExecEnvironment(this._uri),diagnosticRuleSet:this._diagnosticRuleSet,lines:this._writableData.tokenizerLines,typingSymbolAliases:this._writableData.parserOutput.typingSymbolAliases,definedConstants:e.defineConstant,fileUri:this._uri,moduleName:this.getModuleName(),isStubFile:this._isStubFile,isTypingStubFile:this._isTypingStubFile,isTypingExtensionsStubFile:this._isTypingExtensionsStubFile,isTypeshedStubFile:this._isTypeshedStubFile,isBuiltInStubFile:this._isBuiltInStubFile,isInPyTypedPackage:this._isThirdPartyPyTypedPresent,ipythonMode:this._ipythonMode,accessedSymbolSet:new Set}}_cleanParseTreeIfRequired(){if(this._writableData.parserOutput&&this._writableData.parseTreeNeedsCleaning){new D.ParseTreeCleanerWalker(this._writableData.parserOutput.parseTree).clean(),this._writableData.parseTreeNeedsCleaning=!1}}_resolveImports(e,t,n){const a=[],r=(t,r=!1)=>{const s=e.resolveImport(this._uri,n,{leadingDots:0,nameParts:t,importedSymbols:void 0});if(!r||s.isImportFound)return 0===s.resolvedUris.length||s.resolvedUris[0]!==this._uri?(a.push(s),s):void 0};let s;this._isThirdPartyImport||this._isStubFile||(s=r(["__builtins__"],!0)),s||(s=r(["builtins"]));for(const r of t){const t=e.resolveImport(this._uri,n,{leadingDots:r.leadingDots,nameParts:r.nameParts,importedSymbols:r.importedSymbols});a.push(t),r.nameParts.length===r.nameNode.nameParts.length?A.setImportInfo(r.nameNode,t):((0,d.assert)(r.nameParts.length>0),(0,d.assert)(r.nameParts.length-1<r.nameNode.nameParts.length),A.setImportInfo(r.nameNode.nameParts[r.nameParts.length-1],t))}return{imports:a,builtinsImportResult:s}}_getPathForLogging(e){return(0,g.getPathForLogging)(this.fileSystem,e)}_parseFile(e,t,n,a,r){var s;const i=e.findExecEnvironment(t),o=new w.ParseOptions;o.ipythonMode=a,t.pathEndsWith("pyi")&&(o.isStubFile=!0),o.pythonVersion=i.pythonVersion,o.skipFunctionAndClassBody=null!==(s=e.indexGenerationMode)&&void 0!==s&&s;return(new w.Parser).parseSourceFile(n,o,r)}_tokenizeContents(e){const t=(new S.Tokenizer).tokenize(e);return void 0!==this._writableData.clientDocumentContents&&(this._writableData.tokenizerOutput=t,this._writableData.tokenizerLines=t.lines),t}_fireFileDirtyEvent(){var e;null===(e=this.serviceProvider.tryGet(T.ServiceKeys.stateMutationListeners))||void 0===e||e.forEach((e=>{var t;try{null===(t=e.onFileDirty)||void 0===t||t.call(e,this._uri)}catch(e){const t=this.serviceProvider.tryGet(T.ServiceKeys.console);t&&t.error(`State mutation listener exception: ${e.message}`)}}))}}},80068:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SourceFileInfo=void 0;t.SourceFileInfo=class{constructor(e,t,n,a,r,s={}){this.sourceFile=e,this.isTypeshedFile=t,this.isThirdPartyImport=n,this.isThirdPartyPyTypedPresent=a,this._editModeTracker=r,this.isCreatedInEditMode=this._editModeTracker.isEditMode,this._writableData=this._createWriteableData(s),this._cachePreEditState()}get diagnosticsVersion(){return this._writableData.diagnosticsVersion}get builtinsImport(){return this._writableData.builtinsImport}get chainedSourceFile(){return this._writableData.chainedSourceFile}get effectiveFutureImports(){return this._writableData.effectiveFutureImports}get isTracked(){return this._writableData.isTracked}get isOpenByClient(){return this._writableData.isOpenByClient}get imports(){return this._writableData.imports}get importedBy(){return this._writableData.importedBy}get shadows(){return this._writableData.shadows}get shadowedBy(){return this._writableData.shadowedBy}set diagnosticsVersion(e){this._cachePreEditState(),this._writableData.diagnosticsVersion=e}set builtinsImport(e){this._cachePreEditState(),this._writableData.builtinsImport=e}set chainedSourceFile(e){this._cachePreEditState(),this._writableData.chainedSourceFile=e}set effectiveFutureImports(e){this._cachePreEditState(),this._writableData.effectiveFutureImports=e}set isTracked(e){this._cachePreEditState(),this._writableData.isTracked=e}set isOpenByClient(e){this._cachePreEditState(),this._writableData.isOpenByClient=e}mutate(e){this._cachePreEditState(),e(this._writableData)}restore(){return this._preEditData&&(this._writableData=this._preEditData,this._preEditData=void 0,this.sourceFile.dropParseAndBindInfo()),this.sourceFile.restore()}_cachePreEditState(){this._editModeTracker.isEditMode&&!this._preEditData&&(this._preEditData=this._writableData,this._writableData=this._cloneWriteableData(this._writableData),this._editModeTracker.addMutatedFiles(this))}_createWriteableData(e){var t,n;return{isTracked:null!==(t=e.isTracked)&&void 0!==t&&t,isOpenByClient:null!==(n=e.isOpenByClient)&&void 0!==n&&n,builtinsImport:e.builtinsImport,chainedSourceFile:e.chainedSourceFile,diagnosticsVersion:e.diagnosticsVersion,effectiveFutureImports:e.effectiveFutureImports,imports:[],importedBy:[],shadows:[],shadowedBy:[]}}_cloneWriteableData(e){return{isTracked:e.isTracked,isOpenByClient:e.isOpenByClient,builtinsImport:e.builtinsImport,chainedSourceFile:e.chainedSourceFile,diagnosticsVersion:e.diagnosticsVersion,effectiveFutureImports:e.effectiveFutureImports,imports:e.imports.slice(),importedBy:e.importedBy.slice(),shadows:e.shadows.slice(),shadowedBy:e.shadowedBy.slice()}}}},408:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createChainedByList=t.verifyNoCyclesInChainedFiles=t.collectImportedByCells=t.isUserCode=void 0;const a=n(83181),r=n(37636),s=n(41500);function i(e,t){e.importedBy.forEach((e=>{t.has(e)||(t.add(e),i(e,t))}))}t.isUserCode=function(e){return!!e&&e.isTracked&&!e.isThirdPartyImport&&!e.isTypeshedFile},t.collectImportedByCells=function(e,t){!function(e){for(const t of e.getSourceFileInfoList())t.sourceFile.getIPythonMode()===s.IPythonMode.CellDocs&&(e.getParserOutput(t.sourceFile.getUri()),e.handleMemoryHighUsage())}(e);const n=new Set;return i(t,n),n},t.verifyNoCyclesInChainedFiles=function(e,t){var n,s;let i=t.chainedSourceFile;if(!i)return;const o=new Set([t.sourceFile.getUri().key]);for(;i;){const t=i.sourceFile.getUri().key;o.has(t)&&(0,a.fail)(null!==(s=null===(n=e.serviceProvider.tryGet(r.ServiceKeys.debugInfoInspector))||void 0===n?void 0:n.getCycleDetail(e,i))&&void 0!==s?s:`Found a cycle in implicit imports files for ${t}`),o.add(t),i=i.chainedSourceFile}},t.createChainedByList=function(e,t){var n,s;const i=new Map;for(const t of e.getSourceFileInfoList())t.chainedSourceFile&&i.set(t.chainedSourceFile,t);const o=new Set,l=[t];let p=t;for(;p;)o.has(p)&&(0,a.fail)(null!==(s=null===(n=e.serviceProvider.tryGet(r.ServiceKeys.debugInfoInspector))||void 0===n?void 0:n.getCycleDetail(e,p))&&void 0!==s?s:"detected a cycle in chained files"),o.add(p),p=i.get(p),p&&l.push(p);return l}},76392:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.isStubFile=t.SourceMapper=void 0;const i=s(n(9316)),o=s(n(28340)),l=n(28040),p=n(86016),c=n(83181),d=n(65392),u=n(408),m=n(82020),y=n(808),g=n(8312);function h(e){return".pyi"===e.lastExtension}t.SourceMapper=class{constructor(e,t,n,a,r,s,i,o,l){this._importResolver=e,this._execEnv=t,this._evaluator=n,this._fileBinder=a,this._boundSourceGetter=r,this._mapCompiled=s,this._preferStubs=i,this._fromFile=o,this._cancelToken=l}findModules(e){var t;return(this._isStubThatShouldBeMappedToImplementation(e)?this._getBoundSourceFilesFromStubFile(e):[null===(t=this._boundSourceGetter(e))||void 0===t?void 0:t.sourceFile]).filter(p.isDefined).map((e=>{var t;return null===(t=e.getParserOutput())||void 0===t?void 0:t.parseTree})).filter(p.isDefined)}getModuleNode(e){var t,n;return null===(n=null===(t=this._boundSourceGetter(e))||void 0===t?void 0:t.sourceFile.getParserOutput())||void 0===n?void 0:n.parseTree}findDeclarations(e){return(0,d.isClassDeclaration)(e)?this._findClassOrTypeAliasDeclarations(e):(0,d.isFunctionDeclaration)(e)?this._findFunctionOrTypeAliasDeclarations(e):(0,d.isVariableDeclaration)(e)?this._findVariableDeclarations(e):(0,d.isParameterDeclaration)(e)?this._findParameterDeclarations(e):(0,d.isSpecialBuiltInClassDeclaration)(e)?this._findSpecialBuiltInClassDeclarations(e):[]}findDeclarationsByType(e,t,n=!1){const a=[];return this._addClassTypeDeclarations(e,t,a,new Set,n),a}findClassDeclarationsByType(e,t){return this.findDeclarationsByType(e,t).filter((e=>(0,d.isClassDeclaration)(e))).map((e=>e))}findFunctionDeclarations(e){return this._findFunctionOrTypeAliasDeclarations(e).filter((e=>(0,d.isFunctionDeclaration)(e))).map((e=>e))}isUserCode(e){return(0,u.isUserCode)(this._boundSourceGetter(e))}getNextFileName(e){const t=e.stripExtension();let n=1,a=t.addExtension(`_${n}.py`);for(;this.isUserCode(a)&&n<1e3;)n+=1,a=t.addExtension(`_${n}.py`);return a}_findSpecialBuiltInClassDeclarations(e,t=new Set){if(38===e.node.valueExpression.nodeType){const n=e.node.valueExpression.value;return this._getBoundSourceFilesFromStubFile(e.uri).flatMap((e=>this._findClassDeclarationsByName(e,n,t)))}return[]}_findClassOrTypeAliasDeclarations(e,t=new Set){const n=this._getFullClassName(e.node);return this._getBoundSourceFilesFromStubFile(e.uri).flatMap((e=>this._findClassDeclarationsByName(e,n,t)))}_findFunctionOrTypeAliasDeclarations(e,t=new Set){const n=e.node.name.value,a=this._getBoundSourceFilesFromStubFile(e.uri);if(e.isMethod){const r=o.getEnclosingClass(e.node);if(void 0===r)return[];const s=this._getFullClassName(r);return a.flatMap((e=>this._findMethodDeclarationsByName(e,s,n,t)))}return a.flatMap((e=>this._findFunctionDeclarationsByName(e,n,t)))}_findVariableDeclarations(e,t=new Set){if(38!==e.node.nodeType)return[];const n=e.node.value,a=this._getBoundSourceFilesFromStubFile(e.uri),r=o.getEnclosingClass(e.node);if(r){const e=this._getFullClassName(r);return a.flatMap((a=>this._findFieldDeclarationsByName(a,e,n,t)))}return a.flatMap((e=>this._findVariableDeclarationsByName(e,n,t)))}_findParameterDeclarations(e){const t=[];if(!e.node.name)return t;const n=o.getEnclosingFunction(e.node);if(!n)return t;const a=this._evaluator.getDeclarationsForNameNode(n.name);if(!a)return t;const r=new Set;for(const n of a)for(const a of this._findFunctionOrTypeAliasDeclarations(n,r))(0,l.appendArray)(t,this._lookUpSymbolDeclarations(a.node,e.node.name.value).filter((e=>(0,d.isParameterDeclaration)(e))).map((e=>e)));return t}_findMemberDeclarationsByName(e,t,n,a,r){const s=[],i=this._findClassDeclarationsByName(e,t,r);for(const e of i.filter((e=>(0,d.isClassDeclaration)(e))).map((e=>e))){const t=this._evaluator.getTypeOfClass(e.node);if(!t)continue;const i=(0,y.lookUpClassMember)(t.classType,n);if(i)for(const e of i.symbol.getDeclarations())a(e,r,s)}return s}_findFieldDeclarationsByName(e,t,n,a){let r=[];const s=`@${e.getUri()}/c/${t}/v/${n}`;return a.has(s)||(a.add(s),r=this._findMemberDeclarationsByName(e,t,n,((e,t,n)=>{if((0,d.isVariableDeclaration)(e))if(this._isStubThatShouldBeMappedToImplementation(e.uri))for(const a of this._findVariableDeclarations(e,t))(0,d.isVariableDeclaration)(a)&&n.push(a);else n.push(e)}),a),a.delete(s)),r}_findMethodDeclarationsByName(e,t,n,a){let r=[];const s=`@${e.getUri()}/c/${t}/f/${n}`;return a.has(s)||(a.add(s),r=this._findMemberDeclarationsByName(e,t,n,((e,t,n)=>{(0,d.isFunctionDeclaration)(e)&&(this._isStubThatShouldBeMappedToImplementation(e.uri)?(0,l.appendArray)(n,this._findFunctionOrTypeAliasDeclarations(e,t)):n.push(e))}),a),a.delete(s)),r}_findVariableDeclarationsByName(e,t,n){var a;const r=[],s=`@${e.getUri()}/v/${t}`;if(n.has(s))return r;n.add(s);const i=null===(a=e.getParserOutput())||void 0===a?void 0:a.parseTree;if(!i)return r;const o=this._lookUpSymbolDeclarations(i,t);if(0===o.length)this._addDeclarationsFollowingWildcardImports(i,t,r,n);else for(const e of o)this._addVariableDeclarations(e,r,n);return n.delete(s),r}_findFunctionDeclarationsByName(e,t,n){var a;const r=[],s=`@${e.getUri()}/f/${t}`;if(n.has(s))return r;n.add(s);const i=null===(a=e.getParserOutput())||void 0===a?void 0:a.parseTree;if(!i)return r;const o=this._lookUpSymbolDeclarations(i,t);if(0===o.length)this._addDeclarationsFollowingWildcardImports(i,t,r,n);else for(const e of o)this._addClassOrFunctionDeclarations(e,r,n);return n.delete(s),r}_findClassDeclarationsByName(e,t,n){var a;let r=[];const s=null===(a=e.getParserOutput())||void 0===a?void 0:a.parseTree;if(s){let a=t.split(".");a.length>0&&(r=this._findClassDeclarations(e,a[0],s,n),a=a.slice(1));for(const t of a)r=r.flatMap((a=>this._findClassDeclarations(e,t,a.node,n)))}return r}_findClassDeclarations(e,t,n,a){const r=[],s=`@${e.getUri()}[${n.start}]${t}`;if(a.has(s))return r;a.add(s);const i=this._lookUpSymbolDeclarations(n,t);if(0===i.length&&36===n.nodeType)this._addDeclarationsFollowingWildcardImports(n,t,r,a);else for(const e of i)this._addClassOrFunctionDeclarations(e,r,a);return a.delete(s),r}_addVariableDeclarations(e,t,n){if((0,d.isVariableDeclaration)(e))this._isStubThatShouldBeMappedToImplementation(e.uri)?(0,l.appendArray)(t,this._findVariableDeclarations(e,n)):t.push(e);else if((0,d.isAliasDeclaration)(e)){const a=this._evaluator.resolveAliasDeclaration(e,!0);a&&((0,d.isVariableDeclaration)(a)?this._addVariableDeclarations(a,t,n):((0,d.isClassDeclaration)(a)||(0,d.isFunctionDeclaration)(a))&&this._addClassOrFunctionDeclarations(a,t,n))}}_addClassOrFunctionDeclarations(e,t,n){var a;if((0,d.isClassDeclaration)(e))this._isStubThatShouldBeMappedToImplementation(e.uri)?(0,l.appendArray)(t,this._findClassOrTypeAliasDeclarations(e,n)):t.push(e);else if((0,d.isSpecialBuiltInClassDeclaration)(e))t.push(e);else if((0,d.isFunctionDeclaration)(e))this._isStubThatShouldBeMappedToImplementation(e.uri)?(0,l.appendArray)(t,this._findFunctionOrTypeAliasDeclarations(e,n)):t.push(e);else if((0,d.isAliasDeclaration)(e)){const a=this._handleSpecialBuiltInModule(e),r=this._evaluator.resolveAliasDeclaration(a,!0);r&&!(0,d.isAliasDeclaration)(r)&&this._addClassOrFunctionDeclarations(r,t,n)}else if((0,d.isVariableDeclaration)(e)){this._addVariableDeclarations(e,t,n);const r=null!==(a=e.typeAliasName)&&void 0!==a?a:e.node,s=this._evaluator.getType(r);if(!s)return;if((0,g.isFunction)(s)&&s.details.declaration)this._addClassOrFunctionDeclarations(s.details.declaration,t,n);else if((0,g.isOverloadedFunction)(s))for(const e of s.overloads.map((e=>e.details.declaration)).filter(p.isDefined))this._addClassOrFunctionDeclarations(e,t,n);else(0,g.isInstantiableClass)(s)&&this._addClassTypeDeclarations(e.uri,s,t,n)}}_handleSpecialBuiltInModule(e){if(!e.uri.isEmpty()||!e.node)return e;if("io"!==e.moduleName&&"collections"!==e.moduleName)return e;const t=this._importResolver.getTypeshedStdLibPath(this._execEnv);if(!t)return e;const n=o.getFileInfoFromNode(e.node);if(!n)return e;const a=t.combinePaths(function(){switch(e.node.nodeType){case 21:case 22:return e.node.module;case 23:return e.node.parent.module;default:return(0,c.assertNever)(e.node)}}().nameParts.map((e=>e.value)).join(".")+".pyi"),r=this._getSourceFiles(a,n.fileUri);if(0===r.length)return e;const s={...e};return s.uri=r[0].getUri(),s}_addClassTypeDeclarations(e,t,n,a,r=!1){const s=r&&t.typeAliasInfo?t.typeAliasInfo.fileUri:t.details.fileUri,i=this._getSourceFiles(s,void 0,e),o=r&&t.typeAliasInfo?t.typeAliasInfo.fullName:t.details.fullName,p=r&&t.typeAliasInfo?t.typeAliasInfo.moduleName:t.details.moduleName,c=o.substring(p.length+1);for(const e of i)(0,l.appendArray)(n,this._findClassDeclarationsByName(e,c,a))}_getSourceFiles(e,t,n){const a=[];if(this._isStubThatShouldBeMappedToImplementation(e))(0,l.appendArray)(a,this._getBoundSourceFilesFromStubFile(e,t,n));else{const t=this._boundSourceGetter(e);t&&a.push(t.sourceFile)}return a}_addDeclarationsFollowingWildcardImports(e,t,n,a){var r,s;const o=null===(r=i.getScope(e))||void 0===r?void 0:r.symbolTable;if(o)for(const e of o.values())for(const r of e.getDeclarations()){if(!(0,d.isAliasDeclaration)(r)||r.uri.isEmpty()||22!==r.node.nodeType||!r.node.isWildcardImport)continue;const e=`@${r.uri.key}/l/${t}`;if(a.has(e))continue;a.add(e);const i=this._getSourceFiles(r.uri);for(const e of i){const r=null===(s=e.getParserOutput())||void 0===s?void 0:s.parseTree;if(!r)continue;const i=this._lookUpSymbolDeclarations(r,t);if(0===i.length)this._addDeclarationsFollowingWildcardImports(r,t,n,a);else for(const e of i){const t=this._evaluator.resolveAliasDeclaration(e,!0);t&&((0,d.isFunctionDeclaration)(t)||(0,d.isClassDeclaration)(t)?this._addClassOrFunctionDeclarations(t,n,a):(0,d.isVariableDeclaration)(t)&&this._addVariableDeclarations(t,n,a))}}}}_lookUpSymbolDeclarations(e,t){if(void 0===e)return[];const n=i.getScope(e),a=null==n?void 0:n.lookUpSymbol(t),r=null==a?void 0:a.getDeclarations();return null!=r?r:[]}_getFullClassName(e){const t=[];let n=e;for(;void 0!==n;)t.push(n.name.value),n=o.getEnclosingClass(n);return t.reverse().join(".")}_getBoundSourceFilesFromStubFile(e,t,n){var a;return this._getSourcePathsFromStub(e,null!=n?n:null===(a=this._fromFile)||void 0===a?void 0:a.sourceFile.getUri()).map((n=>this._fileBinder(null!=t?t:e,n))).filter(p.isDefined)}_getSourcePathsFromStub(e,t){let n=this._importResolver.getSourceFilesFromStub(e,this._execEnv,this._mapCompiled);if(n.length>0)return n;const a=this._getStubFileImportTree(e,t);for(let e=0;e<a.length;e++)if(n=this._importResolver.getSourceFilesFromStub(a[e],this._execEnv,this._mapCompiled),n.length>0)return n;return[]}_getStubFileImportTree(e,t){return t&&this._isStubThatShouldBeMappedToImplementation(e)?(0,m.buildImportTree)(t,e,(e=>{const t=this._boundSourceGetter(e);return t?t.importedBy.map((e=>e.sourceFile.getUri())):[]}),this._cancelToken).filter((e=>this._isStubThatShouldBeMappedToImplementation(e))):[e]}_isStubThatShouldBeMappedToImplementation(e){if(this._preferStubs)return!1;return!!h(e)&&this._importResolver.getSourceFilesFromStub(e,this._execEnv,this._mapCompiled).every((t=>t!==e))}},t.isStubFile=h},82020:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.buildImportTree=void 0;const n=1e3;class a{constructor(){this.value=0}}function r(e,t,a,s,i,o){if(i.value>n||o.isCancellationRequested)return[];if(i.value+=1,t.equals(e))return s.length?s:[t];if(s.length>1&&s.find((e=>e.equals(t))))return[];const l=a(t);for(let n=0;n<l.length&&!o.isCancellationRequested;n++){const p=r(e,l[n],a,[...s,t],i,o);if(p.length>0)return p}return[]}t.buildImportTree=function(e,t,n,s){const i=r(e,t,n,[],new a,s);return i.length>0?i:[t]}},21084:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateStaticBoolLikeExpression=t.evaluateStaticBoolExpression=void 0;const a=n(55484),r=n(61328);function s(e,t,n,c,d){if(4===e.nodeType)return s(e.rightExpression,t,n,c,d);if(55===e.nodeType){if(38===e.operator){const a=i(e.expression,t,n,c,d);if(void 0!==a)return!a}}else if(7===e.nodeType){if(37===e.operator||36===e.operator){const a=s(e.leftExpression,t,n,c,d),r=s(e.rightExpression,t,n,c,d);if(void 0===a||void 0===r)return;return 37===e.operator?a||r:a&&r}if(p(e.leftExpression,d)&&52===e.rightExpression.nodeType){const n=function(e){if(e.expressions.length>=2){if(40===e.expressions[0].nodeType&&!e.expressions[0].isImaginary&&40===e.expressions[1].nodeType&&!e.expressions[1].isImaginary){const t=e.expressions[0],n=e.expressions[1];if("number"!=typeof t.value||"number"!=typeof n.value)return;const a=t.value,s=n.value;let i,o,l;return e.expressions.length>=3&&40===e.expressions[2].nodeType&&!e.expressions[2].isImaginary&&"number"==typeof e.expressions[2].value&&(i=e.expressions[2].value),e.expressions.length>=4&&48===e.expressions[3].nodeType&&1===e.expressions[3].strings.length&&49===e.expressions[3].strings[0].nodeType&&(o=e.expressions[3].strings[0].value),e.expressions.length>=5&&40===e.expressions[4].nodeType&&!e.expressions[4].isImaginary&&"number"==typeof e.expressions[4].value&&(l=e.expressions[4].value),new r.PythonVersion(a,s,i,o,l)}}else if(1===e.expressions.length){const t=e.expressions[0];if("number"==typeof t.value)return new r.PythonVersion(t.value,0)}return}(e.rightExpression);return o(e.operator,t.pythonVersion,n)}if(24===e.leftExpression.nodeType&&p(e.leftExpression.baseExpression,d)&&1===e.leftExpression.items.length&&!e.leftExpression.trailingComma&&!e.leftExpression.items[0].name&&0===e.leftExpression.items[0].argumentCategory&&40===e.leftExpression.items[0].valueExpression.nodeType&&!e.leftExpression.items[0].valueExpression.isImaginary&&0===e.leftExpression.items[0].valueExpression.value&&40===e.rightExpression.nodeType&&e.rightExpression.isInteger&&"number"==typeof e.rightExpression.value)return o(e.operator,new r.PythonVersion(t.pythonVersion.major,0),new r.PythonVersion(e.rightExpression.value,0));if(function(e,t=["sys"]){if(35===e.nodeType&&38===e.leftExpression.nodeType&&"platform"===e.memberName.value&&t.some((t=>t===e.leftExpression.value)))return!0;return!1}(e.leftExpression,d)&&48===e.rightExpression.nodeType){const n=e.rightExpression.strings.map((e=>e.value)).join(""),r=function(e){if(e.pythonPlatform===a.PythonPlatform.Darwin)return"darwin";if(e.pythonPlatform===a.PythonPlatform.Windows)return"win32";if(e.pythonPlatform===a.PythonPlatform.Linux)return"linux";return}(t);return l(e.operator,r,n)}if(function(e){if(35===e.nodeType&&38===e.leftExpression.nodeType&&"os"===e.leftExpression.value&&"name"===e.memberName.value)return!0;return!1}(e.leftExpression)&&48===e.rightExpression.nodeType){const n=e.rightExpression.strings.map((e=>e.value)).join(""),r=function(e){if(e.pythonPlatform===a.PythonPlatform.Darwin)return"posix";if(e.pythonPlatform===a.PythonPlatform.Windows)return"nt";if(e.pythonPlatform===a.PythonPlatform.Linux)return"posix";return}(t);if(void 0!==r)return l(e.operator,r,n)}else if(48===e.rightExpression.nodeType){let t;if(38===e.leftExpression.nodeType?t=n.get(e.leftExpression.value):35===e.leftExpression.nodeType&&(t=n.get(e.leftExpression.memberName.value)),void 0!==t&&"string"==typeof t){const n=e.rightExpression.strings.map((e=>e.value)).join("");return l(e.operator,t,n)}}}else if(11===e.nodeType){if(33===e.constType)return!0;if(15===e.constType)return!1}else if(38===e.nodeType){if("TYPE_CHECKING"===e.value)return!0;const t=n.get(e.value);if(void 0!==t)return!!t}else if(35===e.nodeType){if(c&&"TYPE_CHECKING"===e.memberName.value&&38===e.leftExpression.nodeType&&c.some((t=>t===e.leftExpression.value)))return!0;const t=n.get(e.memberName.value);if(void 0!==t)return!!t}}function i(e,t,n,a,r){return(11!==e.nodeType||26!==e.constType)&&s(e,t,n,a,r)}function o(e,t,n){if(void 0!==t&&void 0!==n){if(20===e)return t.isLessThan(n);if(21===e)return t.isLessOrEqualTo(n);if(15===e)return t.isGreaterThan(n);if(16===e)return t.isGreaterOrEqualTo(n);if(12===e)return t.isEqualTo(n);if(28===e)return!t.isEqualTo(n)}}function l(e,t,n){if(void 0!==t&&void 0!==n){if(12===e)return t===n;if(28===e)return t!==n}}function p(e,t=["sys"]){return!(35!==e.nodeType||38!==e.leftExpression.nodeType||"version_info"!==e.memberName.value||!t.some((t=>t===e.leftExpression.value)))}t.evaluateStaticBoolExpression=s,t.evaluateStaticBoolLikeExpression=i},52328:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Symbol=t.indeterminateSymbolId=void 0;const a=n(61340);let r=1;t.indeterminateSymbolId=0;class s{constructor(e){this.id=r++,this._flags=e}static createWithType(e,t){const n=new s(e);return n._synthesizedType=t,n}isInitiallyUnbound(){return!!(1&this._flags)}setIsExternallyHidden(){this._flags|=2}isExternallyHidden(){return!!(2&this._flags)}setIsIgnoredForProtocolMatch(){this._flags|=64}isIgnoredForProtocolMatch(){return!!(64&this._flags)}setIsClassMember(){this._flags|=4}isClassMember(){return!!(4&this._flags)}setIsInstanceMember(){this._flags|=8}isInstanceMember(){return!!(8&this._flags)}setIsClassVar(){this._flags|=128}isClassVar(){return!!(128&this._flags)}setIsFinalVarInClassBody(){this._flags|=8192}isFinalVarInClassBody(){return!!(8192&this._flags)}setIsInitVar(){this._flags|=1024}isInitVar(){return!!(1024&this._flags)}setIsInDunderAll(){this._flags|=256}isInDunderAll(){return!!(256&this._flags)}setIsPrivateMember(){this._flags|=32}isPrivateMember(){return!!(32&this._flags)}setPrivatePyTypedImport(){this._flags|=512}isPrivatePyTypedImport(){return!!(512&this._flags)}isNamedTupleMemberMember(){return!!(2048&this._flags)}isIgnoredForOverrideChecks(){return!!(4096&this._flags)}addDeclaration(e){if(this._declarations){const t=this._declarations.findIndex((t=>(0,a.areDeclarationsSame)(t,e)));if(t<0)this._declarations.push(e),this._declarations.forEach((e=>{1===e.type&&e.typeAliasName&&delete e.typeAliasName}));else{const n=this._declarations[t];(0,a.hasTypeForDeclaration)(e)?(this._declarations[t]=e,1===n.type&&1===e.type&&!e.inferredTypeSource&&n.inferredTypeSource&&(e.inferredTypeSource=n.inferredTypeSource)):1===e.type&&1===n.type&&(e.isFinal&&(n.isFinal=!0),n.typeAliasName=e.typeAliasName,!n.inferredTypeSource&&e.inferredTypeSource&&(n.inferredTypeSource=e.inferredTypeSource))}}else this._declarations=[e]}hasDeclarations(){return!!this._declarations&&this._declarations.length>0}getDeclarations(){return this._declarations?this._declarations:[]}hasTypedDeclarations(){return!!this._synthesizedType||this.getDeclarations().some((e=>(0,a.hasTypeForDeclaration)(e)))}getTypedDeclarations(){return this.getDeclarations().filter((e=>(0,a.hasTypeForDeclaration)(e)))}getSynthesizedType(){return this._synthesizedType}}t.Symbol=s},80944:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPublicConstantOrTypeAlias=t.isTypeAliasName=t.isConstantName=t.isSingleDunderName=t.isDunderName=t.isPrivateOrProtectedName=t.isProtectedName=t.isPrivateName=void 0;const n=/^[A-Z0-9_]+$/,a=/^[_]+$/,r=/^_{0,2}[A-Z][A-Za-z0-9_]+$/;function s(e){return e.length>2&&e.startsWith("__")&&!e.endsWith("__")}function i(e){return e.length>1&&e.startsWith("_")&&!e.startsWith("__")}function o(e){return s(e)||i(e)}function l(e){return!!e.match(n)&&!e.match(a)}function p(e){return!!e.match(r)}t.isPrivateName=s,t.isProtectedName=i,t.isPrivateOrProtectedName=o,t.isDunderName=function(e){return e.length>4&&e.startsWith("__")&&e.endsWith("__")},t.isSingleDunderName=function(e){return e.length>2&&e.startsWith("_")&&e.endsWith("_")},t.isConstantName=l,t.isTypeAliasName=p,t.isPublicConstantOrTypeAlias=function(e){return!o(e)&&(l(e)||p(e))}},8e4:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEffectivelyClassVar=t.isVisibleExternally=t.isTypedDictMemberAccessedThroughIndex=t.getLastTypedDeclarationForSymbol=void 0,t.getLastTypedDeclarationForSymbol=function(e){const t=e.getTypedDeclarations();if(t.length>0)return t[t.length-1]},t.isTypedDictMemberAccessedThroughIndex=function(e){const t=e.getTypedDeclarations();if(t.length>0){if(1===t[t.length-1].type)return!0}return!1},t.isVisibleExternally=function(e){return!e.isExternallyHidden()&&!e.isPrivatePyTypedImport()},t.isEffectivelyClassVar=function(e,t){return!!e.isClassVar()||!!e.isFinalVarInClassBody()&&!t}},92220:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NameTypeWalker=t.TestWalker=void 0;const a=n(78232),r=n(83181),s=n(55164),i=n(28340);class o extends a.ParseTreeWalker{constructor(){super()}visitNode(e){const t=super.visitNode(e);return this._verifyParentChildLinks(e,t),this._verifyChildRanges(e,t),t}_verifyParentChildLinks(e,t){t.forEach((t=>{t&&t.parent!==e&&(0,r.fail)(`Child node ${t.nodeType} does not contain a reference to its parent ${e.nodeType}`)}))}_verifyChildRanges(e,t){let n;const a=(0,i.isCompliantWithNodeRangeRules)(e);t.forEach((t=>{if(t){let i=!1;if(!a)switch(e.nodeType){case 3:t===e.typeAnnotationComment&&(i=!0),3===t.nodeType&&(i=!0);break;case 48:t===e.typeAnnotation&&(i=!0);break;default:(0,r.fail)(`node ${e.nodeType} is not marked as not following range rules.`)}i||((t.start<e.start||s.TextRange.getEnd(t)>s.TextRange.getEnd(e))&&(0,r.fail)(`Child node ${t.nodeType} is not contained within its parent ${e.nodeType}`),n&&t.start<s.TextRange.getEnd(n)&&62!==n.nodeType&&(0,r.fail)("Child node is not after previous child node"),n=t)}}))}}t.TestWalker=o;class l extends a.ParseTreeWalker{constructor(e){super(),this._evaluator=e}visitName(e){var t,n;return 23!==(null===(t=e.parent)||void 0===t?void 0:t.nodeType)&&21!==(null===(n=e.parent)||void 0===n?void 0:n.nodeType)&&this._evaluator.isNodeReachable(e,void 0)&&this._evaluator.getType(e),!0}}t.NameTypeWalker=l},74068:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createTracePrinter=void 0;const i=n(86016),o=n(83181),l=n(11699),p=n(96193),c=n(55084),d=n(79428),u=s(n(9316)),m=s(n(28340)),y=n(52328),g=n(8312);t.createTracePrinter=function(e){function t(e,t="'"){return e?`${t}${e}${t}`:""}e=e.sort(((e,t)=>e.key.localeCompare(t.key))).reverse();const n=/[\\/]/g;function a(t){if(t){if(c.Uri.is(t)){for(const a of e)if(t.isChild(a)){const e=a.getRelativePath(t);return(0,l.stripFileExtension)(e).replace(n,".")}return t.toUserVisibleString()}if(t.nameParts)return t.nameParts.join(".")}return""}function r(e){var n,a,s,i,l;if(e)switch(e.category){case 2:return`Any ${t(null===(n=e.typeAliasInfo)||void 0===n?void 0:n.fullName)}`;case 6:return g.TypeBase.isInstantiable(e)?`Class '${e.details.name}' (${e.details.moduleName})`:`Object '${e.details.name}' (${e.details.moduleName})`;case 4:return`Function '${e.details.name}' (${e.details.moduleName})`;case 7:return`Module '${e.moduleName}' (${e.moduleName})`;case 3:return`Never ${t(null===(a=e.typeAliasInfo)||void 0===a?void 0:a.fullName)}`;case 5:return`OverloadedFunction [${e.overloads.map((e=>t(r(e),'"'))).join(",")}]`;case 9:return`TypeVar '${e.details.name}' ${t(null===(s=e.typeAliasInfo)||void 0===s?void 0:s.fullName)}`;case 0:return`Unbound ${t(null===(i=e.typeAliasInfo)||void 0===i?void 0:i.fullName)}`;case 8:return`Union [${e.subtypes.map((e=>t(r(e),'"'))).join(",")}]`;case 1:return`Unknown ${t(null===(l=e.typeAliasInfo)||void 0===l?void 0:l.fullName)}`;default:(0,o.assertNever)(e)}return""}function s(e){if(e)switch(e.type){case 8:return`Alias, ${f(e.node)} (${a(e.uri)})`;case 6:return`Class, ${f(e.node)} (${a(e.uri)})`;case 5:return`Function, ${f(e.node)} (${a(e.uri)})`;case 0:return`Intrinsic, ${f(e.node)} ${e.intrinsicType} (${a(e.uri)})`;case 2:return`Parameter, ${f(e.node)} (${a(e.uri)})`;case 3:return`TypeParameter, ${f(e.node)} (${a(e.uri)})`;case 7:return`SpecialBuiltInClass, ${f(e.node)} (${a(e.uri)})`;case 1:return`Variable, ${f(e.node)} (${a(e.uri)})`;case 4:return`TypeAlias, ${f(e.node)} (${a(e.uri)})`;default:(0,o.assertNever)(e)}return""}function h(e){for(;36!==e.nodeType&&e.parent;)e=e.parent;return 36===e.nodeType?u.getFileInfo(e):void 0}function f(e,n=!1){var r;if(!e)return"";let s=n?`(${a(null===(r=h(e))||void 0===r?void 0:r.fileUri)})`:"";const i=h(e);if(null==i?void 0:i.lines){const t=(0,p.convertOffsetToPosition)(e.start,i.lines);s+=` [${t.line+1}:${t.character+1}]`}if((0,d.isExpressionNode)(e))return t(function(e,t=30){return e.length<t?e:e.substring(0,t)+" <shortened> "}(m.printExpression(e)),'"')+` ${s}`;switch(e.nodeType){case 21:return`importAs '${f(e.module)}' ${t(e.alias?f(e.alias):"")} ${s}`;case 22:return`importFrom [${e.imports.map((e=>t(f(e),'"'))).join(",")}]`;case 23:return`ImportFromAs '${f(e.name)}' ${t(e.alias?f(e.alias):"")} ${s}`;case 36:return`module ${s}`;case 10:return`class '${f(e.name)}' ${s}`;case 28:return`function '${f(e.name)}' ${s}`;case 37:return`moduleName '${e.nameParts.map((e=>f(e))).join(".")}' ${s}`;case 1:return`argument '${e.name?f(e.name):"N/A"}' ${s}`;case 41:return`parameter '${e.name?f(e.name):"N/A"}' ${s}`;default:return`${m.printParseNodeType(e.nodeType)} ${s}`}}return{print:function(e){return e?function(e){const t=e;return t&&(0,i.isNumber)(t.nodeType)}(e)?f(e,!0):function(e){const t=e;return t&&(0,i.isNumber)(t.type)&&c.Uri.is(t.uri)&&(0,i.isString)(t.moduleName)}(e)?s(e):e instanceof y.Symbol?(t=e)?t.hasDeclarations()?`symbol ${s(t.getDeclarations()[0])}`:"<symbol>":"":function(e){const t=e;return t&&(0,i.isNumber)(t.category)&&(0,i.isNumber)(t.flags)}(e)?r(e):"":"";var t},printFileOrModuleName:a}}},42676:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.SpeculativeTypeTracker=void 0;const i=n(83181),o=s(n(28340)),l=n(8312);t.SpeculativeTypeTracker=class{constructor(){this._speculativeContextStack=[],this._speculativeTypeCache=new Map,this._activeDependentTypes=[]}enterSpeculativeContext(e,t){this._speculativeContextStack.push({speculativeRootNode:e,entriesToUndo:[],dependentType:null==t?void 0:t.dependentType,allowDiagnostics:null==t?void 0:t.allowDiagnostics}),(null==t?void 0:t.dependentType)&&this._activeDependentTypes.push({speculativeRootNode:e,dependentType:t.dependentType})}leaveSpeculativeContext(){(0,i.assert)(this._speculativeContextStack.length>0);const e=this._speculativeContextStack.pop();(null==e?void 0:e.dependentType)&&((0,i.assert)(this._activeDependentTypes.length>0),this._activeDependentTypes.pop()),e.entriesToUndo.forEach((e=>{e.cache.delete(e.id)}))}isSpeculative(e,t=!1){if(0===this._speculativeContextStack.length)return!1;if(!e)return!0;for(let n=this._speculativeContextStack.length-1;n>=0;n--){const a=this._speculativeContextStack[n];if(o.isNodeContainedWithin(e,a.speculativeRootNode)&&(!t||!a.allowDiagnostics))return!0}return!1}trackEntry(e,t){const n=this._speculativeContextStack.length;n>0&&this._speculativeContextStack[n-1].entriesToUndo.push({cache:e,id:t})}disableSpeculativeMode(){const e=this._speculativeContextStack;return this._speculativeContextStack=[],e}enableSpeculativeMode(e){(0,i.assert)(0===this._speculativeContextStack.length),this._speculativeContextStack=e}addSpeculativeType(e,t,n,a){(0,i.assert)(this._speculativeContextStack.length>0);let r=this._speculativeTypeCache.get(e.id);r?(r=r.filter((e=>(!e.typeResult.isIncomplete||e.incompleteGenerationCount===n)&&(a?!e.expectedType||!(0,l.isTypeSame)(e.expectedType,a):!!e.expectedType))),r.length>=8&&r.slice(1)):r=[];const s={typeResult:t,expectedType:a,incompleteGenerationCount:n};this._activeDependentTypes.length>0&&(s.dependentTypes=Array.from(this._activeDependentTypes)),r.push(s),this._speculativeTypeCache.set(e.id,r)}getSpeculativeType(e,t){if(this._speculativeContextStack.some((t=>o.isNodeContainedWithin(e,t.speculativeRootNode)))){const n=this._speculativeTypeCache.get(e.id);if(n)for(const e of n)if(t){if(e.expectedType&&(0,l.isTypeSame)(t,e.expectedType)&&this._dependentTypesMatch(e))return e}else if(!e.expectedType&&this._dependentTypesMatch(e))return e}}_dependentTypesMatch(e){var t;const n=null!==(t=e.dependentTypes)&&void 0!==t?t:[];return n.length===this._activeDependentTypes.length&&n.every(((e,t)=>{const n=this._activeDependentTypes[t];return e.speculativeRootNode===n.speculativeRootNode&&(0,l.isTypeSame)(e.dependentType,n.dependentType)}))}}},58260:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getVariableDocString=t.getFunctionOrClassDeclDocString=t.getClassDocString=t.getModuleDocString=t.getModuleDocStringFromUris=t.getModuleDocStringFromModuleNodes=t.getVariableInStubFileDocStrings=t.getPropertyDocStringInherited=t.getOverloadedFunctionDocStringsInherited=t.getFunctionDocStringInherited=void 0;const i=n(65392),o=s(n(28340)),l=n(76392),p=n(8312),c=n(28040),d=n(808);function u(e,t){if(5===e.category){if(0===e.overloads.length)return!1;e=e.overloads[0]}return!!e.details.methodClass&&p.ClassType.isBuiltIn(e.details.methodClass)&&!!e.boundToType&&!p.ClassType.isBuiltIn(e.boundToType)}function m(e,t){const n=[];if(!(0,l.isStubFile)(e.uri))return n;for(const a of t.findDeclarations(e))if((0,i.isVariableDeclaration)(a)&&a.docString)n.push(a.docString);else if((0,i.isClassDeclaration)(a)||(0,i.isFunctionDeclaration)(a)){const e=h(a);e&&n.push(e)}return n}function y(e){for(const t of e)if(t.statements){const e=o.getDocString(t.statements);if(e)return e}}function g(e,t){const n=[];for(const a of e)(0,l.isStubFile)(a)&&(0,c.addIfNotNull)(n,t.getModuleNode(a)),(0,c.appendArray)(n,t.findModules(a));return y(n)}function h(e){var t,n,a;return o.getDocString(null!==(a=null===(n=null===(t=e.node)||void 0===t?void 0:t.suite)||void 0===n?void 0:n.statements)&&void 0!==a?a:[])}function f(e,t,n){if(!(0,p.isOverloadedFunction)(e))return;const a=[];if(e.overloads.some((e=>e.details.docString)))e.overloads.forEach((e=>{e.details.docString&&a.push(e.details.docString)}));else if(t&&(0,l.isStubFile)(t.uri)&&(0,i.isFunctionDeclaration)(t)){const e=v(n.findFunctionDeclarations(t));e&&a.push(e)}return a}function T(e,t){let n=v([e]);if(!n&&(0,l.isStubFile)(e.uri)){n=v(t.findFunctionDeclarations(e))}return n}function v(e){for(const t of e){const e=h(t);if(e)return e}}t.getFunctionDocStringInherited=function(e,t,n,a){let r;if(!u(e)&&t&&(0,i.isFunctionDeclaration)(t)&&(r=function(e,t,n){if(!(0,p.isFunction)(e))return;let a=e.details.docString;!a&&t&&(a=T(t,n));!a&&e.details.declaration&&(a=T(e.details.declaration,n));return a}(e,t,n)),!r&&a){const t=e.details.name,s=(0,d.getClassMemberIterator)(a,t,85);for(const e of s){if(e.symbol.getDeclarations().length>0){const t=e.symbol.getDeclarations().slice(-1)[0];if((0,i.isFunctionDeclaration)(t)&&(r=T(t,n),r))break}}}return r||e.details.docString},t.getOverloadedFunctionDocStringsInherited=function(e,t,n,a,r){var s;let i;if(!u(e))for(const a of t)if(i=f(e,a,n),i&&i.length>0)return i;if(r&&e.overloads.length>0){const t=e.overloads[0].details.name,o=(0,d.getClassMemberIterator)(r,t,85);for(const e of o){const t=e.symbol.getDeclarations().slice(-1)[0],r=null===(s=a.getTypeForDeclaration(t))||void 0===s?void 0:s.type;if(r&&(i=f(r,t,n),i&&i.length>0))break}}return null!=i?i:[]},t.getPropertyDocStringInherited=function(e,t,n){const a=o.getEnclosingClass(e.node.name,!1),r=a?n.getTypeOfClass(a):void 0;if(r)return function(e,t,n,a){var r,s;if(!e||!(0,i.isFunctionDeclaration)(e))return;const o=null===(r=n.getTypeForDeclaration(e))||void 0===r?void 0:r.type;if(!o||!(0,d.isMaybeDescriptorInstance)(o))return;const l=28===e.node.nodeType?e.node.name.value:void 0;if(!l)return;const c=(0,d.getClassIterator)(a,0);for(const[e]of c){if(!(0,p.isInstantiableClass)(e))continue;const a=p.ClassType.getSymbolTable(e).get(l),r=null==a?void 0:a.getDeclarations();if(r)for(const e of r)if((0,i.isFunctionDeclaration)(e)){const a=null===(s=n.getTypeForDeclaration(e))||void 0===s?void 0:s.type;if(a&&(0,d.isMaybeDescriptorInstance)(a)){const n=T(e,t);if(n)return n}}}return}(e,t,n,r.classType)},t.getVariableInStubFileDocStrings=m,t.getModuleDocStringFromModuleNodes=y,t.getModuleDocStringFromUris=g,t.getModuleDocString=function(e,t,n){var a;let r=e.docString;if(!r){r=g([null!==(a=null==t?void 0:t.uri)&&void 0!==a?a:e.fileUri],n)}return r},t.getClassDocString=function(e,t,n){let a=e.details.docString;if(!a&&t&&(r=t,(0,i.isClassDeclaration)(r)||(0,i.isSpecialBuiltInClassDeclaration)(r))&&(a=(0,i.isClassDeclaration)(t)?v([t]):void 0,!a&&t&&(0,l.isStubFile)(t.uri)))for(const e of n.findDeclarations(t)){if((0,i.isVariableDeclaration)(e)&&e.docString){a=e.docString;break}if((0,i.isClassDeclaration)(e)||(0,i.isFunctionDeclaration)(e)){a=h(e);break}}var r;if(!a&&t){const r=n.findClassDeclarationsByType(t.uri,e);if(r){a=v(r.filter((e=>(0,i.isClassDeclaration)(e))).map((e=>e)))}}return a},t.getFunctionOrClassDeclDocString=h,t.getVariableDocString=function(e,t){if(e)return void 0!==e.docString?e.docString:m(e,t).find((e=>e))}},508:function(e,t,n){var a=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,a,r)}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&a(t,e,n);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createTypeEvaluator=t.maxCodeComplexity=void 0;const i=n(64704),o=n(28040),l=n(83181),p=n(72484),c=n(97652),d=n(96193),u=n(61328),m=n(55164),y=n(55084),g=n(95960),h=n(79428),f=n(87368),T=n(35964),v=s(n(9316)),b=n(94416),_=n(31508),C=n(99868),I=n(90272),k=n(33215),w=n(61340),S=n(91720),A=n(62744),x=n(60092),P=n(37356),N=n(86084),D=n(92488),F=s(n(28340)),E=n(3573),M=n(50520),O=n(85636),z=s(n(69160)),V=n(21084),U=n(52328),R=n(80944),L=n(8e4),j=n(42676),B=n(90549),q=s(n(3388)),W=n(808),G=n(97632),K=n(45468),$=n(8312),H=new Map([["asyncio.futures.Future",u.pythonVersion3_9],["asyncio.tasks.Task",u.pythonVersion3_9],["builtins.dict",u.pythonVersion3_9],["builtins.frozenset",u.pythonVersion3_9],["builtins.list",u.pythonVersion3_9],["builtins._PathLike",u.pythonVersion3_9],["builtins.set",u.pythonVersion3_9],["builtins.tuple",u.pythonVersion3_9],["collections.ChainMap",u.pythonVersion3_9],["collections.Counter",u.pythonVersion3_9],["collections.defaultdict",u.pythonVersion3_9],["collections.DefaultDict",u.pythonVersion3_9],["collections.deque",u.pythonVersion3_9],["collections.OrderedDict",u.pythonVersion3_9],["queue.Queue",u.pythonVersion3_9]]),Z=new Map([["builtins.float",["builtins.int"]],["builtins.complex",["builtins.float","builtins.int"]],["builtins.bytes",["builtins.bytearray","builtins.memoryview"]]]),Y=64;t.maxCodeComplexity=768,t.createTypeEvaluator=function(e,n,a){const r=[],s=new Set,J=new j.SpeculativeTypeTracker,Q=[],X=[];let ee,te,ne,ae,re,se,ie,oe,le,pe,ce,de,ue,me,ye,ge,he,fe=new Set,Te=new Map,ve=new Map,be=new Map,_e=new Map,Ce=[],Ie=!1,ke=0;const we=[];let Se;function Ae(){ee&&(0,i.throwIfCancellationRequested)(ee)}function xe(e){return Se&&Ee(e)?Se.get(e.id):ve.get(e.id)}function Pe(e){const t=xe(e);return!!t&&(!t.typeResult.isIncomplete||t.incompleteGenerationCount===ke)}function Ne(e,t){var a,r;const s=xe(e);if(s&&!s.typeResult.isIncomplete){if(n.verifyTypeCacheEvaluatorFlags&&void 0!==t){const i=s.flags;if(void 0!==i&&t!==i){const s=v.getFileInfo(e),o=(0,d.convertOffsetToPosition)(e.start,s.lines),p=`Type cache flag mismatch for node type ${e.nodeType} (parent ${null!==(r=null===(a=e.parent)||void 0===a?void 0:a.nodeType)&&void 0!==r?r:"none"}): cached flags = ${i}, access flags = ${t}, file = {${s.fileUri} [${o.line+1}:${o.character+1}]}`;n.verifyTypeCacheEvaluatorFlags?(0,l.fail)(p):console.log(p)}}return s.typeResult.type}}function De(e,t,n,a,r=!1){const s=Se&&Ee(e)?Se:ve;if(t.isIncomplete){const n=s.get(e.id);void 0===n||(0,$.isTypeSame)(t.type,n.typeResult.type)||ke++}else ke++;s.set(e.id,{typeResult:t,flags:n,incompleteGenerationCount:ke}),Va(e)&&(J.trackEntry(s,e.id),r&&J.addSpeculativeType(e,t,ke,null==a?void 0:a.expectedType))}function Fe(e,t,n=0){De(e,t,n)}function Ee(e){const t=we.length;if(0===t)return!1;const n=we[t-1];let a=e;for(;a;){if(a===n.functionNode)return!0;a=a.parent}return!1}function Me(e,t){return r.findIndex((n=>n.symbolId===e.id&&n.declaration===t))}function Oe(e,t){const n=Me(e,t);if(n>=0){for(let e=n+1;e<r.length;e++)r[e].isResultValid=!1;return!1}return r.push({symbolId:e.id,declaration:t,isResultValid:!0}),!0}function ze(e){const t=r.pop();return(0,l.assert)(t.symbolId===e.id),t.isResultValid}function Ve(e,t,n){const a=Me(e,t);a>=0&&(r[a].partialType=n)}function Ue(e,t){const n=Me(e,t);if(n>=0)return r[n].partialType}function Re(e){var t,n;je(e);let a=null===(t=wa(e,(()=>{Ca(e)})))||void 0===t?void 0:t.type;if(a&&(0,$.isTypeVar)(a)&&0===a.details.declaredVariance){const t=a,r=F.getParentNodeOfType(e,76);if(10===(null===(n=null==r?void 0:r.parent)||void 0===n?void 0:n.nodeType)){const e=Yn(r.parent);if(e){Qn(e.classType);const n=e.classType.details.typeParameters.find((e=>(0,$.isTypeSame)(e,t,{ignoreTypeFlags:!0})));n&&(a=$.TypeBase.isInstance(a)?$.TypeVarType.cloneAsInstance(n):n)}}}return a&&(a=(0,W.transformPossibleRecursiveTypeAlias)(a)),a}function Le(e){let t=e,n=e;for(;n;)(0,h.isExpressionNode)(n)&&(t=n),n=n.parent;for(Ca(t),n=e;n;){const e=_e.get(n.id);if(e)return{type:e,node:n};if(n===t)break;n=n.parent}}function je(e){var t;if(!Ie){Ie=!0,ae=Ea(e,"object"),re=Fa(e,"type"),oe=Ea(e,"function"),se=function(e,t){return ot(e,t,["types"])}(e,"UnionType"),se&&(0,$.isClass)(se)&&(se.details.flags|=-2147483648),st(e,"Collection"),te=null!==(t=it(e,"NoneType"))&&void 0!==t?t:$.UnknownType.create(),ne=(0,$.isInstantiableClass)(te)?$.ClassType.cloneAsInstance(te):$.UnknownType.create(),le=Fa(e,"tuple"),pe=Fa(e,"bool"),ce=Fa(e,"int"),de=Fa(e,"str"),ue=Fa(e,"dict"),me=st(e,"TypedDict"),ye=st(e,"_TypedDict"),ie=st(e,"Awaitable"),he=st(e,"Mapping"),ge=it(e,"SupportsKeysAndGetItem"),ge||(ge=he);const n=Fa(e,"object");if(n&&(0,$.isInstantiableClass)(n)&&re&&(0,$.isInstantiableClass)(re)){const e=$.ClassType.createInstantiable("Any","typing.Any","typing",y.Uri.empty(),-2147483647,-1,void 0,re);e.details.baseClasses.push(n),(0,W.computeMroLinearization)(e);const t=$.AnyType.createSpecialForm();(0,$.isAny)(t)&&(t.specialForm=e)}}}function Be(e,t=0,n,a){const r=xe(e);if(r&&(!r.typeResult.isIncomplete||r.incompleteGenerationCount===ke))return r.typeResult;{const t=J.getSpeculativeType(e,null==n?void 0:n.expectedType);if(t&&(!t.typeResult.isIncomplete||t.incompleteGenerationCount===ke))return t.typeResult}let s;Ae(),n&&(n.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(n.expectedType)),je(e);let i=0!=(128&t),o=!0;switch(e.nodeType){case 38:s=function(e,t){const n=v.getFileInfo(e),a=e.value;let r,s,i=!1;const o=0!=(4&t)||n.isStubFile;let p=Ma(e,a,!o,o&&0!=(256&t));if(!p){const n=Ra(e);n&&(p=Ma(n,n.value,!o,o&&0!=(256&t)))}if(p){let d=!o;if(5===p.scope.type&&(d=!1),r=p.symbol,St(n,r,e),!n.diagnosticRuleSet.analyzeUnannotatedFunctions){const t=F.getEnclosingFunction(e);if(t&&F.isUnannotatedFunction(t))return{type:$.AnyType.create(),isIncomplete:!1}}const u=Ka(r,d?e:void 0);let m=(0,W.transformPossibleRecursiveTypeAlias)(u.type);u.isIncomplete&&((0,$.isUnbound)(m)&&(m=$.UnknownType.create(!0)),i=!0),u.isRecursiveDefinition&&pt(e)&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.recursiveDefinition().format({name:a}),e);const y=!!m&&(0,$.isInstantiableClass)(m)&&$.ClassType.isSpecialBuiltIn(m);if(s=m,d&&!y){let n=m,o=!1;if(!p.isBeyondExecutionScope&&r.isInitiallyUnbound()&&(n=$.UnboundType.create(),4===p.scope.type)){(0,l.assert)(p.scope.parent);const e=p.scope.parent.lookUpSymbol(a);if(e){n=Ka(e).type}}if(p.isBeyondExecutionScope){const t=function(e,t,n){if(t.usesGlobalBinding||t.usesNonlocalBinding)return;const a=t.symbol.getDeclarations();if(!a.every((e=>1===e.type||2===e.type||8===e.type)))return;if(!a.every((e=>2===e.type||z.getScopeForNode(e.node)===t.scope)))return;if(!a.every((e=>{var t;return 1!==e.type||e.isFinal||4!==(null===(t=z.getScopeForNode(e.node))||void 0===t?void 0:t.type)})))return;const r=z.getScopeHierarchy(e,t.scope);if(r&&r.length>=2){const a=z.findTopNodeInScope(e,r[r.length-2]);if(28===(null==a?void 0:a.nodeType)||30===(null==a?void 0:a.nodeType)||10===(null==a?void 0:a.nodeType)){const r=v.getFlowNode(a);if(r&&t.symbol.getDeclarations().every((e=>{if(2===e.type)return!0;const t=v.getFlowNode(e.node);return!!t&&!xr.isFlowNodeReachable(t,r,!0)}))){let r=n;return t.symbol.isInitiallyUnbound()&&(r=$.UnboundType.create()),Aa(e,a,{targetSymbolId:t.symbol.id,typeAtStart:{type:r}})}}}return}(e,p,m);(null==t?void 0:t.type)&&(s=t.type,n=s,o=!!t.isIncomplete)}const c=Aa(e,void 0,{targetSymbolId:r.id,typeAtStart:{type:n,isIncomplete:o},skipConditionalNarrowing:0!=(256&t)});c.type&&(s=c.type),c.isIncomplete&&(i=!0)}if(s=xt(e,s,t),0!=(256&t)&&u.includesVariableDecl&&!s.typeAliasInfo){let a=(0,$.isTypeVar)(s)||(0,W.isTypeAliasPlaceholder)(s);(0,$.isClass)(s)&&!s.includeSubclasses&&!r.hasTypedDeclarations()&&$.ClassType.isValidTypeAliasClass(s)&&(a=!0),a||n.isTypingStubFile||!u.includesIllegalTypeAliasDecl&&$.TypeBase.isInstantiable(s)&&0==(2&t)||(ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.typeAnnotationVariable(),e),s=$.UnknownType.create())}}else"reveal_type"===a||"reveal_locals"===a?s=$.AnyType.create():(ht(c.DiagnosticRule.reportUndefinedVariable,g.LocMessage.symbolIsUndefined().format({name:a}),e),s=$.UnknownType.create());(0,$.isParamSpec)(s)&&32&t&&(mt(g.LocMessage.paramSpecContext(),e),s=$.UnknownType.create());s=function(e,t,n){var a;if(!t.specialForm||t.typeAliasInfo)return t;if(!(0,$.isTypeVar)(t)||t.isVariadicInUnion||0!=(128&n))return t;if(0!=(33554432&n)&&t.details.isParamSpec)return $.TypeBase.cloneAsSpecialForm(t,void 0);const r=7===(null===(a=e.parent)||void 0===a?void 0:a.nodeType)&&6===e.parent.operator;if(r)return $.TypeBase.cloneAsSpecialForm(t,void 0);return $.ClassType.cloneAsInstance(t.specialForm)}(e,s,t),0==(256&t)&&qe(s,e);0!=(128&t)&&0==(1024&t)&&(0,$.isInstantiableClass)(s)&&$.ClassType.isBuiltIn(s,"Generic")&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.genericNotAllowed(),e);(0,$.isTypeVar)(s)&&!s.details.isSynthesized&&(s=At(e,s,t));return{type:s,isIncomplete:i}}(e,t);break;case 35:s=function(e,t){var n;let a=2;if(a|=567556&t,0!=(128&t)){const t=e.memberName.value;"args"!==t&&"kwargs"!==t||(a|=33554432)}const r=Be(e.leftExpression,a);if((0,W.isTypeAliasPlaceholder)(r.type))return{type:$.UnknownType.create(!0),isIncomplete:!0};const s=Pt(e,r,{method:"get"},2|t);if((0,_.isCodeFlowSupportedForReference)(e)){De(e,{...s,isIncomplete:!0},t),De(e.memberName,{...s,isIncomplete:!0},t);let n=s.type,a=!!s.isIncomplete;if((0,$.isUnbound)(n)){const t=Ct(r.type);let s;(0,$.isInstantiableClass)(t)?s=(0,W.lookUpClassMember)(t,e.memberName.value,1):(0,$.isClassInstance)(t)&&(s=(0,W.lookUpObjectMember)(t,e.memberName.value,1)),s&&(n=Ja(s),a=!1)}const i=Aa(e,void 0,{targetSymbolId:U.indeterminateSymbolId,typeAtStart:{type:n,isIncomplete:a},skipConditionalNarrowing:0!=(256&t)});i.type&&(s.type=i.type),i.isIncomplete&&(s.isIncomplete=!0),s.type=xt(e,s.type,t)}r.isIncomplete&&(s.isIncomplete=!0);let i=s.isIncomplete;if((0,$.isInstantiableClass)(s.type)&&!s.type.includeSubclasses||s.type.specialForm){const t=F.getParentNodeOfType(e,1);t&&9===(null===(n=null==t?void 0:t.parent)||void 0===n?void 0:n.nodeType)&&(i=!0)}i||kn(v.getFileInfo(e).diagnosticRuleSet.reportUnknownMemberType,c.DiagnosticRule.reportUnknownMemberType,e.memberName,s.type,e,!1);return De(e.memberName,s,t),s}(e,t);break;case 24:s=function(e,t=0){const n=Be(e.baseExpression,2|t);128&t&&48===e.baseExpression.nodeType&&mt(g.LocMessage.stringNotSubscriptable(),e.baseExpression);if(0==(4&t)){let a=0!=(32768&t);if(a){const t=F.getExecutionScopeNode(e);36===(null==t?void 0:t.nodeType)&&(a=!1)}if(!a){const t=v.getFileInfo(e);if((0,$.isInstantiableClass)(n.type)&&$.ClassType.isBuiltIn(n.type)&&!n.type.aliasName){const a=H.get(n.type.details.fullName);void 0!==a&&t.executionEnvironment.pythonVersion.isLessThan(a)&&!t.isStubFile&&mt(g.LocMessage.classNotRuntimeSubscriptable().format({name:n.type.aliasName||n.type.details.name}),e.baseExpression)}}}const a=Mt(e,n,{method:"get"},t);if((0,_.isCodeFlowSupportedForReference)(e)){let r=!(0,$.isAny)(n.type);if(It(n.type,void 0,(e=>{(0,$.isClassInstance)(e)&&($.ClassType.isBuiltIn(e)||$.ClassType.isTypedDictClass(e))||(r=!1)})),r){De(e,{...a,isIncomplete:!0},t);const r=Aa(e,void 0,{targetSymbolId:U.indeterminateSymbolId,typeAtStart:{type:a.type,isIncomplete:!!n.isIncomplete||!!a.isIncomplete},skipConditionalNarrowing:0!=(256&t)});r.type&&(a.type=r.type),r.isIncomplete&&(a.isIncomplete=!0)}}n.isIncomplete&&(a.isIncomplete=!0);return a}(e,t);break;case 9:s=function(e,t,n,a){var r;let s;if(0!=(256&t)&&38===e.leftExpression.nodeType&&"type"===e.leftExpression.value){const t=new p.DiagnosticAddendum;t.addMessage(g.LocAddendum.useTypeInstead()),ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.typeCallNotAllowed()+t.getString(),e)}s=30===e.leftExpression.nodeType?function(e,t){(0,l.assert)(30===e.leftExpression.nodeType);const n=$.FunctionType.createSynthesizedInstance("");n.details.declaredReturnType=t?t.expectedType:$.UnknownType.create();let a=!1;e.arguments.forEach(((e,t)=>{const r=Be(e.valueExpression);r.isIncomplete&&(a=!0),$.FunctionType.addParameter(n,{category:0,name:`p${t.toString()}`,type:r.type,hasDeclaredType:!0})}));const r=e.leftExpression.parameters;if(r.length>0){const e=r[r.length-1];0!==e.category||e.name||$.FunctionType.addPositionOnlyParameterSeparator(n)}function s(){return Be(e.leftExpression,2,(0,W.makeInferenceContext)(n))}let i=a||Va(e)||(null==t?void 0:t.isTypeIncomplete)?za(e.leftExpression,s):s();i.typeErrors&&(i=Be(e.leftExpression,2));return i}(e,n):Be(e.leftExpression,2|4&t);const i=F.getArgumentsByRuntimeOrder(e).map((e=>({valueExpression:e.valueExpression,argumentCategory:e.argumentCategory,node:e,name:e.name})));let o={type:$.UnknownType.create()};a&&(s.type=(0,W.ensureFunctionSignaturesAreUnique)(s.type,a,e.leftExpression.start));if((0,W.isTypeAliasPlaceholder)(s.type))o.isIncomplete=!0;else{if(38===e.leftExpression.nodeType&&"super"===e.leftExpression.value)o=function(e){var t;e.arguments.length>2&&mt(g.LocMessage.superCallArgCount(),e.arguments[2]);const n=F.getEnclosingFunctionEvaluationScope(e),a=n?F.getEnclosingClass(n):void 0,r=a?null===(t=Yn(a))||void 0===t?void 0:t.classType:void 0;let s,i;if(e.arguments.length>0){s=Be(e.arguments[0].valueExpression).type;const t=Ct(s);(0,$.isAnyOrUnknown)(t)||(0,$.isInstantiableClass)(t)||(0,W.isMetaclassInstance)(t)||ht(c.DiagnosticRule.reportArgumentType,g.LocMessage.superCallFirstArg().format({type:wr(s)}),e.arguments[0].valueExpression)}else if(r){if(s=null!=r?r:$.UnknownType.create(),n){const t=(0,S.getFunctionInfoFromDecorators)(Ar,n,!0);0!=(4&(null==t?void 0:t.flags))&&(mt(g.LocMessage.superCallZeroArgFormStaticMethod(),e.leftExpression),s=$.UnknownType.create())}}else mt(g.LocMessage.superCallZeroArgForm(),e.leftExpression),s=$.UnknownType.create();if(e.arguments.length>1){const t=Ct(Be(e.arguments[1].valueExpression).type);let n=!1;if((0,$.isAnyOrUnknown)(t)||((0,$.isClassInstance)(t)?((0,$.isInstantiableClass)(s)&&((0,W.derivesFromClassRecursive)($.ClassType.cloneAsInstantiable(t),s,!0)||(n=!0)),i=t):(0,$.isInstantiableClass)(t)?((0,$.isInstantiableClass)(s)&&($.ClassType.isBuiltIn(s,"type")||(0,W.derivesFromClassRecursive)(t,s,!0)||(n=!0)),i=t):n=!0),n)return ht(c.DiagnosticRule.reportArgumentType,g.LocMessage.superCallSecondArg().format({type:wr(s)}),e.arguments[1].valueExpression),{type:$.UnknownType.create()}}else if(r){i=$.ClassType.cloneAsInstance(r);const t=F.getEnclosingFunction(e);let n;if(t){const e=aa(t);if(e){const t=e.functionType;($.FunctionType.isClassMethod(t)||$.FunctionType.isConstructorMethod(t)||$.FunctionType.isInstanceMethod(t))&&t.details.parameters.length>0&&t.details.parameters[0].hasDeclaredType&&(n=Ct(t.details.parameters[0].type))}}if(i&&n){const e=(0,W.getTypeCondition)(n);e?i=(0,W.addConditionToType)(i,e):(0,$.isClass)(n)&&(i=n)}}let o=!0;if(e.arguments.length<=1){const t=F.getEnclosingFunction(e);if(t){const e=aa(t);e&&($.FunctionType.isStaticMethod(e.functionType)||$.FunctionType.isConstructorMethod(e.functionType)||$.FunctionType.isClassMethod(e.functionType))&&(o=!1)}}const l=e.parent;if(35===(null==l?void 0:l.nodeType)){const e=l.memberName.value;let t=(0,$.isClass)(s)?s:void 0,n=!1;i&&$.ClassType.isProtocolClass(i)&&t&&!$.ClassType.isSameGenericClass(i,t)&&(n=!0,t=void 0);const a=i?(0,W.lookUpClassMember)(i,e,0,t):void 0;let r;return a&&(0,$.isInstantiableClass)(a.classType)?(r=a.classType,n&&(r=$.ClassType.cloneIncludeSubclasses(r))):r=t&&!(0,$.isAnyOrUnknown)(t)&&!(0,W.derivesFromAnyOrUnknown)(t)&&ae&&(0,$.isClassInstance)(ae)?$.ClassType.cloneAsInstantiable(ae):$.UnknownType.create(),{type:o?(0,W.convertToInstance)(r,!1):r,bindToSelfType:i?$.TypeBase.cloneForCondition((0,W.synthesizeTypeVarForSelfCls)($.ClassType.cloneIncludeSubclasses(i,!1),!1),i.condition):void 0}}if((0,$.isInstantiableClass)(s))if(i){let e;if($.ClassType.isSameGenericClass(i,s))i.details.baseClasses.length>0&&(e=i.details.baseClasses[0]);else{const t=i.details.baseClasses.findIndex((e=>(0,$.isClass)(e)&&$.ClassType.isSameGenericClass(e,s)));t>=0&&t<i.details.baseClasses.length-1&&(e=i.details.baseClasses[t+1])}if(e)return(0,$.isInstantiableClass)(e)&&(e=(0,W.specializeForBaseClass)(i,e)),{type:o?(0,W.convertToInstance)(e):e};if(ae&&(0,$.isClassInstance)(ae)&&re&&(0,$.isInstantiableClass)(re))return{type:o?ae:(0,W.convertToInstance)(re)}}else{if(s.details.mro.some((e=>(0,$.isAnyOrUnknown)(e))))return{type:$.UnknownType.create()};const e=s.details.baseClasses;if(e.length>0){const t=e[0];if((0,$.isInstantiableClass)(t))return{type:o?$.ClassType.cloneAsInstance(t):t}}}return{type:$.UnknownType.create()}}(e);else if((0,$.isAnyOrUnknown)(s.type)&&38===e.leftExpression.nodeType&&"reveal_type"===e.leftExpression.value)o=qt(e,n,a);else if((0,$.isFunction)(s.type)&&"reveal_type"===s.type.details.builtInName)o=qt(e,n,a);else if((0,$.isFunction)(s.type)&&"assert_type"===s.type.details.builtInName)o=function(e,t,n){if(2!==e.arguments.length||0!==e.arguments[0].argumentCategory||void 0!==e.arguments[0].name||0!==e.arguments[0].argumentCategory||void 0!==e.arguments[1].name)return mt(g.LocMessage.assertTypeArgs(),e),{type:$.UnknownType.create()};const a=Be(e.arguments[0].valueExpression,void 0,t,n);if(a.isIncomplete)return{type:$.UnknownType.create(!0),isIncomplete:!0};const r=(0,W.convertToInstance)(Na(e.arguments[1]).type);if(!(0,$.isTypeSame)(r,a.type,{treatAnySameAsUnknown:!0,ignorePseudoGeneric:!0})){const t=kr(a.type,r,{expandTypeAlias:!0});ht(c.DiagnosticRule.reportAssertTypeFailure,g.LocMessage.assertTypeTypeMismatch().format({expected:t.destType,received:t.sourceType}),e.arguments[0].valueExpression)}return{type:a.type}}(e,n,a);else if((0,$.isAnyOrUnknown)(s.type)&&38===e.leftExpression.nodeType&&"reveal_locals"===e.leftExpression.value)0===e.arguments.length?o.type=function(e){let t,n=e;for(;n&&(t=z.getScopeForNode(n),!t||1===t.type);)n=n.parent;const a=[];t&&t.symbolTable.forEach(((e,t)=>{if(!e.isIgnoredForProtocolMatch()){const n=Ga(e);a.push(g.LocAddendum.typeOfSymbol().format({name:t,type:wr(n,{expandTypeAlias:!0})}))}}));a.length>0?ut(a.join("\n"),e):ut(g.LocMessage.revealLocalsNone(),e);return rt()}(e):mt(g.LocMessage.revealLocalsArgs(),e);else{const t=Zt(e,i,s,void 0,!1,n,a);o.type=null!==(r=t.returnType)&&void 0!==r?r:$.UnknownType.create(),t.argumentErrors?o.typeErrors=!0:o.overloadsUsedForCall=t.overloadsUsedForCall,t.isTypeIncomplete&&(o.isIncomplete=!0)}s.isIncomplete&&(o.isIncomplete=!0)}if(!Va(e)&&!s.isIncomplete){(0,$.isInstantiableClass)(s.type)&&$.ClassType.isBuiltIn(s.type,"TypeVar")&&v.getFileInfo(e).isTypingStubFile||i.forEach((e=>{e.valueExpression&&48!==e.valueExpression.nodeType&&!Pe(e.valueExpression)&&Be(e.valueExpression)}))}0!=(256&t)&&(ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.typeAnnotationCall(),e),o={type:$.UnknownType.create()});return o}(e,t,n,a);break;case 52:s=function(e,t,n,a){var r;if(0!=(256&t)&&1!==(null===(r=e.parent)||void 0===r?void 0:r.nodeType)){const t=new p.DiagnosticAddendum;return t.addMessage(g.LocAddendum.useTupleInstead()),ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.tupleInAnnotation()+t.getString(),e),{type:$.UnknownType.create()}}if(0!=(128&t)&&0===e.expressions.length&&!n)return{type:zt([]),isEmptyTupleShorthand:!0};let s,i=null==n?void 0:n.expectedType,o=n&&(0,$.isAny)(n.expectedType);if(n&&(0,$.isUnion)(n.expectedType)){let t;(0,W.doForEachSubtype)(n.expectedType,(n=>{if((0,$.isAny)(n)&&(o=!0),!t){const a=za(e,(()=>jt(e,(0,W.makeInferenceContext)(n),void 0)));a&&nr(n,a.type)&&(t=n)}}),!0),i=t}if(i){const t=jt(e,(0,W.makeInferenceContext)(i),a);if(t&&!t.typeErrors)return t;s=null==t?void 0:t.expectedTypeDiagAddendum}const l=function(e){const t=e.expressions.map((e=>Be(e))),n=t.some((e=>e.isIncomplete)),a=zt(Bt(t));if(n&&(0,W.getContainerDepth)(a)>8)return{type:$.UnknownType.create()};return{type:a,isIncomplete:n}}(e);o&&(l.type=$.AnyType.create());return{...l,expectedTypeDiagAddendum:s}}(e,t,n,a);break;case 11:s=function(e,t){let n;26===e.constType?n=0!=(128&t)?te:ne:33!==e.constType&&15!==e.constType&&9!==e.constType||(n=Ea(e,"bool"),n&&(0,$.isClassInstance)(n)&&(33===e.constType?n=$.ClassType.cloneWithLiteral(n,!0):15===e.constType&&(n=$.ClassType.cloneWithLiteral(n,!1))));return{type:null!=n?n:$.UnknownType.create()}}(e,t);break;case 48:{const n=0!=(8&t)&&!function(e){if(e.parent&&24===e.parent.nodeType){const t=Be(e.parent.baseExpression).type;if(t&&(0,$.isInstantiableClass)(t)&&$.ClassType.isSpecialBuiltIn(t,"Literal"))return!0}return!1}(e);n&&(i=!1),s=function(e,t,n){let a;if(n){let n=132|t;if(0==(4194304&t)&&(n|=524288),e.typeAnnotation)a=Be(e.typeAnnotation,n);else if(!e.typeAnnotation&&1===e.strings.length){const t=e.strings[0].token.flags;if(32&t)ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.annotationBytesString(),e),a={type:$.UnknownType.create()};else if(8&t)ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.annotationRawString(),e),a={type:$.UnknownType.create()};else if(64&t)ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.annotationFormatString(),e),a={type:$.UnknownType.create()};else{const t=function(e){const t=v.getFileInfo(e),n=new f.Parser,a=e.strings[0].value;let r=e.strings[0].start;49===e.strings[0].nodeType&&(r+=e.strings[0].token.prefixLength+e.strings[0].token.quoteMarkLength);const s=" ".repeat(r)+a,i=new f.ParseOptions;i.isStubFile=t.isStubFile,i.pythonVersion=t.executionEnvironment.pythonVersion,i.reportErrorsForParsedStringContents=!0;const o=n.parseTextExpression(s,r,a.length,i,void 0,void 0,t.typingSymbolAliases);if(o.parseTree&&62!==o.parseTree.nodeType)return o.diagnostics.forEach((t=>{mt(t.message,e)})),o.parseTree.parent=e,o.parseTree;return}(e);t&&(a=Be(t,n))}}a||(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.expectedTypeNotString(),e),a={type:$.UnknownType.create()})}else{let t=!0,n=!1;e.strings.forEach((e=>{const a=We(e);a.isIncomplete&&(n=!0);let r=!1;(0,$.isClassInstance)(a.type)&&($.ClassType.isBuiltIn(a.type,"str")&&void 0!==a.type.literalValue||$.ClassType.isBuiltIn(null==a?void 0:a.type,"LiteralString"))&&(r=!0),r||(t=!1)}));const r=0!=(32&e.strings[0].token.flags);if(e.strings.some((e=>27===e.nodeType))){if(t){const t=st(e,"LiteralString");t&&(0,$.isInstantiableClass)(t)&&(a={type:$.ClassType.cloneAsInstance(t)})}a||(a={type:Ea(e,r?"bytes":"str"),isIncomplete:n})}else a={type:Nn(e,r?"bytes":"str",e.strings.map((e=>e.value)).join("")),isIncomplete:n}}return a}(e,t,n);break}case 40:s=function(e,t){t=e.isImaginary?{type:Ea(e,"complex")}:e.isInteger?{type:Nn(e,"int",e.value)}:{type:Ea(e,"float")};return t}(e,s);break;case 18:s=function(e,t,n){var a,r;if(0!=(1&e))t={type:$.AnyType.create(!0)};else{t={type:null!==(r=null!==(a=Ea(n,"EllipsisType"))&&void 0!==a?a:Ea(n,"ellipsis"))&&void 0!==r?r:$.AnyType.create()}}return t}(t,s,e);break;case 55:s=(0,N.getTypeOfUnaryOperation)(Ar,e,t,n);break;case 7:{let a=t;i&&6!==e.operator&&(a&=-129),s=(0,N.getTypeOfBinaryOperation)(Ar,e,a,n);break}case 5:s=(0,N.getTypeOfAugmentedAssignment)(Ar,e,n);break;case 31:case 45:s=function(e,t,n){var a;if(0!=(256&t)&&31===e.nodeType&&1!==(null===(a=e.parent)||void 0===a?void 0:a.nodeType)){const t=new p.DiagnosticAddendum;t.addMessage(g.LocAddendum.useListInstead()),ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.listInAnnotation()+t.getString(),e)}let r,s=null==n?void 0:n.expectedType;if(n&&(0,$.isUnion)(n.expectedType)){let t,a;(0,W.doForEachSubtype)(n.expectedType,(n=>{if(a&&!a.typeErrors)return;const r=za(e,(()=>vn(e,(0,W.makeInferenceContext)(n))));r&&nr(n,r.type)&&(!a||a.typeErrors&&!r.typeErrors)&&(t=n,a=r)}),!0),s=t}if(s){const t=vn(e,(0,W.makeInferenceContext)(s));if(t&&!t.typeErrors)return t;r=null==t?void 0:t.expectedTypeDiagAddendum}const i=function(e,t){const n=31===e.nodeType?"list":"set",a=45===e.nodeType;let r=!1,s=!1,i=!1,o=[];e.entries.forEach(((e,t)=>{let n;n=32!==e.nodeType||e.isGenerator?Be(e):Sn(e),n.isIncomplete&&(s=!0),n.typeErrors&&(i=!0),t<Y&&o.push(n.type),!a||n.isIncomplete||n.typeErrors||_n(e,n.type,!1)})),o=o.map((e=>Ge(e)));let l=t?$.AnyType.create():$.UnknownType.create();if(o.length>0){const a=v.getFileInfo(e);l="list"===n&&a.diagnosticRuleSet.strictListInference||"set"===n&&a.diagnosticRuleSet.strictSetInference||t?(0,$.combineTypes)(o,B.maxSubtypesForInferredType):(0,W.areTypesSame)(o,{ignorePseudoGeneric:!0})?o[0]:l}else r=!0;const p=Fa(e,n),c=(0,$.isInstantiableClass)(p)?$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(p,[l],!0,void 0,void 0,r)):$.UnknownType.create();if(s&&(0,W.getContainerDepth)(c)>8)return{type:$.UnknownType.create()};return{type:c,isIncomplete:s,typeErrors:i}}(e,void 0!==n);return{...i,expectedTypeDiagAddendum:r}}(e,t,n);break;case 46:s=function(e){Va(e)||(e.startValue&&Be(e.startValue),e.endValue&&Be(e.endValue),e.stepValue&&Be(e.stepValue));return{type:Ea(e,"slice")}}(e);break;case 6:s=function(e,t,n){if(0!=(256&t))return mt(g.LocMessage.awaitNotAllowed(),e),{type:$.UnknownType.create()};const a=n?ca(e,n.expectedType,!1,!1):void 0,r=Be(e.expression,t,(0,W.makeInferenceContext)(a)),s={type:tt(r.type,e.expression),isIncomplete:r.isIncomplete,typeErrors:r.typeErrors};r.isIncomplete&&(s.isIncomplete=!0);return s}(e,t,n);break;case 51:s=(0,N.getTypeOfTernaryOperation)(Ar,e,t,n);break;case 32:s=function(e,t){let n=!1,a=!1,r=e.forIfNodes.some(((e,t)=>!(33!==e.nodeType||!e.isAsync)||t>0&&F.containsAwaitNode(e))),s=$.UnknownType.create();F.containsAwaitNode(e.expression)&&(r=!0);const i=st(e,r?"AsyncGenerator":"Generator"),o=bn(e,i,t),l=Sn(e,o);l.isIncomplete&&(n=!0);l.typeErrors&&(a=!0);let p=l.type;o&&(0,W.containsLiteralType)(o)||(p=Ge(p));i&&(0,$.isInstantiableClass)(i)&&(s=$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(i,r?[p,rt()]:[p,rt(),rt()],!0)));return{type:s,isIncomplete:n,typeErrors:a}}(e,n);break;case 15:s=function(e,t,n){var a;if(0!=(256&t)&&1!==(null===(a=e.parent)||void 0===a?void 0:a.nodeType)){const t=new p.DiagnosticAddendum;t.addMessage(g.LocAddendum.useDictInstead()),ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.dictInAnnotation()+t.getString(),e)}let r=null==n?void 0:n.expectedType;if(n&&(0,$.isUnion)(n.expectedType)){let t,a;(0,W.doForEachSubtype)(n.expectedType,(n=>{if(a&&!a.typeErrors)return;const r=za(e,(()=>fn(e,(0,W.makeInferenceContext)(n))));r&&nr(n,r.type)&&(!a||a.typeErrors&&!r.typeErrors)&&(t=n,a=r)}),!0),r=t}let s;if(r){s=new p.DiagnosticAddendum;const t=fn(e,(0,W.makeInferenceContext)(r),s);if(t)return t}const i=function(e,t){const n=t?$.AnyType.create():$.UnknownType.create();let a=n,r=n;const s=[],i=[];let o=!1,l=!1,p=!1;const c=Tn(e,s,i,t,!1);c.isIncomplete&&(l=!0);c.typeErrors&&(p=!0);const d=s.map((e=>Ge(e.type))),u=i.map((e=>Ge(e.type)));a=d.length>0?(0,$.combineTypes)(d):n,u.length>0?r=v.getFileInfo(e).diagnosticRuleSet.strictDictionaryInference||t?(0,$.combineTypes)(u):(0,W.areTypesSame)(u,{ignorePseudoGeneric:!0})?u[0]:n:(r=n,o=!0);const m=Fa(e,"dict"),y=(0,$.isInstantiableClass)(m)?$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(m,[a,r],!0,void 0,void 0,o)):$.UnknownType.create();if(l&&(0,W.getContainerDepth)(y)>8)return{type:$.UnknownType.create()};return{type:y,isIncomplete:l,typeErrors:p}}(e,!!n);return{...i,expectedTypeDiagAddendum:s}}(e,t,n);break;case 30:s=function(e,t){let n,a=[];t&&(0,W.mapSubtypes)(t.expectedType,(e=>{if((0,$.isFunction)(e)&&a.push(e),(0,$.isClassInstance)(e)){const t=Je(e,"__call__");t&&(0,$.isFunction)(t)&&a.push(t)}}));if(a.length>1){a=(0,W.sortTypes)(a);for(const r of a){if(!In(e,r,t,!0).typeErrors){n=r;break}}}!n&&a.length>0&&(n=a[0]);return In(e,n,t,!1)}(e,n);break;case 3:s=Be(e.rightExpression,t,n,a),kt(e.leftExpression,s.type,!!s.isIncomplete,e.rightExpression,!0,!0);break;case 4:0!=(256&t)&&mt(g.LocMessage.walrusNotAllowed(),e),s=Be(e.rightExpression,t,n,a),kt(e.name,s.type,!!s.isIncomplete,e.rightExpression,!0),o=!1;break;case 60:s=function(e){let t,n,a=!1;const r=F.getEnclosingFunction(e);if(r){const e=aa(r);if(e){const a=$.FunctionType.getSpecializedReturnType(e.functionType);if(a){t=(0,W.getGeneratorYieldType)(a,!!r.isAsync);const e=(0,W.getGeneratorTypeArgs)(a);e&&e.length>=2&&(n=e[1])}}}if(e.expression){Be(e.expression,void 0,(0,W.makeInferenceContext)(t)).isIncomplete&&(a=!0)}return{type:n||$.UnknownType.create(),isIncomplete:a}}(e);break;case 61:s=function(e){const t=Be(e.expression),n=t.type,a=(0,W.mapSubtypes)(n,(n=>{var a,r;let s=(0,W.getGeneratorTypeArgs)(n);if(s)return s.length>=2?s[2]:$.UnknownType.create();if((0,$.isClassInstance)(n)&&$.ClassType.isBuiltIn(n,"Coroutine"))return $.UnknownType.create();const i=null!==(r=null===(a=at(t,!1,e))||void 0===a?void 0:a.type)&&void 0!==r?r:$.UnknownType.create();return s=(0,W.getGeneratorTypeArgs)(i),s&&s.length>=2?s[2]:$.UnknownType.create()}));return{type:a}}(e);break;case 56:s=function(e,t,n){var a;let r,s;if(n){const t=Fa(e,"Iterable");t&&(0,$.isInstantiableClass)(t)&&(s=$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(t,[n.expectedType],!0)))}const i=Be(e.expression,t,(0,W.makeInferenceContext)(s)),o=i.type;if(0==(64&t)&&(0,$.isVariadicTypeVar)(o)&&!o.isVariadicUnpacked)r={type:$.TypeVarType.cloneForUnpacked(o)};else if(0!=(2097152&t)&&(0,$.isInstantiableClass)(o)&&$.ClassType.isBuiltIn(o,"tuple"))r={type:$.ClassType.cloneForUnpacked(o)};else if(0!=(256&t))mt(g.LocMessage.unpackInAnnotation(),e,e.starToken),r={type:$.UnknownType.create()};else{const t=null!==(a=nt(i,!1,e))&&void 0!==a?a:{type:$.UnknownType.create(!!i.isIncomplete),isIncomplete:i.isIncomplete};r={type:t.type,typeErrors:i.typeErrors,unpackedType:o,isIncomplete:t.isIncomplete}}return r}(e,t,n);break;case 54:s=Be(e.typeAnnotation,33256);break;case 49:case 27:s=We(e);break;case 0:Oa(e,(()=>{e.child&&Be(e.child)})),s={type:$.UnknownType.create()};break;default:(0,l.assertNever)(e,`Illegal node type: ${e.nodeType}`)}if(s||(0,l.fail)(`Unhandled expression type '${F.printExpression(e)}'`),i&&function(e,t,n){var a;if(e.isIncomplete)return;64&t&&(0,$.isVariadicTypeVar)(e.type)&&!e.type.isVariadicInUnion&&(mt(g.LocMessage.typeVarTupleContext(),n),e.type=$.UnknownType.create());if(!(0,W.isEffectivelyInstantiable)(e.type)){const t=(0,$.isClassInstance)(e.type)&&$.ClassType.isTupleClass(e.type)&&0===(null===(a=e.type.tupleTypeArguments)||void 0===a?void 0:a.length),r=(0,$.isClassInstance)(e.type)&&$.ClassType.isBuiltIn(e.type,["EllipsisType","ellipsis"]);t||r||(Tt(e.type,n),e.type=$.UnknownType.create(),e.typeErrors=!0)}}(s,t,e),(0,$.isInstantiableClass)(s.type)&&s.type.includePromotions&&!s.type.includeSubclasses&&$.ClassType.isBuiltIn(s.type,"bytes")&&v.getFileInfo(e).diagnosticRuleSet.disableBytesTypePromotions&&(s={...s,type:$.ClassType.cloneRemoveTypePromotions(s.type)}),De(e,s,t,n,o),n&&!(0,$.isAnyOrUnknown)(n.expectedType)&&!(0,$.isNever)(n.expectedType)&&(_e.set(e.id,n.expectedType),a&&(0,$.isFunction)(s.type)&&(s.type=(0,W.ensureFunctionSignaturesAreUnique)(s.type,a,e.start)),!s.isIncomplete&&!s.expectedTypeDiagAddendum)){const t=new p.DiagnosticAddendum;nr(n.expectedType,s.type,t,void 0,void 0,1024)||(s.typeErrors=!0,s.expectedTypeDiagAddendum=t,t.addTextRange(e))}return s}function qe(e,t){let n=!1,a="";if((0,$.isInstantiableClass)(e)&&!e.includeSubclasses?(n=$.ClassType.isTypeCheckOnly(e),a=e.details.name):(0,$.isFunction)(e)&&(n=$.FunctionType.isTypeCheckOnly(e),a=e.details.name),n){v.getFileInfo(t).isStubFile||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeCheckOnly().format({name:a}),t)}}function We(e){const t=0!=(32&e.token.flags);let n,a=!1;if(27===e.nodeType){let r=!0;if(e.fieldExpressions.forEach((e=>{const t=Be(e),n=t.type;t.isIncomplete&&(a=!0),(0,W.doForEachSubtype)(n,(e=>{(0,$.isClassInstance)(e)&&($.ClassType.isBuiltIn(e,"LiteralString")||$.ClassType.isBuiltIn(e,"str")&&void 0!==e.literalValue)||(r=!1)}))})),!t&&r){const t=st(e,"LiteralString");t&&(0,$.isInstantiableClass)(t)&&(n={type:$.ClassType.cloneAsInstance(t),isIncomplete:a})}n||(n={type:Ea(e,t?"bytes":"str"),isIncomplete:a},(0,$.isClass)(n.type)&&n.type.includePromotions&&(n.type=$.ClassType.cloneRemoveTypePromotions(n.type)))}else n={type:Nn(e,t?"bytes":"str",e.value),isIncomplete:a};return n}function Ge(e){var t,n,a;return(0,$.isUnion)(e)&&e.subtypes.length>0&&((null===(t=e.literalInstances.literalStrMap)||void 0===t?void 0:t.size)===e.subtypes.length||(null===(n=e.literalInstances.literalIntMap)||void 0===n?void 0:n.size)===e.subtypes.length||(null===(a=e.literalInstances.literalEnumMap)||void 0===a?void 0:a.size)===e.subtypes.length)?Ge(e.subtypes[0]):(0,W.mapSubtypes)(e,(e=>{if((0,$.isClass)(e)){if(void 0!==e.literalValue)return $.ClassType.cloneWithLiteral(e,void 0);if($.ClassType.isBuiltIn(e,"LiteralString")&&de&&(0,$.isInstantiableClass)(de)){let t=$.ClassType.cloneAsInstance(de);return e.condition&&(t=$.TypeBase.cloneForCondition(t,(0,W.getTypeCondition)(e))),t}}return e}))}function Ke(e,t){return $e(e,{associateTypeVarsWithScope:!0,allowTypeVarTuple:1===t,allowUnpackedTypedDict:2===t,allowUnpackedTuple:1===t})}function $e(e,t){var n,a,r;const s=v.getFileInfo(e);if(s.isTypingStubFile||s.isTypingExtensionsStubFile){const t=function(e){if(!e.parent||54!==e.parent.nodeType)return;if(38!==e.parent.valueExpression.nodeType)return;const t=e.parent.valueExpression,n=t.value,a=new Map([["Tuple",{alias:"tuple",module:"builtins"}],["Generic",{alias:"",module:"builtins",isSpecialForm:!0}],["Protocol",{alias:"",module:"builtins",isSpecialForm:!0}],["Callable",{alias:"",module:"builtins",isSpecialForm:!0}],["Type",{alias:"type",module:"builtins"}],["ClassVar",{alias:"",module:"builtins",isSpecialForm:!0}],["Final",{alias:"",module:"builtins",isSpecialForm:!0}],["Literal",{alias:"",module:"builtins",isSpecialForm:!0}],["TypedDict",{alias:"_TypedDict",module:"self"}],["Union",{alias:"",module:"builtins",isSpecialForm:!0}],["Optional",{alias:"",module:"builtins",isSpecialForm:!0}],["Annotated",{alias:"",module:"builtins",isSpecialForm:!0}],["TypeAlias",{alias:"",module:"builtins",isSpecialForm:!0}],["Concatenate",{alias:"",module:"builtins",isSpecialForm:!0}],["TypeGuard",{alias:"",module:"builtins",isSpecialForm:!0,typeParamVariance:3}],["Unpack",{alias:"",module:"builtins",isSpecialForm:!0}],["Required",{alias:"",module:"builtins",isSpecialForm:!0}],["NotRequired",{alias:"",module:"builtins",isSpecialForm:!0}],["Self",{alias:"",module:"builtins",isSpecialForm:!0}],["NoReturn",{alias:"",module:"builtins",isSpecialForm:!0}],["Never",{alias:"",module:"builtins",isSpecialForm:!0}],["LiteralString",{alias:"",module:"builtins",isSpecialForm:!0}],["ReadOnly",{alias:"",module:"builtins",isSpecialForm:!0}],["TypeIs",{alias:"",module:"builtins",isSpecialForm:!0,typeParamVariance:2}]]).get(n);if(a){const t=Ne(e,0);if(t)return(0,l.assert)((0,$.isInstantiableClass)(t)),t;const r=qn(e,n,a);return"LiteralString"===n&&(r.details.baseClasses.push(null!=de?de:$.AnyType.create()),(0,W.computeMroLinearization)(r)),De(e,{type:r},0),r}return}(e);if(t)return t}let i=393;(null==t?void 0:t.isVariableAnnotation)&&(i|=32768),(null==t?void 0:t.allowFinal)||(i|=16),(null==t?void 0:t.allowClassVar)||(i|=131072),(null==t?void 0:t.allowTypeVarTuple)?i|=2097152:i|=64,(null==t?void 0:t.allowParamSpec)||(i|=32),(null==t?void 0:t.associateTypeVarsWithScope)&&(i|=8192),(null==t?void 0:t.allowUnpackedTypedDict)&&(i|=8388608),(null==t?void 0:t.allowUnpackedTuple)&&(i|=2097152),(null==t?void 0:t.notParsedByInterpreter)&&(i|=524288),(null==t?void 0:t.allowRequired)&&(i|=1048576),(0,T.isAnnotationEvaluationPostponed)(s)&&(i|=4),3===(null===(n=null==e?void 0:e.parent)||void 0===n?void 0:n.nodeType)&&e.parent.typeAnnotationComment===e?i|=524292:62===(null===(a=null==e?void 0:e.parent)||void 0===a?void 0:a.nodeType)?(e.parent.returnTypeAnnotation===e||e.parent.paramTypeAnnotations.some((t=>t===e)))&&(i|=524292):41===(null===(r=null==e?void 0:e.parent)||void 0===r?void 0:r.nodeType)&&e.parent.typeAnnotationComment===e&&(i|=524292);const o=Be(e,i).type;return(0,$.isModule)(o)&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.moduleAsType(),e),(0,W.convertToInstance)(o)}function He(e,t=0){if(e=Ct(e),t>$.maxTypeRecursionCount)return!0;switch(t++,e.category){case 0:case 1:case 2:case 3:return!0;case 8:return void 0!==(0,$.findSubtype)(e,(e=>He(e,t)));case 4:case 5:case 7:case 9:return!1;case 6:{if($.TypeBase.isInstantiable(e))return!1;if((0,W.isTupleClass)(e)&&e.tupleTypeArguments)return(0,W.isUnboundedTupleClass)(e)||0===e.tupleTypeArguments.length;const t=e.details.mro.find((e=>!(0,$.isClass)(e)||(0,W.isTupleClass)(e)));if(t&&(0,$.isClass)(t)&&t.tupleTypeArguments)return(0,W.isUnboundedTupleClass)(t)||0===t.tupleTypeArguments.length;if($.ClassType.isBuiltIn(e,"bool")&&void 0!==e.literalValue)return!1===e.literalValue;if($.ClassType.isProtocolClass(e))return!0;if((0,W.lookUpObjectMember)(e,"__len__"))return!0;const n=(0,W.lookUpObjectMember)(e,"__bool__");if(n){const e=Ja(n);if((0,$.isFunction)(e)&&e.details.declaredReturnType){const t=e.details.declaredReturnType;if((0,$.isClassInstance)(t)&&$.ClassType.isBuiltIn(t,"bool")&&!0===t.literalValue)return!1}return!0}return $.ClassType.isBuiltIn(e,"object")}}}function Ze(e,t=0){if(e=Ct(e),t>$.maxTypeRecursionCount)return!0;switch(t++,e.category){case 1:case 4:case 5:case 7:case 9:case 3:case 2:return!0;case 8:return void 0!==(0,$.findSubtype)(e,(e=>Ze(e,t)));case 0:return!1;case 6:{if($.TypeBase.isInstantiable(e))return!0;if((0,W.isNoneInstance)(e))return!1;if((0,W.isTupleClass)(e)&&e.tupleTypeArguments&&0===e.tupleTypeArguments.length)return!1;if(!1===e.literalValue||0===e.literalValue||e.literalValue===BigInt(0)||""===e.literalValue)return!1;if($.ClassType.isProtocolClass(e))return!0;const t=(0,W.lookUpObjectMember)(e,"__bool__");if(t){const e=Ja(t);if((0,$.isFunction)(e)&&e.details.declaredReturnType){const t=e.details.declaredReturnType;if((0,$.isClassInstance)(t)&&$.ClassType.isBuiltIn(t,"bool")&&!1===t.literalValue)return!1}}return!0}}}function Ye(e,t,n,a={method:"get"},r=void 0,s=0,i,o=0){if($.ClassType.isPartiallyEvaluated(t))return e&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.classDefinitionCycle().format({name:t.details.name}),e),{type:$.UnknownType.create()};(0,$.isInstantiableClass)(t)&&!t.includeSubclasses&&t.details.typeParameters.length>0&&0==(512&s)&&(t=(0,W.specializeWithDefaultTypeArgs)(t));const l=$.TypeBase.isInstantiable(t),d=t.details.effectiveMetaclass;let u,m,y=l&&0!=(16&s);if("get"===a.method&&l&&d&&(0,$.isInstantiableClass)(d)&&!$.ClassType.isBuiltIn(d,"type")&&!$.ClassType.isSameGenericClass(d,t)){const r=Nt(e,d,n,a,void 0,512|s,t,o);if(r){const e=(0,$.isClassInstance)(r.type)&&$.ClassType.isPropertyClass(r.type);((0,W.isDescriptorInstance)(r.type,!0)||e)&&(y=!0)}}if(!y){let c=s;l?(c|=1552,c&=-33):c|=128,m=r?new p.DiagnosticAddendum:void 0,u=Nt(e,t,n,a,m,c,i,o)}if(!u&&d&&(0,$.isInstantiableClass)(d)){let i=s;l||(i|=552,i&=-17);const c=r?new p.DiagnosticAddendum:void 0;u=Nt(e,$.ClassType.cloneAsInstance(d),n,a,c,i,l?t:$.ClassType.cloneAsInstantiable(t),o),(null==u?void 0:u.isDescriptorError)&&(m=c)}if(u)return u.isDescriptorError&&r&&m&&r.addAddendum(m),{type:u.type,classType:u.classType,isIncomplete:!!u.isTypeIncomplete,isAsymmetricAccessor:u.isAsymmetricAccessor,narrowedTypeForSet:u.narrowedTypeForSet,memberAccessDeprecationInfo:u.memberAccessDeprecationInfo,typeErrors:u.isDescriptorError};if((0,$.isClassInstance)(t)&&$.ClassType.isBuiltIn(t,"type")&&t.includeSubclasses&&0==(8&s)){const e=t.typeArguments&&t.typeArguments.length>=1?t.typeArguments[0]:$.UnknownType.create();if((0,$.isAnyOrUnknown)(e))return{type:e,classType:$.UnknownType.create()}}r&&m&&r.addAddendum(m)}function Je(e,t,n,a,r=0){if(r>$.maxTypeRecursionCount)return;const s=Ye(void 0,e,t,void 0,a,528,n,++r);return s&&!s.typeErrors?(0,$.isFunction)(s.type)||(0,$.isOverloadedFunction)(s.type)?s.type:(0,$.isClassInstance)(s.type)?Je(s.type,"__call__",null!=n?n:$.ClassType.cloneAsInstance(e),a,r):(0,$.isAnyOrUnknown)(s.type)?(0,W.getUnknownTypeForCallable)():void 0:void 0}function Qe(e){var t,n;const a=e.details.parameters.findIndex((e=>2===e.category));if(a<0)return e;(0,l.assert)(a===e.details.parameters.length-1);const r=$.FunctionType.getEffectiveParameterType(e,a);if(!(0,$.isClassInstance)(r)||!$.ClassType.isTypedDictClass(r)||!r.isUnpacked)return e;const s=null!==(t=r.typedDictNarrowedEntries)&&void 0!==t?t:null===(n=r.details.typedDictEntries)||void 0===n?void 0:n.knownItems;if(!s)return e;const i=$.FunctionType.clone(e);i.details.parameters.splice(a),i.specializedTypes&&i.specializedTypes.parameterTypes.splice(a);return e.details.parameters.findIndex((e=>1===e.category))<0&&$.FunctionType.addKeywordOnlyParameterSeparator(i),s.forEach(((e,t)=>{$.FunctionType.addParameter(i,{category:0,name:t,hasDeclaredType:!0,type:e.valueType,hasDefault:!e.isRequired,defaultType:e.valueType})})),i}function Xe(e){if(54===e.nodeType&&38===e.valueExpression.nodeType){const t=Ma(e,e.valueExpression.value,!1);if(t){return void 0!==t.symbol.getDeclarations().find((e=>vr(e)))}}return!1}function et(e,t){var n,a;let r,s,i,o=!0,l=!1;switch(e.nodeType){case 38:{const t=Ma(e,e.value,!0);if(t&&(r=t.symbol,!(null===(n=$a(r,e))||void 0===n?void 0:n.type)&&3===t.scope.type)){const t=F.getEnclosingClassOrFunction(e);if(t&&10===t.nodeType){const n=Yn(t);if(n){const t=(0,W.lookUpClassMember)(n.classType,e.value,80);t&&(r=t.symbol)}}}break}case 54:return et(e.valueExpression,t);case 35:{const t=Ct(Be(e.leftExpression,2).type);let n;(0,$.isClassInstance)(t)?(n=(0,W.lookUpObjectMember)(t,e.memberName.value,64),s=t,i=null==n?void 0:n.classType,(null==n?void 0:n.isInstanceMember)&&(o=!1),l=!0):(0,$.isInstantiableClass)(t)&&(n=(0,W.lookUpClassMember)(t,e.memberName.value,80),s=t,i=null==n?void 0:n.classType),n&&(r=n.symbol);break}case 24:{const n=Ct(Be(e.baseExpression,2).type);if(n&&(0,$.isClassInstance)(n)){const a=Je(n,"__setitem__");if(a&&(0,$.isFunction)(a)&&a.details.parameters.length>=2){const e=$.FunctionType.getEffectiveParameterType(a,1);if(!(0,$.isAnyOrUnknown)(e))return e}else if($.ClassType.isTypedDictClass(n)){const a=(0,K.getTypeOfIndexedTypedDict)(Ar,e,n,t||{method:"get"});if(a)return a.type}}break}}if(r){let e=null===(a=$a(r))||void 0===a?void 0:a.type;if(e){if(l&&(0,$.isClassInstance)(e)){const t=Je(e,"__set__");if(t&&(0,$.isFunction)(t)&&t.details.parameters.length>=2&&(e=t.details.parameters[1].type,(0,$.isAnyOrUnknown)(e)))return}return s&&(i&&(0,$.isInstantiableClass)(i)&&(e=(0,W.partiallySpecializeType)(e,i)),((0,$.isFunction)(e)||(0,$.isOverloadedFunction)(e))&&o&&(e=gr(s,e))),e}}}function tt(e,t){if(!ie||!(0,$.isInstantiableClass)(ie)||1!==ie.details.typeParameters.length)return $.UnknownType.create();const n=$.ClassType.cloneAsInstance(ie);return(0,W.mapSubtypes)(e,(e=>{if(e=Ct(e),(0,$.isAnyOrUnknown)(e))return e;const a=t?new p.DiagnosticAddendum:void 0;if((0,$.isClassInstance)(e)){const t=new G.TypeVarContext((0,W.getTypeVarScopeId)(n));if(nr(n,e,a,t)){const e=(0,W.applySolvedTypeVars)(n,t);return(0,$.isClass)(e)&&e.typeArguments&&e.typeArguments.length>0?e.typeArguments[0]:$.UnknownType.create()}}return t&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeNotAwaitable().format({type:wr(e)})+(null==a?void 0:a.getString()),t),$.UnknownType.create()}))}function nt(e,t,n,a=!0){const r=t?"__aiter__":"__iter__",s=t?"__anext__":"__next__";let i=!0,o=(0,W.transformPossibleRecursiveTypeAlias)(e.type);o=Ct(o),o=(0,$.removeUnbound)(o),(0,W.isOptionalType)(o)&&a&&(e.isIncomplete||ht(c.DiagnosticRule.reportOptionalIterable,g.LocMessage.noneNotIterable(),n),o=(0,W.removeNoneFromUnion)(o));const l=(0,W.mapSubtypes)(o,(o=>{if(o=Ct(o),(0,$.isAnyOrUnknown)(o))return o;const l=new p.DiagnosticAddendum;if((0,$.isClass)(o)){if($.TypeBase.isInstance(o)&&(0,W.isTupleClass)(o)&&o.tupleTypeArguments&&0===o.tupleTypeArguments.length)return $.NeverType.createNever();const e=hn(o,r,[],n);if(e){const a=new p.DiagnosticAddendum,i=It(e,void 0,(e=>{if((0,$.isAnyOrUnknown)(e))return e;if((0,$.isClassInstance)(e)){let r=hn(e,s,[],n);if(r)return r=(0,W.mapSubtypes)(r,(e=>(0,$.isTypeVar)(e)&&(0,$.isUnpackedVariadicTypeVar)(e)?null!=ae?ae:$.UnknownType.create():e)),t?tt(r,n):r;a.addMessage(g.LocMessage.methodNotDefinedOnType().format({name:s,type:wr(e)}))}else a.addMessage(g.LocMessage.methodReturnsNonObject().format({name:r}))}));if(a.isEmpty())return i;l.addAddendum(a)}else{if(!t&&(0,$.isClassInstance)(o)){const e=hn(o,"__getitem__",[{type:ce&&(0,$.isInstantiableClass)(ce)?$.ClassType.cloneAsInstance(ce):$.UnknownType.create()}],n);if(e)return e}l.addMessage(g.LocMessage.methodNotDefined().format({name:r}))}}!e.isIncomplete&&a&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeNotIterable().format({type:wr(o)})+l.getString(),n),i=!1}));return i?{type:l,isIncomplete:e.isIncomplete}:void 0}function at(e,t,n,a=!0){const r=t?"__aiter__":"__iter__";let s=!0,i=Ct(e.type);(0,W.isOptionalType)(i)&&(!e.isIncomplete&&a&&ht(c.DiagnosticRule.reportOptionalIterable,g.LocMessage.noneNotIterable(),n),i=(0,W.removeNoneFromUnion)(i));const o=(0,W.mapSubtypes)(i,(e=>{if((0,$.isAnyOrUnknown)(e))return e;if((0,$.isClass)(e)){const t=hn(e,r,[],n);if(t)return Ct(t)}a&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeNotIterable().format({type:wr(e)}),n),s=!1}));return s?{type:o,isIncomplete:e.isIncomplete}:void 0}function rt(){return null!=ne?ne:$.UnknownType.create()}function st(e,t){var n;return null!==(n=ot(e,t,["typing"]))&&void 0!==n?n:ot(e,t,["typing_extensions"])}function it(e,t){return ot(e,t,["_typeshed"])}function ot(t,n,a){const r=v.getFileInfo(t),s=e({nameParts:a,importingFileUri:r.fileUri});if(!s)return;const i=s.symbolTable.get(n);return i?Ga(i):void 0}function lt(e){const n=28===e.nodeType?e:F.getExecutionScopeNode(e);if(v.getCodeFlowComplexity(n)>t.maxCodeComplexity){let t=n;28===n.nodeType?t=n.name:36===n.nodeType&&(t={start:0,length:0});const a=v.getFileInfo(e);return ft(a,a.diagnosticRuleSet.reportGeneralTypeIssues,c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.codeTooComplexToAnalyze(),t),!0}return!1}function pt(e,t){if(lt(e))return!0;const n=v.getFlowNode(e);if(!n)return!!e.parent&&pt(e.parent,t);const a=t?v.getFlowNode(t):void 0;return xr.isFlowNodeReachable(n,a)}function ct(e){const t=v.getAfterFlowNode(e);return!!t&&(!!lt(e)||!!xr.isFlowNodeReachable(t)&&!!function(e,t){const n=Sa(e.id,void 0);if(lt(e))return!0;const a=n.getTypeFromCodeFlow(t,void 0,{typeAtStart:{type:$.UnboundType.create()}});return void 0!==a.type&&!(0,$.isNever)(a.type)}(e,t))}function dt(e,t,n=!0){if(lt(e))return!0;const a=v.getFlowNode(e),r=v.getFlowNode(t);return!(!a||!r)&&(a===r?n:xr.isFlowNodeReachable(r,a,!0))}function ut(e,t,n){return yt("information",e,t,n)}function mt(e,t,n){return yt("error",e,t,n)}function yt(e,t,n,a){if(!gt(n)&&pt(n)){return v.getFileInfo(n).diagnosticSink.addDiagnosticWithTextRange(e,t,a||n)}}function gt(e){return Q.some((t=>F.isNodeContainedWithin(e,t)))||J.isSpeculative(e,!0)}function ht(e,t,n,a){const r=v.getFileInfo(n).diagnosticRuleSet[e];if("none"===r)return;const s=F.getEnclosingFunction(n);if(s){if(!v.getFileInfo(n).diagnosticRuleSet.analyzeUnannotatedFunctions&&F.isUnannotatedFunction(s)&&F.isNodeContainedWithin(n,s.suite))return;const e=F.getEnclosingClass(s,!0);if(0!=(524288&(0,S.getFunctionInfoFromDecorators)(Ar,s,!!e).flags))return}const i=yt(r,t,n,a);return i&&i.setRule(e),i}function ft(e,t,n,a,r){if("none"===t)return;const s=e.diagnosticSink.addDiagnosticWithTextRange(t,a,r);return n&&s.setRule(n),s}function Tt(e,t){const n=new p.DiagnosticAddendum;(0,$.isUnion)(e)&&(0,W.doForEachSubtype)(e,(e=>{(0,W.isEffectivelyInstantiable)(e)||n.addMessage(g.LocAddendum.typeNotClass().format({type:wr(e)}))})),ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeExpectedClass().format({type:wr(e)})+n.getString(),t)}function vt(e,t,n,a,r,s=!1,i){var o,l,d;const u=e.value,m=Ma(e,u,!1);if(!m)return;const y=m.symbol.getDeclarations();let h=null===(o=$a(m.symbol))||void 0===o?void 0:o.type;const f=v.getFileInfo(e);if(void 0===h&&3===m.scope.type){const t=F.getEnclosingClass(e);if(t){const n=Yn(t);if(n){const t=(0,W.lookUpClassMember)(n.classType,e.value,1);(null==t?void 0:t.isTypeDeclared)&&(h=Ja(t))}}}let T=t;const b=!!h&&(0,$.isClassInstance)(h)&&$.ClassType.isBuiltIn(h,"TypeAlias");if(h&&!b){let a=new p.DiagnosticAddendum;nr(h,t,a)?T=dr(e,h,t):(i&&(a=i),n||ht(c.DiagnosticRule.reportAssignmentType,g.LocMessage.typeAssignmentMismatch().format(kr(t,h))+a.getString(),null!=r?r:e,null!==(d=null!==(l=a.getEffectiveTextRange())&&void 0!==l?l:r)&&void 0!==d?d:e),T=h)}else{const t=z.getScopeForNode(e);3===(null==t?void 0:t.type)&&(!$.TypeBase.isInstance(T)||(0,R.isConstantName)(u)||fr(m.symbol)||(T=Ge(T)))}const _=y.findIndex((e=>1===e.type)),C=_>=0?y[_]:void 0,I=y.find(((e,t)=>_<t&&1!==e.type));C&&1===C.type&&(C.isConstant?(e!==(0,w.getNameNodeForDeclaration)(y[0])||I)&&ht(c.DiagnosticRule.reportConstantRedefinition,g.LocMessage.constantRedefinition().format({name:u}),e):Tr(C)&&!s&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.finalReassigned().format({name:u}),e)),n||kn(f.diagnosticRuleSet.reportUnknownVariableType,c.DiagnosticRule.reportUnknownVariableType,e,T,e,a),De(e,{type:T,isIncomplete:n},0)}function bt(e,t,n,a,r){var i;const o=Be(e.leftExpression,2),l=Ct(o.type);if(38===e.leftExpression.nodeType){const r=F.getEnclosingClass(e);if(r){const s=Yn(r);if(s&&(0,$.isInstantiableClass)(s.classType)&&((0,$.isClassInstance)(l)?$.ClassType.isSameGenericClass(l,s.classType)&&_t(e,t,n,!0,a):(0,$.isInstantiableClass)(l)&&$.ClassType.isSameGenericClass(l,s.classType)&&_t(e,t,n,!1,a),$.ClassType.isProtocolClass(s.classType))){const t=$.ClassType.getSymbolTable(s.classType).get(e.memberName.value);if(t){0===t.getDeclarations().filter((e=>!F.getEnclosingFunction(e.node))).length&&mt(g.LocMessage.assignmentInProtocol(),e.memberName)}}}}const p=Pt(e,o,{method:"set",setType:{type:t,isIncomplete:n},setErrorNode:a,setExpectedTypeDiag:r},0);var c;p.isAsymmetricAccessor&&(c=e,Va(void 0)||s.add(c.id));const d={type:null!==(i=p.narrowedTypeForSet)&&void 0!==i?i:t,isIncomplete:n,memberAccessDeprecationInfo:p.memberAccessDeprecationInfo};De(e.memberName,d,0),De(e,d,0)}function _t(e,t,n,a,r){var s;const i=e.memberName.value,o=v.getFileInfo(e),p=F.getEnclosingClass(e);if(!p)return;const d=Yn(p);if(d&&(0,$.isInstantiableClass)(d.classType)){let p=(0,W.lookUpClassMember)(d.classType,i,a?0:16);const u=$.ClassType.getSymbolTable(d.classType);if(p){const n=(0,$.isInstantiableClass)(p.classType)?p.classType:void 0,m=n&&$.ClassType.isSameGenericClass(d.classType,n);if(m&&a&&n){const t=$.ClassType.getInheritedSlotsNames(n);if(t&&n.details.localSlotsNames&&n.details.localSlotsNames.length>0&&!t.some((e=>e===i))){const t=(0,W.lookUpClassMember)(n,i,16);let a=!1;if(t){const e=Ga(t.symbol);((0,$.isAnyOrUnknown)(e)||(0,$.isUnbound)(e)||(0,W.isMaybeDescriptorInstance)(e))&&(a=!0)}a||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.slotsAttributeError().format({name:i}),e.memberName)}}if(m&&p.isInstanceMember===a){const t=u.get(i);(0,l.assert)(void 0!==t);const n=t.getDeclarations();n.length>0&&1===n[0].type&&r&&e.memberName!==n[0].node&&n[0].isConstant&&ht(c.DiagnosticRule.reportConstantRedefinition,g.LocMessage.constantRedefinition().format({name:e.memberName.value}),e.memberName)}else{const n=null===(s=$a(p.symbol))||void 0===s?void 0:s.type;if(n&&!(0,W.isProperty)(n)&&!p.isInstanceMember&&a){St(o,p.symbol,e.memberName);const n=Ja(p);t=(0,$.combineTypes)([t,n])}}}p=(0,W.lookUpClassMember)(d.classType,i,64),p||!r||n||kn(o.diagnosticRuleSet.reportUnknownMemberType,c.DiagnosticRule.reportUnknownMemberType,e.memberName,t,e,!0)}}function Ct(e,t=!1,n){return(0,W.mapSubtypes)(e,(e=>{var a,r;if((0,$.isParamSpec)(e)){if("args"===e.paramSpecAccess)return ae&&(0,$.isClassInstance)(ae)?zt([{type:ae,isUnbounded:!0}]):$.UnknownType.create();if("kwargs"===e.paramSpecAccess)return ue&&(0,$.isInstantiableClass)(ue)&&de&&(0,$.isInstantiableClass)(de)&&ae&&(0,$.isClassInstance)(ae)?$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(ue,[(0,W.convertToInstance)(de),ae],!0)):$.UnknownType.create()}if(t&&(0,$.isFunction)(e)&&0===e.details.parameters.length&&e.details.paramSpec)return $.FunctionType.cloneForParamSpec(e,(0,W.getUnknownTypeForCallable)());if((0,$.isTypeVar)(e)&&e.details.isVariadic){if(e.isVariadicInUnion){if($.TypeBase.isInstantiable(e)){if(re&&(0,$.isInstantiableClass)(re))return re}else if(ae)return ae;return $.AnyType.create()}return zt([{type:null!=ae?ae:$.UnknownType.create(),isUnbounded:!0}],!0)}if((0,$.isTypeVar)(e)){if(e.details.recursiveTypeAliasName)return e;if(e.details.constraints.length>0){const t=[];return e.details.constraints.forEach(((a,r)=>{if(n){const t=$.TypeVarType.getNameWithScope(e),a=n.find((e=>e.typeVar.nameWithScope===t));if(a&&a.constraintIndex!==r)return}$.TypeBase.isInstantiable(e)&&(a=(0,W.convertToInstantiable)(a)),t.push((0,W.addConditionToType)(a,[{typeVar:e,constraintIndex:r}]))})),(0,$.combineTypes)(t)}if(e.details.isExemptFromBoundCheck)return $.AnyType.create();let t=null!==(r=null!==(a=e.details.boundType)&&void 0!==a?a:ae)&&void 0!==r?r:$.UnknownType.create();return t=$.TypeBase.isInstantiable(e)?(0,W.convertToInstantiable)(t):t,(0,W.addConditionToType)(t,[{typeVar:e,constraintIndex:0}])}return e}))}function It(e,t,n,a=0){const r=[];let s=!1;function i(e,i){let o=(0,$.isUnion)(e)?e:Ct(e);o=(0,W.transformPossibleRecursiveTypeAlias)(o),(null==t?void 0:t.expandCallback)&&(o=t.expandCallback(o)),(0,W.doForEachSubtype)(o,((o,l,p)=>{var c;if(null==t?void 0:t.conditionFilter){const e=function(e,t,n){if(n>$.maxTypeRecursionCount)return e;if(n++,!$.TypeCondition.isCompatible((0,W.getTypeCondition)(e),t))return;if((0,$.isClass)(e)&&e.typeArguments&&!e.tupleTypeArguments){Qn(e);let a=!1;const r=e.typeArguments.map(((r,s)=>{if(s>=e.details.typeParameters.length)return r;if(3!==$.TypeVarType.getVariance(e.details.typeParameters[s]))return r;const i=It(r,{conditionFilter:t},(e=>e),n);return i!==r&&(a=!0),i}));if(a)return $.ClassType.cloneForSpecialization(e,r,!0)}return e}(o,t.conditionFilter,a);if(!e)return;o=e}let d=n(o,e,i&&l===p.length-1);if(d!==e&&(s=!0),d){const e=null===(c=(0,W.getTypeCondition)(o))||void 0===c?void 0:c.filter((e=>e.typeVar.details.constraints.length>0));e&&e.length>0&&(d=(0,W.addConditionToType)(d,e)),0!==r.length&&(0,$.isTypeSame)(d,r[r.length-1])||r.push(d)}}),null==t?void 0:t.sortSubtypes)}if((0,$.isUnion)(e)){((null==t?void 0:t.sortSubtypes)?(0,W.sortTypes)(e.subtypes):e.subtypes).forEach(((t,n)=>{i(t,n===e.subtypes.length-1)}))}else i(e,!0);if(!s)return e;const o=(0,$.combineTypes)(r);return 8===o.category&&$.UnionType.addTypeAliasSource(o,e),o}function kt(e,t,n,a,r=!1,s=!1,i){if((0,$.isTypeVar)(t)&&a&&9===a.nodeType){const n=Be(a.leftExpression,2).type;if((0,$.isInstantiableClass)(n)&&($.ClassType.isBuiltIn(n,"TypeVar")||$.ClassType.isBuiltIn(n,"TypeVarTuple")||$.ClassType.isBuiltIn(n,"ParamSpec"))){const n=54===e.nodeType?e.valueExpression:e;38===n.nodeType&&n.value===t.details.name||mt(t.details.isParamSpec?g.LocMessage.paramSpecAssignedName().format({name:$.TypeVarType.getReadableName(t)}):g.LocMessage.typeVarAssignedName().format({name:$.TypeVarType.getReadableName(t)}),n)}}switch(t=(0,$.removeUnbound)(t),e.nodeType){case 38:vt(e,t,n,r,a,s,i);break;case 35:bt(e,t,n,a,i);break;case 24:{const r=Be(e.baseExpression,2);Mt(e,r,{method:"set",setType:{type:t,isIncomplete:n},setErrorNode:a,setExpectedTypeDiag:i},0),De(e,{type:t,isIncomplete:n},0);break}case 31:case 52:!function(e,t,n,a){const r=31===e.nodeType?e.entries:e.expressions,s=new Array(r.length);for(let e=0;e<r.length;e++)s[e]=[];const i=r.findIndex((e=>56===e.nodeType)),o=r.findIndex((e=>56===e.nodeType));t=Ct(t);const l=new p.DiagnosticAddendum;(0,W.doForEachSubtype)(t,(t=>{var p,c;const d=(0,W.getSpecializedTupleType)(t);if(d&&d.tupleTypeArguments){const n=d.tupleTypeArguments.map((e=>(0,W.addConditionToType)(e.type,(0,W.getTypeCondition)(t),!0))),a=d.tupleTypeArguments.findIndex((e=>e.isUnbounded));if(a>=0&&n.length<s.length){const e=n.length>0?n[a]:$.AnyType.create();for(;n.length<s.length;)n.splice(a,0,e)}if(i>=0)if(n.length>s.length){const t=n.splice(i,n.length-s.length+1);let a=(0,$.combineTypes)(t);31===e.nodeType&&(a=Ge(a)),n.splice(i,0,a)}else n.length===s.length-1&&n.splice(i,0,$.NeverType.createNever());if(n.forEach(((e,t)=>{t<s.length&&s[t].push(e)})),n.length!==r.length){const a=l.createAddendum();a.addMessage((31===e.nodeType?g.LocAddendum.listAssignmentMismatch():g.LocAddendum.tupleAssignmentMismatch()).format({type:wr(t)})),a.createAddendum().addMessage((o>=0?g.LocAddendum.tupleSizeMismatchIndeterminateDest():g.LocAddendum.tupleSizeMismatch()).format({expected:o>=0?r.length-1:r.length,received:n.length}))}}else{const e=null!==(c=null===(p=nt({type:t,isIncomplete:n},!1,a))||void 0===p?void 0:p.type)&&void 0!==c?c:$.UnknownType.create();for(let n=0;n<r.length;n++)s[n].push((0,W.addConditionToType)(e,(0,W.getTypeCondition)(t)))}})),l.isEmpty()||ht(c.DiagnosticRule.reportAssignmentType,(31===e.nodeType?g.LocMessage.listAssignmentMismatch():g.LocMessage.tupleAssignmentMismatch()).format({type:wr(t)})+l.getString(),e),r.forEach(((e,t)=>{const r=s[t];kt(e,0===r.length?$.UnknownType.create():(0,$.combineTypes)(r),n,a,!0)})),De(e,{type:t,isIncomplete:n},0)}(e,t,n,a);break;case 54:{const o=$e(e.typeAnnotation,{isVariableAnnotation:!0,allowFinal:F.isFinalAllowedForAssignmentTarget(e.valueExpression),allowClassVar:F.isClassVarAllowedForAssignmentTarget(e.valueExpression)});if(!((0,$.isClassInstance)(o)&&($.ClassType.isBuiltIn(o,"Final")||$.ClassType.isBuiltIn(o,"ClassVar")))){(0,$.isClassInstance)(o)&&$.ClassType.isBuiltIn(o,"TypeAlias")||nr(o,t)&&((0,$.isClassInstance)(t)&&$.ClassType.isEnumClass(t)||(t=dr(e,o,t)))}kt(e.valueExpression,t,n,a,r,s,i);break}case 56:38===e.expression.nodeType&&vt(e.expression,Ea(e.expression,"list",[t]),!1,r,a);break;case 0:e.child&&Oa(e.child,(()=>{Be(e.child)}));break;default:mt(g.LocMessage.assignmentTargetExpr(),e)}}function wt(e){switch(e.nodeType){case 38:Be(e);break;case 35:{const t=Be(e.leftExpression,2),n=Pt(e,t,{method:"del"},0),a={type:n.type,memberAccessDeprecationInfo:n.memberAccessDeprecationInfo};De(e.memberName,a,0),De(e,a,0);break}case 24:{const t=Be(e.baseExpression,2);Mt(e,t,{method:"del"},0),De(e,{type:$.UnboundType.create()},0);break}case 52:e.expressions.forEach((e=>{wt(e)}));break;case 0:e.child&&Oa(e.child,(()=>{Be(e.child)}));break;default:ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.delTargetExpr(),e)}}function St(e,t,n){Va(n)||e.accessedSymbolSet.add(t.id)}function At(e,t,n){var a;if($.TypeBase.isInstantiable(t)&&!t.scopeId&&!(0,W.isTypeAliasPlaceholder)(t)){const r=function(e,t){let n=e,a=0;(0,l.assert)($.TypeBase.isInstantiable(t));for(;n&&(n=F.getTypeVarScopeNode(n),n);){let e,r=!1;if(10===n.nodeType){const t=Yn(n);t&&!$.ClassType.isPartiallyEvaluated(t.classType)&&(e=t.classType.details.typeParameters),r=!!n.typeParameters,a++}else if(28===n.nodeType){const t=ra(n);if(t){e=t.details.typeParameters}r=!!n.typeParameters}else 77===n.nodeType&&(r=!!n.typeParameters);if(e){const n=e.find((e=>e.details.name===t.details.name));if(void 0!==(null==n?void 0:n.scopeId)&&void 0!==n.scopeName&&void 0!==n.scopeType)return{type:t=$.TypeVarType.cloneForScopeId(t,n.scopeId,n.scopeName,n.scopeType),foundInterveningClass:a>1&&!r}}n=n.parent}n=e;for(;n;){let a,r;if(77===n.nodeType?(a=Ne(n.name,0),r=n):3===n.nodeType&&(a=Ne(n.leftExpression,0)),a&&a&&(0,$.isTypeVar)(a)&&a.details.recursiveTypeAliasScopeId&&a.details.recursiveTypeAliasName){if(r&&!t.details.isTypeParamSyntax)ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeParameterNotDeclared().format({name:t.details.name,container:r.name.value}),e);else{const e=a.details.recursiveTypeParameters;if(e&&!e.some((e=>e.details.name===t.details.name)))return{type:t,foundInterveningClass:!1}}return{type:$.TypeVarType.cloneForScopeId(t,a.details.recursiveTypeAliasScopeId,a.details.recursiveTypeAliasName,2),foundInterveningClass:!1}}n=n.parent}return{type:t,foundInterveningClass:!1}}(e,t);if(t=r.type,0!=(2048&n)&&void 0!==t.scopeId){if(!t.details.isSynthesized&&!t.details.isParamSpec){if(t.details.isTypeParamSyntax)return t;const n=F.getTypeVarScopeNode(e);if(n&&n.typeParameters&&!n.typeParameters.parameters.some((t=>t.name===e)))return t;ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarUsedByOuterScope().format({name:t.details.name}),e)}}else if(0!=(8192&n)){if(void 0===t.scopeId)if(r.foundInterveningClass)ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarUsedByOuterScope().format({name:t.details.name}),e);else{let n=F.getEnclosingClassOrFunction(e);if(n&&35===(null===(a=e.parent)||void 0===a?void 0:a.nodeType)&&e.parent.leftExpression===e){const a=e.parent.memberName.value;if("args"===a||"kwargs"===a){const a=F.getEnclosingClassOrFunction(n);28===(null==a?void 0:a.nodeType)?n=a:r.type.scopeId||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.paramSpecNotUsedByOuterScope().format({name:t.details.name}),e)}}n?(n.typeParameters&&!n.typeParameters.parameters.some((e=>e.name.value===t.details.name))&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeParameterNotDeclared().format({name:t.details.name,container:n.name.value}),e),t=$.TypeVarType.cloneForScopeId(t,F.getScopeIdForNode(n),n.name.value,28===n.nodeType?1:0)):(0,l.fail)("AssociateTypeVarsWithCurrentScope flag was set but enclosing scope not found")}}else if(0==(4096&n)&&(void 0===t.scopeId||r.foundInterveningClass)&&!t.details.isSynthesized){const n=(0,$.isParamSpec)(t)?g.LocMessage.paramSpecNotUsedByOuterScope():g.LocMessage.typeVarNotUsedByOuterScope();ht(c.DiagnosticRule.reportGeneralTypeIssues,n.format({name:t.details.name}),e)}}return(0,$.isUnpackedVariadicTypeVar)(t)&&(t=$.TypeVarType.cloneForPacked(t)),t}function xt(e,t,n){var a;if(0!=(2&n))return t;if((0,$.isInstantiableClass)(t)&&(0!=(128&n)&&0==(512&n)&&!t.typeAliasInfo&&(0,W.requiresTypeArguments)(t)&&(t.typeArguments&&t.isTypeArgumentExplicit||ht(c.DiagnosticRule.reportMissingTypeArgument,g.LocMessage.typeArgsMissingForClass().format({name:t.aliasName||t.details.name}),e)),t.typeArguments||(t=null===(a=xa(t,void 0,n,e))||void 0===a?void 0:a.type)),0!=(128&n)&&t.typeAliasInfo&&t.typeAliasInfo.typeParameters&&t.typeAliasInfo.typeParameters.length>0&&!t.typeAliasInfo.typeArguments){let n=!1;const a=[],r=new G.TypeVarContext(t.typeAliasInfo.typeVarScopeId);t.typeAliasInfo.typeParameters.forEach((e=>{let t;e.details.isDefaultExplicit||(n=!0),t=e.details.isDefaultExplicit||e.details.isParamSpec?(0,W.applySolvedTypeVars)(e,r,{unknownIfNotFound:!0}):e.details.isVariadic&&le&&(0,$.isInstantiableClass)(le)?zt([{type:$.UnknownType.create(),isUnbounded:!0}],!0):$.UnknownType.create(),a.push(t),r.setTypeVarType(e,t)})),n&&ht(c.DiagnosticRule.reportMissingTypeArgument,g.LocMessage.typeArgsMissingForAlias().format({name:t.typeAliasInfo.name}),e),t=$.TypeBase.cloneForTypeAlias((0,W.applySolvedTypeVars)(t,r,{unknownIfNotFound:!0}),t.typeAliasInfo.name,t.typeAliasInfo.fullName,t.typeAliasInfo.moduleName,t.typeAliasInfo.fileUri,t.typeAliasInfo.typeVarScopeId,t.typeAliasInfo.isPep695Syntax,t.typeAliasInfo.typeParameters,a)}return t}function Pt(e,t,a,r){var s,i;let o=(0,W.transformPossibleRecursiveTypeAlias)(t.type);const d=e.memberName.value;let m=new p.DiagnosticAddendum;const y=v.getFileInfo(e);let h,f,T,b=!1,_=!!t.isIncomplete;let C;if(t.isIncomplete&&(0,$.isUnbound)(o))return{type:$.UnknownType.create(!0),isIncomplete:!0};switch(o.specialForm&&(o=o.specialForm),(0,$.isParamSpec)(o)&&o.paramSpecAccess&&(o=Ct(o)),o.category){case 2:case 1:case 3:h=o;break;case 0:break;case 9:if(o.details.isParamSpec){if("args"===d||"kwargs"===d){const t="args"===d,n=F.getEnclosingParameter(e),a=t?1:2;if(!n||n.category!==a){mt(t?g.LocMessage.paramSpecArgsUsage():g.LocMessage.paramSpecKwargsUsage(),e),h=$.UnknownType.create(_);break}h=$.TypeVarType.cloneForParamSpecAccess(o,d);break}_||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.paramSpecUnknownMember().format({name:d}),e),h=$.UnknownType.create(_);break}if(0!=(256&r)){_||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarNoMember().format({type:wr(o),name:d}),e.leftExpression),h=$.UnknownType.create(_);break}if(o.details.recursiveTypeAliasName){h=$.UnknownType.create(!0),_=!0;break}if(o.details.isVariadic)break;return Pt(e,{type:Ct(o),bindToSelfType:$.TypeBase.isInstantiable(o)?(0,W.convertToInstance)(o):o,isIncomplete:_},a,0);case 6:{let n;const r=(0,A.getTypeOfEnumMember)(Ar,e,o,d,_);if(r)if("get"===a.method)n=r;else if((0,$.isClassInstance)(r.type)&&$.ClassType.isSameGenericClass(r.type,o)&&void 0!==r.type.literalValue){const t="set"===a.method?g.LocMessage.enumMemberSet():g.LocMessage.enumMemberDelete();ht(c.DiagnosticRule.reportAttributeAccessIssue,t.format({name:d})+m.getString(),e.memberName,null!==(s=m.getEffectiveTextRange())&&void 0!==s?s:e.memberName)}n||(n=Ye(e.memberName,o,d,a,m,void 0,t.bindToSelfType)),n&&(n.typeErrors?b=!0:h=(0,W.addConditionToType)(n.type,(0,W.getTypeCondition)(o),!0),n.isAsymmetricAccessor&&(T=!0),n.isIncomplete&&(_=!0),n.narrowedTypeForSet&&(f=(0,W.addConditionToType)(n.narrowedTypeForSet,(0,W.getTypeCondition)(o),!0)),n.memberAccessDeprecationInfo&&(C=n.memberAccessDeprecationInfo));break}case 7:{const t=$.ModuleType.getField(o,d);if(t&&!t.isExternallyHidden())"get"===a.method&&St(y,t,e.memberName),h=Ka(t,void 0,!0).type,(0,$.isTypeVar)(h)&&(h=At(e,h,r)),(0,$.isUnbound)(h)&&(h=$.UnknownType.create(!0)),t.isPrivateMember()&&ht(c.DiagnosticRule.reportPrivateUsage,g.LocMessage.privateUsedOutsideOfModule().format({name:d}),e.memberName),t.isPrivatePyTypedImport()&&ht(c.DiagnosticRule.reportPrivateImportUsage,g.LocMessage.privateImportFromPyTypedModule().format({name:d,module:o.moduleName}),e.memberName);else{if("get"===a.method){const e=$.ModuleType.getField(o,"__getattr__");if(e){if(y.executionEnvironment.pythonVersion.isGreaterOrEqualTo(u.pythonVersion3_7)||e.getDeclarations().some((e=>e.uri.hasExtension(".pyi")))){const t=Ka(e);(0,$.isFunction)(t.type)&&(h=Za(t.type),t.isIncomplete&&(_=!0))}}}!h&&o.notPresentFieldType&&(h=o.notPresentFieldType),h||(_||ht(c.DiagnosticRule.reportAttributeAccessIssue,g.LocMessage.moduleUnknownMember().format({memberName:d,moduleName:o.moduleName}),e.memberName),h=n.evaluateUnknownImportsAsAny?$.AnyType.create():$.UnknownType.create())}break}case 8:h=(0,W.mapSubtypes)(o,(n=>{if((0,$.isUnbound)(n))return;if((0,W.isNoneInstance)(n)&&ne&&(0,$.isClassInstance)(ne)){const t=Ye(e.memberName,ne,d,a,m);return t&&!t.typeErrors?(h=(0,W.addConditionToType)(t.type,(0,W.getTypeCondition)(o)),t.isIncomplete&&(_=!0),h):void(_||ht(c.DiagnosticRule.reportOptionalMemberAccess,g.LocMessage.noneUnknownMember().format({name:d}),e.memberName))}const r=Pt(e,{type:n,isIncomplete:t.isIncomplete},a,0);return r.isIncomplete&&(_=!0),r.memberAccessDeprecationInfo&&(C=r.memberAccessDeprecationInfo),r.typeErrors&&(b=!0),r.type}));break;case 4:case 5:if("__self__"===d){const e=(0,$.isFunction)(o)?o:o.overloads[0];void 0!==e.preBoundFlags&&0==(4&e.preBoundFlags)&&(h=e.boundToType)}else h=Pt(e,{type:null!=oe?oe:$.AnyType.create()},a,r).type;break;default:(0,l.assertNever)(o)}if(!h){const n=(0,$.isFunction)(o)||(0,$.isOverloadedFunction)(o)||(0,$.isClassInstance)(o)&&$.ClassType.isBuiltIn(o,"function");if(!t.isIncomplete){let t=g.LocMessage.memberAccess();if("set"===a.method?t=g.LocMessage.memberSet():"del"===a.method&&(t=g.LocMessage.memberDelete()),a.setExpectedTypeDiag&&(m=a.setExpectedTypeDiag),(0,$.isClass)(o)&&o.details.typedDictEntries){if(o.details.typedDictEntries.knownItems.get(d)){const e=new p.DiagnosticAddendum;e.addMessage(g.LocAddendum.typedDictKeyAccess().format({name:d})),m.addAddendum(e)}}ht(n?c.DiagnosticRule.reportFunctionMemberAccess:c.DiagnosticRule.reportAttributeAccessIssue,t.format({name:d,type:wr(o)})+m.getString(),e.memberName,null!==(i=m.getEffectiveTextRange())&&void 0!==i?i:e.memberName)}h=n?$.AnyType.create():$.UnknownType.create()}return 0==(256&r)&&qe(h,e.memberName),{type:h,isIncomplete:_,isAsymmetricAccessor:T,narrowedTypeForSet:f,isRequired:!1,isNotRequired:!1,memberAccessDeprecationInfo:C,typeErrors:b}}function Nt(e,t,n,a,r,s,i,o=0){var p,c,d;const u=$.TypeBase.isInstance(t);let m,y=(0,W.lookUpClassMember)(t,n,64|s);if(y||(y=(0,W.lookUpClassMember)(t,n,s)),!y){if(0==(512&s)&&e){const r=function(e,t,n,a,r){var s,i,o,p,c;const d=n=>{var a;return null===(a=Ye(e,t,n,void 0,void 0,540,r))||void 0===a?void 0:a.type};let u;"get"===n.method?u=null!==(s=d("__getattribute__"))&&void 0!==s?s:d("__getattr__"):"set"===n.method?u=d("__setattr__"):((0,l.assert)("del"===n.method),u=d("__delattr__"));if(!u)return;const m=[];m.push({argumentCategory:0,typeResult:{type:de&&(0,$.isInstantiableClass)(de)?$.ClassType.cloneWithLiteral($.ClassType.cloneAsInstance(de),a):$.AnyType.create()}}),"set"===n.method&&m.push({argumentCategory:0,typeResult:{type:null!==(o=null===(i=n.setType)||void 0===i?void 0:i.type)&&void 0!==o?o:$.UnknownType.create(),isIncomplete:!!(null===(p=n.setType)||void 0===p?void 0:p.isIncomplete)}});if(!(0,$.isFunction)(u)&&!(0,$.isOverloadedFunction)(u))return(0,$.isAnyOrUnknown)(u)?{type:u}:void 0;const y=new G.TypeVarContext((0,W.getTypeVarScopeId)(u)),g=Zt(e,m,{type:u},y,!0,void 0,void 0);let h=!1;"set"===n.method&&(h=function(e){var t;if(void 0!==e.isAsymmetricAttributeAccessor)return e.isAsymmetricAttributeAccessor;let n=!1;const a=(0,W.lookUpClassMember)(e,"__getattr__",2),r=(0,W.lookUpClassMember)(e,"__setattr__",2);if(a&&r){const e=Ga(a.symbol),s=Ga(r.symbol);if((0,$.isFunction)(e)&&(0,$.isFunction)(s)&&s.details.parameters.length>=3&&e.details.declaredReturnType){const a=$.FunctionType.getEffectiveParameterType(s,2),r=null!==(t=$.FunctionType.getSpecializedReturnType(e))&&void 0!==t?t:$.UnknownType.create();(0,$.isTypeSame)(a,r)||(n=!0)}}else n=!1;return e.isAsymmetricAttributeAccessor=n,n}(t));return{type:null!==(c=g.returnType)&&void 0!==c?c:$.UnknownType.create(),typeErrors:g.argumentErrors,isAsymmetricAccessor:h}}(e,t,a,n,i);if(r)return{symbol:void 0,type:r.type,isTypeIncomplete:!1,isDescriptorError:!1,isClassMember:!1,isClassVar:!1,isAsymmetricAccessor:!!r.isAsymmetricAccessor}}return void(null==r||r.addMessage(g.LocAddendum.memberUnknown().format({name:n})))}let h,f=!1;if(y.symbol.isInitVar())return void(null==r||r.addMessage(g.LocAddendum.memberIsInitVar().format({name:n})));if("get"!==a.method&&e){const r=F.getEnclosingClass(e);if(r){const o=null===(p=Yn(r))||void 0===p?void 0:p.classType;if(o&&(0,$.isInstantiableClass)(o)&&$.ClassType.isSameGenericClass(o,t)){if(m=null===(c=$a(y.symbol))||void 0===c?void 0:c.type,m&&(0,$.isInstantiableClass)(y.classType)&&(m=(0,W.partiallySpecializeType)(m,y.classType)),"set"===a.method&&(0,L.isEffectivelyClassVar)(y.symbol,$.ClassType.isDataClass(o))&&u){const a=Qa(e,y,(null!=i?i:"__new__"===n)?void 0:t,s);a&&(0,W.isDescriptorInstance)(a.type,!0)&&(m=a.type,s&=128)}m||(m=$.UnknownType.create())}}}if(!m){let a;i?a=(0,W.convertToInstantiable)(i):"__new__"!==n&&(a=t);const r=Qa(e,y,a,s);m=null!==(d=null==r?void 0:r.type)&&void 0!==d?d:$.UnknownType.create(),(null==r?void 0:r.isIncomplete)&&(f=!0)}if((0,$.isClass)(y.classType)&&$.ClassType.isTypedDictClass(y.classType)){const e=y.symbol.getTypedDeclarations();if(e.length>0&&1===e[0].type)return void(null==r||r.addMessage(g.LocAddendum.memberUnknown().format({name:n})))}"get"===a.method&&(e&&(0,$.isInstantiableClass)(y.classType)&&$.ClassType.isSameGenericClass(y.classType,t)&&St(v.getFileInfo(e),y.symbol,e),"__init_subclass__"!==n&&"__class_getitem__"!==n||(0,$.isFunction)(m)&&!$.FunctionType.isClassMethod(m)&&(m=$.FunctionType.cloneWithNewFlags(m,2|m.details.flags)));let T,b=!1,_=!1,C=!1;return m=(0,W.mapSubtypes)(m,(l=>{const p=Ct(l),c=!y||y.isClassMember;let d;if((0,$.isClass)(p)&&c&&e){const o=function(e,t,n,a,r,s,i,o,l,p){var c,d,u,m,y,h,f;const T=$.TypeBase.isInstance(a);let v;v="get"===l.method?"__get__":"set"===l.method?"__set__":"__delete__";const b=Ye(i,t,v,void 0,null==p?void 0:p.createAddendum(),528);if(!b||b.typeErrors){if($.ClassType.isPropertyClass(t)&&"get"!==l.method){const e="set"===l.method?g.LocAddendum.propertyMissingSetter():g.LocAddendum.propertyMissingDeleter();return null==p||p.addMessage(e.format({name:o})),{type:$.AnyType.create(),typeErrors:!0}}return{type:e}}const _=b.classType;let C=b.type;if(b.typeErrors||!_)return{type:$.UnknownType.create(),typeErrors:!0};if(!(0,$.isFunction)(C)&&!(0,$.isOverloadedFunction)(C))return(0,$.isAnyOrUnknown)(C)?{type:C}:{type:e,typeErrors:!0};if($.ClassType.isPropertyClass(t)&&n&&(0,$.isInstantiableClass)(n.classType)&&C){if(0!=(16&s)&&$.ClassType.isProtocolClass(a))return null==p||p.addMessage(g.LocAddendum.propertyAccessFromProtocolClass()),{type:e,typeErrors:!0};let i;if(Ha(C),i="get"===l.method?null===(c=t.fgetInfo)||void 0===c?void 0:c.classType:"set"===l.method?null===(d=t.fsetInfo)||void 0===d?void 0:d.classType:null===(u=t.fdelInfo)||void 0===u?void 0:u.classType,i){const e=new G.TypeVarContext((0,W.getTypeVarScopeId)(i));i=(0,W.selfSpecializeClass)(i),nr($.ClassType.cloneAsInstance(i),$.ClassType.cloneAsInstance(n.classType),void 0,e),i=(0,W.applySolvedTypeVars)(i,e);const t=(0,W.partiallySpecializeType)(C,i,r?(0,W.convertToInstantiable)(r):a);((0,$.isFunction)(t)||(0,$.isOverloadedFunction)(t))&&(C=t)}}let I=!1;"set"===l.method&&(0,$.isClass)(_)&&function(e){var t;if(void 0!==e.isAsymmetricDescriptor)return e.isAsymmetricDescriptor;let n=!1;const a=(0,W.lookUpClassMember)(e,"__get__",2),r=(0,W.lookUpClassMember)(e,"__set__",2);if(a&&r){const e=Ga(a.symbol),s=Ga(r.symbol);if((0,$.isFunction)(e)&&(0,$.isFunction)(s)&&s.details.parameters.length>=3&&e.details.declaredReturnType){const a=$.FunctionType.getEffectiveParameterType(s,2),r=null!==(t=$.FunctionType.getSpecializedReturnType(e))&&void 0!==t?t:$.UnknownType.create();(0,$.isTypeSame)(a,r)||(n=!0)}}else n=!1;return e.isAsymmetricDescriptor=n,n}(_)&&(I=!0);if(!C)return null==p||p.addMessage(g.LocAddendum.descriptorAccessBindingFailed().format({name:v,className:wr((0,W.convertToInstance)(_))})),{type:$.UnknownType.create(),typeErrors:!0,isDescriptorApplied:!0,isAsymmetricAccessor:I};const k=[];let w;w=$.ClassType.isClassProperty(t)?T?$.ClassType.cloneAsInstantiable(a):a:T?null!=r?r:$.ClassType.cloneAsInstance(a):rt();if(k.push({argumentCategory:0,typeResult:{type:w}}),"get"===l.method){let e;e=r?(0,W.convertToInstantiable)(r):T?$.ClassType.cloneAsInstantiable(a):a,k.push({argumentCategory:0,typeResult:{type:e}})}else"set"===l.method&&k.push({argumentCategory:0,typeResult:{type:null!==(y=null===(m=l.setType)||void 0===m?void 0:m.type)&&void 0!==y?y:$.UnknownType.create(),isIncomplete:!!(null===(h=l.setType)||void 0===h?void 0:h.isIncomplete)}});const S=Oa(i,(()=>Zt(i,k,{type:C},void 0,!0,void 0,void 0)));let A;if(S.overloadsUsedForCall&&S.overloadsUsedForCall.length>=1){const e=S.overloadsUsedForCall[0];e.details.deprecatedMessage&&(A={deprecationMessage:e.details.deprecatedMessage,accessType:$.ClassType.isPropertyClass(t)?"property":"descriptor",accessMethod:l.method})}if(!S.argumentErrors)return{type:"get"===l.method?null!==(f=S.returnType)&&void 0!==f?f:$.UnknownType.create():$.AnyType.create(),isDescriptorApplied:!0,isAsymmetricAccessor:I,memberAccessDeprecationInfo:A};if("set"===l.method)if(l.setType&&(0,$.isFunction)(C)&&C.details.parameters.length>=2&&!l.setType.isIncomplete){const e=$.FunctionType.getEffectiveParameterType(C,1);null==p||p.addMessage(g.LocAddendum.typeIncompatible().format({destType:wr(e),sourceType:wr(l.setType.type)}))}else(0,$.isOverloadedFunction)(C)&&(null==p||p.addMessage(g.LocMessage.noOverload().format({name:v})));else null==p||p.addMessage(g.LocAddendum.descriptorAccessCallFailed().format({name:v,className:wr((0,W.convertToInstance)(_))}));return{type:$.UnknownType.create(),typeErrors:!0,isDescriptorApplied:!0,isAsymmetricAccessor:I,memberAccessDeprecationInfo:A}}(l,p,y,t,i,s,e,n,a,r);o.isAsymmetricAccessor&&(_=!0),o.memberAccessDeprecationInfo&&(T=o.memberAccessDeprecationInfo),o.typeErrors&&(b=!0),o.isDescriptorApplied&&(C=!0),d=o.type}else if((0,$.isFunction)(p)||(0,$.isOverloadedFunction)(p)){const e=function(e,t,n,a,r,s,i,o,l,p=0){if("set"===o.method){const e=(0,$.isFunction)(t)?t:$.OverloadedFunctionType.getImplementation(t);if(e&&$.FunctionType.isFinal(e)&&n&&(0,$.isClass)(n.classType))return null==l||l.addMessage(g.LocMessage.finalMethodOverride().format({name:i,className:n.classType.details.name})),{type:$.UnknownType.create(),typeErrors:!0}}if($.TypeBase.isInstance(a)&&(!n||n.isInstanceMember))return{type:e};const c=gr(a,t,n&&(0,$.isInstantiableClass)(n.classType)?n.classType:void 0,0!=(256&s),r&&(0,$.isClass)(r)?$.ClassType.cloneIncludeSubclasses(r):r,l,p);return{type:null!=c?c:$.UnknownType.create(),typeErrors:!c}}(l,p,y,t,i,s,n,a,r,o);d=e.type,e.typeErrors&&(b=!0)}else d=l;if("get"===a.method)return d;!C&&y&&(0,L.isEffectivelyClassVar)(y.symbol,$.ClassType.isDataClass(t))&&0!=(128&s)&&(null==r||r.addMessage(g.LocAddendum.memberSetClassVar().format({name:n})),b=!0);const u=null==y?void 0:y.symbol.getDeclarations().find((e=>Tr(e)));if(u&&e&&!F.isNodeContainedWithin(e,u.node)){const t=F.getEnclosingFunction(e);t&&"__init__"===t.name.value||(null==r||r.addMessage(g.LocMessage.finalReassigned().format({name:n})),b=!0)}return(null==y?void 0:y.isInstanceMember)&&(0,$.isClass)(y.classType)&&$.ClassType.isReadOnlyInstanceVariables(y.classType)&&(null==r||r.addMessage(g.LocAddendum.readOnlyAttribute().format({name:n})),b=!0),d})),!b&&"set"===a.method&&a.setType&&(e&&y.symbol.hasTypedDeclarations()&&(h=C?a.setType.type:dr(e,m,a.setType.type)),nr(m,a.setType.type,null==r?void 0:r.createAddendum())||(a.setType.isIncomplete||null==r||r.addMessage(g.LocAddendum.memberAssignment().format({type:wr(a.setType.type),name:n,classType:Ir(t)})),h=m,b=!0),(0,$.isInstantiableClass)(y.classType)&&$.ClassType.isFrozenDataClass(y.classType)&&u&&(null==r||r.addMessage(g.LocAddendum.dataClassFrozen().format({name:wr($.ClassType.cloneAsInstance(y.classType))})),b=!0)),{symbol:y.symbol,type:m,isTypeIncomplete:f,isDescriptorError:b,isClassMember:!y.isInstanceMember,isClassVar:y.isClassVar,classType:y.classType,isAsymmetricAccessor:_,narrowedTypeForSet:h,memberAccessDeprecationInfo:T}}function Dt(e,t,n){const a=t.findIndex((e=>(0,$.isVariadicTypeVar)(e)));let r,s=e.findIndex((e=>!!((0,$.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments&&1===e.type.tupleTypeArguments.length&&e.type.tupleTypeArguments[0].isUnbounded)&&(r=e.type.tupleTypeArguments[0].type,!0)));if(r&&s>=0&&a>=0&&e.length<t.length){for(;a>s;)e=[...e.slice(0,s),{node:e[s].node,type:r},...e.slice(s)],s++;for(;e.length<t.length;)e=[...e.slice(0,s+1),{node:e[s].node,type:r},...e.slice(s+1)]}if(a>=0){const r=t[a];let s=t.length;for(;s>0;){const e=t[s-1];if(!e.details.isParamSpec||!e.details.isDefaultExplicit)break;s--}if(a<e.length){let t=a+1+e.length-s;for(;t>a&&e[t-1].typeList;)t--;const n=e.slice(a,t);if(1===n.length&&(0,$.isVariadicTypeVar)(n[0].type))Ft(n[0].type,n[0].node);else{n.forEach(((e,t)=>{An(e,{allowEmptyTuple:0===t,allowVariadicTypeVar:!0,allowUnpackedTuples:!0})}));const r=[];1===n.length&&n[0].isEmptyTupleShorthand||n.forEach((e=>{(0,$.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments?(0,o.appendArray)(r,e.type.tupleTypeArguments):r.push({type:(0,W.convertToInstance)(e.type),isUnbounded:!1})}));const s=zt(r,!0);e=[...e.slice(0,a),{node:e[a].node,type:s},...e.slice(t,e.length)]}}else r.details.isDefaultExplicit||e.push({node:n,type:zt([],!0)})}return e}function Ft(e,t){return!!e.isVariadicUnpacked||(mt(g.LocMessage.unpackedTypeVarTupleExpected().format({name1:e.details.name,name2:e.details.name}),t),!1)}function Et(e,t,n){var a,r,s;if(!(null===(a=t.typeAliasInfo)||void 0===a?void 0:a.typeParameters)||0===t.typeAliasInfo.typeParameters.length&&t.typeAliasInfo.typeArguments)return;if(!$.TypeBase.isInstantiable(t))return;if(t.typeAliasInfo.typeArguments)return;const i=t.typeAliasInfo.typeParameters;let o=Dt(Lt(e,n),i,e);1===i.length&&i[0].details.isParamSpec&&o&&o.every((e=>!(0,W.isEllipsisType)(e.type)&&!e.typeList&&!(0,$.isParamSpec)(e.type)))&&(o=[{type:$.UnknownType.create(),node:o[0].node,typeList:o}]);let l=i.length;const c=i.findIndex((e=>!!e.details.isDefaultExplicit));if(c>=0&&(l=c),o.length>i.length?mt(g.LocMessage.typeArgsTooMany().format({name:wr(t),expected:i.length,received:o.length}),o[i.length].node):o.length<l&&mt(g.LocMessage.typeArgsTooFew().format({name:wr(t),expected:i.length,received:o.length}),e.items[e.items.length-1]),(0,$.isInstantiableClass)(t)&&"mypy_extensions.FlexibleAlias"===t.details.fullName&&o.length>=1)return{node:e,type:o[0].type};const d=new G.TypeVarContext(t.typeAliasInfo.typeVarScopeId),u=new p.DiagnosticAddendum;i.forEach(((e,a)=>{if(e.details.isParamSpec&&a<o.length){const t=o[a].type,n=o[a].typeList;if(n){const t=$.FunctionType.createSynthesizedInstance("",65536);n.forEach(((e,n)=>{$.FunctionType.addParameter(t,{category:0,name:`__p${n}`,isNameSynthesized:!0,type:(0,W.convertToInstance)(e.type),hasDeclaredType:!0})})),n.length>0&&$.FunctionType.addPositionOnlyParameterSeparator(t),(0,C.assignTypeToTypeVar)(Ar,e,t,u,d,256)}else if((0,$.isParamSpec)(t))(0,C.assignTypeToTypeVar)(Ar,e,(0,W.convertToInstance)(t),u,d,256);else if((0,$.isInstantiableClass)(t)&&$.ClassType.isBuiltIn(t,"Concatenate")){const n=t.typeArguments,a=$.FunctionType.createInstance("","","",0);n&&n.length>0&&n.forEach(((e,t)=>{t===n.length-1?($.FunctionType.addPositionOnlyParameterSeparator(a),(0,$.isParamSpec)(e)?a.details.paramSpec=e:(0,W.isEllipsisType)(e)&&($.FunctionType.addDefaultParameters(a),a.details.flags|=32768)):$.FunctionType.addParameter(a,{category:0,name:`__p${t}`,isNameSynthesized:!0,hasDeclaredType:!0,type:e})})),(0,C.assignTypeToTypeVar)(Ar,e,a,u,d,256)}else if((0,W.isEllipsisType)(t)){const t=$.FunctionType.createSynthesizedInstance("",98304);$.FunctionType.addDefaultParameters(t),(0,C.assignTypeToTypeVar)(Ar,e,t,u,d)}else mt(g.LocMessage.typeArgListExpected(),o[a].node)}else{let r;if(a<o.length&&o[a].typeList&&mt(g.LocMessage.typeArgListNotAllowed(),o[a].node),r=a<o.length?(0,W.convertToInstance)(o[a].type):e.details.isDefaultExplicit?(0,W.applySolvedTypeVars)(e,d,{unknownIfNotFound:!0}):$.UnknownType.create(),0!=(16384&n)){const e=function(e){if(!e.typeAliasInfo||!e.typeAliasInfo.typeParameters)return;if(e.typeAliasInfo.usageVariance)return e.typeAliasInfo.usageVariance;const t=e.typeAliasInfo.typeParameters,n=t.map((()=>1));return e.typeAliasInfo.usageVariance=n,Ot(e,t,n),n}(t);if(e&&a<e.length){const t=e[a];if(!(0,W.isVarianceOfTypeArgumentCompatible)(r,t)){const e=u.createAddendum();e.addMessage(g.LocAddendum.varianceMismatchForTypeAlias().format({typeVarName:wr(r),typeAliasParam:wr(i[a])})),e.addTextRange(o[a].node)}}}if((0,$.isUnpacked)(r)&&!(0,$.isVariadicTypeVar)(e)){const e=u.createAddendum();e.addMessage(g.LocMessage.unpackedArgInTypeArgument()),e.addTextRange(o[a].node),r=$.UnknownType.create()}(0,C.assignTypeToTypeVar)(Ar,e,r,u,d,256)}})),u.isEmpty()||mt(g.LocMessage.typeNotSpecializable().format({type:wr(t)})+u.getString(),e,null!==(r=u.getEffectiveTextRange())&&void 0!==r?r:e);const m=d.getPrimarySignature(),y=[];null===(s=t.typeAliasInfo.typeParameters)||void 0===s||s.forEach((e=>{let t;if((0,$.isParamSpec)(e)){const n=m.getParamSpecType(e);t=n?(0,W.convertParamSpecValueToType)(n):$.UnknownType.create(),t||(t=(0,W.getUnknownTypeForParamSpec)(),m.setTypeVarType(e,t))}else t=m.getTypeVarType(e),t||(t=$.UnknownType.create(),m.setTypeVarType(e,t));y.push(t)}));return{type:$.TypeBase.cloneForTypeAlias((0,W.applySolvedTypeVars)(t,d),t.typeAliasInfo.name,t.typeAliasInfo.fullName,t.typeAliasInfo.moduleName,t.typeAliasInfo.fileUri,t.typeAliasInfo.typeVarScopeId,t.typeAliasInfo.isPep695Syntax,t.typeAliasInfo.typeParameters,y),node:e}}function Mt(e,t,n,a){const r=Et(e,t.type,a);if(r)return r;if((0,$.isTypeVar)(t.type)&&(0,W.isTypeAliasPlaceholder)(t.type)){const n=Lt(e,a).map((e=>(0,W.convertToInstance)(e.type)));return{type:$.TypeBase.cloneForTypeAlias(t.type,t.type.details.recursiveTypeAliasName,"","",y.Uri.empty(),t.type.details.recursiveTypeAliasScopeId,!!t.type.details.recursiveTypeAliasIsPep695Syntax,t.type.details.recursiveTypeParameters,n)}}let s=t.isIncomplete,i=!1,o=!1,l=!1;const p=It(t.type,void 0,((t,r)=>{var p;const d=(0,$.isTypeVar)(r)?r:void 0;if((0,$.isAnyOrUnknown)(t))return t;if(128&a&&(0,$.isTypeVar)(r))return ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarNotSubscriptable().format({type:wr(r)}),e.baseExpression),Lt(e,a),$.UnknownType.create();if((0,$.isInstantiableClass)(t)){if(t.details.effectiveMetaclass&&(0,$.isInstantiableClass)(t.details.effectiveMetaclass)&&!$.ClassType.isBuiltIn(t.details.effectiveMetaclass,["type","_InitVarMeta"])&&0==(128&a)){const r=Je(t,Vt(n));if(0!=(256&a)&&ht(c.DiagnosticRule.reportInvalidTypeArguments,g.LocMessage.typeArgsExpectingNone().format({name:wr($.ClassType.cloneAsInstance(t))}),e),r)return Ut(e,t,d,n).type}if("set"===n.method?ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.genericClassAssigned(),e.baseExpression):"del"===n.method&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.genericClassDeleted(),e.baseExpression),$.ClassType.isSpecialBuiltIn(t,"Literal"))return function(e,t,n){if(0===t.items.length)return mt(g.LocMessage.literalEmptyArgs(),t.baseExpression),$.UnknownType.create();const a=[];for(const r of t.items){let s;const i=r.valueExpression;if(0!==r.argumentCategory)mt(g.LocMessage.unpackedArgInTypeArgument(),i),s=$.UnknownType.create();else if(r.name)mt(g.LocMessage.keywordArgInTypeArgument(),i),s=$.UnknownType.create();else if(48===i.nodeType){const n=0!=(32&i.strings[0].token.flags),a=i.strings.map((e=>e.value)).join("");s=Dn(t,e,n?"bytes":"str",a),i.strings.forEach((e=>{0!=(512&e.token.flags)&&ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.literalNamedUnicodeEscape(),e)}))}else 40===i.nodeType?!i.isImaginary&&i.isInteger&&(s=Dn(t,e,"int",i.value)):11===i.nodeType?33===i.constType?s=Dn(t,e,"bool",!0):15===i.constType?s=Dn(t,e,"bool",!1):26===i.constType&&(s=null!=te?te:$.UnknownType.create()):55===i.nodeType&&(33!==i.operator&&0!==i.operator||40===i.expression.nodeType&&!i.expression.isImaginary&&i.expression.isInteger&&(s=Dn(t,e,"int",33===i.operator?-i.expression.value:i.expression.value)));if(!s){const e=Be(i,4&n);if((0,$.isClassInstance)(e.type)&&$.ClassType.isEnumClass(e.type)&&void 0!==e.type.literalValue)s=$.ClassType.cloneAsInstantiable(e.type);else{let t=!0;(0,W.doForEachSubtype)(e.type,(e=>{(0,$.isInstantiableClass)(e)&&void 0!==e.literalValue||(0,W.isNoneTypeClass)(e)||(t=!1)})),t&&(s=e.type)}}s||(mt(g.LocMessage.literalUnsupportedType(),r),s=$.UnknownType.create()),a.push(s)}let r=(0,$.combineTypes)(a);(0,$.isUnion)(r)&&se&&(0,$.isInstantiableClass)(se)&&(r=$.TypeBase.cloneAsSpecialForm(r,$.ClassType.cloneAsInstance(se)));return r}(t,e,a);if($.ClassType.isBuiltIn(t,"InitVar")){const t=Lt(e,a);return 0!=(256&a)&&0==(32768&a)&&mt(g.LocMessage.initVarNotAllowed(),e.baseExpression),1===t.length?t[0].type:(mt(g.LocMessage.typeArgsMismatchOne().format({received:t.length}),e.baseExpression),$.UnknownType.create())}if($.ClassType.isEnumClass(t))return $.ClassType.cloneAsInstance(t);const r=(0,$.isInstantiableClass)(t)&&$.ClassType.isBuiltIn(t,"Annotated"),s=(0,$.isInstantiableClass)(t)&&$.ClassType.hasCustomClassGetItem(t),u=(null===(p=t.details.typeParameters)||void 0===p?void 0:p.length)>0||$.ClassType.isSpecialBuiltIn(t)||$.ClassType.isBuiltIn(t,"type")||$.ClassType.isPartiallyEvaluated(t),m=(0,$.isInstantiableClass)(t)&&$.ClassType.isBuiltIn(t,"Final"),y=(0,$.isInstantiableClass)(t)&&$.ClassType.isBuiltIn(t,"ClassVar"),h=v.getFileInfo(e).diagnosticRuleSet.enableExperimentalFeatures&&$.ClassType.isBuiltIn(t,"dict")&&!$.ClassType.isBuiltIn(t,"Dict");let f=Lt(e,a,{isAnnotatedClass:r,hasCustomClassGetItem:s||!u,isFinalAnnotation:m,isClassVarAnnotation:y,supportsTypedDictTypeArg:h});if(r||(f=Dt(f,t.details.typeParameters,e)),s)return t;if(t.typeArguments)return ht(c.DiagnosticRule.reportInvalidTypeArguments,g.LocMessage.classAlreadySpecialized().format({type:wr((0,W.convertToInstance)(t),{expandTypeAlias:!0})}),e.baseExpression),t;const T=xa(t,f,a,e);return T.isRequired?i=!0:T.isNotRequired&&(o=!0),T.isReadOnly&&(l=!0),T.type}if((0,W.isNoneInstance)(t))return s||ht(c.DiagnosticRule.reportOptionalSubscript,g.LocMessage.noneNotSubscriptable(),e.baseExpression),$.UnknownType.create();if((0,$.isClassInstance)(t)){const a=Ut(e,t,d,n);return a.isIncomplete&&(s=!0),a.type}return(0,$.isNever)(t)?$.NeverType.createNever():((0,$.isUnbound)(t)||s||ht(c.DiagnosticRule.reportIndexIssue,g.LocMessage.typeNotSubscriptable().format({type:wr(t)}),e.baseExpression),$.UnknownType.create())}));return t.isIncomplete||e.items.forEach((e=>{Pe(e.valueExpression)||Be(e.valueExpression,4&a)})),{type:p,isIncomplete:s,isReadOnly:l,isRequired:i,isNotRequired:o}}function Ot(e,t,n,a=0){function r(e,r){(0,W.doForEachSubtype)(e,(e=>{const s=t.findIndex((t=>(0,$.isTypeSame)(t,e)));s>=0?n[s]=(0,W.combineVariances)(n[s],r):Ot(e,t,n,a)}))}a>$.maxTypeRecursionCount||(a++,(0,W.doForEachSubtype)(e,(e=>{if(4===e.category){if(e.specializedTypes){e.specializedTypes.parameterTypes.forEach((e=>{r(e,4)}));const t=e.specializedTypes.returnType;t&&r(t,3)}}else 6===e.category&&e.typeArguments&&(Qn(e),e.typeArguments.forEach(((t,n)=>{var a;if((0,W.isTupleClass)(e))r(t,3);else if(n<e.details.typeParameters.length){const s=e.details.typeParameters[n];(0,$.isUnpackedClass)(t)&&t.tupleTypeArguments?t.tupleTypeArguments.forEach((e=>{r(e.type,2)})):r(t,null!==(a=s.computedVariance)&&void 0!==a?a:s.details.declaredVariance)}})))})))}function zt(e,t=!1){return le&&(0,$.isInstantiableClass)(le)?(0,W.convertToInstance)((0,W.specializeTupleClass)(le,e,!0,t)):$.UnknownType.create()}function Vt(e){return"get"===e.method?"__getitem__":"set"===e.method?"__setitem__":((0,l.assert)("del"===e.method),"__delitem__")}function Ut(e,t,n,a){var r,s,i,o;if((0,$.isClassInstance)(t)&&$.ClassType.isTypedDictClass(t)){const n=(0,K.getTypeOfIndexedTypedDict)(Ar,e,t,a);if(n)return n}const l=Vt(a),p=Je(t,l,n);if(!p)return ht(c.DiagnosticRule.reportIndexIssue,g.LocMessage.methodNotDefinedOnType().format({name:l,type:wr(t)}),e.baseExpression),{type:$.UnknownType.create()};if(1===e.items.length&&!e.trailingComma&&!e.items[0].name&&0===e.items[0].argumentCategory&&(0,$.isClassInstance)(t)){const n=e.items[0].valueExpression,a=Be(n).type;if((0,$.isClassInstance)(a)&&$.ClassType.isBuiltIn(a,"int")&&(0,W.isLiteralType)(a)&&"number"==typeof a.literalValue){const e=a.literalValue,n=(0,W.getSpecializedTupleType)(t);if(n&&n.tupleTypeArguments&&(0,W.isTupleIndexUnambiguous)(n,e)){if(e>=0&&e<n.tupleTypeArguments.length)return{type:n.tupleTypeArguments[e].type};if(e<0&&n.tupleTypeArguments.length+e>=0)return{type:n.tupleTypeArguments[n.tupleTypeArguments.length+e].type}}}else if((0,$.isClassInstance)(a)&&$.ClassType.isBuiltIn(a,"slice")){const e=(0,W.getSpecializedTupleType)(t);if(e&&46===n.nodeType){const t=function(e,t){if(t.stepValue||!e.tupleTypeArguments)return;const n=e.tupleTypeArguments,a=Rt(t.startValue,0,n),r=Rt(t.endValue,n.length,n);if(void 0===a||void 0===r||r<a)return;return zt(n.slice(a,r))}(e,n);if(t)return{type:t}}}}const d=e.items.filter((e=>0===e.argumentCategory&&!e.name)),u=e.items.filter((e=>1===e.argumentCategory)),m=e.items.filter((e=>0===e.argumentCategory&&!!e.name)),y=e.items.filter((e=>2===e.argumentCategory));let h,f=!1;if(1!==d.length||0!==u.length||e.trailingComma)if(0===d.length&&0===u.length)h=zt([]);else{const e=[];d.forEach((t=>{const n=Be(t.valueExpression);e.push({type:n.type,isUnbounded:!1}),n.isIncomplete&&(f=!0)})),u.forEach((t=>{var n,a;const r=Be(t.valueExpression);r.isIncomplete&&(f=!0);const s=null!==(a=null===(n=nt(r,!1,t.valueExpression))||void 0===n?void 0:n.type)&&void 0!==a?a:$.UnknownType.create();e.push({type:s,isUnbounded:!0})})),h=zt(e)}else{const e=Be(d[0].valueExpression);h=e.type,e.isIncomplete&&(f=!0)}let T,v=[{argumentCategory:0,typeResult:{type:h,isIncomplete:f}}];if("set"===a.method){let e=null!==(s=null===(r=a.setType)||void 0===r?void 0:r.type)&&void 0!==s?s:$.AnyType.create();if((0,$.isTypeVar)(e)&&e.details.constraints.length>0){e=Ct(e,void 0,(0,$.isClassInstance)(t)?t.condition:void 0)}v.push({argumentCategory:0,typeResult:{type:e,isIncomplete:!!(null===(i=a.setType)||void 0===i?void 0:i.isIncomplete)}})}return m.forEach((e=>{v.push({argumentCategory:0,valueExpression:e.valueExpression,node:e,name:e.name})})),y.forEach((e=>{v.push({argumentCategory:2,valueExpression:e.valueExpression,node:e})})),0===m.length&&0===y.length&&1===d.length&&za(e,(()=>{if(T=Zt(e,v,{type:p},void 0,!0,void 0,void 0),T.argumentErrors&&(0,$.isClassInstance)(h)){const t=[...v];t[0]={...t[0]};if(Je(h,"__index__")){const n=Ea(e,"int");(0,$.isClassInstance)(n)&&(t[0].typeResult={type:n})}T=Zt(e,t,{type:p},void 0,!0,void 0,void 0),T.argumentErrors||(v=t)}})),T=Zt(e,v,{type:p},void 0,!0,void 0,void 0),{type:null!==(o=T.returnType)&&void 0!==o?o:$.UnknownType.create(),isIncomplete:!!T.isTypeIncomplete}}function Rt(e,t,n){let a=t;if(e){const t=Be(e).type;if(!(0,$.isClassInstance)(t)||!$.ClassType.isBuiltIn(t,"int")||!(0,W.isLiteralType)(t))return;a=t.literalValue;const r=n.findIndex((e=>e.isUnbounded||(0,$.isVariadicTypeVar)(e.type)));if(a<0){if(a=n.length+a,r>=0&&a<=r)return;if(a<0)return 0}else{if(r>=0&&a>r)return;if(a>n.length)return n.length}}return a}function Lt(e,t,n){const a=[];let r=t;if(null==n?void 0:n.isFinalAnnotation)r|=131088;else if(null==n?void 0:n.isClassVarAnnotation){r|=131072;let t=!0;const n=F.getEnclosingClass(e,!0);if(n){const e=Yn(n);e&&$.ClassType.isDataClass(e.classType)&&(t=!1)}t&&(r|=16)}else r&=-1065059,(null==n?void 0:n.isAnnotatedClass)||(r|=131088),r|=136314880;const s=(t,a)=>{let s;return(null==n?void 0:n.hasCustomClassGetItem)?(r=131170,s={...Be(t,r),node:t}):(null==n?void 0:n.isAnnotatedClass)&&a>0?(r=131170,(0,T.isAnnotationEvaluationPostponed)(v.getFileInfo(e))&&(r|=4),s={...Be(t,r),node:t}):s=function(e,t,n){let a,r=137|t;const s=v.getFileInfo(e);s.isStubFile&&(r|=4);if(31===e.nodeType)a={type:$.UnknownType.create(),typeList:e.entries.map((e=>({...Be(e,r),node:e}))),node:e},Fe(e,{type:$.UnknownType.create()});else if(15===e.nodeType&&n){const t=me&&(0,$.isInstantiableClass)(me)?(0,K.createTypedDictTypeInlined)(Ar,e,me):void 0;a={type:de&&(0,$.isInstantiableClass)(de)?de:$.UnknownType.create(),inlinedTypeDict:t,node:e}}else a={...Be(e,r),node:e},15===e.nodeType&&mt(g.LocMessage.dictInAnnotation(),e),0!=(131072&t)&&(0,$.isClass)(a.type)&&$.ClassType.isBuiltIn(a.type,"ClassVar")&&mt(g.LocMessage.classVarNotAllowed(),e);return a}(t,r,!!(null==n?void 0:n.supportsTypedDictTypeArg)&&0===a),s};return 1===e.items.length&&!e.trailingComma&&!e.items[0].name&&52===e.items[0].valueExpression.nodeType&&e.items[0].valueExpression.expressions.length>0?(e.items[0].valueExpression.expressions.forEach(((e,t)=>{a.push(s(e,t))})),Fe(e.items[0].valueExpression,{type:$.UnknownType.create()})):e.items.forEach(((e,t)=>{const r=s(e.valueExpression,t);0!==e.argumentCategory&&1===e.argumentCategory&&((null==n?void 0:n.isAnnotatedClass)&&0!==t||((0,$.isVariadicTypeVar)(r.type)&&!r.type.isVariadicUnpacked?r.type=$.TypeVarType.cloneForUnpacked(r.type):(0,$.isInstantiableClass)(r.type)&&!r.type.includeSubclasses&&(0,W.isTupleClass)(r.type)?r.type=$.ClassType.cloneForUnpacked(r.type):mt(g.LocMessage.unpackNotAllowed(),e.valueExpression))),e.name&&mt(g.LocMessage.keywordArgInTypeArgument(),e.valueExpression),a.push(r)})),a}function jt(e,t,n){if(t.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(t.expectedType),!(0,$.isClassInstance)(t.expectedType))return;if(!le||!(0,$.isInstantiableClass)(le))return;let a=[];if((0,W.isTupleClass)(t.expectedType)&&t.expectedType.tupleTypeArguments){a=t.expectedType.tupleTypeArguments.map((e=>(0,W.transformPossibleRecursiveTypeAlias)(e.type)));const n=t.expectedType.tupleTypeArguments.findIndex((e=>e.isUnbounded));if(n>=0)if(a.length>e.expressions.length)a.splice(n,1);else for(;a.length<e.expressions.length;)a.splice(n,0,a[n])}else{const n=new G.TypeVarContext((0,W.getTypeVarScopeId)(le));if(!(0,C.populateTypeVarContextBasedOnExpectedType)(Ar,$.ClassType.cloneAsInstance(le),t.expectedType,n,F.getTypeVarScopesForNode(e),e.start))return;const r=(0,W.applySolvedTypeVars)(le,n);if(!r.typeArguments||1!==r.typeArguments.length)return;const s=(0,W.transformPossibleRecursiveTypeAlias)(r.typeArguments[0]);for(let t=0;t<e.expressions.length;t++)a.push(s)}const r=e.expressions.map(((e,r)=>Be(e,void 0,(0,W.makeInferenceContext)(r<a.length?a[r]:void 0,t.isTypeIncomplete),n))),s=r.some((e=>e.isIncomplete)),i=zt(Bt(r));let o;return r.some((e=>e.expectedTypeDiagAddendum))&&(o=new p.DiagnosticAddendum,r.forEach((e=>{e.expectedTypeDiagAddendum&&o.addAddendum(e.expectedTypeDiagAddendum)}))),{type:i,expectedTypeDiagAddendum:o,isIncomplete:s}}function Bt(e){const t=[];for(const n of e){let e;if(n.unpackedType?e=n.unpackedType:(0,$.isUnpacked)(n.type)&&(e=n.type),e&&(0,$.isClassInstance)(e)&&e.tupleTypeArguments){const n=e.tupleTypeArguments;n?(0,o.appendArray)(t,n):t.push({type:$.UnknownType.create(),isUnbounded:!0})}else(0,$.isNever)(n.type)&&n.isIncomplete&&!n.unpackedType?t.push({type:$.UnknownType.create(!0),isUnbounded:!1}):t.push({type:n.type,isUnbounded:!!n.unpackedType})}if(t.filter((e=>e.isUnbounded)).length>1){const e=t.findIndex((e=>e.isUnbounded)),n=t.splice(e);t.push({type:(0,$.combineTypes)(n.map((e=>e.type))),isUnbounded:!0})}return t}function qt(e,t,n){let a,r,s,i,o;if(e.arguments.forEach(((e,t)=>{if(0===t)0!==e.argumentCategory||e.name||(a=e.valueExpression);else if(0===e.argumentCategory&&e.name)if("expected_text"===e.name.value){i=e.valueExpression;const t=Be(e.valueExpression).type;(0,$.isClassInstance)(t)&&$.ClassType.isBuiltIn(t,"str")&&"string"==typeof t.literalValue?o=t.literalValue:mt(g.LocMessage.revealTypeExpectedTextArg(),e.valueExpression)}else"expected_type"===e.name.value&&(r=e.valueExpression,s=(0,W.convertToInstance)(Na(e).type));else a=void 0})),!a)return mt(g.LocMessage.revealTypeArgs(),e),{type:$.UnknownType.create()};const l=Be(a,void 0,t,n),p=l.type,c=F.printExpression(a),d=wr(p,{expandTypeAlias:!0});if(void 0!==o&&o!==d&&mt(g.LocMessage.revealTypeExpectedTextMismatch().format({expected:o,received:d}),null!=i?i:a),s&&!(0,$.isTypeSame)(s,p,{ignorePseudoGeneric:!0})){const e=wr(s);mt(g.LocMessage.revealTypeExpectedTypeMismatch().format({expected:e,received:d}),null!=r?r:a)}return ut(g.LocAddendum.typeOfSymbol().format({name:c,type:d}),e.arguments[0]),{type:p,isIncomplete:l.isIncomplete}}function Wt(e,t,n,a,r,s,i){var o,l;const p=[],c=[];let d=!1,u=[],m=!1;for(let r=0;r<t.length;r++){let y;const g=t[r],h=g.some((e=>void 0!==e));let f=[],T=!1;m=!1;for(let t=0;t<n.length;t++){const r=n[t].overload;let v=n[t];h&&(v={...n[t]},v.argParams=v.argParams.map(((e,t)=>{if(!g[t])return e;const n={...e};return n.argType=g[t],n})));const b=null!==(o=null==a?void 0:a.clone())&&void 0!==o?o:new G.TypeVarContext((0,W.getTypeVarScopeId)(r));b.addSolveForScope((0,W.getTypeVarScopeIds)(r)),b.unlock();const _=za(e,(()=>Xt(e,v,b,!0,s,i)));if(_.isTypeIncomplete&&(d=!0),!_.argumentErrors&&_.returnType){u.push(r),y=r;const e={overload:y,matchResults:v,typeVarContext:b,returnType:_.returnType,argResults:null!==(l=_.argResults)&&void 0!==l?l:[]};if(c.push(e),!_.anyOrUnknownArgument){p.push(_.returnType),m=!0;break}f.push(e),(0,W.isIncompleteUnknown)(_.anyOrUnknownArgument)&&(T=!0)}}if(!m&&f.length>0)if(f=Gt(f),1===f.length)u=[f[0].overload],p.push(f[0].returnType);else{let e=[],t=!1;f.forEach((n=>{let a=!1;for(let r=0;r<e.length;r++){if(nr(e[r],n.returnType)){const n=(0,W.containsAnyOrUnknown)(e[r],!1);n?(0,$.isAny)(n)&&(t=!0):a=!0;break}if(nr(n.returnType,e[r])){const a=(0,W.containsAnyOrUnknown)(n.returnType,!1);a?(0,$.isAny)(a)&&(t=!0):e[r]=$.NeverType.createNever();break}}a||e.push(n.returnType)})),e=e.filter((e=>!(0,$.isNever)(e)));const n=(0,$.combineTypes)(e);let a=n;e.length>1&&(a=t?$.AnyType.create():$.UnknownType.createPossibleType(n,T)),p.push(a)}if(!y)return{argumentErrors:!0,isTypeIncomplete:d,overloadsUsedForCall:u}}a&&m&&a.copyFromClone(c[c.length-1].typeVarContext);const y=null!=a?a:c[0].typeVarContext;y.unlock(),y.addSolveForScope((0,W.getTypeVarScopeId)(c[0].overload));const g=Xt(e,c[0].matchResults,y,r,s,i);return g.isTypeIncomplete&&(d=!0),{argumentErrors:g.argumentErrors,anyOrUnknownArgument:g.anyOrUnknownArgument,returnType:(0,$.combineTypes)(p),isTypeIncomplete:d,specializedInitSelfType:g.specializedInitSelfType,overloadsUsedForCall:u}}function Gt(e){if(e.length<2)return e;if(e[0].matchResults.relevance!==e[e.length-1].matchResults.relevance&&(e=e.filter((t=>t.matchResults.relevance===e[0].matchResults.relevance))).length<2)return e;if((0,W.areTypesSame)(e.map((e=>e.returnType)),{treatAnySameAsUnknown:!0}))return[e[0]];const t=e[0].argResults;if(!t)return e;let n=!1;for(let a=0;a<t.length;a++)if((0,$.isAnyOrUnknown)(t[a].argType)){const t=e.map((e=>a<e.matchResults.argParams.length?e.matchResults.argParams[a].paramType:$.UnknownType.create()));(0,W.areTypesSame)(t,{treatAnySameAsUnknown:!0})||(n=!0)}return n||e.some((e=>e.argResults.length!==t.length))?e:[e[0]]}function Kt(e){return e.sort(((e,t)=>e.relevance!==t.relevance?t.relevance-e.relevance:e.overloadIndex-t.overloadIndex))}function $t(e,t,n,a,r,s,i){let o,l=[],d=!!n.isIncomplete;if(za(e,(()=>{let a=0;$.OverloadedFunctionType.getOverloads(n.type).forEach((r=>{const s=Qt(e,t,{type:r,isIncomplete:n.isIncomplete},a,i);s.argumentErrors||l.push(s),a++}))})),l=Kt(l),0===l.length){if(!gt(e)){const a=n.type.overloads[0].details.name||"<anonymous function>",r=new p.DiagnosticAddendum,s=t.map((e=>{const t=wr(Pa(e,void 0,i).type);return 1===e.argumentCategory?`*${t}`:2===e.argumentCategory?`**${t}`:t}));r.addMessage(g.LocAddendum.argumentTypes().format({types:s.join(", ")})),ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.noOverload().format({name:a})+r.getString(),e)}return{argumentErrors:!0,isTypeIncomplete:d,overloadsUsedForCall:[]}}function u(t,n){const r=l.reduce(((e,t)=>t.argumentMatchScore===e.argumentMatchScore?t.overloadIndex>e.overloadIndex?t:e:t.argumentMatchScore<e.argumentMatchScore?t:e));if(n){const t=r.overload.details.name||"<anonymous function>",n=ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.noOverload().format({name:t}),e),a=r.overload.details.declaration;n&&a&&n.addRelatedInfo(g.LocAddendum.overloadIndex().format({index:r.overloadIndex+1}),a.uri,a.range)}const o=null!=a?a:new G.TypeVarContext;return o.addSolveForScope((0,W.getTypeVarScopeIds)(r.overload)),o.unlock(),Xt(e,r,o,t,s,i)}if(1===l.length)return u(!1,!1);let m=[t.map((e=>{}))];for(;;){const n=Wt(e,m,l,a,r,s,i);if(n.isTypeIncomplete&&(d=!0),!n.argumentErrors)return n;if(o||za(e,(()=>{o=t.map((e=>{if(e.typeResult)return e.typeResult.type;if(e.valueExpression){const t=e.valueExpression;return za(t,(()=>Be(t).type))}return $.AnyType.create()}))})),m=Ht(o,m),!m||m.length>64)break}if(!gt(e)&&!d){const e=u(!0,!0);return e.returnType=$.UnknownType.create(),{...e,argumentErrors:!0}}return{argumentErrors:!0,isTypeIncomplete:d,overloadsUsedForCall:[]}}function Ht(e,t){let n,a=e.length-1;for(;a>=0&&!t[0][a];)a--;if(a++,a>=e.length)return;for(;a<e.length;){const t=e[a];if((0,$.isUnion)(t)){n=Ct(t);break}if((0,$.isTypeVar)(t)&&t.details.constraints.length>1){n=Ct(t);break}a++}if(!n)return;const r=[];return t.forEach((e=>{(0,W.doForEachSubtype)(n,(t=>{const n=[...e];n[a]=t,r.push(n)}))})),r}function Zt(e,t,n,a,r,s,i,l=0){let d,u=!1,m=!1;const y=[];if(l>$.maxTypeRecursionCount)return{returnType:$.UnknownType.create(),argumentErrors:!0,overloadsUsedForCall:y};if(l++,n.type.specialForm){const t=9===e.nodeType?e.leftExpression:e;return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.objectNotCallable().format({type:wr(n.type.specialForm,{expandTypeAlias:!0})}),t),{returnType:$.UnknownType.create(),argumentErrors:!0,overloadsUsedForCall:y}}let h=It(n.type,{sortSubtypes:!0},((h,f,T)=>za(T?void 0:e,(()=>{const T=function(e,t,n,a,r,s,i,o,l,d){switch(n.category){case 3:case 1:case 2:return r||t.forEach((e=>{e.valueExpression&&!Va(e.valueExpression)&&Pa(e,void 0,l)})),{returnType:n};case 4:return function(e,t,n,a,r,s,i,o){var l;if($.TypeBase.isInstantiable(n))return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.callableNotInstantiable().format({type:wr(n)}),e),{returnType:void 0,argumentErrors:!0};let p=r;p||(p=new G.TypeVarContext((0,W.getTypeVarScopeIds)(n)));if("namedtuple"===n.details.builtInName){ht(c.DiagnosticRule.reportUntypedNamedTuple,g.LocMessage.namedTupleNoTypes(),e);const a={returnType:(0,P.createNamedTupleType)(Ar,e,t,!1)};return an(e,t,{type:n},p,s,i,o),a}if("NewType"===n.details.builtInName)return{returnType:yn(e,t)};const d=an(e,t,{type:n,isIncomplete:a},p,s,i,o);let u=!!d.isTypeIncomplete,m=d.returnType,y=!!d.argumentErrors;if(!y){const a=(0,x.applyFunctionTransform)(Ar,e,t,n,{argumentErrors:!!d.argumentErrors,returnType:null!==(l=d.returnType)&&void 0!==l?l:$.UnknownType.create(u),isTypeIncomplete:u});m=a.returnType,a.isTypeIncomplete&&(u=!0),a.argumentErrors&&(y=!0)}"__import__"===n.details.builtInName&&(m=$.AnyType.create());return{returnType:m,isTypeIncomplete:u,argumentErrors:y,overloadsUsedForCall:d.overloadsUsedForCall,specializedInitSelfType:d.specializedInitSelfType}}(e,t,n,r,s,i,o,l);case 5:return function(e,t,n,a,r,s,i,o){var l,p;if("cast"===n.overloads[0].details.builtInName&&2===t.length)return{returnType:Jt(t,e)};const c=$t(e,t,{type:n,isIncomplete:a},r,s,i,o);let d=null!==(l=c.returnType)&&void 0!==l?l:$.UnknownType.create(),u=!!c.isTypeIncomplete,m=!!c.argumentErrors;if(!m){const a=(0,x.applyFunctionTransform)(Ar,e,t,n,{argumentErrors:!!c.argumentErrors,returnType:null!==(p=c.returnType)&&void 0!==p?p:$.UnknownType.create(u),isTypeIncomplete:u});d=a.returnType,a.isTypeIncomplete&&(u=!0),a.argumentErrors&&(m=!0)}return{returnType:d,isTypeIncomplete:u,argumentErrors:m,overloadsUsedForCall:c.overloadsUsedForCall,specializedInitSelfType:c.specializedInitSelfType}}(e,t,n,r,s,i,o,l);case 6:return(0,W.isNoneInstance)(n)?(ht(c.DiagnosticRule.reportOptionalCall,g.LocMessage.noneNotCallable(),e),{argumentErrors:!0}):$.TypeBase.isInstantiable(n)?function(e,t,n,a,r,s,i){var o,l;if(void 0!==n.literalValue)return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.literalNotCallable(),e),{returnType:$.UnknownType.create(),argumentErrors:!0};if($.ClassType.isBuiltIn(n)){const a=null!==(o=n.aliasName)&&void 0!==o?o:n.details.name;if((0,W.isInstantiableMetaclass)(n)){if(n.typeArguments&&n.isTypeArgumentExplicit)return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.objectNotCallable().format({type:wr(n)}),e),{returnType:$.UnknownType.create(),argumentErrors:!0};if((0,I.validateConstructorArguments)(Ar,e,t,n,r,s,i),"type"===n.details.name&&1===t.length){const e=Pa(t[0],void 0,i).type;return{returnType:(0,W.mapSubtypes)(e,(e=>{if((0,$.isInstantiableClass)(e)&&e.details.effectiveMetaclass)return e.details.effectiveMetaclass;if((0,$.isNever)(e))return e;if($.TypeBase.isInstance(e)){if((0,$.isClass)(e)||(0,$.isTypeVar)(e))return(0,W.convertToInstantiable)(Ge(e));if((0,$.isFunction)(e))return $.FunctionType.cloneAsInstantiable(e)}return $.ClassType.cloneForSpecialization($.ClassType.cloneAsInstance(n),[$.UnknownType.create()],!0)}))}}return t.length>=2?{returnType:gn(e,t,n)||$.AnyType.create()}:{returnType:$.AnyType.create()}}if("TypeVar"===a)return{returnType:on(e,n,t)};if("TypeVarTuple"===a)return{returnType:pn(e,n,t)};if("ParamSpec"===a)return{returnType:dn(e,n,t)};if("TypeAliasType"===a){const n=function(e,t){if(9!==e.nodeType||!e.parent||t.length<2)return;if(3!==e.parent.nodeType||e.parent.rightExpression!==e||38!==e.parent.leftExpression.nodeType)return void ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasTypeMustBeAssigned(),e);const n=e.parent.leftExpression,a=t[0];if(!a.valueExpression||48!==a.valueExpression.nodeType)return void ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasTypeNameArg(),a.valueExpression||e);a.valueExpression.strings.map((e=>e.value)).join("")!==n.value&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasTypeNameMismatch(),a.valueExpression);let r,s,i;for(let e=1;e<t.length;e++){const n=t[e].name,a=n?n.value:void 0;if(a)if("type_params"!==a||s){if("value"!==a||r)return;r=t[e].valueExpression}else s=t[e].valueExpression;else{if(1!==e)return;r=t[e].valueExpression}}if(!r)return;if(s){if(52!==s.nodeType)return void mt(g.LocMessage.typeAliasTypeParamInvalid(),s);i=[];let e=!0;if(s.expressions.map((t=>{let a=Be(t,4224).type;(0,$.isTypeVar)(a)?(a.scopeId||a.isVariadicUnpacked?e=!1:a=$.TypeVarType.cloneForScopeId(a,F.getScopeIdForNode(n),n.value,2),i.push(a)):e=!1})),!e)return void ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasTypeParamInvalid(),s)}return $n(n,n,r,!0,void 0,(()=>i))}(e,t);if(n)return{returnType:n}}if("NamedTuple"===a){const a={returnType:(0,P.createNamedTupleType)(Ar,e,t,!0)},s=(0,I.getBoundInitMethod)(Ar,e,$.ClassType.cloneAsInstance(n),void 0,0);return s&&(0,$.isOverloadedFunction)(s.type)&&$t(e,t,{type:s.type},void 0,r,void 0,i),a}if("NewType"===a)return{returnType:yn(e,t)};if($.ClassType.isSpecialFormClass(n))return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.typeNotIntantiable().format({type:a}),e),{returnType:$.UnknownType.create(),argumentErrors:!0};if("TypedDict"===a)return{returnType:(0,K.createTypedDictType)(Ar,e,n,t)};if("auto"===a&&0===t.length)return{returnType:(0,A.getEnumAutoValueType)(Ar,e)}}if((0,$.isClass)(n)&&n.details.effectiveMetaclass&&(0,$.isClass)(n.details.effectiveMetaclass)&&(0,A.isEnumMetaclass)(n.details.effectiveMetaclass)&&!(0,A.isEnumClassWithMembers)(Ar,n))return{returnType:null!==(l=(0,A.createEnumType)(Ar,e,n,t))&&void 0!==l?l:(0,W.convertToInstance)(a)};if($.ClassType.supportsAbstractMethods(n)){const t=yr(n);if(t.length>0&&!n.includeSubclasses&&!(0,$.isTypeVar)(a)){const a=new p.DiagnosticAddendum,r=2;t.forEach(((e,n)=>{if(n===r)a.addMessage(g.LocAddendum.memberIsAbstractMore().format({count:t.length-r}));else if(n<r&&(0,$.isInstantiableClass)(e.classType)){const t=e.classType.details.name;a.addMessage(g.LocAddendum.memberIsAbstract().format({type:t,name:e.symbolName}))}})),ht(c.DiagnosticRule.reportAbstractUsage,g.LocMessage.instantiateAbstract().format({type:n.details.name})+a.getString(),e)}}$.ClassType.isProtocolClass(n)&&!n.includeSubclasses&&ht(c.DiagnosticRule.reportAbstractUsage,g.LocMessage.instantiateProtocol().format({type:n.details.name}),e);const d=(0,I.validateConstructorArguments)(Ar,e,t,n,r,s,i),u=d.overloadsUsedForCall,m=d.argumentErrors,y=d.isTypeIncomplete;let h=d.returnType;(0,$.isTypeVar)(a)&&(h=(0,W.convertToInstance)(a));if(h&&(0,$.isClassInstance)(h)&&h.details.mro.some((e=>(0,$.isInstantiableClass)(e)&&$.ClassType.isBuiltIn(e,"type")))){let a="__class_"+h.details.name;if(3===t.length){const e=Pa(t[0],void 0,i).type;(0,$.isClassInstance)(e)&&$.ClassType.isBuiltIn(e,"str")&&"string"==typeof e.literalValue&&(a=e.literalValue)}const r=$.ClassType.createInstantiable(a,"","",v.getFileInfo(e).fileUri,0,F.getTypeSourceId(e),$.ClassType.cloneAsInstantiable(h),$.ClassType.cloneAsInstantiable(h));r.details.baseClasses.push(Fa(e,"object")),r.details.effectiveMetaclass=n,r.details.declaration=h.details.declaration,(0,W.computeMroLinearization)(r),h=r}return{returnType:h,overloadsUsedForCall:u,argumentErrors:m,isTypeIncomplete:y}}(e,t,n,a,i,o,l):function(e,t,n,a,r,s,i,o,l){var d;const u=new p.DiagnosticAddendum,m=Ye(e,n,"__call__",void 0,u,528,void 0,l),y=null==m?void 0:m.type;if(!y||m.typeErrors)return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.objectNotCallable().format({type:wr(n)})+u.getString(),e),{returnType:$.UnknownType.create(),argumentErrors:!0};const h=Zt(e,t,{type:y},r,s,i,o,l);let f=null!==(d=h.returnType)&&void 0!==d?d:$.UnknownType.create();(0,$.isTypeVar)(a)&&$.TypeBase.isInstantiable(a)&&(0,$.isClass)(n)&&$.ClassType.isBuiltIn(n,"type")&&(f=(0,W.convertToInstance)(a));return{returnType:f,argumentErrors:h.argumentErrors,overloadsUsedForCall:h.overloadsUsedForCall}}(e,t,n,a,s,i,o,l,d);case 9:return Zt(e,t,{type:(0,W.transformPossibleRecursiveTypeAlias)(n),isIncomplete:r},s,i,o,l,d);case 7:return ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.moduleNotCallable(),e),{argumentErrors:!0}}return{argumentErrors:!0}}(e,t,h,f,!!n.isIncomplete,a,r,s,i,l);return T.argumentErrors&&(u=!0),T.isTypeIncomplete&&(m=!0),T.overloadsUsedForCall&&(0,o.appendArray)(y,T.overloadsUsedForCall),d=T.specializedInitSelfType,T.returnType}),{allowDiagnostics:!0})));return u&&(0,$.isNever)(h)&&!h.isNoReturn&&(h=$.UnknownType.create()),{argumentErrors:u,returnType:h,isTypeIncomplete:m,specializedInitSelfType:d,overloadsUsedForCall:y}}function Yt(e,t){const n=$.ClassType.isProtocolClass(e),a=$.ClassType.getSymbolTable(e).get(t);if(!a)return;if(!a.isClassMember()&&!a.isNamedTupleMemberMember())return;const r=(0,L.getLastTypedDeclarationForSymbol)(a);if(!r)return;if(n&&1===r.type){if(!a.getDeclarations().some((e=>1===e.type&&!!e.inferredTypeSource)))return{symbol:a,symbolName:t,classType:e,hasImplementation:!1}}if(5!==r.type)return;let s=!1;const i=(0,S.getFunctionInfoFromDecorators)(Ar,r.node,!0);0!=(8&i.flags)&&(s=!0);const o=v.getFileInfo(r.node).isStubFile,l=a.getDeclarations()[0];let p;if(l!==r&&5===l.type&&(p=(0,S.getFunctionInfoFromDecorators)(Ar,l.node,!0),0!=(8&p.flags)&&(s=!0),n&&0!=(256&i.flags))){if(n&&!s&&o)return;return{symbol:a,symbolName:t,classType:e,hasImplementation:!1}}if(!n&&!s)return;const c=!F.isSuiteEmpty(r.node.suite)&&!ua(r);return!n||s||!c&&!o?{symbol:a,symbolName:t,classType:e,hasImplementation:c}:void 0}function Jt(e,t){const n=Na(e[0],{enforceTypeAnnotationRules:!0}).type;let a=Pa(e[1],void 0,void 0).type;return a.specialForm&&(a=a.specialForm),$.TypeBase.isInstantiable(n)&&!(0,$.isUnknown)(n)&&(0,$.isTypeSame)((0,W.convertToInstance)(n),a,{ignorePseudoGeneric:!0})&&ht(c.DiagnosticRule.reportUnnecessaryCast,g.LocMessage.unnecessaryCast().format({type:wr(a)}),t),(0,W.convertToInstance)(n)}function Qt(e,t,n,a,r){var s,i,o,d,u,m,y,h,f,T;const v=(0,D.getParameterListDetails)(n.type);let b=0,_=!1,C=!1,I=!!n.isIncomplete,k=!1;t=function(e,t){var n;const a=[];for(const r of e){if(1===r.argumentCategory){const e=Pa(r,void 0,t).type,s=(0,W.combineSameSizedTuples)(Ct(e),le);if((0,$.isClassInstance)(s)&&(0,W.isTupleClass)(s)){const e=null!==(n=s.tupleTypeArguments)&&void 0!==n?n:[];if(1!==e.length||!e[0].isUnbounded){for(const t of e)t.isUnbounded?a.push({...r,argumentCategory:1,valueExpression:void 0,typeResult:{type:zt([t])}}):a.push({...r,argumentCategory:0,valueExpression:void 0,typeResult:{type:t.type}});continue}}}a.push(r)}return a}(t,r);const w=new Map;v.params.forEach((e=>{(0,l.assert)(void 0!==e,"paramInfo is undefined for param name map");const t=e.param;t.name&&0===t.category&&w.set(t.name,{argsNeeded:0!==t.category||t.hasDefault?0:1,argsReceived:0,isPositionalOnly:e.source===D.ParameterSource.PositionOnly})}));let S=v.positionOnlyParamCount,A=null!==(s=v.firstKeywordOnlyIndex)&&void 0!==s?s:v.params.length;const x=v.argsIndex,P=v.kwargsIndex;let N,F,E=!1;if(void 0!==x&&void 0!==P){(0,l.assert)(v.params[x],"varArgListParamIndex params entry is undefined");const e=v.params[x].param;(0,l.assert)(v.params[P],"varArgDictParamIndex params entry is undefined");const t=v.params[P].param;if((0,$.isParamSpec)(e.type)&&"args"===e.type.paramSpecAccess&&(0,$.isParamSpec)(t.type)&&"kwargs"===t.type.paramSpecAccess&&e.type.details.name===t.type.details.name){E=!0;const t=e.type.scopeId;(null===(i=(0,W.getTypeVarScopeIds)(n.type))||void 0===i?void 0:i.some((e=>e===t)))?(N=[],F=$.TypeVarType.cloneForParamSpecAccess(e.type,void 0)):S=x}}else if(n.type.details.paramSpec){const e=n.type.details.paramSpec.scopeId;(null===(o=(0,W.getTypeVarScopeIds)(n.type))||void 0===o?void 0:o.some((t=>t===e)))&&(E=!0,N=[],F=$.TypeVarType.cloneForParamSpecAccess(n.type.details.paramSpec,void 0))}t.some((e=>1===e.argumentCategory))&&t.forEach((e=>{if(e.name){const t=v.params.findIndex((t=>((0,l.assert)(t,"paramInfo entry is undefined fork kwargs check"),t.param.name===e.name.value&&0===t.param.category)));t>=0&&t>=S&&(A<0||t<A)&&(A=t)}})),A<0&&(A=v.params.length);let M=t.findIndex((e=>2===e.argumentCategory||void 0!==e.name));M<0&&(M=t.length);let O,z=[];function V(e,t){e.active&&(O=t)}const U=void 0!==t.find((e=>1===e.argumentCategory));let R=0;for(;b<M;){if(b<S&&t[b].name){const e=t[b].name;e&&(ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.argPositional(),e),C=!0)}const n=M-b,a=A-R-1;if(R>=A){if(N)for(;b<M;)N.push(t[b]),b++;else{let n=!1;if(U&&1===t[b].argumentCategory){const e=Pa(t[b],void 0,r).type;(0,$.isClassInstance)(e)&&(0,W.isTupleClass)(e)&&!(0,W.isUnboundedTupleClass)(e)&&void 0!==e.tupleTypeArguments&&e.tupleTypeArguments.length>0&&(n=!0)}else n=!0;n&&(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,1===A?g.LocMessage.argPositionalExpectedOne():g.LocMessage.argPositionalExpectedCount().format({expected:A}),null!==(d=t[b].valueExpression)&&void 0!==d?d:e),C=!0)}break}if(R>=v.params.length)break;(0,l.assert)(v.params[R],"paramIndex params entry is undefined");const s=v.params[R].type,i=v.params[R].param.name,o=1===v.params[R].param.category&&(0,$.isVariadicTypeVar)(s);if(1===t[b].argumentCategory){let l=!1;const p=Pa(t[b],void 0,r);let d,h=!1;R<A&&(0,$.isTypeVar)(p.type)&&"args"===p.type.paramSpecAccess&&1!==v.params[R].param.category&&(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,1===A?g.LocMessage.argPositionalExpectedOne():g.LocMessage.argPositionalExpectedCount().format({expected:A}),null!==(u=t[b].valueExpression)&&void 0!==u?u:e),C=!0);const f=p.type;o&&(0,$.isUnpackedVariadicTypeVar)(f)?(d=f,l=!0,h=!0,k=!0):(0,$.isClassInstance)(f)&&(0,W.isTupleClass)(f)&&f.tupleTypeArguments&&1===f.tupleTypeArguments.length&&(0,$.isUnpackedVariadicTypeVar)(f.tupleTypeArguments[0].type)?(d=f.tupleTypeArguments[0].type,l=!0,h=!0,k=!0):o&&(0,$.isClassInstance)(f)&&(0,W.isTupleClass)(f)?(l=!0,h=!0,n<a&&(k=!0),d=$.ClassType.cloneForUnpacked(f)):(0,$.isParamSpec)(f)&&"args"===f.paramSpecAccess?d=void 0:(d=null===(m=nt({type:f,isIncomplete:p.isIncomplete},!1,e,!1))||void 0===m?void 0:m.type,1!==v.params[R].param.category&&(_=!0));const T=d?{argumentCategory:0,typeResult:{type:d,isIncomplete:p.isIncomplete}}:{...t[b]};p.isIncomplete&&(I=!0),o&&!l?(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.unpackedArgWithVariadicParam(),t[b].valueExpression||e),C=!0):(N&&N.push(t[b]),T&&z.push({paramCategory:v.params[R].param.category,paramType:s,requiresTypeVarMatching:(0,W.requiresSpecialization)(s),argument:T,errorNode:null!==(y=t[b].valueExpression)&&void 0!==y?y:e,paramName:i,isParamNameSynthesized:v.params[R].param.isNameSynthesized,mapsToVarArgList:o&&n>a})),V(t[b],v.params[R].param),i&&0===v.params[R].param.category&&w.has(i)&&w.get(i).argsReceived++,(h||1===v.params[R].param.category)&&b++,(k||1!==v.params[R].param.category)&&R++}else if(1===v.params[R].param.category)if(V(t[b],v.params[R].param),N)N.push(t[b]),b++;else{let r=v.params[R].param.category,i=s;const o=v.params[R].param.name;(0,$.isUnpackedClass)(s)&&s.tupleTypeArguments&&s.tupleTypeArguments.length>0&&(i=s.tupleTypeArguments[0].type),r=(0,$.isVariadicTypeVar)(i)?1:0,n<=a?(n<a&&(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,1===n?g.LocMessage.argMorePositionalExpectedOne():g.LocMessage.argMorePositionalExpectedCount().format({expected:n}),t[b].valueExpression||e),C=!0),R++):(z.push({paramCategory:r,paramType:i,requiresTypeVarMatching:(0,W.requiresSpecialization)(s),argument:t[b],errorNode:t[b].valueExpression||e,paramName:o,isParamNameSynthesized:v.params[R].param.isNameSynthesized,mapsToVarArgList:!0}),b++)}else{const n=v.params[R].param.name;z.push({paramCategory:v.params[R].param.category,paramType:s,requiresTypeVarMatching:(0,W.requiresSpecialization)(s),argument:t[b],errorNode:t[b].valueExpression||e,paramName:n,isParamNameSynthesized:v.params[R].param.isNameSynthesized}),V(t[b],v.params[R].param),n&&w.has(n)&&w.get(n).argsReceived++,b++,R++}}let L=!1;if(S>=0&&R<S&&R<v.params.length&&1===v.params[R].param.category&&!(0,$.isParamSpec)(v.params[R].param.type)&&(R++,L=!0),S>=0&&R<S&&(!U||E)){const n=v.params.findIndex((e=>e.param.hasDefault));let a=(n>=0&&n<S?n:S)-M;L&&a--;const r=v.params.findIndex((e=>1===e.param.category&&!(0,$.isParamSpec)(e.param.type)));r>=R&&r<S&&a--,a>0&&(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,1===a?g.LocMessage.argMorePositionalExpectedOne():g.LocMessage.argMorePositionalExpectedCount().format({expected:a}),t.length>M&&t[M].valueExpression||e),C=!0)}if(!C){let a;for(;b<t.length;){if(2===t[b].argumentCategory){const s=Pa(t[b],(0,W.makeInferenceContext)(v.unpackedKwargsTypedDictType),r).type;if((0,$.isAnyOrUnknown)(s))a=s;else if((0,$.isClassInstance)(s)&&$.ClassType.isTypedDictClass(s)){const n=(0,K.getTypedDictMembersForClass)(Ar,s),a=new p.DiagnosticAddendum;n.knownItems.forEach(((n,r)=>{const s=w.get(r);if(s&&!s.isPositionalOnly)if(s.argsReceived>0)a.addMessage(g.LocMessage.paramAlreadyAssigned().format({name:r}));else{s.argsReceived++;const a=v.params.findIndex((e=>e.param.name===r));(0,l.assert)(a>=0);const i=v.params[a].type;z.push({paramCategory:0,paramType:i,requiresTypeVarMatching:(0,W.requiresSpecialization)(i),argument:{argumentCategory:0,typeResult:{type:n.valueType}},errorNode:t[b].valueExpression||e,paramName:r})}else if(void 0!==v.kwargsIndex){const a=v.params[v.kwargsIndex].type;z.push({paramCategory:2,paramType:a,requiresTypeVarMatching:(0,W.requiresSpecialization)(a),argument:{argumentCategory:0,typeResult:{type:n.valueType}},errorNode:t[b].valueExpression||e,paramName:r}),w.set(r,{argsNeeded:1,argsReceived:1,isPositionalOnly:!1})}else v.hasUnpackedTypedDict||a.addMessage(g.LocMessage.paramNameMissing().format({name:r}))})),a.isEmpty()||(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.unpackedTypedDictArgument()+a.getString(),t[b].valueExpression||e),C=!0)}else if(n.type.details.paramSpec&&(0,D.isParamSpecKwargsArgument)(n.type.details.paramSpec,s))a=$.AnyType.create(),N||z.push({paramCategory:2,paramType:n.type.details.paramSpec,requiresTypeVarMatching:!1,argument:t[b],argType:(0,$.isParamSpec)(s)?void 0:$.AnyType.create(),errorNode:t[b].valueExpression||e});else{const n=Ea(e,"str");if(ge&&(0,$.isInstantiableClass)(ge)&&n&&(0,$.isClassInstance)(n)){const r=new G.TypeVarContext((0,W.getTypeVarScopeId)(ge));let i=!1;if((0,$.isTypeVar)(s))i=!0;else if(nr($.ClassType.cloneAsInstance(ge),s,void 0,r)){const e=(0,W.applySolvedTypeVars)(ge,r).typeArguments;e&&e.length>=2?(nr(n,e[0])&&(i=!0),a=e[1]):(i=!0,a=$.UnknownType.create())}if(void 0!==v.kwargsIndex&&a){const n=v.params[v.kwargsIndex].type;z.push({paramCategory:0,paramType:n,requiresTypeVarMatching:(0,W.requiresSpecialization)(n),argType:a,argument:t[b],errorNode:t[b].valueExpression||e,paramName:v.params[v.kwargsIndex].param.name})}i||(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.unpackedDictArgumentNotMapping(),t[b].valueExpression||e),C=!0)}}N&&N.push(t[b])}else{const a=t[b].name;if(a){const n=a.value,r=w.get(n);if(r&&!r.isPositionalOnly)if(r.argsReceived>0)gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.paramAlreadyAssigned().format({name:n}),a),C=!0;else{r.argsReceived++;const a=v.params.findIndex((e=>e.param.name===n));(0,l.assert)(a>=0);const s=v.params[a].type;z.push({paramCategory:0,paramType:s,requiresTypeVarMatching:(0,W.requiresSpecialization)(s),argument:t[b],errorNode:null!==(h=t[b].valueExpression)&&void 0!==h?h:e,paramName:n}),V(t[b],v.params[a].param)}else if(N)N.push(t[b]);else if(void 0!==v.kwargsIndex){const a=v.params[v.kwargsIndex].type;z.push({paramCategory:2,paramType:a,requiresTypeVarMatching:(0,W.requiresSpecialization)(a),argument:t[b],errorNode:null!==(f=t[b].valueExpression)&&void 0!==f?f:e,paramName:n}),w.set(n,{argsNeeded:1,argsReceived:1,isPositionalOnly:!1}),(0,l.assert)(v.params[v.kwargsIndex],"paramDetails.kwargsIndex params entry is undefined"),V(t[b],v.params[v.kwargsIndex].param)}else gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.paramNameMissing().format({name:a.value}),a),C=!0}else if(0===t[b].argumentCategory)N?N.push(t[b]):(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,1===A?g.LocMessage.argPositionalExpectedOne():g.LocMessage.argPositionalExpectedCount().format({expected:A}),t[b].valueExpression||e),C=!0);else if(1===t[b].argumentCategory&&n.type.details.paramSpec){const a=Pa(t[b],void 0,r),s=a.type;a.isIncomplete&&(I=!0),(0,D.isParamSpecArgsArgument)(n.type.details.paramSpec,s)&&z.push({paramCategory:1,paramType:n.type.details.paramSpec,requiresTypeVarMatching:!1,argument:t[b],argType:(0,$.isParamSpec)(s)?void 0:$.AnyType.create(),errorNode:null!==(T=t[b].valueExpression)&&void 0!==T?T:e})}}b++}if(!a||U&&void 0===v.argsIndex||v.params.forEach(((n,r)=>{var s,i;const o=n.param;if(r>=v.firstPositionOrKeywordIndex&&0===o.category&&o.name&&w.has(o.name)&&0===w.get(o.name).argsReceived){const n=v.params[r].type;z.push({paramCategory:0,paramType:n,requiresTypeVarMatching:(0,W.requiresSpecialization)(n),argument:{argumentCategory:0,typeResult:{type:a}},errorNode:null!==(i=null===(s=t.find((e=>2===e.argumentCategory)))||void 0===s?void 0:s.valueExpression)&&void 0!==i?i:e,paramName:o.name,isParamNameSynthesized:o.isNameSynthesized}),w.get(o.name).argsReceived=1}})),!a&&!$.FunctionType.isDefaultParameterCheckDisabled(n.type)){const t=Array.from(w.keys()).filter((e=>{const t=w.get(e);return!t||t.argsReceived<t.argsNeeded}));if(t.length>0){if(!gt(e)){const n=t.map((e=>`"${e}"`)).join(", ");gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,1===t.length?g.LocMessage.argMissingForParam().format({name:n}):g.LocMessage.argMissingForParams().format({names:n}),e)}C=!0}v.params.forEach((t=>{var n;const a=t.param;if(0===a.category&&a.name){const r=w.get(a.name);if(0===r.argsNeeded&&0===r.argsReceived){const r=null!==(n=t.defaultArgType)&&void 0!==n?n:a.defaultType;r&&!(0,W.isEllipsisType)(r)&&(0,W.requiresSpecialization)(a.type)&&z.push({paramCategory:a.category,paramType:t.type,requiresTypeVarMatching:!0,argument:{argumentCategory:0,typeResult:{type:r}},isDefaultArg:!0,errorNode:e,paramName:a.name,isParamNameSynthesized:a.isNameSynthesized})}}}))}}if((!C||!Va(void 0))&&((0,l.assert)(void 0===v.argsIndex||v.argsIndex<v.params.length,"paramDetails.argsIndex params entry is invalid"),void 0!==v.argsIndex&&v.argsIndex>=0&&v.params[v.argsIndex].param.hasDeclaredType&&!k)){const t=v.params[v.argsIndex].type,n=z.filter((e=>e.mapsToVarArgList));if((0,$.isVariadicTypeVar)(t)&&!t.isVariadicInUnion){const a=n.map((t=>{var n;const a=Pa(t.argument,void 0,r).type;return((0,$.isUnpackedVariadicTypeVar)(a)||(0,$.isClassInstance)(a)&&(0,W.isTupleClass)(a)&&a.tupleTypeArguments&&1===a.tupleTypeArguments.length&&(0,$.isUnpackedVariadicTypeVar)(a.tupleTypeArguments[0].type))&&1!==t.argument.argumentCategory&&!t.mapsToVarArgList&&(gt(e)||I||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.typeVarTupleMustBeUnpacked(),null!==(n=t.argument.valueExpression)&&void 0!==n?n:e),C=!0),{type:a,isUnbounded:1===t.argument.argumentCategory}}));let s;s=1!==a.length||a[0].isUnbounded||!(0,$.isUnpackedClass)(a[0].type)&&!(0,$.isVariadicTypeVar)(a[0].type)?zt(a,!0):a[0].type;const i={paramCategory:1,paramType:t,requiresTypeVarMatching:!0,argument:{argumentCategory:0,typeResult:{type:s}},errorNode:e,paramName:v.params[v.argsIndex].param.name,isParamNameSynthesized:v.params[v.argsIndex].param.isNameSynthesized,mapsToVarArgList:!0};z=[...z.filter((e=>!e.mapsToVarArgList)),i]}}let j=0;return _&&j--,["isinstance","issubclass"].some((e=>e===n.type.details.builtInName))&&2===z.length&&(z[1].isinstanceParam=!0),{overload:n.type,overloadIndex:a,argumentErrors:C,isTypeIncomplete:I,argParams:z,paramSpecTarget:F,paramSpecArgList:N,activeParam:O,relevance:j,argumentMatchScore:0}}function Xt(e,t,n,a=!1,r,s){var i;const o=t.overload;if(s||(s=new W.UniqueSignatureTracker),t.overload=(0,W.ensureFunctionSignaturesAreUnique)(t.overload,s,e.start),!r||(0,$.isAnyOrUnknown)(r.expectedType)||(0,$.isNever)(r.expectedType)||!o.details.declaredReturnType||!(0,W.requiresSpecialization)(null!==(i=$.FunctionType.getSpecializedReturnType(o))&&void 0!==i?i:$.UnknownType.create()))return en(e,t,n,s,a);const l=Za(o);let p=r.expectedType,c=2048;if((0,W.containsLiteralType)(p,!0)&&(c|=256),(0,$.isUnion)(r.expectedType)&&za(e,(()=>{const r=n.clone();nr(l,p,void 0,r,void 0,c);const i=en(e,t,r,s,a);(null==i?void 0:i.argumentErrors)&&(p=void 0)})),p){const t=F.getTypeVarScopesForNode(e);if((0,$.isClassInstance)(l)){if((0,$.isUnion)(p)){const e=(0,W.mapSubtypes)(p,(e=>{if((0,$.isClassInstance)(e)&&0!==e.details.typeParameters.length)return $.ClassType.isProtocolClass(e)||e.details.mro.some((e=>(0,$.isClassInstance)(e)&&e.details.typeParameters.length>0&&$.ClassType.isSameGenericClass(l,e)))?e:void 0}),!0);(0,$.isClassInstance)(e)&&(p=e)}if((0,$.isClassInstance)(p)&&!(0,$.isTypeSame)(l,p)){const n=new G.TypeVarContext((0,W.getTypeVarScopeId)(l));if((0,C.populateTypeVarContextBasedOnExpectedType)(Ar,l,p,n,t,e.start)){const e=$.ClassType.cloneForSpecialization(l,void 0,!1);p=(0,W.applySolvedTypeVars)(e,n,{unknownIfNotFound:!0}),c|=4096}}}else(0,$.isFunction)(l)&&(0,$.isUnion)(p)&&(p=(0,W.mapSubtypes)(p,(e=>(0,W.isCallableType)(e)?e:void 0)));p=(0,W.transformExpectedType)(p,t,e.start),nr(l,p,void 0,n,void 0,c)}return en(e,t,n,s,a)}function en(e,t,n,a,r){const s=t.overload;let i,l,p=t.isTypeIncomplete,d=!1,u=0;const m=(0,W.getTypeCondition)(s);if(s.boundToType&&!s.boundToType.includeSubclasses&&s.details.methodClass){const t=Yt(s.details.methodClass,s.details.name);t&&!t.hasImplementation&&ht(c.DiagnosticRule.reportAbstractUsage,g.LocMessage.abstractMethodInvocation().format({method:s.details.name}),9===e.nodeType?e.leftExpression:e)}if(s.boundTypeVarScopeId&&(void 0!==s.preBoundFlags&&s.boundToType&&(0,W.requiresSpecialization)(s.boundToType)&&6&s.preBoundFlags&&n.addSolveForScope(s.boundTypeVarScopeId),"__init__"===s.details.name&&s.strippedFirstParamType&&s.boundToType&&(0,$.isClassInstance)(s.strippedFirstParamType)&&(0,$.isClassInstance)(s.boundToType)&&$.ClassType.isSameGenericClass(s.strippedFirstParamType,s.boundToType)&&s.strippedFirstParamType.typeArguments)){const e=s.strippedFirstParamType.details.typeParameters;i=s.strippedFirstParamType,s.strippedFirstParamType.typeArguments.forEach(((t,a)=>{if(a<e.length){const r=e[a];(0,$.isTypeSame)(r,t,{ignorePseudoGeneric:!0})||n.setTypeVarType(e[a],t)}}))}["cast","isinstance","issubclass"].some((e=>e===s.details.builtInName))&&(r=!0);const y=t.argParams.filter((e=>e.requiresTypeVarMatching)).length;if(y>0){let i=Math.min(y,2);for(let o=0;o<i;o++)za(e,(()=>{t.argParams.forEach((e=>{if(!e.requiresTypeVarMatching)return;const l=sn(e,n,a,{type:s,isIncomplete:t.isTypeIncomplete},{skipUnknownArgCheck:r,skipOverloadArg:0===o,skipBareTypeVarExpectedType:0===o,useNarrowBoundOnly:i>1&&0===o,conditionFilter:m});l.isTypeIncomplete&&(p=!0),0===o&&(l.skippedOverloadArg||l.skippedBareTypeVarExpectedType)&&i++}))}));n.lock()}let h=!1,f=!1,T=[];const v=[];t.argParams.forEach(((e,i)=>{var o;const c=sn(e,n,a,{type:s,isIncomplete:t.isTypeIncomplete},{skipUnknownArgCheck:r,conditionFilter:m});v.push(c),c.isCompatible||(d=!0,u+=t.argParams.length-i+1),c.isTypeIncomplete&&(p=!0),c.condition&&(T=null!==(o=$.TypeCondition.combine(T,c.condition))&&void 0!==o?o:[]),(0,$.isAnyOrUnknown)(c.argType)&&(l=l?(0,W.preserveUnknown)(c.argType,l):c.argType),s.details.paramSpec&&(1===e.argument.argumentCategory&&(0,D.isParamSpecArgsArgument)(s.details.paramSpec,c.argType)&&(h=!0),2===e.argument.argumentCategory&&(0,D.isParamSpecKwargsArgument)(s.details.paramSpec,c.argType)&&(f=!0))}));let b=[];if(t.paramSpecArgList&&t.paramSpecTarget){const r=function(e,t,n,a,r){const s=a.getSignatureContexts();if(1===s.length)return rn(e,t,n,s[0],r);const i=[],l=[];s.forEach((a=>{za(e,(()=>{const s=rn(e,t,n,a,r);s.argumentErrors||i.push(a),(0,o.appendArray)(l,s.typeVarContexts)}))})),i.length>0&&a.copySignatureContexts(i);const p=rn(e,t,n,i.length>0?i[0]:s[0],r);return{argumentErrors:p.argumentErrors,typeVarContexts:l}}(e,t.paramSpecArgList,t.paramSpecTarget,n,a);r.argumentErrors&&(d=!0,u+=1),b=r.typeVarContexts}else s.details.paramSpec&&(h&&f||(p||ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.paramSpecArgsMissing().format({type:wr(s.details.paramSpec)}),e),d=!0,u+=1));let _=Za(s,{args:t.argParams,errorNode:e});T.length>0&&(_=$.TypeBase.cloneForCondition(_,T));let C=!0,I=e;for(;I;){const e=F.getTypeVarScopeNode(I);if(!e)break;const t=F.getScopeIdForNode(e);n.hasSolveForScope(t)&&(C=!1),I=e.parent}((0,$.isFunction)(_)||(0,$.isOverloadedFunction)(_))&&(C=!1);const k=!F.getTypeVarScopesForNode(e).some((e=>n.hasSolveForScope(e)));let w=(0,W.applySolvedTypeVars)(_,n,{unknownIfNotFound:k,unknownExemptTypeVars:tn(s,_),eliminateUnsolvedInUnions:C,applyInScopePlaceholders:!0});if(w=(0,W.addConditionToType)(w,m),b.length>0&&b.forEach((e=>{e&&(w=(0,W.applySolvedTypeVars)(w,e))})),(0,$.isUnpackedClass)(w)&&(w=$.ClassType.cloneForUnpacked(w,!1)),(0,$.isClassInstance)(w)&&$.ClassType.isBuiltIn(w,["TypeGuard","TypeIs"])&&w.typeArguments&&w.typeArguments.length>0&&pe&&(0,$.isInstantiableClass)(pe)){let e=w.typeArguments[0];if(v.length>0){const t=v[0].argType;(0,$.isTypeVar)(t)&&!t.details.isParamSpec&&0===t.details.constraints.length&&(e=(0,W.addConditionToType)(e,[{typeVar:t,constraintIndex:0}]))}const t=$.ClassType.isBuiltIn(w,"TypeIs");w=$.ClassType.cloneAsInstance($.ClassType.cloneForTypeGuard(pe,e,t))}const S=F.getTypeVarScopesForNode(e);return w=nn(s,w,S,a.getTrackedSignatures()),i&&(i=(0,W.applySolvedTypeVars)(i,n)),t.argumentMatchScore=u,{argumentErrors:d,argResults:v,anyOrUnknownArgument:l,returnType:w,isTypeIncomplete:p,activeParam:t.activeParam,specializedInitSelfType:i,overloadsUsedForCall:d?[]:[s]}}function tn(e,t){if((0,$.isFunction)(t)&&!t.details.name){if(t.details.typeVarScopeId&&e.details.typeVarScopeId){let n=(0,W.getTypeVarArgumentsRecursive)(t);return e.details.parameters.forEach(((e,t)=>{if(e.hasDeclaredType){const t=(0,W.getTypeVarArgumentsRecursive)(e.type);n=n.filter((e=>!t.some((t=>(0,$.isTypeSame)(e,t)))))}})),n}}return[]}function nn(e,t,n,a){if((0,$.isFunction)(t)&&!t.details.name&&e.details.typeVarScopeId){const r=(0,W.getTypeVarArgumentsRecursive)(t).filter((e=>!n.some((t=>e.scopeId===t))));if(r.length>0)return $.FunctionType.cloneWithNewTypeVarScopeId(t,e.details.typeVarScopeId,r,a)}return t}function an(e,t,n,a,r=!1,s,i){i||(i=new W.UniqueSignatureTracker),n.type=(0,W.ensureFunctionSignaturesAreUnique)(n.type,i,e.start);const o=Qt(e,t,n,0,i);return o.argumentErrors?(t.forEach((e=>{e.valueExpression&&!Va(e.valueExpression)&&Be(e.valueExpression)})),{argumentErrors:!0,activeParam:o.activeParam,overloadsUsedForCall:[]}):Xt(e,o,a,r,(0,W.makeInferenceContext)(null==s?void 0:s.expectedType,null==s?void 0:s.isTypeIncomplete),i)}function rn(e,t,n,a,r){var s;let i=a.getParamSpecType(n);i||(i=(0,W.convertTypeToParamSpecValue)(n));const o=Qt(e,t,{type:i},0,r),l=o.overload,p=new G.TypeVarContext((0,W.getTypeVarScopeIds)(i));if(o.argumentErrors)return t.forEach((e=>{e.valueExpression&&!Va(e.valueExpression)&&Be(e.valueExpression)})),{argumentErrors:!0,typeVarContexts:[p]};if(l.details.paramSpec&&0===l.details.parameters.length&&(0,$.isTypeSame)(l.details.paramSpec,n)){let a,i=!1,o=!1,d=!1;for(const e of t){const t=null===(s=Pa(e,void 0,r))||void 0===s?void 0:s.type,l=t&&((0,$.isTypeSame)(t,n,{ignoreTypeFlags:!0})||(0,$.isAnyOrUnknown)(t));1===e.argumentCategory&&!i&&l?i=!0:2===e.argumentCategory&&!o&&l?o=!0:(a=null!=a?a:e.valueExpression,d=!0)}return i&&o||(d=!0),d&&ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.paramSpecArgsMissing().format({type:wr(l.details.paramSpec)}),null!=a?a:e),{argumentErrors:d,typeVarContexts:[p]}}return{argumentErrors:!!en(e,o,p,r,void 0).argumentErrors,typeVarContexts:[p]}}function sn(e,t,n,a,r){var s;let i,o,l=!!(null==a?void 0:a.isIncomplete),d=!0;const u=null==a?void 0:a.type.details.name;let m=!1,y=!1;if(e.argument.valueExpression){let b,_=!0;if((0,W.doForEachSubtype)(e.paramType,(e=>{(0,$.isTypeVar)(e)&&e.scopeId===(null==a?void 0:a.type.details.typeVarScopeId)||(_=!1)})),r.skipBareTypeVarExpectedType&&_)m=!0,(0,$.isUnion)(e.paramType)&&(y=!0);else{b=e.paramType;(0,$.isFunction)(e.paramType)&&!!e.paramType.details.paramSpec&&t.getSignatureContexts().length>1||(b=(0,W.applySolvedTypeVars)(b,t,{useNarrowBoundOnly:!!r.useNarrowBoundOnly}))}if(b&&(0,$.isUnknown)(b)&&(b=void 0),e.argType)i=e.argType;else{const C=e.isinstanceParam?634:18,k=Be(e.argument.valueExpression,C,(0,W.makeInferenceContext)(b,!!(null==a?void 0:a.isIncomplete)),n);if(i=k.type,i=(0,W.ensureFunctionSignaturesAreUnique)(i,n,e.argument.valueExpression.start),k.isIncomplete&&(l=!0),k.typeErrors)d=!1;else if(b&&(0,W.requiresSpecialization)(b)){const w=t.clone();nr(b,i,void 0,w)?t.copyFromClone(w):d=!1}o=k.expectedTypeDiagAddendum}e.argument&&e.argument.name&&!Va(e.errorNode)&&De(e.argument.name,{type:null!=b?b:i,isIncomplete:l},0)}else{if(e.argType)i=e.argType;else{const S=Pa(e.argument,void 0,n);i=S.type,S.isIncomplete&&(l=!0)}e.isDefaultArg&&(i=(0,W.applySolvedTypeVars)(i,t))}2===e.paramCategory&&(0,$.isTypeVar)(e.paramType)&&(i=Ge(i)),r.conditionFilter&&(i=It(i,{conditionFilter:r.conditionFilter},(e=>e)));const h=i.condition;let f=new p.DiagnosticAddendum;if((0,$.isParamSpec)(e.paramType)){if(void 0!==e.paramType.paramSpecAccess)return{isCompatible:d,argType:i,isTypeIncomplete:l,condition:h};if((0,$.isParamSpec)(i)&&void 0!==i.paramSpecAccess)return{isCompatible:d,argType:i,isTypeIncomplete:l,condition:h}}if(r.skipOverloadArg){if((0,$.isOverloadedFunction)(i))return{isCompatible:d,argType:i,isTypeIncomplete:l,skippedOverloadArg:!0,skippedBareTypeVarExpectedType:m,condition:h};const A=Ct(e.paramType);if((0,$.isFunction)(A)||(0,$.isOverloadedFunction)(A)){if((0,$.isInstantiableClass)(i)){if((0,I.createFunctionFromConstructor)(Ar,i))return{isCompatible:d,argType:i,isTypeIncomplete:l,skippedOverloadArg:!0,skippedBareTypeVarExpectedType:m,condition:h}}if((0,$.isClassInstance)(i)){const x=(0,W.lookUpObjectMember)(i,"__call__",16);if(x){const P=Ja(x);if((0,$.isOverloadedFunction)(P))return{isCompatible:d,argType:i,isTypeIncomplete:l,skippedOverloadArg:!0,skippedBareTypeVarExpectedType:m,condition:h}}}}}let T=y?8:0;if(e.isinstanceParam&&(T|=32768),!nr(e.paramType,i,f.createAddendum(),t,void 0,T)){if("none"!==v.getFileInfo(e.errorNode).diagnosticRuleSet.reportArgumentType&&!gt(e.errorNode)&&!l){const N=wr(i),D=wr(e.paramType);let F;F=e.paramName&&!e.isParamNameSynthesized?u?g.LocMessage.argAssignmentParamFunction().format({argType:N,paramType:D,functionName:u,paramName:e.paramName}):g.LocMessage.argAssignmentParam().format({argType:N,paramType:D,paramName:e.paramName}):u?g.LocMessage.argAssignmentFunction().format({argType:N,paramType:D,functionName:u}):g.LocMessage.argAssignment().format({argType:N,paramType:D}),o&&(f=o),ht(c.DiagnosticRule.reportArgumentType,F+f.getString(),e.errorNode,null!==(s=f.getEffectiveTextRange())&&void 0!==s?s:e.errorNode)}return{isCompatible:!1,argType:i,isTypeIncomplete:l,skippedBareTypeVarExpectedType:m,condition:h}}if(!r.skipUnknownArgCheck){const E=(0,$.removeUnbound)(i);function M(){const t=new p.DiagnosticAddendum;return e.paramName&&t.addMessage((u?g.LocAddendum.argParamFunction().format({paramName:e.paramName,functionName:u}):g.LocAddendum.argParam().format({paramName:e.paramName}))+t.getString()),t}if("none"!==v.getFileInfo(e.errorNode).diagnosticRuleSet.reportUnknownArgumentType&&!(0,$.isAny)(e.paramType)&&!l)if((0,$.isUnknown)(E)){const O=M();ht(c.DiagnosticRule.reportUnknownArgumentType,g.LocMessage.argTypeUnknown()+O.getString(),e.errorNode)}else if((0,W.isPartlyUnknown)(E)&&!(0,W.isPartlyUnknown)(e.paramType)){const z=M();z.addMessage(g.LocAddendum.argumentType().format({type:wr(E,{expandTypeAlias:!0})})),ht(c.DiagnosticRule.reportUnknownArgumentType,g.LocMessage.argTypePartiallyUnknown()+z.getString(),e.errorNode)}}return{isCompatible:d,argType:i,isTypeIncomplete:l,skippedBareTypeVarExpectedType:m,condition:h}}function on(e,t,n){var a,r,s,i,o,l,p;let d,m,y="";if(0===n.length)return void mt(g.LocMessage.typeVarFirstArg(),e);const h=n[0];h.valueExpression&&48===h.valueExpression.nodeType?y=h.valueExpression.strings.map((e=>e.value)).join(""):mt(g.LocMessage.typeVarFirstArg(),h.valueExpression||e);const f=$.TypeBase.cloneAsSpecialForm($.TypeVarType.createInstantiable(y,!1),$.ClassType.cloneAsInstance(t)),T=new Map;for(let c=1;c<n.length;c++){const y=n[c].name,h=y?y.value:void 0;if(h){if(T.get(h)&&mt(g.LocMessage.duplicateParam().format({name:h}),n[c].valueExpression||e),"bound"===h)if(f.details.constraints.length>0)mt(g.LocMessage.typeVarBoundAndConstrained(),n[c].valueExpression||e);else{const t=null!==(r=null===(a=n[c].typeResult)||void 0===a?void 0:a.type)&&void 0!==r?r:Da(n[c].valueExpression,{disallowProtocolAndTypedDict:!0}).type;(0,W.requiresSpecialization)(t,{ignorePseudoGeneric:!0,ignoreImplicitTypeArgs:!0})&&mt(g.LocMessage.typeVarBoundGeneric(),n[c].valueExpression||e),f.details.boundType=(0,W.convertToInstance)(t)}else if("covariant"===h)n[c].valueExpression&&mn(n[c].valueExpression)&&(4===f.details.declaredVariance||0===f.details.declaredVariance?mt(g.LocMessage.typeVarVariance(),n[c].valueExpression):f.details.declaredVariance=3);else if("contravariant"===h)n[c].valueExpression&&mn(n[c].valueExpression)&&(3===f.details.declaredVariance||0===f.details.declaredVariance?mt(g.LocMessage.typeVarVariance(),n[c].valueExpression):f.details.declaredVariance=4);else if("infer_variance"===h)n[c].valueExpression&&mn(n[c].valueExpression)&&(3===f.details.declaredVariance||4===f.details.declaredVariance?mt(g.LocMessage.typeVarVariance(),n[c].valueExpression):f.details.declaredVariance=0);else if("default"===h){m=n[c].valueExpression;const a=null!==(i=null===(s=n[c].typeResult)||void 0===s?void 0:s.type)&&void 0!==i?i:Da(m,{allowTypeVarsWithoutScopeId:!0}).type;f.details.defaultType=(0,W.convertToInstance)(a),f.details.isDefaultExplicit=!0;const r=v.getFileInfo(e);!r.isStubFile&&r.executionEnvironment.pythonVersion.isLessThan(u.pythonVersion3_13)&&"typing_extensions"!==t.details.moduleName&&mt(g.LocMessage.typeVarDefaultIllegal(),m)}else mt(g.LocMessage.typeVarUnknownParam().format({name:h}),(null===(o=n[c].node)||void 0===o?void 0:o.name)||n[c].valueExpression||e);T.set(h,h)}else if(f.details.boundType)mt(g.LocMessage.typeVarBoundAndConstrained(),n[c].valueExpression||e);else{const t=null!==(p=null===(l=n[c].typeResult)||void 0===l?void 0:l.type)&&void 0!==p?p:Da(n[c].valueExpression).type;(0,W.requiresSpecialization)(t,{ignorePseudoGeneric:!0})&&mt(g.LocMessage.typeVarConstraintGeneric(),n[c].valueExpression||e),$.TypeVarType.addConstraint(f,(0,W.convertToInstance)(t)),void 0===d&&(d=n[c])}}return 1===f.details.constraints.length&&d&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarSingleConstraint(),d.valueExpression||e),f.details.isDefaultExplicit&&m&&ln(f,m),f}function ln(e,t){(0,l.assert)(e.details.isDefaultExplicit);const n=new G.TypeVarContext(e.scopeId),a=Ct((0,W.applySolvedTypeVars)(e.details.defaultType,n,{unknownIfNotFound:!0}));if(e.details.boundType)nr(e.details.boundType,a)||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarDefaultBoundMismatch(),t);else if(e.details.constraints.length>0){let n=!0;if((0,$.isTypeVar)(e.details.defaultType)&&e.details.defaultType.details.constraints.length>0)for(const t of e.details.defaultType.details.constraints)e.details.constraints.some((e=>(0,$.isTypeSame)(e,t)))||(n=!1);else e.details.constraints.some((e=>(0,$.isTypeSame)(e,a,{ignoreConditions:!0})))||(n=!1);n||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarDefaultConstraintMismatch(),t)}}function pn(e,t,n){var a,r;let s="";if(0===n.length)return void mt(g.LocMessage.typeVarFirstArg(),e);const i=n[0];i.valueExpression&&48===i.valueExpression.nodeType?s=i.valueExpression.strings.map((e=>e.value)).join(""):mt(g.LocMessage.typeVarFirstArg(),i.valueExpression||e);const o=$.TypeBase.cloneAsSpecialForm($.TypeVarType.createInstantiable(s,!1),$.ClassType.cloneAsInstance(t));o.details.isVariadic=!0,o.details.defaultType=zt([{type:$.UnknownType.create(),isUnbounded:!0}]);for(let s=1;s<n.length;s++){const i=n[s].name,l=i?i.value:void 0;if(l)if("default"===l){const a=n[s].valueExpression;if(a){const e=cn(a,!1);e&&(o.details.defaultType=e,o.details.isDefaultExplicit=!0)}const r=v.getFileInfo(e);!r.isStubFile&&r.executionEnvironment.pythonVersion.isLessThan(u.pythonVersion3_13)&&"typing_extensions"!==t.details.moduleName&&mt(g.LocMessage.typeVarDefaultIllegal(),a)}else mt(g.LocMessage.typeVarTupleUnknownParam().format({name:(null===(a=n[s].name)||void 0===a?void 0:a.value)||"?"}),(null===(r=n[s].node)||void 0===r?void 0:r.name)||n[s].valueExpression||e);else mt(g.LocMessage.typeVarTupleConstraints(),n[s].valueExpression||e)}return o}function cn(e,t){const n=Da(e,{allowUnpackedTuple:!0,allowTypeVarsWithoutScopeId:!0,allowForwardReference:t}).type,a=(0,$.isClass)(n)&&(0,W.isTupleClass)(n)&&n.isUnpacked,r=(0,$.isUnpackedVariadicTypeVar)(n);if(a||r)return(0,W.convertToInstance)(n);ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarTupleDefaultNotUnpacked(),e)}function dn(e,t,n){if(0===n.length)return void mt(g.LocMessage.paramSpecFirstArg(),e);const a=n[0];let r="";a.valueExpression&&48===a.valueExpression.nodeType?r=a.valueExpression.strings.map((e=>e.value)).join(""):mt(g.LocMessage.paramSpecFirstArg(),a.valueExpression||e);const s=$.TypeBase.cloneAsSpecialForm($.TypeVarType.createInstantiable(r,!0),$.ClassType.cloneAsInstance(t));s.details.defaultType=(0,W.getUnknownTypeForParamSpec)();for(let a=1;a<n.length;a++){const r=n[a].name,i=r?r.value:void 0;if(!i){mt(g.LocMessage.paramSpecUnknownArg(),n[a].valueExpression||e);break}if("default"===i){const r=n[a].valueExpression;if(r){const e=un(r,!1);e&&(s.details.defaultType=e,s.details.isDefaultExplicit=!0)}const i=v.getFileInfo(e);!i.isStubFile&&i.executionEnvironment.pythonVersion.isLessThan(u.pythonVersion3_13)&&"typing_extensions"!==t.details.moduleName&&mt(g.LocMessage.typeVarDefaultIllegal(),r)}else mt(g.LocMessage.paramSpecUnknownParam().format({name:i}),r||n[a].valueExpression||e)}return s}function un(e,t){const n=$.FunctionType.createSynthesizedInstance("",65536);if(18===e.nodeType)return $.FunctionType.addDefaultParameters(n),n.details.flags|=32768,n;if(31===e.nodeType)return e.entries.forEach(((e,a)=>{const r=Da(e,{allowTypeVarsWithoutScopeId:!0,allowForwardReference:t});$.FunctionType.addParameter(n,{category:0,name:`__p${a}`,isNameSynthesized:!0,hasDeclaredType:!0,type:(0,W.convertToInstance)(r.type)})})),e.entries.length>0&&$.FunctionType.addPositionOnlyParameterSeparator(n),De(e,{type:$.AnyType.create()},void 0),n;{const t=Da(e,{allowParamSpec:!0,allowTypeVarsWithoutScopeId:!0});if(t.typeErrors)return;if((0,$.isParamSpec)(t.type))return n.details.paramSpec=t.type,n;if((0,$.isClassInstance)(t.type)&&$.ClassType.isBuiltIn(t.type,["EllipsisType","ellipsis"]))return $.FunctionType.addDefaultParameters(n),n}ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.paramSpecDefaultNotTuple(),e)}function mn(e){if(11===e.nodeType){if(15===e.constType)return!1;if(33===e.constType)return!0}return ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.expectedBoolLiteral(),e),!1}function yn(e,t){var n,a,r;const s=v.getFileInfo(e);let i="";if(2!==t.length)return void ht(c.DiagnosticRule.reportCallIssue,g.LocMessage.newTypeParamCount(),e);const o=t[0];if(0===o.argumentCategory&&o.valueExpression&&48===o.valueExpression.nodeType&&(i=o.valueExpression.strings.map((e=>e.value)).join("")),!i)return void ht(c.DiagnosticRule.reportArgumentType,g.LocMessage.newTypeBadName(),null!==(n=t[0].node)&&void 0!==n?n:e);if(3===(null===(a=e.parent)||void 0===a?void 0:a.nodeType)&&38===e.parent.leftExpression.nodeType&&e.parent.leftExpression.value!==i)return void ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.newTypeNameMismatch(),e.parent.leftExpression);let l=Na(t[1]).type,p=!1;if((0,$.isAnyOrUnknown)(l)&&(ae&&(0,$.isClassInstance)(ae)&&(l=$.ClassType.cloneAsInstantiable(ae)),ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.newTypeAnyOrUnknown(),null!==(r=t[1].node)&&void 0!==r?r:e),p=!0),l.specialForm&&(0,$.isInstantiableClass)(l.specialForm)&&$.ClassType.isBuiltIn(l.specialForm,"Annotated"))return void ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.newTypeNotAClass(),t[1].node||e);if(!(0,$.isInstantiableClass)(l))return void ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.newTypeNotAClass(),t[1].node||e);$.ClassType.isProtocolClass(l)||$.ClassType.isTypedDictClass(l)?ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.newTypeProtocolClass(),t[1].node||e):void 0!==l.literalValue&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.newTypeLiteral(),t[1].node||e);let d=-4&l.details.flags;d|=1610620928;const u=$.ClassType.createInstantiable(i,F.getClassFullName(e,s.moduleName,i),s.moduleName,s.fileUri,d,F.getTypeSourceId(e),void 0,l.details.effectiveMetaclass);if(u.details.baseClasses.push(p?$.AnyType.create():l),(0,W.computeMroLinearization)(u),!p){const e=$.FunctionType.createSynthesizedInstance("__init__");$.FunctionType.addParameter(e,{category:0,name:"self",type:$.ClassType.cloneAsInstance(u),hasDeclaredType:!0}),$.FunctionType.addParameter(e,{category:0,name:"_x",type:$.ClassType.cloneAsInstance(l),hasDeclaredType:!0}),e.details.declaredReturnType=rt(),$.ClassType.getSymbolTable(u).set("__init__",U.Symbol.createWithType(4,e));const t=$.FunctionType.createSynthesizedInstance("__new__",1);$.FunctionType.addParameter(t,{category:0,name:"cls",type:u,hasDeclaredType:!0}),$.FunctionType.addDefaultParameters(t),t.details.declaredReturnType=$.ClassType.cloneAsInstance(u),t.details.constructorTypeVarScopeId=u.details.typeVarScopeId,$.ClassType.getSymbolTable(u).set("__new__",U.Symbol.createWithType(4,t))}return u}function gn(e,t,n){const a=v.getFileInfo(e),r=Pa(t[0],void 0,void 0).type;if(!(0,$.isClassInstance)(r)||!$.ClassType.isBuiltIn(r,"str"))return;const s=r.literalValue||"_",i=Pa(t[1],void 0,void 0).type;if(!(0,$.isClassInstance)(i)||!(0,W.isTupleClass)(i)||void 0===i.tupleTypeArguments)return;const o=$.ClassType.createInstantiable(s,F.getClassFullName(e,a.moduleName,s),a.moduleName,a.fileUri,1073741824,F.getTypeSourceId(e),n,i.details.effectiveMetaclass);return i.tupleTypeArguments.forEach((n=>{const a=Ct(n.type);(0,W.isEffectivelyInstantiable)(a)?o.details.baseClasses.push(a):Tt(n.type,t[1].valueExpression||e)})),(0,W.computeMroLinearization)(o)||mt(g.LocMessage.methodOrdering(),e),o}function hn(e,t,n,a,r,s){let i=!0;const o=e=>{let o;const p=Ct(e);if((0,$.isClass)(p)&&(o=Je(p,t,e,s)),o){const e=n.map((e=>({argumentCategory:0,typeResult:e})));let t;return t=za(a,(()=>((0,l.assert)(void 0!==o),Zt(a,e,{type:o},void 0,!0,r,void 0)))),t.argumentErrors&&r&&(t=za(a,(()=>((0,l.assert)(void 0!==o),Zt(a,e,{type:o},void 0,!0,void 0,void 0))))),t.argumentErrors&&(i=!1),t.returnType}i=!1},p=(0,W.mapSubtypes)(e,(e=>(0,$.isAnyOrUnknown)(e)?e:(0,$.isClassInstance)(e)||(0,$.isInstantiableClass)(e)||(0,$.isTypeVar)(e)?o(e):(0,W.isNoneInstance)(e)&&ae&&(0,$.isClassInstance)(ae)?o(ae):(0,W.isNoneTypeClass)(e)&&re&&(0,$.isInstantiableClass)(re)?o($.ClassType.cloneAsInstance(re)):void(i=!1)));if(i)return p}function fn(e,t,n){t.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(t.expectedType);let a=Ct(t.expectedType);if(!(0,$.isClassInstance)(a))return;const r=[],s=[];let i,o,l=!1,p=!1;if($.ClassType.isTypedDictClass(a)){a=$.TypeBase.cloneForCondition(a,void 0);const t=Tn(e,r,s,!0,!0,void 0,void 0,(0,K.getTypedDictMembersForClass)(Ar,a),n);t.isIncomplete&&(l=!0),t.typeErrors&&(p=!0);const i=(0,K.assignToTypedDict)(Ar,a,r,s,(null==n?void 0:n.isEmpty())?n:void 0);return i?{type:i,isIncomplete:l}:void 0}if((0,$.isAnyOrUnknown)(t.expectedType))i=t.expectedType,o=t.expectedType;else{const n=Ea(e,"dict");if(!(0,$.isClassInstance)(n))return;const a=new G.TypeVarContext((0,W.getTypeVarScopeId)(n));if(!(0,C.populateTypeVarContextBasedOnExpectedType)(Ar,n,t.expectedType,a,F.getTypeVarScopesForNode(e),e.start))return;const r=(0,W.applySolvedTypeVars)($.ClassType.cloneAsInstantiable(n),a);if(!r.typeArguments||2!==r.typeArguments.length)return;i=r.typeArguments[0],o=r.typeArguments[1]}let c=!1;if((0,$.isClassInstance)(t.expectedType)&&t.expectedType.details.typeParameters.length>=2){const e=t.expectedType.details.typeParameters[1];2===$.TypeVarType.getVariance(e)&&(c=!0)}const d=Tn(e,r,s,!0,c,i,o,void 0,n);d.isIncomplete&&(l=!0),d.typeErrors&&(p=!0);const u=Cn((0,W.makeInferenceContext)(i),r.map((e=>e.type)),!1),m=Cn((0,W.makeInferenceContext)(o),s.map((e=>e.type)),!c);if(!u||!m)return;return{type:Ea(e,"dict",[u,m]),isIncomplete:l,typeErrors:p}}function Tn(e,t,n,a,r,s,i,o,l){let p=!1,d=!1;return e.entries.forEach(((e,u)=>{var m,y,h,f;let T=!0;if(17===e.nodeType){const c=Be(e.keyExpression,void 0,(0,W.makeInferenceContext)(null!=s?s:a?$.NeverType.createNever():void 0));c.isIncomplete&&(p=!0),c.typeErrors&&(d=!0);const m=c.type;let y,g;if(c.isIncomplete||c.typeErrors||_n(e.keyExpression,m,!0),l&&c.expectedTypeDiagAddendum&&l.addAddendum(c.expectedTypeDiagAddendum),o&&(0,$.isClassInstance)(m)&&$.ClassType.isBuiltIn(m,"str")&&(0,W.isLiteralType)(m)&&o.knownItems.has(m.literalValue)){const t=o.knownItems.get(m.literalValue).valueType;g=(0,W.makeInferenceContext)(t),y=Be(e.valueExpression,void 0,g)}else{const t=null!=i?i:a?$.NeverType.createNever():void 0;g=(0,W.makeInferenceContext)(t),y=Be(e.valueExpression,void 0,g)}if(g&&!y.typeErrors){const e=Cn(g,[y.type],!r);e&&(y={...y,type:e})}l&&y.expectedTypeDiagAddendum&&l.addAddendum(y.expectedTypeDiagAddendum);const h=y.type;if(y.isIncomplete&&(p=!0),y.typeErrors&&(d=!0),a||u<Y){if((0,$.isClass)(m)&&(0,W.isLiteralType)(m)){const e=t.findIndex((e=>(0,$.isTypeSame)(m,e.type)));e>=0&&(t.splice(e,1),n.splice(e,1))}t.push({node:e.keyExpression,type:m}),n.push({node:e.valueExpression,type:h})}T=!1}else if(16===e.nodeType){let l;s&&i&&ge&&(0,$.isInstantiableClass)(ge)&&(l=$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(ge,[s,i],!0)));const f=(0,W.makeInferenceContext)(l);let v=Be(e.expandExpression,void 0,f);if(f&&!v.typeErrors){const e=Cn(f,[v.type],!r);e&&(v={...v,type:e})}v.isIncomplete&&(p=!0),v.typeErrors&&(d=!0);const b=v.type;if((0,$.isAnyOrUnknown)(b))T=!1;else if((0,$.isClassInstance)(b)&&$.ClassType.isTypedDictClass(b)){if(de&&(0,$.isInstantiableClass)(de)){const a=$.ClassType.cloneAsInstance(de),r=(0,K.getTypedDictMembersForClass)(Ar,b,!0);r.knownItems.forEach(((r,s)=>{(r.isRequired||r.isProvided)&&(t.push({node:e,type:$.ClassType.cloneWithLiteral(a,s)}),n.push({node:e,type:r.valueType}))})),o||(t.push({node:e,type:$.ClassType.cloneAsInstance(a)}),n.push({node:e,type:null!==(h=null!==(y=null===(m=r.extraItems)||void 0===m?void 0:m.valueType)&&void 0!==y?y:ae)&&void 0!==h?h:$.UnknownType.create()})),T=!1}}else if(ge&&(0,$.isInstantiableClass)(ge)){const r=new G.TypeVarContext((0,W.getTypeVarScopeId)(ge));if(ge=(0,W.selfSpecializeClass)(ge),nr($.ClassType.cloneAsInstance(ge),b,void 0,r,void 0,256)){const s=(0,W.applySolvedTypeVars)(ge,r).typeArguments;s&&s.length>=2&&((a||u<Y)&&(t.push({node:e,type:s[0]}),n.push({node:e,type:s[1]})),T=!1)}else ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.dictUnpackIsNotMapping(),e)}}else if(32===e.nodeType){const r=Sn(e,i,s),o=r.type;if(r.isIncomplete&&(p=!0),r.typeErrors&&(d=!0),(0,$.isClassInstance)(o)&&(0,W.isTupleClass)(o)){const r=null===(f=o.tupleTypeArguments)||void 0===f?void 0:f.map((e=>e.type));r&&2===r.length&&((a||u<Y)&&(t.push({node:e,type:r[0]}),n.push({node:e,type:r[1]})),T=!1)}}T&&(a||u<Y)&&(t.push({node:e,type:$.UnknownType.create()}),n.push({node:e,type:$.UnknownType.create()}))})),{type:$.AnyType.create(),isIncomplete:p,typeErrors:d}}function vn(e,t){const n=31===e.nodeType?"list":"set";t.expectedType=(0,W.transformPossibleRecursiveTypeAlias)(t.expectedType);let a=!1,r=!1;const s=45===e.nodeType,i=bn(e,Fa(e,n),t);if(!i)return;const o=[],l=new p.DiagnosticAddendum;e.entries.forEach((e=>{let t;t=32===e.nodeType?Sn(e,i):Be(e,void 0,(0,W.makeInferenceContext)(i)),o.push(t.type),t.isIncomplete&&(a=!0),t.typeErrors&&(r=!0),t.expectedTypeDiagAddendum&&l.addAddendum(t.expectedTypeDiagAddendum),!s||t.isIncomplete||t.typeErrors||_n(e,t.type,!1)}));let c=!1;(0,$.isClassInstance)(t.expectedType)&&(Qn(t.expectedType),t.expectedType.details.typeParameters.some((e=>2===$.TypeVarType.getVariance(e)))&&(c=!0));const d=Cn((0,W.makeInferenceContext)(i),o,!c);if(!d)return{type:$.UnknownType.create(),isIncomplete:a,typeErrors:!0,expectedTypeDiagAddendum:l};return{type:Ea(e,n,[d]),isIncomplete:a,typeErrors:r,expectedTypeDiagAddendum:l}}function bn(e,t,n){if(!n)return;if(!t||!(0,$.isInstantiableClass)(t))return;if((0,$.isAnyOrUnknown)(n.expectedType))return n.expectedType;if(!(0,$.isClassInstance)(n.expectedType))return;const a=new G.TypeVarContext((0,W.getTypeVarScopeId)(t));if(!(0,C.populateTypeVarContextBasedOnExpectedType)(Ar,$.ClassType.cloneAsInstance(t),n.expectedType,a,F.getTypeVarScopesForNode(e),e.start))return;const r=(0,W.applySolvedTypeVars)(t,a);return r.typeArguments?r.typeArguments[0]:void 0}function _n(e,t,n){if(!function(e){let t=!0;return(0,W.doForEachSubtype)(Ct(e),(e=>{if((0,$.isClassInstance)(e)){let n=!0;if(void 0!==e.details.isInstanceHashable)n=e.details.isInstanceHashable;else{const t=(0,W.lookUpObjectMember)(e,"__hash__",4);if(t&&t.isTypeDeclared){const e=t.symbol.getTypedDeclarations(),a=t.symbol.getSynthesizedType();a?n=!(0,W.isNoneInstance)(a):e.every((e=>1===e.type))&&(n=!1)}e.details.isInstanceHashable=n}n||(t=!1)}})),t}(t)){const a=new p.DiagnosticAddendum;a.addMessage(g.LocAddendum.unhashableType().format({type:wr(t)}));const r=n?g.LocMessage.unhashableDictKey():g.LocMessage.unhashableSetEntry();ht(c.DiagnosticRule.reportUnhashable,r+a.getString(),e)}}function Cn(e,t,n){if((0,$.isAny)(e.expectedType))return e.expectedType;const a=new G.TypeVarContext((0,W.getTypeVarScopeId)(e.expectedType)),r=e.expectedType;let s=!0;if(t.forEach((e=>{s&&!nr(r,e,void 0,a)&&(s=!1)})),s){if(n&&t.length>0){const n=(0,$.combineTypes)(t);return(0,W.containsLiteralType)(e.expectedType)?n:Ge(n)}return(0,W.mapSubtypes)((0,W.applySolvedTypeVars)(e.expectedType,a,{applyInScopePlaceholders:!0}),(e=>{if(1!==t.length)return e;const n=t[0];return(0,$.isTypeSame)(e,n,{ignoreTypedDictNarrowEntries:!0})&&(0,$.isClass)(e)&&(0,$.isClass)(n)&&$.ClassType.isTypedDictClass(n)?$.ClassType.cloneForNarrowedTypedDictEntries(e,n.typedDictNarrowedEntries):e}))}}function In(e,t,n,a){let r,s,i=!!(null==n?void 0:n.isTypeIncomplete),o=!0;if(t){const n=F.getTypeVarScopesForNode(e);t=(0,W.transformExpectedType)(t,n,e.start),s=(0,D.getParameterListDetails)(t),r=Za(t)}let l=$.FunctionType.createInstance("","","",131072);l.details.typeVarScopeId=F.getScopeIdForNode(e),De(e,{type:l,isIncomplete:!0},0);let p=!1;e.parameters.forEach(((t,a)=>{let r;if(s&&!p)if(a<s.params.length){const e=s.params[a];e.param.category===t.category&&!t.name==!e.param.name?r=e.type:p=!0}else t.defaultValue&&(r=Be(t.defaultValue,void 0,n).type);else t.defaultValue&&(r=la(t.defaultValue));if(t.name&&De(t.name,{type:pa(e,t.category,null!=r?r:$.UnknownType.create())},0),t.defaultValue&&Be(t.defaultValue,1),a>=0){let e=!1;0===t.category&&t.name?(0,R.isPrivateName)(t.name.value)&&(e=!0):o=!1,o&&!e&&l.details.parameters.length>0&&$.FunctionType.addPositionOnlyParameterSeparator(l),e||(o=!1)}const i={category:t.category,name:t.name?t.name.value:void 0,hasDefault:!!t.defaultValue,defaultValueExpression:t.defaultValue,hasDeclaredType:!0,type:null!=r?r:$.UnknownType.create()};$.FunctionType.addParameter(l,i)})),o&&l.details.parameters.length>0&&$.FunctionType.addPositionOnlyParameterSeparator(l);let c=!1;return za(a||Va(e)||(null==n?void 0:n.isTypeIncomplete)?e.expression:void 0,(()=>{const t=Be(e.expression,void 0,(0,W.makeInferenceContext)(r));if(l.inferredReturnType=t.type,t.isIncomplete&&(i=!0),t.typeErrors)c=!0;else if(r&&(0,W.requiresSpecialization)(r)){const e=new G.TypeVarContext((0,W.getTypeVarScopeId)(l));nr(r,t.type,void 0,e)&&(l=(0,W.applySolvedTypeVars)(l,e,{applyInScopePlaceholders:!0}))}}),{dependentType:null==n?void 0:n.expectedType,allowDiagnostics:!a&&!gt(e)&&!(null==n?void 0:n.isTypeIncomplete)}),l.details.flags&=-131073,t&&!nr(t,l)&&(c=!0),{type:l,isIncomplete:i,typeErrors:c}}function kn(e,t,n,a,r,s){if("none"===e)return;const i=n.value,o=(0,$.removeUnbound)(a);if((0,$.isUnknown)(o))ht(t,g.LocMessage.typeUnknown().format({name:i}),r);else if((0,W.isPartlyUnknown)(o)&&(!s||!(0,$.isClassInstance)(a)||!a.isEmptyContainer)){const e=new p.DiagnosticAddendum;e.addMessage(g.LocAddendum.typeOfSymbol().format({name:i,type:wr(o,{expandTypeAlias:!0})})),ht(t,g.LocMessage.typePartiallyUnknown().format({name:i})+e.getString(),r)}}function wn(e){var t;let n=!1;if(33===e.nodeType){const a=Be(e.iterableExpression);a.isIncomplete&&(n=!0);const r=null!==(t=nt({type:Ge(a.type),isIncomplete:a.isIncomplete},!!e.isAsync,e.iterableExpression))&&void 0!==t?t:{type:$.UnknownType.create(),isIncomplete:a.isIncomplete};kt(e.targetExpression,r.type,!!r.isIncomplete,e.iterableExpression)}else(0,l.assert)(34===e.nodeType),Va(e.testExpression)||Be(e.testExpression);return n}function Sn(e,t,n){let a=!1,r=!1;for(const t of e.forIfNodes)wn(t)&&(a=!0);let s=$.UnknownType.create();if(17===e.expression.nodeType){const i=Be(e.expression.keyExpression,void 0,(0,W.makeInferenceContext)(n));i.isIncomplete&&(a=!0),i.typeErrors&&(r=!0);let o=i.type;n&&(0,W.containsLiteralType)(n)||(o=Ge(o));const l=Be(e.expression.valueExpression,void 0,(0,W.makeInferenceContext)(t));l.isIncomplete&&(a=!0),l.typeErrors&&(r=!0);let p=l.type;t&&(0,W.containsLiteralType)(t)||(p=Ge(p)),s=zt([{type:o,isUnbounded:!1},{type:p,isUnbounded:!1}])}else if(16===e.expression.nodeType)Be(e.expression.expandExpression,void 0,(0,W.makeInferenceContext)(t));else if((0,h.isExpressionNode)(e)){const n=Be(e.expression,void 0,(0,W.makeInferenceContext)(t));n.isIncomplete&&(a=!0),n.typeErrors&&(r=!0),s=n.type}return{type:s,isIncomplete:a,typeErrors:r}}function An(e,t){if(e.typeList){if(!(null==t?void 0:t.allowTypeArgList))return mt(g.LocMessage.typeArgListNotAllowed(),e.node),!1;e.typeList.forEach((e=>{An(e)}))}if((0,W.isEllipsisType)(e.type)&&!(null==t?void 0:t.allowTypeArgList))return mt(g.LocMessage.ellipsisContext(),e.node),!1;if((0,$.isModule)(e.type))return mt(g.LocMessage.moduleAsType(),e.node),!1;if((0,$.isParamSpec)(e.type)&&!(null==t?void 0:t.allowParamSpec))return mt(g.LocMessage.paramSpecContext(),e.node),!1;if((0,$.isVariadicTypeVar)(e.type)&&!e.type.isVariadicInUnion){if(!(null==t?void 0:t.allowVariadicTypeVar))return mt(g.LocMessage.typeVarTupleContext(),e.node),!1;Ft(e.type,e.node)}return!(null==t?void 0:t.allowEmptyTuple)&&e.isEmptyTupleShorthand?(mt(g.LocMessage.zeroLengthTupleNotAllowed(),e.node),!1):!((0,$.isUnpackedClass)(e.type)&&!(null==t?void 0:t.allowUnpackedTuples))||(mt(g.LocMessage.unpackedArgInTypeArgument(),e.node),!1)}function xn(e,t,n){const a=$.FunctionType.createInstantiable(0);if(a.specialForm=e,a.details.declaredReturnType=$.UnknownType.create(),a.details.typeVarScopeId=F.getScopeIdForNode(n),t&&t.length>0){if(a.isCallableWithTypeArgs=!0,t[0].typeList){const e=t[0].typeList;let n=!1,r=!1;const s=e=>{n&&(r||(mt(g.LocMessage.variadicTypeArgsTooMany(),e.node),r=!0)),n=!0};e.forEach(((e,t)=>{var n;let r=e.type,i=0;const o=`__p${t.toString()}`;(0,$.isVariadicTypeVar)(r)?(Ft(r,e.node),i=1,s(e)):An(e,{allowUnpackedTuples:!0})?(0,$.isUnpackedClass)(r)&&(i=1,(null===(n=r.tupleTypeArguments)||void 0===n?void 0:n.some((e=>(0,$.isVariadicTypeVar)(e.type)||e.isUnbounded)))&&s(e)):r=$.UnknownType.create(),$.FunctionType.addParameter(a,{category:i,name:o,isNameSynthesized:!0,type:(0,W.convertToInstance)(r),hasDeclaredType:!0})})),e.length>0&&$.FunctionType.addPositionOnlyParameterSeparator(a)}else if((0,W.isEllipsisType)(t[0].type))$.FunctionType.addDefaultParameters(a),a.details.flags|=32768;else if((0,$.isParamSpec)(t[0].type))a.details.paramSpec=t[0].type;else if((0,$.isInstantiableClass)(t[0].type)&&$.ClassType.isBuiltIn(t[0].type,"Concatenate")){const e=t[0].type.typeArguments;e&&e.length>0&&e.forEach(((t,n)=>{n===e.length-1?($.FunctionType.addPositionOnlyParameterSeparator(a),(0,$.isParamSpec)(t)?a.details.paramSpec=t:(0,W.isEllipsisType)(t)&&($.FunctionType.addDefaultParameters(a),a.details.flags|=32768)):$.FunctionType.addParameter(a,{category:0,name:`__p${n}`,isNameSynthesized:!0,hasDeclaredType:!0,type:t})}))}else mt(g.LocMessage.callableFirstArg(),t[0].node);if(t.length>1){let e=t[1].type;An(t[1])||(e=$.UnknownType.create()),a.details.declaredReturnType=(0,W.convertToInstance)(e)}else ht(c.DiagnosticRule.reportMissingTypeArgument,g.LocMessage.callableSecondArg(),n),a.details.declaredReturnType=$.UnknownType.create();t.length>2&&mt(g.LocMessage.callableExtraArgs(),t[2].node)}else $.FunctionType.addDefaultParameters(a,!0),a.details.flags|=32768;return a}function Pn(e,t,n,a){if(!n)return 0!=(256&a)?(mt(g.LocMessage.optionalExtraArgs(),t),$.UnknownType.create()):e;if(n.length>1)return mt(g.LocMessage.optionalExtraArgs(),t),$.UnknownType.create();let r=n[0].type;An(n[0])?(0,W.isEffectivelyInstantiable)(r)||(Tt(r,n[0].node),r=$.UnknownType.create()):r=$.UnknownType.create();let s=(0,$.combineTypes)([r,null!=te?te:$.UnknownType.create()]);return se&&(0,$.isInstantiableClass)(se)&&(s=$.TypeBase.cloneAsSpecialForm(s,$.ClassType.cloneAsInstance(se))),s}function Nn(e,t,n){const a=Ea(e,t);return(0,$.isClassInstance)(a)?$.ClassType.cloneWithLiteral($.ClassType.cloneRemoveTypePromotions(a),n):$.UnknownType.create()}function Dn(e,t,n,a){const r=Fa(e,n);if((0,$.isInstantiableClass)(r)){const e=$.ClassType.cloneWithLiteral(r,a);return e.specialForm=t,e}return $.UnknownType.create()}function Fn(e,t,n,a){var r;if(131072&a)return mt(g.LocMessage.classVarNotAllowed(),t),$.AnyType.create();if(!n)return e;if(0===n.length)return mt(g.LocMessage.classVarFirstArgMissing(),t),$.UnknownType.create();if(n.length>1)return mt(g.LocMessage.classVarTooManyArgs(),n[1].node),$.UnknownType.create();const s=n[0].type;return(0,W.requiresSpecialization)(s,{ignorePseudoGeneric:!0,ignoreSelf:!0})&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.classVarWithTypeVar(),null!==(r=n[0].node)&&void 0!==r?r:t),s}function En(e,t,n,a){if(!n)return 0!=(256&a)&&mt(g.LocMessage.typeGuardArgCount(),t),e;if(1!==n.length)return mt(g.LocMessage.typeGuardArgCount(),t),$.UnknownType.create();const r=n.map((e=>(0,W.convertToInstance)(An(e)?e.type:$.UnknownType.create())));return $.ClassType.cloneForSpecialization(e,r,!0)}function Mn(e,t,n,a){var r;n&&ht(c.DiagnosticRule.reportInvalidTypeArguments,g.LocMessage.typeArgsExpectingNone().format({name:e.details.name}),null!==(r=n[0].node)&&void 0!==r?r:t);let s=F.getEnclosingClass(t);s&&!F.isNodeContainedWithin(t,s.suite)&&(s=void 0);const i=s?Yn(s):void 0;if(!i)return 0!=(384&a)&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.selfTypeContext(),t),$.UnknownType.create();if((0,W.isInstantiableMetaclass)(i.classType))return ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.selfTypeMetaclass(),t),$.UnknownType.create();const o=F.getEnclosingFunction(t);if(o){const e=(0,S.getFunctionInfoFromDecorators)(Ar,o,!0);if(!!!F.getEnclosingFunction(o)){if(4&e.flags)return ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.selfTypeContext(),t),$.UnknownType.create();if(o.parameters.length>0){const e=F.getTypeAnnotationForParameter(o,0);if(e&&!F.isNodeContainedWithin(t,e)){const n=$e(e,{associateTypeVarsWithScope:!0});(0,$.isTypeVar)(n)&&n.details.isSynthesizedSelf||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.selfTypeWithTypedSelfOrCls(),t)}}}}return(0,W.synthesizeTypeVarForSelfCls)(i.classType,!0)}function On(e,t,n,a){if(!n&&0==(256&a))return{type:e};if(!n||1!==n.length)return mt("ReadOnly"===e.details.name?g.LocMessage.readOnlyArgCount():"Required"===e.details.name?g.LocMessage.requiredArgCount():g.LocMessage.notRequiredArgCount(),t),{type:e};const r=n[0].type,s=F.getEnclosingClass(t,!0),i=s?Yn(s):void 0;let o=!1;i&&(0,$.isInstantiableClass)(i.classType)&&$.ClassType.isTypedDictClass(i.classType)&&F.isNodeContainedWithinNodeType(t,54)&&(o=!0),0!=(1048576&a)&&(o=!0);let l=n[0].isReadOnly,p=n[0].isRequired,c=n[0].isNotRequired;return"ReadOnly"===e.details.name?(n[0].isReadOnly&&(o=!1),l=!0):((n[0].isRequired||n[0].isNotRequired)&&(o=!1),p="Required"===e.details.name,c="NotRequired"===e.details.name),o?{type:r,isReadOnly:l,isRequired:p,isNotRequired:c}:(mt("ReadOnly"===e.details.name?g.LocMessage.readOnlyNotInTypedDict():"Required"===e.details.name?g.LocMessage.requiredNotInTypedDict():g.LocMessage.notRequiredNotInTypedDict(),t),{type:$.ClassType.cloneForSpecialization(e,[(0,W.convertToInstance)(r)],!!n)})}function zn(e,t,n,a){if(!n&&0==(256&a))return e;if(!n||1!==n.length)return mt(g.LocMessage.unpackArgCount(),t),$.UnknownType.create();let r=n[0].type;return(0,$.isUnion)(r)&&1===r.subtypes.length&&(r=r.subtypes[0]),0!=(2097152&a)?(0,$.isInstantiableClass)(r)&&!r.includeSubclasses&&(0,W.isTupleClass)(r)?$.ClassType.cloneForUnpacked(r):(0,$.isVariadicTypeVar)(r)&&!r.isVariadicUnpacked?$.TypeVarType.cloneForUnpacked(r):(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.unpackExpectedTypeVarTuple(),t),$.UnknownType.create()):0!=(8388608&a)?(0,$.isInstantiableClass)(r)&&$.ClassType.isTypedDictClass(r)?$.ClassType.cloneForUnpacked(r):(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.unpackExpectedTypedDict(),t),$.UnknownType.create()):(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.unpackNotAllowed(),t),$.UnknownType.create())}function Vn(e,t,n,a){return 16&a?(mt(g.LocMessage.finalContext(),t),e):n&&0!==n.length?(n.length>1&&mt(g.LocMessage.finalTooManyArgs(),t),$.TypeBase.cloneAsSpecialForm(n[0].type,e)):e}function Un(e,t,n,a){return 0==(134217728&a)?(mt(g.LocMessage.concatenateContext(),t),$.AnyType.create()):(n&&0!==n.length?n.forEach(((e,t)=>{t===n.length-1?(0,$.isParamSpec)(e.type)||(0,W.isEllipsisType)(e.type)||mt(g.LocMessage.concatenateParamSpecMissing(),e.node):(0,$.isParamSpec)(e.type)?mt(g.LocMessage.paramSpecContext(),e.node):(0,$.isUnpackedVariadicTypeVar)(e.type)?mt(g.LocMessage.typeVarTupleContext(),e.node):(0,$.isUnpackedClass)(e.type)&&mt(g.LocMessage.unpackedArgInTypeArgument(),e.node)})):mt(g.LocMessage.concatenateTypeArgsMissing(),t),Rn(e,n,void 0,!0))}function Rn(e,t,n,a=!1,r=!0){const s=$.ClassType.isTupleClass(e);if(t)if(s&&1===t.length&&t[0].isEmptyTupleShorthand)t=[];else{let e=!1;const r=t=>{e&&(i||(mt(g.LocMessage.variadicTypeArgsTooMany(),t.node),i=!0)),e=!0};let i=!1;t.forEach(((e,i)=>{var o;(0,l.assert)(void 0!==t),(0,W.isEllipsisType)(e.type)?s?2!==t.length||1!==i?mt(g.LocMessage.ellipsisSecondArg(),e.node):(0,$.isVariadicTypeVar)(t[0].type)&&!t[0].type.isVariadicInUnion?mt(g.LocMessage.typeVarTupleContext(),t[0].node):(0,$.isUnpackedClass)(t[0].type)&&mt(g.LocMessage.ellipsisAfterUnpacked(),e.node):a||mt(g.LocMessage.ellipsisContext(),e.node):(0,$.isParamSpec)(e.type)&&a||(void 0===n&&(0,$.isVariadicTypeVar)(e.type)?(e.type.isVariadicInUnion||r(e),Ft(e.type,e.node)):void 0===n&&(0,$.isUnpackedClass)(e.type)?((null===(o=e.type.tupleTypeArguments)||void 0===o?void 0:o.some((e=>(0,$.isVariadicTypeVar)(e.type)||e.isUnbounded)))&&r(e),An(e,{allowUnpackedTuples:!0})):An(e))}))}let i,p=t?t.map((e=>(0,W.convertToInstance)(e.type))):[];if(void 0!==n)if(t&&p.length>n)mt(g.LocMessage.typeArgsTooMany().format({name:e.aliasName||e.details.name,expected:n,received:p.length}),t[n].node),p=p.slice(0,n);else if(p.length<n)for(;p.length<n;)p.push($.UnknownType.create());if(s){const n=[];t?t.forEach(((e,t)=>{1===t&&(0,W.isEllipsisType)(p[t])?1!==n.length||n[0].isUnbounded||(n[0]={type:n[0].type,isUnbounded:!0}):(0,$.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments?(0,o.appendArray)(n,e.type.tupleTypeArguments):n.push({type:p[t],isUnbounded:!1})})):n.push({type:$.UnknownType.create(),isUnbounded:!0}),i=(0,W.specializeTupleClass)(e,n,void 0!==t)}else i=$.ClassType.cloneForSpecialization(e,p,void 0!==t);return r&&(i=$.TypeBase.cloneAsSpecialForm(i,e)),i}function Ln(e,t,n,a){const r=v.getFileInfo(t),s=[];let i=!1;if(!n)return 0!=(256&a)?(mt(g.LocMessage.unionTypeArgCount(),t),$.NeverType.createNever()):e;for(const e of n){let n=e.type;An(e,{allowVariadicTypeVar:r.diagnosticRuleSet.enableExperimentalFeatures})?(0,W.isEffectivelyInstantiable)(n)||(Tt(n,e.node),n=$.UnknownType.create()):n=$.UnknownType.create(),(0,$.isUnpackedClass)(e.type)&&e.type.tupleTypeArguments?r.diagnosticRuleSet.enableExperimentalFeatures?(e.type.tupleTypeArguments.forEach((e=>{s.push((0,W.convertToInstantiable)(e.type))})),i=!0):(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.unionUnpackedTuple(),t),s.push($.UnknownType.create())):((0,$.isTypeVar)(n)&&(0,$.isUnpackedVariadicTypeVar)(n)&&(r.diagnosticRuleSet.enableExperimentalFeatures?(n=$.TypeVarType.cloneForUnpacked(n,!0),i=!0):(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.unionUnpackedTypeVarTuple(),t),n=$.UnknownType.create())),s.push(n))}1!==s.length||i||(0,W.isNoneInstance)(s[0])||ht(c.DiagnosticRule.reportInvalidTypeArguments,g.LocMessage.unionTypeArgCount(),t);let o=(0,$.combineTypes)(s);return se&&(0,$.isInstantiableClass)(se)&&(o=$.TypeBase.cloneAsSpecialForm(o,$.ClassType.cloneAsInstance(se))),o}function jn(e,t,n,a){if(!n)return 0!=(262400&a)&&mt(g.LocMessage.genericTypeArgMissing(),t),e;const r=[];return n&&(0===n.length&&mt(g.LocMessage.genericTypeArgMissing(),t),n.forEach((e=>{(0,$.isTypeVar)(e.type)?(r.some((t=>(0,$.isTypeSame)(t,e.type)))&&mt(g.LocMessage.genericTypeArgUnique(),e.node),r.push(e.type)):mt(g.LocMessage.genericTypeArgTypeVar(),e.node)}))),Rn(e,n,void 0,!0)}function Bn(e,t,n,a,r,s,i){if(!$.TypeBase.isInstantiable(e))return e;if((0,W.isTypeAliasPlaceholder)(e))return e;s||(s=[],(0,W.doForEachSubtype)(e,(e=>{(0,l.assert)(void 0!==s),(0,W.addTypeVarsToListIfUnique)(s,(0,W.getTypeVarArgumentsRecursive)(e))})),s=s.filter((e=>!e.details.isSynthesized)));const o=(s=s.map((e=>$.TypeBase.isInstance(e)?e:(0,W.convertToInstance)(e)))).findIndex((e=>(0,$.isVariadicTypeVar)(e)));if(o>=0){const e=s.findIndex(((e,t)=>t>o&&!e.details.isParamSpec&&e.details.isDefaultExplicit));e>=0&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarWithDefaultFollowsVariadic().format({typeVarName:s[e].details.name,variadicName:s[o].details.name}),i?i[e].name:t)}const p=F.getScopeIdForNode(t);s.forEach(((e,t)=>{var a;(0,l.assert)(void 0!==s);let r=n;i&&t<i.length&&(r=null!==(a=i[t].defaultExpression)&&void 0!==a?a:i[t].name),Jn(r,e,s.slice(0,t),p)}));const d=s.filter((e=>(0,$.isVariadicTypeVar)(e)));if(d.length>1&&mt(g.LocMessage.variadicTypeParamTooManyAlias().format({names:d.map((e=>`"${e.details.name}"`)).join(", ")}),n),!a&&!r){const e=s.filter((e=>e.scopeId!==p&&0===e.scopeType));e.length>0&&mt(g.LocMessage.genericTypeAliasBoundTypeVar().format({names:e.map((e=>`${e.details.name}`)).join(", ")}),n)}const u=v.getFileInfo(t);let m=$.TypeBase.cloneForTypeAlias(e,t.value,F.getClassFullName(t,u.moduleName,t.value),u.moduleName,u.fileUri,p,a,s.length>0?s:void 0);if(a||r){const e=st(n,"TypeAliasType");e&&(0,$.isInstantiableClass)(e)&&(m=$.TypeBase.cloneAsSpecialForm(m,$.ClassType.cloneAsInstance(e)))}return m}function qn(e,t,n){var a;const r=v.getFileInfo(e);let s=$.ClassType.createInstantiable(t,F.getClassFullName(e,r.moduleName,t),r.moduleName,r.fileUri,3,0,void 0,void 0);if(n.isSpecialForm&&(s.details.flags|=-2147483648),void 0!==n.typeParamVariance){let a=$.TypeVarType.createInstance("T");a=$.TypeVarType.cloneForScopeId(a,F.getScopeIdForNode(e),t,0),a.details.declaredVariance=n.typeParamVariance,s.details.typeParameters.push(a)}const i=null!==(a=v.getDeclaration(e))&&void 0!==a?a:e.parent?v.getDeclaration(e.parent):void 0;s.details.declaration=i,r.isTypingExtensionsStubFile&&(s.details.flags|=131072);const o=n.alias||"object";let l;if("builtins"===n.module)l=Fa(e,o);else if("collections"===n.module)l=ot(e,o,["collections"]);else if("self"===n.module){const t=Ma(e,o,!1);t&&(l=Ga(t.symbol),(0,$.isInstantiableClass)(l)&&$.ClassType.isBuiltIn(l,"_TypedDict")&&(l=$.ClassType.cloneWithNewFlags(l,-268437505&l.details.flags)))}return l&&(0,$.isInstantiableClass)(l)?n.alias?s=$.ClassType.cloneForTypingAlias(l,t):(s.details.baseClasses.push(l),s.details.effectiveMetaclass=l.details.effectiveMetaclass,(0,W.computeMroLinearization)(s)):(s.details.baseClasses.push($.UnknownType.create()),s.details.effectiveMetaclass=$.UnknownType.create(),(0,W.computeMroLinearization)(s)),s}function Wn(e){var t;const n=v.getFileInfo(e);if(Pe(e))return;let a=0;n.isStubFile&&(a|=1),38!==e.rightExpression.nodeType&&35!==e.rightExpression.nodeType||(a|=2),Xe(e.leftExpression)&&(a|=131560,a&=-3);let r,s=Ne(e.rightExpression,a),i=!1;if(!s&&((n.isTypingStubFile||n.isTypingExtensionsStubFile)&&(s=function(e){if(38!==e.leftExpression.nodeType)return;const t=e.leftExpression.value;if("Any"===t)return $.AnyType.createSpecialForm();const n=new Map([["overload",{alias:"",module:"builtins"}],["TypeVar",{alias:"",module:"builtins"}],["_promote",{alias:"",module:"builtins"}],["no_type_check",{alias:"",module:"builtins"}],["NoReturn",{alias:"",module:"builtins"}],["Never",{alias:"",module:"builtins"}],["Counter",{alias:"Counter",module:"collections"}],["List",{alias:"list",module:"builtins"}],["Dict",{alias:"dict",module:"builtins"}],["DefaultDict",{alias:"defaultdict",module:"collections"}],["Set",{alias:"set",module:"builtins"}],["FrozenSet",{alias:"frozenset",module:"builtins"}],["Deque",{alias:"deque",module:"collections"}],["ChainMap",{alias:"ChainMap",module:"collections"}],["OrderedDict",{alias:"OrderedDict",module:"collections"}]]).get(t);return n?(Be(e.rightExpression),qn(e,t,n)):void 0}(e),s&&De(e.rightExpression,{type:s},0)),!s)){const o=et(e.leftExpression,{method:"set"});let p,d,u=!1;if(Xe(e.leftExpression))p=e.leftExpression.valueExpression,_r(e.rightExpression)||ht(c.DiagnosticRule.reportInvalidTypeForm,g.LocMessage.typeAliasIllegalExpressionForm(),e.rightExpression);else if(38===e.leftExpression.nodeType){const t=Ma(e.leftExpression,e.leftExpression.value,!1);if(t){const n=t.symbol.getDeclarations();1===n.length&&Gn(n[0])&&(p=e.leftExpression,u=!0)}}if(p){d=$.TypeVarType.createInstantiable(`__type_alias_${p.value}`),d.details.isSynthesized=!0,d.details.recursiveTypeAliasName=p.value;const t=F.getScopeIdForNode(p);d.details.recursiveTypeAliasScopeId=t,d.details.recursiveTypeAliasIsPep695Syntax=!1,d.scopeId=t,De(e,{type:d},void 0),De(e.leftExpression,{type:d},void 0),54===e.leftExpression.nodeType&&De(e.leftExpression.valueExpression,{type:d},void 0)}const m=Be(e.rightExpression,a,(0,W.makeInferenceContext)(o));let y=m.type;r=m.expectedTypeDiagAddendum,m.isIncomplete&&(i=!0);const h=(0,V.evaluateStaticBoolExpression)(e.rightExpression,n.executionEnvironment,n.definedConstants);if(void 0!==h){const t=Ea(e,"bool");(0,$.isClassInstance)(t)&&(y=$.ClassType.cloneWithLiteral(t,h))}s=y,p&&(u&&!Cr(s)||(s=Bn(s,p,p,!1,!1),(0,l.assert)(void 0!==d),(0,W.isTypeAliasRecursive)(d,s)&&(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasIsRecursiveDirect().format({name:p.value}),e.rightExpression),s=$.UnknownType.create()),d.details.boundType=s,d.details.recursiveTypeParameters=null===(t=s.typeAliasInfo)||void 0===t?void 0:t.typeParameters))}kt(e.leftExpression,s,i,e.rightExpression,!0,!0,r),De(e,{type:s,isIncomplete:i},0)}function Gn(e){var t;if(br(e))return!0;if(1===e.type&&e.node.parent&&3===e.node.parent.nodeType&&9===(null===(t=e.node.parent.rightExpression)||void 0===t?void 0:t.nodeType)){const t=e.node.parent.rightExpression.leftExpression;if("TypedDict"===(38===t.nodeType&&t.value)||35===t.nodeType&&"TypedDict"===t.memberName.value&&38===t.leftExpression.nodeType){const e=Be(t,2).type;if((0,$.isInstantiableClass)(e)&&$.ClassType.isBuiltIn(e,"TypedDict"))return!0}}return!1}function Kn(e){var t;return $n(e,e.name,e.expression,!0,null===(t=e.typeParameters)||void 0===t?void 0:t.parameters,(()=>{if(e.typeParameters)return Xn(e.typeParameters)}))}function $n(e,t,n,a,r,s){const i=Ne(t,0);if(i)return i;const o=$.TypeVarType.createInstantiable(`__type_alias_${t.value}`);o.details.isSynthesized=!0,o.details.recursiveTypeAliasName=t.value;const l=F.getScopeIdForNode(t);o.details.recursiveTypeAliasScopeId=l,o.details.recursiveTypeAliasIsPep695Syntax=a,o.scopeId=l,De(t,{type:o},void 0);const p=z.getScopeForNode(e),d=null==p?void 0:p.lookUpSymbolRecursive(t.value),u=v.getDeclaration(e);u&&d&&Ve(d.symbol,u,o);const m=s();o.details.recursiveTypeParameters=m||[];const y=Da(n,{allowForwardReference:!0,enforceTypeAnnotationRules:!0});let h=!1,f=y.type;return y.isIncomplete&&(h=!0),f=Bn(f,t,t,a,!0,m,r),(0,W.isTypeAliasRecursive)(o,f)&&(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeAliasIsRecursiveDirect().format({name:t.value}),n),f=$.UnknownType.create()),o.details.boundType=f,De(t,{type:f,isIncomplete:h},0),f}function Hn(e){if(Pe(e))return;De(e,(0,N.getTypeOfAugmentedAssignment)(Ar,e,void 0),0)}function Zn(e){return`__type_of_${e}`}function Yn(e){je(e);const t=Ne(e.name,0);if(t){if(!(0,$.isInstantiableClass)(t))return;return{classType:t,decoratedType:Ne(e,0)||$.UnknownType.create()}}const n=z.getScopeForNode(e),a=v.getFileInfo(e);let r=0;(5===(null==n?void 0:n.type)||a.isTypingStubFile||a.isTypingExtensionsStubFile||a.isBuiltInStubFile||a.isTypeshedStubFile)&&(r|=1,a.isTypingExtensionsStubFile&&(r|=131072),"property"===e.name.value&&(r|=4096),"tuple"===e.name.value&&(r|=1048576)),a.isStubFile&&(r|=16777216);const s=$.ClassType.createInstantiable(e.name.value,F.getClassFullName(e,a.moduleName,e.name.value),a.moduleName,a.fileUri,r,0,void 0,void 0,F.getDocString(e.suite.statements));s.details.typeVarScopeId=F.getScopeIdForNode(e),Z.has(s.details.fullName)&&(s.includePromotions=!0);const d=null==n?void 0:n.lookUpSymbol(e.name.value);let y;const h=v.getDeclaration(e);h&&(y=h),y&&d&&Ve(d,y,s),s.details.flags|=262144,s.details.declaration=y;try{De(e,{type:s},void 0),De(e.name,{type:s},void 0);let t,n,r=[];e.typeParameters&&(r=Xn(e.typeParameters).map((e=>$.TypeVarType.cloneAsInstance(e))));let i=!1;const d=[];let y,h=289920;if(a.isStubFile&&(h|=4),e.arguments.forEach((o=>{if(2!==o.argumentCategory)if(o.name)if($.ClassType.isTypedDictClass(s))if("total"===o.name.value||"closed"===o.name.value){const t=(0,V.evaluateStaticBoolExpression)(o.valueExpression,a.executionEnvironment,a.definedConstants);void 0===t?mt(g.LocMessage.typedDictBoolParam().format({name:o.name.value}),o.valueExpression):"total"!==o.name.value||t?"closed"===o.name.value&&t&&v.getFileInfo(e).diagnosticRuleSet.enableExperimentalFeatures&&(s.details.flags|=768):s.details.flags|=1024}else mt(g.LocMessage.typedDictInitsubclassParameter().format({name:o.name.value}),o);else"metaclass"===o.name.value?y?mt(g.LocMessage.metaclassDuplicate(),o):y=o.valueExpression:d.push({argumentCategory:0,node:o,name:o.name,valueExpression:o.valueExpression});else{let p;if(1===o.argumentCategory?(Be(o.valueExpression),p=$.UnknownType.create()):(p=Be(o.valueExpression,h).type,(0,$.isTypeVar)(p)&&p.specialForm&&$.TypeBase.isInstance(p.specialForm)&&(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.baseClassInvalid(),o),p=$.UnknownType.create()),p=Ct(p)),(0,$.isUnion)(p)&&(p=(0,$.removeUnbound)(p)),(0,$.isAny)(p)&&p.specialForm&&(p=$.AnyType.create()),(0,$.isAnyOrUnknown)(p)||(0,$.isUnbound)(p)||((0,W.isMetaclassInstance)(p)?((0,l.assert)((0,$.isClassInstance)(p)),p=p.typeArguments&&p.typeArguments.length>0?p.typeArguments[0]:$.UnknownType.create()):(0,$.isInstantiableClass)(p)?(($.ClassType.isPartiallyEvaluated(p)||p.details.mro.some((e=>(0,$.isClass)(e)&&$.ClassType.isPartiallyEvaluated(e))))&&ta(e,p),$.ClassType.isBuiltIn(p,"Protocol")&&(a.isStubFile||$.ClassType.isTypingExtensionClass(p)||!a.executionEnvironment.pythonVersion.isLessThan(u.pythonVersion3_7)||mt(g.LocMessage.protocolIllegal(),o.valueExpression),s.details.flags|=16384),$.ClassType.isBuiltIn(p,"property")&&(s.details.flags|=4096),a.executionEnvironment.pythonVersion.isGreaterOrEqualTo(u.pythonVersion3_6)&&$.ClassType.isBuiltIn(p,"NamedTuple")&&(i=!0,s.details.flags|=33554468),($.ClassType.isBuiltIn(p,"TypedDict")||$.ClassType.isTypedDictClass(p))&&(s.details.flags|=128,$.ClassType.isTypedDictEffectivelyClosed(p)&&(s.details.flags|=512)),(0,W.derivesFromClassRecursive)(p,s,!0)&&(mt(g.LocMessage.baseClassCircular(),o),p=$.UnknownType.create()),p.specialForm&&$.ClassType.isBuiltIn(p.specialForm,"TypeAliasType")&&(mt(g.LocMessage.typeAliasTypeBaseClass(),o),p=$.UnknownType.create())):(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.baseClassInvalid(),o),p=$.UnknownType.create())),(0,$.isUnknown)(p)&&ht(c.DiagnosticRule.reportUntypedBaseClass,g.LocMessage.baseClassUnknown(),o),s.details.baseClasses.some((e=>(0,$.isInstantiableClass)(e)&&(0,$.isInstantiableClass)(p)&&$.ClassType.isSameGenericClass(p,e)))&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.duplicateBaseClass(),o.name||o),s.details.baseClasses.push(p),(0,$.isInstantiableClass)(p)&&($.ClassType.isEnumClass(p)&&(s.details.flags|=2097152),($.ClassType.supportsAbstractMethods(p)||$.ClassType.isProtocolClass(p)&&!$.ClassType.isBuiltIn(p))&&(s.details.flags|=2048),$.ClassType.isPropertyClass(p)&&(s.details.flags|=4096),$.ClassType.isFinal(p))){const e=Ir(p);mt(g.LocMessage.baseClassFinal().format({type:e}),o.valueExpression)}(0,W.addTypeVarsToListIfUnique)(r,(0,W.getTypeVarArgumentsRecursive)(p)),(0,$.isInstantiableClass)(p)&&($.ClassType.isBuiltIn(p,"Generic")?e.typeParameters?ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.genericBaseClassNotAllowed(),o.valueExpression):t||(n&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.duplicateGenericAndProtocolBase(),o.valueExpression),t=[],(0,W.addTypeVarsToListIfUnique)(t,(0,W.getTypeVarArgumentsRecursive)(p))):$.ClassType.isBuiltIn(p,"Protocol")&&p.typeArguments&&p.typeArguments.length>0&&(n||(t&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.duplicateGenericAndProtocolBase(),o.valueExpression),n=[],(0,W.addTypeVarsToListIfUnique)(n,(0,W.getTypeVarArgumentsRecursive)(p)),e.typeParameters&&n.length>0&&(ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.protocolBaseClassWithTypeArgs(),o.valueExpression),n=[]))))}else Be(o.valueExpression)})),s.details.baseClasses.length>1){let t=!1,n=!1;s.details.baseClasses.forEach((e=>{(0,$.isInstantiableClass)(e)&&($.ClassType.isBuiltIn(e,"NamedTuple")?t=!0:$.ClassType.isBuiltIn(e,"Generic")||(n=!0))})),t&&n&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.namedTupleMultipleInheritance(),e.name)}$.ClassType.isBuiltIn(s,"object")||0!==s.details.baseClasses.filter((e=>(0,$.isClass)(e))).length||s.details.baseClasses.push(Fa(e,"object")),t=null!=t?t:n,t&&!e.typeParameters&&function(e,t,n){const a=t.filter((e=>!n.some((t=>t.details.name===e.details.name))));if(a.length>0){const t=new p.DiagnosticAddendum;t.addMessage(g.LocAddendum.typeVarsMissing().format({names:a.map((e=>`"${e.details.name}"`)).join(", ")})),ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarsNotInGenericOrProtocol()+t.getString(),e)}}(e.name,r,t),s.details.typeParameters=null!=t?t:r,s.details.typeParameters.some((e=>0===e.details.declaredVariance&&void 0===e.computedVariance))&&(s.details.requiresVarianceInference=!0);const T=r.filter((e=>(0,$.isVariadicTypeVar)(e)));if(T.length>1)ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.variadicTypeParamTooManyClass().format({names:T.map((e=>`"${e.details.name}"`)).join(", ")}),e.name,m.TextRange.combine(e.arguments)||e.name);else if(T.length>0){const t=s.details.typeParameters.findIndex((e=>(0,$.isVariadicTypeVar)(e))),n=s.details.typeParameters.findIndex(((e,n)=>n>t&&!e.details.isParamSpec&&e.details.isDefaultExplicit));n>=0&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarWithDefaultFollowsVariadic().format({typeVarName:r[n].details.name,variadicName:r[t].details.name}),e.typeParameters?e.typeParameters.parameters[n].name:e.name)}s.details.typeParameters.forEach(((t,n)=>{var a;let r=e.name;if(e.typeParameters&&n<e.typeParameters.parameters.length){const t=e.typeParameters.parameters[n];r=null!==(a=t.defaultExpression)&&void 0!==a?a:t.name}Jn(r,t,s.details.typeParameters.slice(0,n),s.details.typeVarScopeId)})),(0,W.computeMroLinearization)(s)||ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.methodOrdering(),e.name);const b=z.getScopeForNode(e.suite);s.details.fields=(null==b?void 0:b.symbolTable)?new Map(b.symbolTable):new Map,s.details.fields.has("__eq__")&&!s.details.fields.has("__hash__")&&s.details.fields.set("__hash__",U.Symbol.createWithType(4292,rt()));const _=null==b?void 0:b.getSlotsNames();if(_&&(s.details.localSlotsNames=_),!a.isStubFile&&0===s.details.typeParameters.length){const t=s.details.fields.get("__init__");if(t){const n=t.getTypedDeclarations();if(1===n.length&&5===n[0].type){const t=n[0].node,a=t.parameters;if(a.length>1&&!a.some(((e,n)=>!!F.getTypeAnnotationForParameter(t,n)))){const n=a.filter(((e,t)=>t>0&&e.name&&0===e.category&&!e.defaultValue));n.length>0&&(s.details.flags|=32768,s.details.typeParameters=n.map((n=>{const a=$.TypeVarType.createInstance(Zn(n.name.value));return a.details.isSynthesized=!0,a.scopeId=F.getScopeIdForNode(t),a.details.boundType=$.UnknownType.create(),$.TypeVarType.cloneForScopeId(a,F.getScopeIdForNode(e),e.name.value,0)})))}}}}if(0!==s.details.typeParameters.length||$.ClassType.isBuiltIn(s,"type")||(s.details.baseClasses.some((e=>(0,$.isInstantiableClass)(e)&&$.ClassType.hasCustomClassGetItem(e)))||s.details.fields.has("__class_getitem__"))&&(s.details.flags|=524288),y){const e=Be(y,h).type;((0,$.isInstantiableClass)(e)||(0,$.isUnknown)(e))&&((0,W.requiresSpecialization)(e,{ignorePseudoGeneric:!0})&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.metaclassIsGeneric(),y),s.details.declaredMetaclass=e,(0,$.isInstantiableClass)(e)&&((0,A.isEnumMetaclass)(e)&&(s.details.flags|=2097152),$.ClassType.isBuiltIn(e,"ABCMeta")&&(s.details.flags|=2048)))}const C=ea(s,e.name);s.details.flags&=-262145;let I,w=s,x=!1;for(let t=e.decorators.length-1;t>=0;t--){const n=e.decorators[t],a=(0,S.applyClassDecorator)(Ar,w,s,n),r=(0,W.containsAnyOrUnknown)(a,!1);r&&(0,$.isUnknown)(r)?x||(ht(c.DiagnosticRule.reportUntypedClassDecorator,g.LocMessage.classDecoratorTypeUnknown(),e.decorators[t].expression),x=!0):w=a}if((0,$.isInstantiableClass)(C)&&C.details.classDataClassTransform)I=C.details.classDataClassTransform;else{const e=s.details.mro.find((e=>(0,$.isClass)(e)&&void 0!==e.details.classDataClassTransform&&!$.ClassType.isSameGenericClass(e,s)));e&&(I=e.details.classDataClassTransform)}if(I&&((0,k.applyDataClassDefaultBehaviors)(s,I),(0,k.applyDataClassClassBehaviorOverrides)(Ar,e.name,s,d,I)),f=s,Ce.forEach((e=>{$.ClassType.isSameGenericClass(e.dependsUpon,f)&&e.classesToComplete.forEach((e=>{const t=Ne(e.name,0);t&&function(e,t){(0,W.computeMroLinearization)(e)||mt(g.LocMessage.methodOrdering(),t),ea(e,t)}(t,e.name)}))})),Ce=Ce.filter((e=>!$.ClassType.isSameGenericClass(e.dependsUpon,f))),ta(e,void 0),$.ClassType.isTypedDictClass(s)){let t=!1;const n=new p.DiagnosticAddendum;s.details.baseClasses.forEach((e=>{!(0,$.isClass)(e)||$.ClassType.isTypedDictClass(e)||$.ClassType.isBuiltIn(e,["_TypedDict","Generic"])||(t=!0,n.addMessage(g.LocAddendum.typedDictBaseClass().format({type:e.details.name})))})),t&&mt(g.LocMessage.typedDictBaseClass()+n.getString(),e.name),(0,K.synthesizeTypedDictClassMethods)(Ar,e,s)}if($.ClassType.isDataClass(s)){const t=$.ClassType.isSkipSynthesizedDataClassInit(s);let n=t;if(!t){const e=s.details.fields.get("__init__");e&&e.isClassMember()&&(n=!0)}let a=!1;const r=s.details.fields.get("__hash__");r&&r.isClassMember()&&!r.getSynthesizedType()&&(a=!0);const o=()=>(0,k.synthesizeDataClassMethods)(Ar,e,s,i,t,n,a);i?o():s.details.synthesizeMethodsDeferred=()=>{delete s.details.synthesizeMethodsDeferred,o()}}return s.details.calculateInheritedSlotsNamesDeferred=()=>{if(delete s.details.calculateInheritedSlotsNamesDeferred,s.details.localSlotsNames){let e=!0;const t=Array.from(s.details.localSlotsNames);s.details.baseClasses.forEach((n=>{if((0,$.isInstantiableClass)(n)){if(!$.ClassType.isBuiltIn(n,"object")&&!$.ClassType.isBuiltIn(n,"type")&&!$.ClassType.isBuiltIn(n,"Generic")){const a=$.ClassType.getInheritedSlotsNames(n);a?(0,o.appendArray)(t,a):e=!1}}else e=!1})),e&&(s.details.inheritedSlotsNamesCached=t)}},De(e.name,{type:s},0),De(e,{type:w},0),{classType:s,decoratedType:w}}catch(e){throw i.OperationCanceledException.is(e)&&(e.isTypeCacheInvalid=!0),e}var f}function Jn(e,t,n,a){if(!t.details.isDefaultExplicit&&!t.details.isSynthesized&&!t.details.isSynthesizedSelf){const r=n.find((e=>e.details.isDefaultExplicit&&e.scopeId===a));return void(r&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarWithoutDefault().format({name:t.details.name,other:r.details.name}),e))}const r=new Set;if((0,W.validateTypeVarDefault)(t,n,r),r.size>0){const n=new p.DiagnosticAddendum;r.forEach((e=>{n.addMessage(g.LocAddendum.typeVarDefaultOutOfScope().format({name:e}))})),ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.typeVarDefaultInvalidTypeVar().format({name:t.details.name})+n.getString(),e)}}function Qn(e){if(!e.details.requiresVarianceInference)return;if(!ae||!(0,$.isClassInstance)(ae))return;e.details.requiresVarianceInference=!1,e.details.typeParameters.forEach((e=>{0===e.details.declaredVariance&&(e.computedVariance=1)}));const t=$.ClassType.createInstantiable("__varianceDummy","","",y.Uri.empty(),0,0,void 0,void 0);e.details.typeParameters.forEach(((n,a)=>{if(n.details.isVariadic||n.details.isParamSpec)return;if(0!==n.details.declaredVariance)return;const r=e.details.typeParameters.map(((e,n)=>e.details.isVariadic?e:((0,l.assert)(void 0!==ae),n===a?ae:t))),s=e.details.typeParameters.map(((e,n)=>n===a||e.details.isVariadic?e:t)),i=$.ClassType.cloneForSpecialization(e,r,!0),o=$.ClassType.cloneForSpecialization(e,s,!0);let p;if(er(i,o,3,!1))p=3;else{p=er(o,i,4,!1)?4:2}e.details.typeParameters[a].computedVariance=p}))}function Xn(e){const t=[],n=v.getScope(e);return e.parameters.forEach((e=>{var a;const r=null==n?void 0:n.symbolTable.get(e.name.value);if(!r)return;const s=null===(a=$a(r,e.name))||void 0===a?void 0:a.type;s&&(0,$.isTypeVar)(s)&&(De(e.name,{type:s},0),t.push(s))})),t}function ea(e,t){let n=e.details.declaredMetaclass,a=!1;if(!n||(0,$.isInstantiableClass)(n))for(const r of e.details.baseClasses){if(!(0,$.isInstantiableClass)(r)){n=$.UnknownType.create();break}{const e=r.details.effectiveMetaclass||re;if(!e||!(0,$.isInstantiableClass)(e)){n=e?$.UnknownType.create():void 0;break}if(n){if((0,W.derivesFromClassRecursive)(e,n,!1))n=e;else if(!(0,W.derivesFromClassRecursive)(n,e,!1)&&!a){const r=new p.DiagnosticAddendum;r.addMessage(g.LocAddendum.metaclassConflict().format({metaclass1:wr((0,W.convertToInstance)(n)),metaclass2:wr((0,W.convertToInstance)(e))})),ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.metaclassConflict()+r.getString(),t),a=!0}}else n=e}}if(!n){const e=Fa(t,"type");n=e&&(0,$.isInstantiableClass)(e)?e:$.UnknownType.create()}return e.details.effectiveMetaclass=n,n}function ta(e,t){if(t){const n=Ce.find((e=>$.ClassType.isSameGenericClass(e.dependsUpon,t)));n?n.classesToComplete.push(e):Ce.push({dependsUpon:t,classesToComplete:[e]})}else Ce.forEach((t=>{t.classesToComplete.push(e)}))}function na(e,t){var n,a;const r=[];e.arguments.forEach((e=>{e.name&&"metaclass"!==e.name.value&&r.push({argumentCategory:0,node:e,name:e.name,valueExpression:e.valueExpression})}));const s=r.length>0&&null!==(a=null===(n=r[0].node)||void 0===n?void 0:n.name)&&void 0!==a?a:e.name;let i;if(t.details.effectiveMetaclass&&(0,$.isClass)(t.details.effectiveMetaclass)){$.ClassType.isBuiltIn(t.details.effectiveMetaclass,["ABCMeta","type"])&&!$.ClassType.isTypedDictClass(t)||(i=(0,W.lookUpClassMember)(t.details.effectiveMetaclass,"__new__",8))}if(i){const e=Ja(i);if((0,$.isFunction)(e)){const t=(0,D.getParameterListDetails)(e);if(void 0!==t.firstKeywordOnlyIndex){const n=new Map;for(let e=t.firstKeywordOnlyIndex;e<t.params.length;e++){const a=t.params[e];0===a.param.category&&a.param.name&&n.set(a.param.name,e)}r.forEach((a=>{var r,i,o;const l=new W.UniqueSignatureTracker;if(0===a.argumentCategory&&a.name){const p=null!==(r=n.get(a.name.value))&&void 0!==r?r:t.kwargsIndex;if(void 0!==p){const r=t.params[p];sn({paramCategory:r.param.category,paramType:r.type,requiresTypeVarMatching:!1,argument:a,errorNode:null!==(i=a.valueExpression)&&void 0!==i?i:s},new G.TypeVarContext,l,{type:e},{skipUnknownArgCheck:!0,skipOverloadArg:!0}),n.delete(a.name.value)}else ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.paramNameMissing().format({name:a.name.value}),null!==(o=a.name)&&void 0!==o?o:s)}}));const a=[];if(n.forEach(((e,n)=>{t.params[e].param.hasDefault||a.push(n)})),a.length>0){const e=a.map((e=>`"${e}"`)).join(", ");ht(c.DiagnosticRule.reportGeneralTypeIssues,1===a.length?g.LocMessage.argMissingForParam().format({name:e}):g.LocMessage.argMissingForParams().format({names:e}),s)}}}}else{const n=Ye(s,t,"__init_subclass__",void 0,void 0,545);if(n){const t=n.type;if(t&&n.classType){if(Zt(s,r,{type:t},void 0,!1,(0,W.makeInferenceContext)(rt()),void 0).argumentErrors){const a=ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.initSubclassCallFailed(),e.name),r=(0,$.isOverloadedFunction)(t)?$.OverloadedFunctionType.getOverloads(t)[0]:t,s=(0,$.isFunction)(r)?r.details.declaration:void 0;a&&s&&a.addRelatedInfo(g.LocAddendum.initSubclassLocation().format({name:wr((0,W.convertToInstance)(n.classType))}),s.uri,s.range)}}}}r.forEach((e=>{e.valueExpression&&Be(e.valueExpression)}))}function aa(e){je(e);let t=Ne(e.name,0);if(t){if(!(0,$.isFunction)(t))return;if($.FunctionType.isPartiallyEvaluated(t))return{functionType:t,decoratedType:t}}else t=ra(e);let n=Ne(e,0);if(n)return{functionType:t,decoratedType:n};De(e,{type:t},void 0),t.details.flags|=131072;const a=e.isAsync?function(e,t){(0,l.assert)($.FunctionType.isAsync(t));const n=$.FunctionType.cloneWithNewFlags(t,-131585&t.details.flags);t.details.declaredReturnType?n.details.declaredReturnType=ca(e,t.details.declaredReturnType,$.FunctionType.isGenerator(t)):n.inferredReturnType=ca(e,Sr(t),$.FunctionType.isGenerator(t));return n}(e,t):t;t.details.flags&=-131073,n=a;let r=!1;for(let a=e.decorators.length-1;a>=0;a--){const s=e.decorators[a],i=(0,S.applyFunctionDecorator)(Ar,n,t,s,e),o=(0,W.containsAnyOrUnknown)(i,!1);o&&(0,$.isUnknown)(o)?r||(ht(c.DiagnosticRule.reportUntypedFunctionDecorator,g.LocMessage.functionDecoratorTypeUnknown(),e.decorators[a].expression),r=!0):n=i}return(0,$.isFunction)(n)&&(n.details.deprecatedMessage=t.details.deprecatedMessage,$.FunctionType.isOverloaded(n)&&e.parameters.forEach((e=>{sa(e)})),n=(0,S.addOverloadsToFunctionType)(Ar,e,n)),De(e,{type:n},0),{functionType:t,decoratedType:n}}function ra(e){var t,n,a;const r=v.getFileInfo(e),s=Ne(e.name,0);if(s&&(0,$.isFunction)(s))return s;let i;const o=v.getDeclaration(e);o&&(i=o);const l=F.getEnclosingClass(e,!0);let d;l&&(d=null===(t=Yn(l))||void 0===t?void 0:t.classType);const u=(0,S.getFunctionInfoFromDecorators)(Ar,e,!!l);let m=u.flags;(null==i?void 0:i.isGenerator)&&(m|=16),r.isStubFile?m|=2048:r.isInPyTypedPackage&&(m|=4096),e.isAsync&&(m|=512);const y=$.FunctionType.createInstance(e.name.value,function(e,t,n){const a=[n];let r=e;for(;r;)r=F.getEnclosingClassOrFunction(r),r&&a.push(r.name.value);return a.push(t),a.reverse().join(".")}(e,r.moduleName,e.name.value),r.moduleName,131072|m,F.getDocString(e.suite.statements));y.details.typeVarScopeId=F.getScopeIdForNode(e),y.details.deprecatedMessage=u.deprecationMessage,y.details.methodClass=d,"__init__"!==e.name.value&&"__new__"!==e.name.value||l&&(y.details.constructorTypeVarScopeId=F.getScopeIdForNode(l)),(r.isBuiltInStubFile||r.isTypingStubFile||r.isTypingExtensionsStubFile)&&(y.details.builtInName=e.name.value),y.details.declaration=i;const h=z.getScopeForNode(e),f=null==h?void 0:h.lookUpSymbolRecursive(e.name.value);i&&f&&Ve(f.symbol,i,y),De(e.name,{type:y},void 0);const T=d&&$.ClassType.isPseudoGenericClass(d)&&"__init__"===e.name.value,b=[];let _=0;if(d&&0==(4&y.details.flags)&&(_=1),e.functionAnnotationComment&&!e.functionAnnotationComment.isParamListEllipsis){const t=e.parameters.length-_,n=e.functionAnnotationComment.paramTypeAnnotations.length;_>0&&n===e.parameters.length?_=0:n!==t&&mt(g.LocMessage.annotatedParamCountMismatch().format({expected:t,received:n}),e.functionAnnotationComment)}const C=[];e.typeParameters?y.details.typeParameters=Xn(e.typeParameters).map((e=>(0,W.convertToInstance)(e))):y.details.typeParameters=C;let I=!0;const k=d&&($.FunctionType.isClassMethod(y)||$.FunctionType.isInstanceMethod(y)||$.FunctionType.isConstructorMethod(y)),w=k?1:0;if(e.parameters.forEach(((t,n)=>{let a,s,i,o;if(t.name&&(0===n&&k||$.FunctionType.isAbstractMethod(y)||d&&$.ClassType.isProtocolClass(d))&&sa(t),t.typeAnnotation)i=t.typeAnnotation;else if(t.typeAnnotationComment)i=t.typeAnnotationComment;else if(e.functionAnnotationComment&&!e.functionAnnotationComment.isParamListEllipsis){const t=n-_;t>=0&&t<e.functionAnnotationComment.paramTypeAnnotations.length&&(i=e.functionAnnotationComment.paramTypeAnnotations[t])}if(i&&(s=0!=(524288&u.flags)?$.UnknownType.create():Ke(i,t.category),s&&(0,W.addTypeVarsToListIfUnique)(C,(0,W.getTypeVarArgumentsRecursive)(s),y.details.typeVarScopeId),(0,$.isVariadicTypeVar)(s)&&!s.isVariadicUnpacked&&(mt(g.LocMessage.unpackedTypeVarTupleExpected().format({name1:s.details.name,name2:s.details.name}),i),s=$.UnknownType.create())),!s&&T&&n>0&&0===t.category&&t.name&&!t.defaultValue){const e=Zn(t.name.value);s=d.details.typeParameters.find((t=>t.details.name===e))}if(s){const e=ia(t,s);e!==s&&(s=e)}if(t.defaultValue){let n=r.isStubFile||F.isSuiteEmpty(e.suite);d&&$.ClassType.isProtocolClass(d)&&(n=!0),($.FunctionType.isOverloaded(y)||$.FunctionType.isAbstractMethod(y))&&(n=!0),o=Be(t.defaultValue,n?1:0,(0,W.makeInferenceContext)(s)).type}if(s){if(t.defaultValue&&o){const n=new p.DiagnosticAddendum,a=new G.TypeVarContext(y.details.typeVarScopeId);d&&void 0!==d.details.typeVarScopeId&&("__init__"!==e.name.value&&"__new__"!==e.name.value||a.addSolveForScope(d.details.typeVarScopeId)),nr(s,o,n,a)||ht(c.DiagnosticRule.reportArgumentType,g.LocMessage.paramAssignmentMismatch().format({sourceType:wr(o),paramType:wr(s)})+n.getString(),t.defaultValue)}a=s}if(n>=w){let n=!1;0===t.category&&t.name?(0,R.isPrivateName)(t.name.value)&&!e.parameters.some((e=>0===e.category&&!e.name))&&(n=!0,!I&&y.details.parameters.every((e=>0===e.category))&&ht(c.DiagnosticRule.reportGeneralTypeIssues,g.LocMessage.positionOnlyAfterNon(),t.name)):I=!1,I&&!n&&y.details.parameters.length>w&&$.FunctionType.addPositionOnlyParameterSeparator(y),n||(I=!1)}let l=!1;if(!i){l=!0;const t=oa(e,y.details.flags,n,d);t&&(a=t)}const m={category:t.category,name:t.name?t.name.value:void 0,hasDefault:!!t.defaultValue,defaultValueExpression:t.defaultValue,defaultType:o,type:null!=a?a:$.UnknownType.create(),typeAnnotation:i,hasDeclaredType:!!i,isTypeInferred:l};if($.FunctionType.addParameter(y,m),m.hasDeclaredType&&(0,W.addTypeVarsToListIfUnique)(C,(0,W.getTypeVarArgumentsRecursive)(m.type),y.details.typeVarScopeId),t.name){const n=pa(e,t.category,m.type);b.push(n)}else b.push(m.type)})),I&&y.details.parameters.length>w&&$.FunctionType.addPositionOnlyParameterSeparator(y),b.forEach(((t,n)=>{const a=e.parameters[n].name;a&&((0,$.isUnknown)(t)&&(y.details.flags|=16384),De(a,{type:t},0))})),b.length>=2){const e=b[b.length-2],t=b[b.length-1];(0,$.isParamSpec)(e)&&"args"===e.paramSpecAccess&&(0,$.isParamSpec)(t)&&"kwargs"===t.paramSpecAccess&&(y.details.flags|=32768)}y.details.parameters.filter((e=>0!==e.category&&e.name&&(0,$.isAnyOrUnknown)(e.type))).length>=2&&(y.details.flags|=32768);const A=null!==(n=e.returnTypeAnnotation)&&void 0!==n?n:null===(a=e.functionAnnotationComment)||void 0===a?void 0:a.returnTypeAnnotation;if(A){y.details.declaredReturnType=$.UnknownType.create();const e=$e(A,{associateTypeVarsWithScope:!0});y.details.declaredReturnType=e}else r.isStubFile&&("__init__"===e.name.value?y.details.declaredReturnType=rt():y.details.declaredReturnType=$.UnknownType.create());return y.details.declaredReturnType&&A&&(0,W.addTypeVarsToListIfUnique)(C,(0,W.getTypeVarArgumentsRecursive)(y.details.declaredReturnType),y.details.typeVarScopeId),(r.isStubFile||F.isSuiteEmpty(e.suite))&&y.details.declaredReturnType&&(0,$.isClassInstance)(y.details.declaredReturnType)&&$.ClassType.isBuiltIn(y.details.declaredReturnType,["Generator","AsyncGenerator","AwaitableGenerator"])&&(y.details.flags|=16),y.details.typeParameters.forEach(((t,n)=>{var a;let r=e.name;if(e.typeParameters&&n<e.typeParameters.parameters.length){const t=e.typeParameters.parameters[n];r=null!==(a=t.defaultExpression)&&void 0!==a?a:t.name}Jn(r,t,y.details.typeParameters.slice(0,n),y.details.typeVarScopeId)})),y.details.flags&=-131073,De(e.name,{type:y},0),y}function sa(e){if(e.name){const t=Ma(e.name,e.name.value,!1);t&&St(v.getFileInfo(e),t.symbol,e.name)}}function ia(e,t){var n;return 11!==(null===(n=e.defaultValue)||void 0===n?void 0:n.nodeType)||26!==e.defaultValue.constType||(0,W.isOptionalType)(t)||v.getFileInfo(e).diagnosticRuleSet.strictParameterNoneValue?t:(0,$.combineTypes)([t,rt()])}function oa(e,t,n,a){var r;if(a){if(0===n&&0==(4&t)){const e=0!=(3&t);return(0,W.synthesizeTypeVarForSelfCls)(a,e)}const s=e.name.value,i=(0,W.lookUpClassMember)(a,s,1);if(i){const t=i.symbol.getDeclarations();if(1===t.length&&5===t[0].type){const a=t[0].node;if(a.parameters.length===e.parameters.length&&a.parameters.every(((t,n)=>{var a,r;const s=e.parameters[n];return(null===(a=s.name)||void 0===a?void 0:a.value)===(null===(r=t.name)||void 0===r?void 0:r.value)&&s.category===t.category}))){const t=a.parameters[n],s=null!==(r=t.typeAnnotation)&&void 0!==r?r:t.typeAnnotationComment;if(s){let t=Ke(s,e.parameters[n].category);if((0,W.requiresSpecialization)(t)&&(0,$.isClass)(i.classType)){const e=(0,W.buildTypeVarContextFromSpecializedClass)(i.classType);e.addSolveForScope(F.getScopeIdForNode(a)),t=(0,W.applySolvedTypeVars)(t,e,{unknownIfNotFound:!0})}const r=v.getFileInfo(e);return r.isInPyTypedPackage&&!r.isStubFile&&(t=$.TypeBase.cloneForAmbiguousType(t)),t}}}}}const s=e.parameters[n].defaultValue;if(s)return la(s)}function la(e){const t=Be(e,1).type;let n;if((0,W.isNoneInstance)(t)||(0,$.isClassInstance)(t)&&(0,R.isPrivateOrProtectedName)(t.details.name))n=(0,$.combineTypes)([t,$.UnknownType.create()]);else{let e=!1;((0,$.isFunction)(t)||(0,$.isOverloadedFunction)(t)||(0,$.isClassInstance)(t)&&$.ClassType.isBuiltIn(t,["tuple","list","set","dict"]))&&(e=!0),e||(n=Ge(t))}if(n){const t=v.getFileInfo(e);t.isInPyTypedPackage&&!t.isStubFile&&(n=$.TypeBase.cloneForAmbiguousType(n))}return n}function pa(e,t,n){switch(t){case 0:return n;case 1:return(0,$.isTypeVar)(n)&&n.paramSpecAccess?n:(0,$.isUnpackedClass)(n)?$.ClassType.cloneForUnpacked(n,!1):zt([{type:n,isUnbounded:!(0,$.isVariadicTypeVar)(n)}]);case 2:{if((0,$.isTypeVar)(n)&&n.paramSpecAccess)return n;if((0,$.isClassInstance)(n)&&$.ClassType.isTypedDictClass(n)&&n.isUnpacked)return n;const t=Fa(e,"dict"),a=Ea(e,"str");return(0,$.isInstantiableClass)(t)&&(0,$.isClassInstance)(a)?$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(t,[a,n],!0)):$.UnknownType.create()}}}function ca(e,t,n,a=!0){let r;if((0,$.isClassInstance)(t)&&$.ClassType.isBuiltIn(t))if("Generator"===t.details.name){const n=st(e,"AsyncGenerator");if(n&&(0,$.isInstantiableClass)(n)){const e=[],a=t.typeArguments;a&&a.length>0&&e.push(a[0]),a&&a.length>1&&e.push(a[1]),r=$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(n,e,!0))}}else["AsyncGenerator","AsyncIterator","AsyncIterable"].some((e=>e===t.details.name))&&(r=t);if(!r||!n){const n=st(e,a?"Coroutine":"Awaitable");r=n&&(0,$.isInstantiableClass)(n)?$.ClassType.cloneAsInstance($.ClassType.cloneForSpecialization(n,a?[$.AnyType.create(),$.AnyType.create(),t]:[t],!0)):$.UnknownType.create()}return r}function da(e,t){var n;if(e.returnTypeAnnotation||(null===(n=e.functionAn